/*!
 *  build: 杭州数蛙科技有限公司 
 *  copyright: dgiot-dashboard 
 *  author: h7ml(h7ml@qq.com) 
 *  Time: 2022-01-13 11:36:25
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-494de57d"],{"00c5":function(e,t,a){e.exports=a.p+"static/img/personal_video_black_24dp.a490dea5.svg"},"0471":function(e,t,a){"use strict";a("f20e")},"08e9":function(e,t,a){e.exports=a.p+"static/img/timeline_black_24dp.15b1384c.svg"},"0c3c":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{key:e.queryForm.key,staticClass:"comprehensive-table-container"},[a("vab-query-form",[a("vab-query-form-top-panel",[a("el-form",{ref:"form",attrs:{inline:!0,"label-width":"49px",model:e.queryForm,size:"mini"}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.Table Name")}},[a("el-input",{attrs:{size:"mini"},model:{value:e.queryForm.class,callback:function(t){e.$set(e.queryForm,"class",t)},expression:"queryForm.class"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.title")}},[a("el-input",{model:{value:e.queryForm.title,callback:function(t){e.$set(e.queryForm,"title",t)},expression:"queryForm.title"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("rule.Type")}},[a("el-input",{model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),a("el-form-item",{attrs:{label:"key"}},[a("el-input",{model:{value:e.queryForm.key,callback:function(t){e.$set(e.queryForm,"key",t)},expression:"queryForm.key"}})],1),a("el-form-item",{attrs:{label:"id"}},[a("el-input",{attrs:{size:"mini"},model:{value:e.queryForm.objectId,callback:function(t){e.$set(e.queryForm,"objectId",t)},expression:"queryForm.objectId"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},on:{click:e.handleAdd}}),a("el-button",{attrs:{icon:"el-icon-search",type:"success"},on:{click:function(t){return e.fetchData()}}})],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list}},[a("el-table-column",{attrs:{align:"center",label:"序号","show-overflow-tooltip":"",width:"55"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.$index;return[e._v(" "+e._s(a+1)+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:"objectId",prop:"objectId","show-overflow-tooltip":""}}),a("el-table-column",{directives:[{name:"show",rawName:"v-show",value:!e.queryForm.hiddenRow.includes("title"),expression:"!queryForm.hiddenRow.includes('title')"}],attrs:{align:"center",label:e.$translateTitle("product.title"),prop:"title","show-overflow-tooltip":""}}),a("el-table-column",{directives:[{name:"show",rawName:"v-show",value:!e.queryForm.hiddenRow.includes("class"),expression:"!queryForm.hiddenRow.includes('class')"}],attrs:{align:"center",label:e.$translateTitle("product.Table Name"),prop:"class","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{align:"center",label:"key",prop:"key","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("rule.Type"),prop:"type","show-overflow-tooltip":""}}),a("el-table-column",{directives:[{name:"show",rawName:"v-show",value:!e.queryForm.hiddenRow.includes("createdAt"),expression:"!queryForm.hiddenRow.includes('createdAt')"}],attrs:{align:"center",label:e.$translateTitle("application.createtime"),prop:"createdAt","show-overflow-tooltip":"",width:"140"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("node.operation"),"show-overflow-tooltip":"",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return[a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleLowCode(o.objectId)}}},[e._v(" "+e._s(e.$translateTitle("application.preview"))+" ")]),a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleEdit(o)}}},[e._v(" "+e._s(e.$translateTitle("product.Design"))+" ")]),a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDelete(o)}}},[e._v(" "+e._s(e.$translateTitle("task.Delete"))+" ")])]}}])})],1),a("vab-parser-pagination",{attrs:{pagination:e.paginations,"query-payload":e.queryPayload},on:{pagination:e.fetchData,paginationQuery:e.paginationQuery}}),a("view-edit",{ref:"edit",on:{"fetch-data":e.fetchData}}),a("lowcodeDesign",{ref:"lowcodeDesign",on:{objectId:e.lowcodeId}})],1)},i=[],s=a("fb07"),r=a("e97b"),n=a("d0d7"),l=a.n(n),c=(a("f764"),a("3eb0"),a("3dec"),a("9c6a"),a("5880")),d=a("209d"),u=a("8ba7"),p=a("eb54"),m={class:"",type:"",title:"",key:"",data:{type:"page",initApi:{url:"iotapi/classes/Device/parse_objectid",method:"get",adaptor:'return {\r\n  "status":0,\r\n  "msg":"",\r\n  "data":response.data.basedata\r\n  }',headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json"},body:[{type:"form",api:{method:"put",url:"iotapi/classes/Device/parse_objectid",headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json",requestAdaptor:"return {\r\n    ...api,\r\n    data: {\r\n        basedata:{ ...api.data}\r\n    }\r\n}"},body:[{type:"input-text",label:"设备名称",name:"name"}]}]},disabled:!1,hiddenRow:[]},b={name:"ComprehensiveTable",components:{ViewEdit:p["default"],lowcodeDesign:d["default"]},filters:{statusFilter:function(e){var t={published:"success",draft:"gray",deleted:"danger"};return t[e]}},props:{viewForm:{required:!1,type:Object,default:function(){return m}}},data:function(){return{lowcodeId:"",paginations:{pageSizes:[5,10,20,50,100,200,500],layout:"total, sizes, prev, pager, next, jumper",background:!0,hidden:!1,small:!1,pageSize:10,total:0,pageCount:0,pagerCount:7,currentPage:1,popperClass:"",prevText:"",nextText:"",disabled:!1,hideOnSinglePage:!1},queryPayload:{excludeKeys:"data",include:"",order:"-updatedAt",limit:10,skip:0,count:"objectId"},queryForm:this.viewForm,list:[],imageList:[],listLoading:!0,selectRows:""}},created:function(){this.setTreeFlag(!1),this.fetchData()},mounted:function(){var e=this;this.$dgiotBus.$off("saveLowCode"),this.$dgiotBus.$on("saveLowCode",(function(t){e.saveLowCode(t.id,t.data)}))},methods:Object(r["a"])(Object(r["a"])({},Object(c["mapMutations"])({set_amisJson:"amis/set_amisJson",setTreeFlag:"settings/setTreeFlag"})),{},{handleAdd:function(){this.$refs["edit"].type="add",this.$refs["edit"].showEdit(this.queryForm)},handleEdit:function(e){var t=this;return Object(s["a"])(l.a.mark((function a(){var o,i,s,r;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return o=t.$baseLoading(1),a.next=3,Object(u["getView"])(e.objectId);case 3:i=a.sent,s=i.data,r=void 0===s?{}:s,["amis_view","amis"].includes(e.type)?t.$router.push({path:"/design/editor/amis",query:{viewId:e.objectId,type:"amis"}}):t.$router.push({path:"/design/editor/".concat(e.type),query:{viewId:e.objectId,type:e.type}}),o.close(),t.set_amisJson(r);case 9:case"end":return a.stop()}}),a)})))()},handleDelete:function(e){var t=this;console.log(e.data,e.objectId),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,Object(s["a"])(l.a.mark((function a(){return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(u["delView"])(e.objectId);case 2:a.sent,t.$baseMessage(t.$translateTitle("successfully deleted"),"success","vab-hey-message-success"),t.fetchData();case 5:case"end":return a.stop()}}),a)}))))},handleLowCode:function(e){var t=this;return Object(s["a"])(l.a.mark((function a(){var o,i;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return o=t.$baseColorfullLoading(1),a.next=3,Object(u["getView"])(e);case 3:i=a.sent,o.close(),t.$dgiotBus.$emit("lowcodePreview",i);case 6:case"end":return a.stop()}}),a)})))()},saveLowCode:function(e,t){var a=this;return Object(s["a"])(l.a.mark((function o(){var i;return l.a.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return i=a.$baseColorfullLoading(1),o.next=3,Object(u["putView"])(e,t);case 3:o.sent,i.close();case 5:case"end":return o.stop()}}),o)})))()},paginationQuery:function(e){var t=this;return Object(s["a"])(l.a.mark((function a(){return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.queryPayload=e;case 1:case"end":return a.stop()}}),a)})))()},fetchData:function(e){var t=this;return Object(s["a"])(l.a.mark((function a(){var o,i,s,r,n,c,d,p,m,b;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return _.isEmpty(e)&&(e=t.queryPayload),t.queryPayload.where={class:t.queryForm["class"]?{$regex:t.queryForm["class"]}:{$ne:null},type:t.queryForm.type?{$regex:t.queryForm.type}:{$ne:null},title:t.queryForm.title?{$regex:t.queryForm.title}:{$ne:null},key:t.queryForm.key?{$regex:t.queryForm.key}:{$ne:null},objectId:t.queryForm.objectId?{$regex:t.queryForm.objectId}:{$ne:null}},o=e,i=o.count,s=o.order,r=o.excludeKeys,n=o.limit,c=o.skip,d=o.where,console.log(t.queryForm),t.listLoading=!0,a.next=7,Object(u["queryView"])({count:i,order:s,excludeKeys:r,limit:n,skip:c,where:d});case 7:p=a.sent,m=p.results,b=p.count,m&&m.forEach((function(e){e.createdAt=moment(e.createdAt).format("YYYY-MM-DD HH:mm:ss")})),t.list=m,t.$dgiotBus.$emit("lowcodeLen",b),t.paginations.total=b,t.listLoading=!1;case 15:case"end":return a.stop()}}),a)})))()}})},f=b,g=a("bdd7"),v=Object(g["a"])(f,o,i,!1,null,null,null);t["default"]=v.exports},"0ed6":function(e,t,a){e.exports=a.p+"static/img/volume_up_black_24dp.4835d0b2.svg"},"18ae":function(e,t,a){"use strict";a("da59f")},"209d":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"index-container"},[a("el-drawer",{directives:[{name:"drawerDrag",rawName:"v-drawerDrag"}],key:e.type+e.objectId,attrs:{"append-to-body":"","before-close":e.handleClose,size:"90%",title:e.objectId,visible:e.flag,"with-header":e.withHeader},on:{"update:visible":function(t){e.flag=t}}},["topo"===e.type?a("topo",{attrs:{code:e.code.konva,"object-id":e.objectId}}):"amis"===e.type||"amis_view"===e.type?a("amis",{attrs:{code:e.code,"object-id":e.objectId}}):e._e()],1)],1)},i=[],s=a("fb07"),r=a("e97b"),n=a("d0d7"),l=a.n(n),c=(a("f764"),a("5662"),a("8e26")),d=a("f27c"),u=a("5880"),p={name:"Index",components:{topo:d["default"],amis:c["default"]},data:function(){return{withHeader:!0,types:["amis","amis_view","topo"],code:{},objectId:"",flag:!1,type:"amis"}},mounted:function(){var e=this;this.$dgiotBus.$off("lowcodePreview"),this.$dgiotBus.$on("lowcodePreview",(function(t){var a={},o=t.type,i=t.data,s=t.objectId,r=t["class"],n=t.key;"Device"==r&&(console.log(i),a["parse_objectid"]=n,localStorage.setItem("parse_objectid",n),console.groupCollapsed("%c amis env","color:#009a61; font-size: 28px"),console.log("amisEnv",a),console.groupEnd()),e.types.includes(o)?e.designLowCode(o,s,i):e.$message.error("暂不支持该类型低代码设计")}))},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){},methods:Object(r["a"])(Object(r["a"])({},Object(u["mapMutations"])({setData:"view/setData"})),{},{handleClose:function(e){var t=this;return Object(s["a"])(l.a.mark((function a(){return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:try{t.$confirm("确认关闭？").then((function(a){e(),t.$dgiotBus.$emit("lowcodeClose")}))["catch"]((function(e){}))}catch(o){console.log(o)}case 1:case"end":return a.stop()}}),a)})))()},designLowCode:function(e,t,a){var o=this;return Object(s["a"])(l.a.mark((function i(){return l.a.wrap((function(i){while(1)switch(i.prev=i.next){case 0:console.log(e,t,a),o.code=a,o.type=e,o.objectId=t,o.flag=!0;case 5:case"end":return i.stop()}}),i)})))()}})},m=p,b=(a("fe20"),a("bdd7")),f=Object(b["a"])(m,o,i,!1,null,"18e4adba",null);t["default"]=f.exports},"27f8":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"icon-selector-popper"},[a("div",{staticClass:"dialog"},[a("vab-input",{ref:"uploadFinish",on:{fileInfo:e.fileInfo}})],1),a("el-collapse",{attrs:{accordion:""},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[a("el-collapse-item",{attrs:{name:"icon",title:"iconfont"}},[a("el-row",{attrs:{gutter:20}},e._l(e.iconfont.glyphs,(function(t,o){return a("el-col",{directives:[{name:"show",rawName:"v-show",value:o<=11,expression:"index <= 11"}],key:t.icon_id,attrs:{span:8}},[a("i",{directives:[{name:"svg-drag",rawName:"v-svg-drag",value:{callback:e.coordinate},expression:"{ callback: coordinate }"}],on:{mousedown:function(a){return e.moveSvg(t)}}},[a("VabIconfont",{attrs:{name:t.font_class,title:t.name,type:"svg"}})],1)])})),1)],1)],1)],1)},i=[],s=a("6df3"),r=s["a"],n=(a("d859"),a("bdd7")),l=Object(n["a"])(r,o,i,!1,null,null,null);t["default"]=l.exports},"301d":function(e,t,a){},"38e5":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"TopoArom"},[a("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.wmxhandleClose,"close-on-click-modal":!1,title:e.wmxSituation+"自定义属性",top:"5vh",visible:e.wmxdialogVisible,width:"60%"},on:{"update:visible":function(t){e.wmxdialogVisible=t}}},[a("div",{staticClass:"wmxheader"},[a("el-form",{ref:"sizeForm",attrs:{"label-position":"left","label-width":"150px",model:e.sizeForm,rules:e.sizerule,size:"mini"}},["int"==e.sizeForm.type||"float"==e.sizeForm.type||"double"==e.sizeForm.type?a("div",[a("el-collapse",{model:{value:e.collapseName,callback:function(t){e.collapseName=t},expression:"collapseName"}},[a("el-collapse-item",{attrs:{name:"1"}},[a("template",{slot:"title"},[a("h3",{staticStyle:{"font-size":"normal"}},[e._v("数据存储")])]),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.functionname"),prop:"name"}},[a("el-input",{model:{value:e.sizeForm.name,callback:function(t){e.$set(e.sizeForm,"name",t)},expression:"sizeForm.name"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.identifier"),prop:"identifier"}},[a("el-input",{model:{value:e.sizeForm.identifier,callback:function(t){e.$set(e.sizeForm,"identifier",t)},expression:"sizeForm.identifier"}})],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"取值范围(最小值)",prop:"startnumber"}},[a("el-input",{attrs:{placeholder:e.$translateTitle("product.minimumvalue"),type:"number"},model:{value:e.sizeForm.startnumber,callback:function(t){e.$set(e.sizeForm,"startnumber",e._n(t))},expression:"sizeForm.startnumber"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"取值范围(最大值)",prop:"endnumber"}},[a("el-input",{attrs:{placeholder:e.$translateTitle("product.maximumvalue"),type:"number"},on:{input:function(t){return e.changeValue("sizeForm")}},model:{value:e.sizeForm.endnumber,callback:function(t){e.$set(e.sizeForm,"endnumber",e._n(t))},expression:"sizeForm.endnumber"}})],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"步长",prop:"step"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right",min:0,precision:2,step:.01},model:{value:e.sizeForm.step,callback:function(t){e.$set(e.sizeForm,"step",t)},expression:"sizeForm.step"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.readandwritetype"),prop:"isread"}},[a("el-radio-group",{staticStyle:{width:"100%"},attrs:{size:"medium"},model:{value:e.sizeForm.isread,callback:function(t){e.$set(e.sizeForm,"isread",t)},expression:"sizeForm.isread"}},[a("el-radio",{attrs:{label:"rw"}},[e._v(" "+e._s(e.$translateTitle("product.readandwrite"))+" ")]),a("el-radio",{attrs:{label:"r"}},[e._v(" "+e._s(e.$translateTitle("product.onlyread"))+" ")])],1)],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.datatype"),prop:"type"}},[a("el-select",{staticStyle:{width:"100%"},on:{change:e.selectStruct},model:{value:e.sizeForm.type,callback:function(t){e.$set(e.sizeForm,"type",t)},expression:"sizeForm.type"}},[a("el-option",{attrs:{label:e.$translateTitle("product.struct"),value:"struct"}}),a("el-option",{attrs:{label:e.$translateTitle("product.init"),value:"int"}}),a("el-option",{attrs:{label:e.$translateTitle("product.float"),value:"float"}}),a("el-option",{attrs:{label:e.$translateTitle("product.double"),value:"double"}}),a("el-option",{attrs:{label:e.$translateTitle("product.bool"),value:"bool"}}),a("el-option",{attrs:{label:e.$translateTitle("product.enum"),value:"enum"}}),a("el-option",{attrs:{label:e.$translateTitle("product.string"),value:"string"}}),a("el-option",{attrs:{label:e.$translateTitle("product.date"),value:"date"}})],1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.unit")}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:e.$translateTitle("product.unit")},model:{value:e.sizeForm.unit,callback:function(t){e.$set(e.sizeForm,"unit",t)},expression:"sizeForm.unit"}},e._l(e.allunit,(function(e,t){return a("el-option",{key:t,attrs:{label:e.data.Name+"/"+e.data.Symbol,value:e.data.Symbol}})})),1)],1)],1)],1)],2),a("el-collapse-item",{attrs:{name:"2"}},[a("template",{slot:"title"},[a("h3",{staticStyle:{"font-size":"normal"}},[e._v("数据采集")]),a("el-row",{staticStyle:{margin:"0 auto"}},[a("el-col",{attrs:{span:2}},[a("el-popover",{attrs:{placement:"right",trigger:"click",width:"400"}},[a("el-table",{attrs:{data:e.wmxData.slice((e.wmxstart-1)*e.wmxPageSize,e.wmxstart*e.wmxPageSize)}},[a("el-table-column",{attrs:{label:"标识符"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return[a("span",{staticStyle:{"margin-left":"10px"}},[e._v(" "+e._s(o.identifier)+" ")])]}}],null,!1,945501893)}),a("el-table-column",{attrs:{label:"功能名称"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return[a("span",{staticStyle:{"margin-left":"10px"}},[e._v(" "+e._s(o.name)+" ")])]}}],null,!1,3608931969)}),a("el-table-column",{attrs:{label:"数据类型"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return[a("span",{staticStyle:{"margin-left":"10px"}},[e._v(" "+e._s(o.dataType.type)+" ")])]}}],null,!1,404777272)})],1),a("el-pagination",{staticStyle:{"margin-top":"10px"},attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":e.wmxPageSize,"page-sizes":[10,20,30,50],total:e.wmxData.length},on:{"current-change":e.wmxCurrentChange,"size-change":e.wmxSizeChange}}),a("el-button",{staticStyle:{"text-align":"center"},attrs:{slot:"reference",size:"mini"},slot:"reference"},[e._v(" 添加变量 ")])],1)],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-tooltip",{staticStyle:{float:"left"},attrs:{effect:"dark",placement:"right-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 采集策略表达式 。 "),a("br"),e._v(" 如： "),a("br"),e._v(" 5分钟 = 5 * 60 "),a("br"),e._v(" 1小时 = 60 * 60 "),a("br"),e._v(" 5小时 = 5 * 60 * 60 "),a("br"),e._v(" 1天 = 24 * 60 * 60 "),a("br")]),a("i",{staticClass:"el-icon-question"})]),a("el-form-item",{attrs:{label:"采集策略(单位：秒)"}},[a("el-select",{staticStyle:{width:"95%"},attrs:{"allow-create":"","default-first-option":"",filterable:"",placeholder:"请选择",size:"mini"},model:{value:e.sizeForm.strategy,callback:function(t){e.$set(e.sizeForm,"strategy",t)},expression:"sizeForm.strategy"}},e._l(e.sizeOption,(function(e){return a("el-option",{key:e.val,attrs:{label:e.label,size:"mini",value:e.val}})})),1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"采集轮次"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{"allow-create":"","default-first-option":"",filterable:"",placeholder:"请选择",size:"mini"},model:{value:e.sizeForm.round,callback:function(t){e.$set(e.sizeForm,"round",t)},expression:"sizeForm.round"}},e._l(e.options,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),a("p",{staticStyle:{position:"absolute",top:"26px",margin:"0","font-size":"12px",color:"black"}},[e._v(" 例如:1,3,5,8;(可选可自主填写)(注意:逗号为英文逗号) ")])],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-tooltip",{staticStyle:{float:"left"},attrs:{effect:"dark",placement:"right-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 1. 采集值 设备上行数据经采集公式计算后显示 。 "),a("br"),e._v(" 公式中的%s为占位符，是固定字段。 "),a("br"),e._v(" 如： "),a("br"),e._v(" 加：%s+10 "),a("br"),e._v(" 减：%s-10 "),a("br"),e._v(" 乘：%s*10 "),a("br"),e._v(" 除：%s/10 "),a("br"),e._v(" 余数：%s%10 "),a("br"),e._v(" 2. 计算值 添加变量按钮, "),a("br"),e._v(" 复制对应的标识符 "),a("br"),e._v(" 例：pressure_out "),a("br"),e._v(" 加：pressure_out+10 "),a("br"),e._v(" 减：pressure_out-10 "),a("br"),e._v(" 乘：pressure_out*10 "),a("br"),e._v(" 除：pressure_out/10 "),a("br"),e._v(" 余数：pressure_out%10 "),a("br"),e._v(" 3. 复杂值 ：关闭本弹窗后使用物解析处理 "),a("br")]),a("i",{staticClass:"el-icon-question"})]),a("el-form-item",{attrs:{label:"采集公式"}},[a("el-input",{staticStyle:{width:"95%"},attrs:{placeholder:"%s",rows:1,type:"textarea"},model:{value:e.sizeForm.collection,callback:function(t){e.$set(e.sizeForm,"collection",t)},expression:"sizeForm.collection"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"采集顺序"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{label:"采集顺序",min:0},model:{value:e.sizeForm.Order,callback:function(t){e.$set(e.sizeForm,"Order",t)},expression:"sizeForm.Order"}})],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:24}},[a("el-tooltip",{attrs:{effect:"dark",placement:"right-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 1. 采集值: 主动向设备写数据经控制公式计算后下发 。 "),a("br"),e._v(" 公式中的%s为占位符，是固定字段。 "),a("br"),e._v(" 如： "),a("br"),e._v(" 加：%s+10 "),a("br"),e._v(" 减：%s-10 "),a("br"),e._v(" 乘：%s*10 "),a("br"),e._v(" 除：%s/10 "),a("br"),e._v(" 余数：%s%10 "),a("br"),e._v(" 2. 计算值: 点击添加变量按钮, "),a("br"),e._v(" 复制对应的标识符 "),a("br"),e._v(" 例：pressure_out "),a("br"),e._v(" 加：pressure_out+10 "),a("br"),e._v(" 减：pressure_out-10 "),a("br"),e._v(" 乘：pressure_out*10 "),a("br"),e._v(" 除：pressure_out/10 "),a("br"),e._v(" 余数：pressure_out%10 "),a("br"),e._v(" 3. 复杂值 ：关闭本弹窗后使用物解析处理 "),a("br")]),a("i",{staticClass:"el-icon-question",staticStyle:{float:"left"}})]),a("el-form-item",{attrs:{label:"控制公式"}},[a("el-input",{staticStyle:{width:"98%"},attrs:{placeholder:"%s",rows:1,type:"textarea"},model:{value:e.sizeForm.control,callback:function(t){e.$set(e.sizeForm,"control",t)},expression:"sizeForm.control"}})],1)],1)],1)],2),a("el-collapse-item",{attrs:{name:"3"}},[a("template",{slot:"title"},[a("h3",{staticStyle:{"font-size":"normal"}},[e._v("数据来源")])]),a("el-divider"),a("div",{attrs:{name:"dataIdentification"}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据标识",prop:"dis",required:""}},[a("el-input",{attrs:{placeholder:"数据标识"},model:{value:e.sizeForm.dis,callback:function(t){e.$set(e.sizeForm,"dis",t)},expression:"sizeForm.dis"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据",required:""}},[a("el-input",{attrs:{placeholder:"数据个数"},model:{value:e.sizeForm.dinumber,callback:function(t){e.$set(e.sizeForm,"dinumber",e._n(t))},expression:"sizeForm.dinumber"}})],1)],1)],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"协议类型"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.sizeForm.protocol,callback:function(t){e.$set(e.sizeForm,"protocol",t)},expression:"sizeForm.protocol"}},e._l(["normal","modbus","DLT645"],(function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1)],1),a("el-col",{directives:[{name:"show",rawName:"v-show",value:"modbus"==e.sizeForm.protocol,expression:"sizeForm.protocol == 'modbus'"}],attrs:{span:12}},[a("el-form-item",{attrs:{label:"字节序",prop:"byteorder"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.sizeForm.byteorder,callback:function(t){e.$set(e.sizeForm,"byteorder",t)},expression:"sizeForm.byteorder"}},e._l([{value:"big",label:"大端"},{value:"little",label:"小端"}],(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:e.showNewItem,expression:"showNewItem"}],attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"寄存器状态",prop:"byteorder"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.sizeForm.operatetype,callback:function(t){e.$set(e.sizeForm,"operatetype",t)},expression:"sizeForm.operatetype"}},e._l([{value:"coilStatus",label:"线圈状态"},{value:"输入状态",label:"输入状态"},{value:"holdingRegister",label:"保持寄存器"},{value:"inputRegister",label:"输入寄存器"}],(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据类型"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.sizeForm.originaltype,callback:function(t){e.$set(e.sizeForm,"originaltype",t)},expression:"sizeForm.originaltype"}},e._l(["int16","uint16","int32","uint32","int64","uint64","float","double","string","customizedData"],(function(e,t){return a("el-option",{key:t,staticStyle:{width:"100%"},attrs:{label:e,value:e}})})),1)],1)],1),a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"从机地址"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.sizeForm.slaveid,callback:function(t){e.$set(e.sizeForm,"slaveid",t)},expression:"sizeForm.slaveid"}})],1)],1)],1)],2)],1)],1):e._e(),"bool"==e.sizeForm.type?a("div",[a("el-form-item",{attrs:{label:e.$translateTitle("product.attribute"),required:""}},[a("div",{staticStyle:{height:"40px"}},[a("el-col",{attrs:{span:11}},[a("el-form-item",[a("el-input",{staticClass:"inputnumber",staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("product.attribute"),readonly:"",type:"number"},model:{value:e.sizeForm.truevalue,callback:function(t){e.$set(e.sizeForm,"truevalue",t)},expression:"sizeForm.truevalue"}})],1)],1),a("el-col",{attrs:{span:2}},[e._v("-")]),a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{prop:"true"}},[a("el-input",{staticClass:"inputnumber",attrs:{placeholder:e.$translateTitle("product.egopen")},model:{value:e.sizeForm.true,callback:function(t){e.$set(e.sizeForm,"true",t)},expression:"sizeForm.true"}})],1)],1)],1),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-col",{attrs:{span:11}},[a("el-form-item",[a("el-input",{staticClass:"inputnumber",attrs:{placeholder:e.$translateTitle("product.attribute"),readonly:"",type:"number"},model:{value:e.sizeForm.falsevalue,callback:function(t){e.$set(e.sizeForm,"falsevalue",t)},expression:"sizeForm.falsevalue"}})],1)],1),a("el-col",{attrs:{span:2}},[e._v("-")]),a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{prop:"true"}},[a("el-input",{staticClass:"inputnumber",attrs:{placeholder:e.$translateTitle("product.egclose")},model:{value:e.sizeForm.false,callback:function(t){e.$set(e.sizeForm,"false",t)},expression:"sizeForm.false"}})],1)],1)],1)])],1):e._e(),"enum"==e.sizeForm.type?a("div",[e._l(e.sizeForm.specs,(function(t,o){return a("el-form-item",{key:o,attrs:{required:""}},[a("el-col",{attrs:{span:9}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.attribute")+o,prop:"specs."+o+".attribute",rules:[{required:!0,message:"输入属性"}]}},[a("el-input",{attrs:{placeholder:e.$translateTitle("product.egnumber0")},model:{value:t.attribute,callback:function(a){e.$set(t,"attribute",a)},expression:"item.attribute"}})],1)],1),a("el-col",{staticClass:"line",attrs:{span:2}},[e._v("-")]),a("el-col",{attrs:{span:9}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.attributevalue")+o,prop:"specs."+o+".attributevalue",rules:[{required:!0,message:"输入属性值"}]}},[a("el-input",{attrs:{placeholder:e.$translateTitle("developer.describe")},model:{value:t.attributevalue,callback:function(a){e.$set(t,"attributevalue",a)},expression:"item.attributevalue"}})],1)],1),a("el-col",{staticClass:"line",attrs:{span:2}}),a("el-col",{staticClass:"line",attrs:{span:4}},[a("el-link",{staticStyle:{"margin-top":"30px","margin-left":"5px"},attrs:{icon:"el-icon-minus",type:"primary",underline:!1},on:{click:function(a){return a.preventDefault(),e.removeDomain(t)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)],1)})),a("el-link",{attrs:{icon:"el-icon-plus",type:"primary",underline:!1},on:{click:e.addDomain}},[e._v(" "+e._s(e.$translateTitle("product.add"))+" ")])],2):e._e(),"struct"==e.sizeForm.type?a("div",[a("el-form-item",{attrs:{label:"JSON对象",required:""}},[a("ul",{staticStyle:{"padding-left":"20px",margin:"0"}},e._l(e.sizeForm.struct,(function(t,o){return a("li",{key:o,staticStyle:{display:"flex","list-style":"none"},attrs:{value:"item"}},[a("div",[a("span",[e._v(" "+e._s(e.$translateTitle("product.parametername")+":")+"} ")]),a("span",[e._v(e._s(t.name))])]),a("div",[a("el-link",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary",underline:!1},on:{click:function(a){return e.editStruct(t,o)}}},[e._v(" "+e._s(e.$translateTitle("developer.edit"))+" ")]),a("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(t){return e.deleteStruct(o)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)])})),0),a("el-link",{attrs:{icon:"el-icon-plus",type:"primary",underline:!1},on:{click:function(t){return e.addStruct("structform")}}},[e._v(" "+e._s(e.$translateTitle("product.addparameter"))+" ")])],1)],1):e._e(),"string"==e.sizeForm.type?a("div",[a("el-form-item",{attrs:{label:e.$translateTitle("product.datalength"),prop:"string"}},[a("el-input",{attrs:{type:"number"},model:{value:e.sizeForm.string,callback:function(t){e.$set(e.sizeForm,"string",e._n(t))},expression:"sizeForm.string"}},[a("template",{slot:"append"},[e._v(" "+e._s(e.$translateTitle("product.byte"))+" ")])],2)],1)],1):e._e(),"date"==e.sizeForm.type?a("div",[a("el-form-item",{attrs:{label:e.$translateTitle("product.timeformat")}},[a("el-input",{attrs:{readonly:""},model:{value:e.sizeForm.date,callback:function(t){e.$set(e.sizeForm,"date",t)},expression:"sizeForm.date"}})],1)],1):e._e()])],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.wmxhandleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("sizeForm")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)])],1)},i=[],s={name:"TopoArom",components:{},data:function(){return{infoData:"TopoArom"}},computed:{},mounted:function(){},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){},methods:{}},r=s,n=a("bdd7"),l=Object(n["a"])(r,o,i,!1,null,null,null);t["default"]=l.exports},"3b3a":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"icon-selector-popper"},[a("div",{staticClass:"dialog"},[a("vab-input",{ref:"uploadFinish",attrs:{params:e.inputParams},on:{fileInfo:e.fileInfo,files:e.files}})],1),a("Thing"),a("div",{directives:[{name:"show",rawName:"v-show",value:e.isDirver,expression:"isDirver"}],staticStyle:{margin:"0 auto","text-align":"center"}},[a("Evidence")],1),a("a-collapse",{directives:[{name:"show",rawName:"v-show",value:!e.isDirver,expression:"!isDirver"}],attrs:{accordion:""}},[a("a-collapse-panel",{key:"1",attrs:{header:e.$translateTitle("topo.background")}},[a("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return e.uploadCkick("bg")}}},[e._v(" "+e._s(e.$translateTitle("topo.Upload background"))+" ")]),a("Background")],1),a("a-collapse-panel",{key:"2",attrs:{header:e.$translateTitle("product.physicalmodel")}},[a("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return e.createThing({productid:e.$route.query.productid,hidden:!1})}}},[e._v(" "+e._s(e.$translateTitle("topo.Add text content"))+" ")])],1),a("a-collapse-panel",{key:"3",attrs:{header:e.$translateTitle("topo.evidence")}},[a("Evidence")],1)],1)],1)},i=[],s=a("6347"),r=s["a"],n=(a("9397"),a("18ae"),a("bdd7")),l=Object(n["a"])(r,o,i,!1,null,null,null);t["default"]=l.exports},"3b9a":function(e,t,a){},"44c1":function(e,t,a){},"459e":function(e,t,a){e.exports=a.p+"static/img/archive_black_24dp.f3ea5f17.svg"},4609:function(e,t,a){},"48b0":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"maintenancePlanAdd"},[e._m(0),a("div",{staticClass:"panel-body"},[a("div",{staticClass:"demo"},[a("canvas",{attrs:{id:"canvas",width:e.width}}),a("div",{staticClass:"draw-btn-group"},[a("div",{class:{active:""==e.drawType},attrs:{title:"自由选择"},on:{click:function(t){return e.drawTypeChange("")}}},[a("i",{staticClass:"draw-icon icon-mouse"})]),a("div",{class:{active:"arrow"==e.drawType},attrs:{title:"画箭头"},on:{click:function(t){return e.drawTypeChange("arrow")}}},[a("i",{staticClass:"draw-icon icon-1"})]),a("div",{class:{active:"text"==e.drawType},attrs:{title:"文本输入框"},on:{click:function(t){return e.drawTypeChange("text")}}},[a("i",{staticClass:"draw-icon icon-2"})]),a("div",{class:{active:"ellipse"==e.drawType},attrs:{title:"画圆"},on:{click:function(t){return e.drawTypeChange("ellipse")}}},[a("i",{staticClass:"draw-icon icon-3"})]),a("div",{class:{active:"rectangle"==e.drawType},attrs:{title:"画矩形"},on:{click:function(t){return e.drawTypeChange("rectangle")}}},[a("i",{staticClass:"draw-icon icon-4"})]),a("div",{class:{active:"polygon"==e.drawType},attrs:{title:"画多边形"},on:{click:e.drawPolygon}},[a("i",{staticClass:"draw-icon icon-6"})]),a("div",{class:{active:"pen"==e.drawType},attrs:{title:"笔画"},on:{click:function(t){return e.drawTypeChange("pen")}}},[a("i",{staticClass:"draw-icon icon-7"})]),a("div",{class:{active:"pentagram"==e.drawType},attrs:{title:"五角星"},on:{click:function(t){return e.drawTypeChange("pentagram")}}},[a("i",{staticClass:"draw-icon icon-pentagram"})]),a("div",{attrs:{title:"从文件选择图片上传"},on:{click:e.uploadImg}},[a("i",{staticClass:"draw-icon icon-img"})]),a("div",{attrs:{title:"加载背景图"},on:{click:e.loadExpImg}},[a("i",{staticClass:"draw-icon icon-back"})]),a("div",{attrs:{title:"保存"},on:{click:e.save}},[a("i",{staticClass:"draw-icon icon-save"})])])])]),a("input",{attrs:{id:"imgInput",accept:"image/*",type:"file"},on:{change:e.uploadImgChange}}),a("img",{attrs:{id:"img",src:e.imgSrc}}),a("img",{attrs:{id:"expImg",src:"https://cdn.jsdelivr.net/gh/Couy69/vue-fabric-drawingboard@master/src/assets/icons/draw/exp.jpg"}})])},i=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"child-panel-title"},[a("h2",[e._v("图形标注")])])}],s=(a("1d17"),a("98da"),a("7690"),a("37c6"),a("16b8"),a("c4bc"),{name:"Fabric",data:function(){return{width:1280,height:720,rect:[],canvas:{},showMenu:!1,x:"",y:"",mouseFrom:{},mouseTo:{},drawType:null,canvasObjectIndex:0,textbox:null,rectangleLabel:"warning",drawWidth:2,color:"#E34F51",drawingObject:null,moveCount:1,doDrawing:!1,polygonMode:!1,pointArray:[],lineArray:[],activeShape:!1,activeLine:"",line:{},delectKlass:{},imgFile:{},imgSrc:""}},watch:{drawType:function(){this.canvas.selection=!this.drawType},width:function(){this.canvas.setWidth(this.width)},height:function(){this.canvas.setHeight(this.height)}},mounted:function(){var e=this;this.canvas=new fabric.Canvas("canvas",{}),this.canvas.selectionColor="rgba(0,0,0,0.05)",this.canvas.on("mouse:down",this.mousedown),this.canvas.on("mouse:move",this.mousemove),this.canvas.on("mouse:up",this.mouseup),document.onkeydown=function(t){46==t.keyCode&&e.deleteObj(),90==t.keyCode&&t.ctrlKey&&e.canvas.remove(e.canvas.getObjects()[e.canvas.getObjects().length-1])}},methods:{save:function(){var e=document.getElementById("canvas"),t=e.toDataURL("png");t=t.replace("image/png","image/octet-stream");var a="drawingboard_"+(new Date).getTime()+".png";this.saveFile(t,a)},saveFile:function(e,t){var a=document.createElement("a");a.href=e,a.download=t;var o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(o)},uploadImg:function(){document.getElementById("imgInput").click()},loadExpImg:function(){var e=document.getElementById("expImg"),t=new fabric.Image(e,{selectable:!1});this.canvas.add(t)},uploadImgChange:function(){var e=this,t=document.getElementById("imgInput");this.imgFile=t.files[0];if(/\.(jpe?g|png|gif)$/i.test(this.imgFile.name)){var a=new FileReader,o=this;a.addEventListener("load",(function(){o.imgFile.name,o.imgSrc=this.result}),!1),a.readAsDataURL(this.imgFile)}var i=document.getElementById("img");i.onload=function(){e.width=i.width,e.height=i.height;var t=new fabric.Image(i,{zIndex:-1,selectable:!1});e.canvas.add(t)}},drawTypeChange:function(e){this.drawType=e,this.canvas.skipTargetFind=!!e,this.canvas.isDrawingMode="pen"==e},mousedown:function(e){var t=e.pointer||this.transformMouse(e.e.offsetX,e.e.offsetY);if(this.mouseFrom.x=t.x,this.mouseFrom.y=t.y,this.doDrawing=!0,"text"==this.drawType&&this.drawing(),this.textbox&&(this.textbox.enterEditing(),this.textbox.hiddenTextarea.focus()),"polygon"==this.drawType){this.canvas.skipTargetFind=!1;try{this.pointArray.length>1&&e.target&&e.target.id==this.pointArray[0].id&&this.generatePolygon(),this.polygonMode&&this.addPoint(e)}catch(a){console.log(a)}}},mouseup:function(e){var t=e.pointer||this.transformMouse(e.e.offsetX,e.e.offsetY);this.mouseTo.x=t.x,this.mouseTo.y=t.y,this.drawingObject=null,this.moveCount=1,"polygon"!=this.drawType&&(this.doDrawing=!1)},mousemove:function(e){if(!(this.moveCount%2)||this.doDrawing){this.moveCount++;var t=e.pointer||this.transformMouse(e.e.offsetX,e.e.offsetY);if(this.mouseTo.x=t.x,this.mouseTo.y=t.y,"text"==this.drawType&&"polygon"==this.drawType||this.drawing(e),"polygon"==this.drawType){if(this.activeLine&&"line"==this.activeLine["class"]){var a=this.canvas.getPointer(e.e);this.activeLine.set({x2:a.x,y2:a.y});var o=this.activeShape.get("points");o[this.pointArray.length]={x:a.x,y:a.y,zIndex:1},this.activeShape.set({points:o}),this.canvas.renderAll()}this.canvas.renderAll()}}},deleteObj:function(){var e=this;this.canvas.getActiveObjects().map((function(t){e.canvas.remove(t)}))},transformMouse:function(e,t){return{x:e/1,y:t/1}},drawPolygon:function(){this.drawType="polygon",this.polygonMode=!0,this.pointArray=new Array,this.lineArray=new Array,this.canvas.isDrawingMode=!1},addPoint:function(e){var t=Math.floor(1e4*Math.random()),a=(new Date).getTime()+t,o=new fabric.Circle({radius:5,fill:"#ffffff",stroke:"#333333",strokeWidth:.5,left:(e.pointer.x||e.e.layerX)/this.canvas.getZoom(),top:(e.pointer.y||e.e.layerY)/this.canvas.getZoom(),selectable:!1,hasBorders:!1,hasControls:!1,originX:"center",originY:"center",id:a,objectCaching:!1});0==this.pointArray.length&&o.set({fill:"red"});var i=[(e.pointer.x||e.e.layerX)/this.canvas.getZoom(),(e.pointer.y||e.e.layerY)/this.canvas.getZoom(),(e.pointer.x||e.e.layerX)/this.canvas.getZoom(),(e.pointer.y||e.e.layerY)/this.canvas.getZoom()];if(this.line=new fabric.Line(i,{strokeWidth:2,fill:"#999999",stroke:"#999999",class:"line",originX:"center",originY:"center",selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1}),this.activeShape){var s=this.canvas.getPointer(e.e);i=this.activeShape.get("points");i.push({x:s.x,y:s.y});var r=new fabric.Polygon(i,{stroke:"#333333",strokeWidth:1,fill:"#cccccc",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});this.canvas.remove(this.activeShape),this.canvas.add(r),this.activeShape=r,this.canvas.renderAll()}else{var n=[{x:(e.pointer.x||e.e.layerX)/this.canvas.getZoom(),y:(e.pointer.y||e.e.layerY)/this.canvas.getZoom()}];r=new fabric.Polygon(n,{stroke:"#333333",strokeWidth:1,fill:"#cccccc",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});this.activeShape=r,this.canvas.add(r)}this.activeLine=this.line,this.pointArray.push(o),this.lineArray.push(this.line),this.canvas.add(this.line),this.canvas.add(o)},generatePolygon:function(){var e=this,t=new Array;this.pointArray.map((function(a,o){t.push({x:a.left,y:a.top}),e.canvas.remove(a)})),this.lineArray.map((function(t,a){e.canvas.remove(t)})),this.canvas.remove(this.activeShape).remove(this.activeLine);var a=new fabric.Polygon(t,{stroke:this.color,strokeWidth:this.drawWidth,fill:"rgba(255, 255, 255, 0)",opacity:1,hasBorders:!0,hasControls:!1});this.canvas.add(a),this.activeLine=null,this.activeShape=null,this.polygonMode=!1,this.doDrawing=!1,this.drawType=null},drawing:function(e){this.drawingObject&&this.canvas.remove(this.drawingObject);var t=null,a=this.mouseFrom.x,o=this.mouseFrom.y,i=this.mouseFrom,s=this.mouseTo;switch(this.drawType){case"arrow":var r=i.x,n=s.x,l=i.y,c=s.y,d=n-r,u=c-l,p=16*Math.cos(Math.PI/4),m=u/Math.sqrt(Math.pow(d,2)+Math.pow(u,2)),b=d/Math.sqrt(Math.pow(d,2)+Math.pow(u,2)),f=16*m/4,g=16*b/4,v=p*b,h=p*m,y=" M "+r+" "+l;y+=" L "+(n-v+f)+" "+(c-h-g),y+=" L "+(n-v+2*f)+" "+(c-h-2*g),y+=" L "+n+" "+c,y+=" L "+(n-v-2*f)+" "+(c-h+2*g),y+=" L "+(n-v-f)+" "+(c-h+g),y+=" Z",t=new fabric.Path(y,{stroke:this.color,fill:this.color,strokeWidth:this.drawWidth});break;case"pentagram":r=i.x,n=s.x,l=i.y,c=s.y,d=Math.abs(n-r),u=Math.abs(c-l);var w=Math.sqrt(d*d+u*u),$=Math.cos(18*Math.PI/180),F=Math.sin(18*Math.PI/180),j=[r,l+w],x=[r+2*w*F,l+w-2*w*$],k=[r-w*$,l+w*F],T=[r+w*$,l+w*F],_=[r-2*w*F,l+w-2*w*$];y=" M "+j[0]+" "+j[1];y+=" L "+x[0]+" "+x[1],y+=" L "+k[0]+" "+k[1],y+=" L "+T[0]+" "+T[1],y+=" L "+_[0]+" "+_[1],y+=" Z",t=new fabric.Path(y,{stroke:this.color,fill:this.color,strokeWidth:this.drawWidth});break;case"ellipse":e.e.shiftKey&&(s.x-a>s.y-o?s.y=o+s.x-a:s.x=a+s.y-o);Math.sqrt((s.x-a)*(s.x-a)+(s.y-o)*(s.y-o));t=new fabric.Ellipse({left:(s.x-a)/2+a,top:(s.y-o)/2+o,stroke:this.color,fill:"rgba(255, 255, 255, 0)",originX:"center",originY:"center",rx:Math.abs(a-s.x)/2,ry:Math.abs(o-s.y)/2,strokeWidth:this.drawWidth});break;case"rectangle":e.e.shiftKey&&(s.x-a>s.y-o?s.y=o+s.x-a:s.x=a+s.y-o);y="M "+i.x+" "+i.y+" L "+s.x+" "+i.y+" L "+s.x+" "+s.y+" L "+i.x+" "+s.y+" L "+i.x+" "+i.y+" z";t=new fabric.Path(y,{left:a,top:o,stroke:this.color,strokeWidth:this.drawWidth,fill:"rgba(255, 255, 255, 0)",hasControls:!1});break;case"text":this.textbox=new fabric.Textbox("",{left:i.x,top:i.y-10,fontSize:16,borderColor:this.color,fill:this.color,hasControls:!1}),this.canvas.add(this.textbox),this.textbox.enterEditing(),this.textbox.hiddenTextarea.focus();break;default:break}t&&(this.canvas.add(t),this.drawingObject=t)}}}),r=s,n=(a("7baf"),a("bdd7")),l=Object(n["a"])(r,o,i,!1,null,"758cb71a",null);t["default"]=l.exports},"52f5":function(e,t,a){},"57b5":function(e,t,a){},"5de5":function(e){e.exports=JSON.parse('{"type":"page","body":[{"body":[{"mode":"inline","name":"deviceid","size":"lg","type":"input-text","label":"任务报告编号"},{"mode":"inline","name":"taskname","size":"lg","type":"input-text","label":"任务名称"},{"mode":"inline","name":"taskitems","size":"lg","type":"select","label":"质检项目","source":"","options":[{"label":"南方家用泵","value":"c5f31fa3a4"}],"autoFill":{},"checkAll":false,"autoComplete":""},{"mode":"inline","name":"starttime","size":"lg","type":"input-datetime","label":"开始时间"},{"mode":"inline","name":"endtime","size":"lg","type":"input-datetime","label":"结束时间"}],"type":"collapse","title":"检测任务基本信息 basedata提交","visible":"","className":"bg-white wrapper b-2x p-b-xs m-b-xs","collapsed":false,"bodyClassName":"m","headingClassName":"font-thin text-lg b-light m-t-xs","clearValueOnHidden":false},{"body":[{"mode":"inline","name":"product","size":"lg","type":"select","label":"测试台体","source":"","options":[{"label":"南方泵业台体","value":"0399cc8e58"}],"autoFill":{},"checkAll":false,"autoComplete":""},{"mode":"inline","name":"ack","size":"lg","type":"select","label":"所属组织","source":"","options":[{"label":"admin","value":"A"},{"label":"立欧泵业","value":"B"}],"autoFill":{},"checkAll":false,"autoComplete":""}],"type":"collapse","title":"检测资源信息","className":"bg-white wrapper b-2x p-b-xs m-b-xs","collapsed":false,"bodyClassName":"m","headingClassName":"font-thin text-lg b-light m-t-xs"},{"tabs":[{"body":[{"mode":"inline","name":"productname","size":"lg","type":"select","label":"产品名称","options":[{"label":"中开泵","value":"中开泵"},{"label":"多级泵","value":"多级泵"},{"label":"斜流泵","value":"斜流泵"},{"label":"长轴泵","value":"长轴泵"},{"label":"渣浆泵","value":"渣浆泵"},{"label":"中开多级泵","value":"中开多级泵"},{"label":"液下多级泵","value":"液下多级泵"},{"label":"离心泵","value":"离心泵"},{"label":"多级离心泵","value":"多级离心泵"}],"checkAll":false},{"mode":"inline","name":"pumptype","size":"lg","type":"input-text","label":"水泵型号"},{"mode":"inline","name":"factorynumber","size":"lg","type":"input-text","label":"出厂编号"},{"mode":"inline","name":"wordnumber","size":"lg","type":"input-text","label":"报告编号"},{"mode":"inline","name":"productnumber","size":"lg","type":"input-text","label":"产品编号"}],"title":"基本信息"},{"body":[{"mode":"inline","name":"select","size":"lg","type":"select","label":"测试点个数","options":[{"label":"1","value":1},{"label":"2","value":2},{"label":"3","value":3},{"label":"4","value":4},{"label":"5","value":5}],"checkAll":false}],"title":"规定点信息"},{"body":[{"name":"radios","type":"radios","label":"检测精度","options":[{"label":"一级","value":"A"},{"label":"二级","value":"B"},{"label":"三级","value":"C"}],"joinValues":true}],"title":"测试设置"}],"type":"tabs","tabsMode":"card","className":"","contentClassName":"m"},{"api":{"url":"iotapi/classes/Device/${deviceid}","method":"post","requestAdaptor":"return {\\r\\n    ...api,\\r\\n    data: {\\r\\n        basedata:{ ...api.data}\\r\\n    }\\r\\n}"},"size":"md","type":"submit","label":"提交","level":"primary","actionType":"ajax"}],"title":"任务详情","regions":["header","body"],"messages":{},"className":"","bodyClassName":"","headerClassName":""}')},"614c":function(e,t,a){var o={"./Background.vue":"79fed","./Thing.vue":"bf14","./TopoAllocation.vue":"27f8","./TopoArom.vue":"38e5","./TopoBase.vue":"65e3","./TopoEvidence.vue":"c250","./TopoOperation.vue":"bd42","./TopoScale.vue":"9bfd","./TopoTabs.vue":"3b3a","./TopoThing.vue":"b99f","./fabric.vue":"48b0","./topoHeader.vue":"5be3"};function i(e){var t=s(e);return a(t)}function s(e){if(!a.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}i.keys=function(){return Object.keys(o)},i.resolve=s,e.exports=i,i.id="614c"},6347:function(e,t,a){"use strict";(function(e){var o=a("fb07"),i=a("e97b"),s=a("d0d7"),r=a.n(s),n=(a("1d17"),a("37c6"),a("1c6f"),a("04d6"),a("7690"),a("6dd4")),l=a("5880"),c=a("6db3"),d=a("bf14"),u=a("79fed"),p=a("c250"),m=/(\/\/)?[\w-]+(\.[\w-]+)+([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?$/,b=Object({NODE_ENV:"production",VUE_APP_TITLE:"物联网开发平台",VUE_APP_AUTHOR:"iotn2n",VUE_APP_UPDATE_TIME:"2022-01-13 11:36:25",VUE_APP_VERSION:"4.4.5",VUE_APP_Keywords:"一站式物联网PaaS平台|物联网应用服务",VUE_APP_Description:"提供物联网垂直领域应用使能平台及解决方案",VUE_APP_URL:"https://dev.iotn2n.com",BASE_URL:""}).CDN_URL,f=a("cad9"),g=m.test(b)?"".concat(b,"/assets/images/dgiot_release/topo/"):f.join(e,"".concat("","/assets/images/dgiot_release/topo/")),v=a("e043");t["a"]={name:"TopoTabs",components:{Thing:d["default"],Background:u["default"],Evidence:p["default"]},props:{isDirver:{type:Boolean,default:!1,required:!1}},data:function(){return{inputParams:{},upImgType:"bg",tabPosition:"left",iconfont:v,busData:{coordinate:{},paths:[]},accept:".jpg,.jpeg,.png,.gif,.bmp,.pdf,.JPG,.JPEG,.PBG,.GIF,.BMP,.PDF",imgHost:g,icon:"24-hours-fill",layout:"total, prev, next",total:0,background:!0,height:0,selectRows:"",queryIcon:[],queryForm:{pageNo:1,pageSize:30,title:""},images:[],imgParams:{},activeNames:"icon"}},computed:{},created:function(){},mounted:function(){},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){},methods:Object(i["a"])(Object(i["a"])({coordinate:function(e){var t={x:e.pageX,y:e.pageY};this.busData.coordinate=t},moveSvg:function(e){var t=Object(c["default"])(e,"path"),a=JSON.stringify(t.topo);console.info("getSvgPath function return ".concat(a)),this.busData.paths=a,this.$dgiotBus.$emit("busTopo","path",this.busData)},createdText:function(e){var t=Object(n["default"])({productid:"productid",thingid:"thingid"});console.log(t)},uploadCkick:function(e){this.upImgType=e,this.$refs["uploadFinish"].$refs.uploader.dispatchEvent(new MouseEvent("click")),this.inputParams={file:"",scene:"app",path:"product/topo/",filename:"".concat(this.$route.query.productid,"_bg")}},files:function(e,t){this.inputParams.filename="".concat(this.$route.query.productid,"_bg"),this.inputParams.file=e}},Object(l["mapMutations"])({setFlag:"konva/setFlag",setDrawParams:"konva/setDrawParams",createThing:"topo/createThing",setKonvaBg:"topo/setKonvaBg"})),{},{fileInfo:function(e){var t=this;return Object(o["a"])(r.a.mark((function a(){return r.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(console.log(e),"img"!==t.upImgType){a.next=6;break}return a.next=4,t.handleIcon(e.url);case 4:a.next=10;break;case 6:return localStorage.setItem("konvaBg",e.path),a.next=9,t.setKonvaBg(e.path);case 9:console.error("set konva bg \n",Cookies.get("fileServer")+e.path);case 10:case"end":return a.stop()}}),a)})))()},handleIcon:function(e){var t=new Image,a=this;t.src=e+"?"+(new Date).getTime(),t.onload=function(){a.$set(a.imgParams,"width",t.width),a.$set(a.imgParams,"height",t.height),a.$set(a.imgParams,"src",t.src),console.log("图片加载完成",a.imgParams),a.$baseMessage(a.$translateTitle("图片加载完成,可双击画图区域填充"),"success",!1,"vab-hey-message-success")},a.setFlag("image"),a.setDrawParams(a.imgParams)}})}}).call(this,"/")},"65e3":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{"append-to-body":"",title:e.$translateTitle("topo.topo")+e.$translateTitle("topo.tag"),visible:e.tagDialog,width:"50%"},on:{"update:visible":function(t){e.tagDialog=t}}},[a("span",[e._v("这是一段信息")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.tagDialog=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.tagDialog=!1}}},[e._v("确 定")])],1)]),a("el-dialog",{attrs:{"append-to-body":"",title:e.$translateTitle("topo.topo")+e.$translateTitle("topo.thing"),visible:e.thingDialog,width:"50%"},on:{"update:visible":function(t){e.thingDialog=t}}},[a("span",[e._v("这是一段信息")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.thingDialog=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.thingDialog=!1}}},[e._v("确 定")])],1)]),a("div",{staticClass:"topoBase",class:{"topoBase-fullscreen":e.isDevice},on:{contextmenu:e.showMenu}},[a("vue-context-menu",{staticStyle:{"font-size":"14px"},attrs:{"context-menu-data":e.contextMenuData},on:{copy:function(t){return e.contextMenu("copy")},deleteSahpe:function(t){return e.contextMenu("remove")},getPicture:function(t){return e.contextMenu("getPicture")},moveDown:function(t){return e.contextMenu("moveDown")},moveToBottom:function(t){return e.contextMenu("moveToBottom")},moveToTop:function(t){return e.contextMenu("moveToTop")},moveUp:function(t){return e.contextMenu("moveUp")}}}),a("div",{key:e.Sale,staticClass:"konvaTest",attrs:{id:"kevCurrent"}})],1)],1)},i=[],s=a("e97b"),r=a("5880"),n=(window.innerWidth,window.innerHeight,{name:"KonvaTest",prop:{},components:{},data:function(){return{contextMenuData:{menuName:"demo",axis:{x:null,y:null},menulists:[{fnHandler:"getPicture",btnName:"导出"},{fnHandler:"moveUp",btnName:"上移"},{fnHandler:"moveDown",btnName:"下移"},{fnHandler:"moveToTop",btnName:"置顶"},{fnHandler:"moveToBottom",btnName:"置底"},{fnHandler:"deleteSahpe",btnName:"删除"}]},stage:{},konvajson:{},tagDialog:!1,thingDialog:!1,defaultJson:'{"attrs":{"width":2382,"height":1200,"draggable":false},"className":"Stage","children":[{"attrs":{"hitGraphEnabled":false},"className":"Layer","children":[{"attrs":{},"className":"Image"},{"attrs":{"source":"https://konvajs.org/assets/yoda.jpg"},"className":"Image"}]},{"attrs":{},"className":"Layer","children":[{"attrs":{"draggable":true,"x":306,"y":303,"transformsEnabled":"position"},"className":"Group","children":[{"attrs":{"radius":20,"stroke":"#231fff","strokeWidth":4,"fill":"#ffffff"},"className":"Circle"},{"attrs":{"text":"1","fontSize":14,"originX":"center","originY":"center","fill":"#231fff","x":-5,"y":-5},"className":"Text"},{"attrs":{"data":"M.91,0H29.09A.91.91,0,0,1,30,.91v243a.88.88,0,0,1-.26.63L15.65,258.86a.9.9,0,0,1-1.3,0L.26,244.52a.88.88,0,0,1-.26-.63V.91A.91.91,0,0,1,.91,0Z","originX":"center","originY":"bottom","x":10,"y":15,"angle":-30,"fill":"#231fff","scaleX":0.15,"scaleY":0.15,"rotation":-30},"className":"Path"}]},{"attrs":{"draggable":true,"x":490,"y":557,"transformsEnabled":"position"},"className":"Group","children":[{"attrs":{"radius":20,"stroke":"#231fff","strokeWidth":4,"fill":"#ffffff"},"className":"Circle"},{"attrs":{"text":"2","fontSize":14,"originX":"center","originY":"center","fill":"#231fff","x":-5,"y":-5},"className":"Text"},{"attrs":{"data":"M.91,0H29.09A.91.91,0,0,1,30,.91v243a.88.88,0,0,1-.26.63L15.65,258.86a.9.9,0,0,1-1.3,0L.26,244.52a.88.88,0,0,1-.26-.63V.91A.91.91,0,0,1,.91,0Z","originX":"center","originY":"bottom","x":10,"y":15,"angle":-30,"fill":"#231fff","scaleX":0.15,"scaleY":0.15,"rotation":-30},"className":"Path"}]}]}]}'}},computed:Object(s["a"])(Object(s["a"])({},Object(r["mapGetters"])({Sale:"topo/konvaSale"})),{},{isDevice:function(){return!("device"!=this.$route.query.type&&!this.$route.query.deviceid)}}),watch:{},mounted:function(){},methods:Object(s["a"])(Object(s["a"])(Object(s["a"])({},Object(r["mapMutations"])({contextMenu:"topo/contextMenu"})),Object(r["mapActions"])({setKonva:"topo/Sale",initKonva:"topo/initKonva"})),{},{showMenu:function(){event.preventDefault();var e=event.clientX,t=event.clientY;this.contextMenuData.axis={x:e,y:t}},getPicture:function(){var e=document.createElement("a");e.href=topo.toDataURL,e.download="stage.png",document.body.appendChild(e),e.click(),document.body.removeChild(e)}})}),l=n,c=(a("a0b4"),a("bdd7")),d=Object(c["a"])(l,o,i,!1,null,"5782729c",null);t["default"]=d.exports},"664b":function(e,t,a){"use strict";a("4609")},"6df3":function(e,t,a){"use strict";(function(e){var o=a("e97b"),i=(a("1d17"),a("37c6"),a("1c6f"),a("04d6"),a("7690"),a("5880")),s=a("6db3"),r=/(\/\/)?[\w-]+(\.[\w-]+)+([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?$/,n=Object({NODE_ENV:"production",VUE_APP_TITLE:"物联网开发平台",VUE_APP_AUTHOR:"iotn2n",VUE_APP_UPDATE_TIME:"2022-01-13 11:36:25",VUE_APP_VERSION:"4.4.5",VUE_APP_Keywords:"一站式物联网PaaS平台|物联网应用服务",VUE_APP_Description:"提供物联网垂直领域应用使能平台及解决方案",VUE_APP_URL:"https://dev.iotn2n.com",BASE_URL:""}).CDN_URL,l=a("cad9"),c=r.test(n)?"".concat(n,"/assets/images/dgiot_release/topo/"):l.join(e,"".concat("","/assets/images/dgiot_release/topo/")),d=a("e043");t["a"]={name:"Allocation",data:function(){return{iconfont:d,busData:{coordinate:{},paths:[]},accept:".jpg,.jpeg,.png,.gif,.bmp,.pdf,.JPG,.JPEG,.PBG,.GIF,.BMP,.PDF",imgHost:c,icon:"24-hours-fill",layout:"total, prev, next",total:0,background:!0,height:0,selectRows:"",queryIcon:[],queryForm:{pageNo:1,pageSize:30,title:""},images:[],imgParams:{},activeNames:"icon"}},computed:{},created:function(){},mounted:function(){console.log(this.$router)},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){},methods:Object(o["a"])(Object(o["a"])({coordinate:function(e){var t={x:e.pageX,y:e.pageY};this.busData.coordinate=t},moveSvg:function(e){var t=Object(s["default"])(e,"path"),a=JSON.stringify(t.topo);console.info("getSvgPath function return ".concat(a)),this.busData.paths=a,this.$dgiotBus.$emit("busTopo","path",this.busData)},uploadCkick:function(){this.$refs["uploadFinish"].$refs.uploader.dispatchEvent(new MouseEvent("click"))}},Object(i["mapMutations"])({setFlag:"konva/setFlag",setDrawParams:"konva/setDrawParams"})),{},{handleChange:function(e){console.log(e)},fileInfo:function(e){console.log(e),this.dialogVisible=!this.dialogVisible,this.handleIcon(e.url)},handleIcon:function(e){var t=new Image,a=this;t.src=e+"?"+(new Date).getTime(),t.onload=function(){a.$set(a.imgParams,"width",t.width),a.$set(a.imgParams,"height",t.height),a.$set(a.imgParams,"src",t.src),console.log("图片加载完成",a.imgParams),a.$baseMessage(a.$translateTitle("图片加载完成,可双击画图区域填充"),"success",!1,"vab-hey-message-success")},a.setFlag("image"),a.setDrawParams(a.imgParams)}})}}).call(this,"/")},7882:function(e,t,a){},"79fed":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"Background"},[a("div",{staticClass:"demo-image__lazy"},e._l(e.urls,(function(t){return a("el-image",{key:t,attrs:{lazy:"",src:t},nativeOn:{click:function(a){return e.setKonvaBg(t)}}})})),1)])},i=[],s=a("e97b"),r=a("5880"),n={name:"Background",components:{},data:function(){return{BackgroundData:[],productconfig:{},BackgroundDialog:!1,infoData:"Background",BackgroundArgs:{},urls:["//img7.ddove.com/upload/20181127/134600237598.jpg"]}},methods:Object(s["a"])({},Object(r["mapActions"])({setKonvaBg:"topo/setKonvaBg"}))},l=n,c=(a("0471"),a("bdd7")),d=Object(c["a"])(l,o,i,!1,null,"2a8bcb9e",null);t["default"]=d.exports},"7baf":function(e,t,a){"use strict";a("d92c")},"83e5":function(e,t,a){"use strict";a("52f5")},"86c7":function(e,t,a){"use strict";a("c539")},"8aa3":function(e,t,a){"use strict";a("44c1")},"8d51":function(e,t,a){e.exports=a.p+"static/img/volume_mute_black_24dp.8b96109a.svg"},"8e26":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("vab-amis",{key:e.objectId,attrs:{schema:e.code,"show-help":!1}})},i=[],s=a("e97b"),r=a("5880"),n={name:"DgiotAmis",components:{},props:{objectId:{default:"",required:!0,type:String},code:{default:function(){},required:!0,type:Object}},data:function(){return{infoData:"dgiotAmis"}},computed:Object(s["a"])({},Object(r["mapGetters"])({viewData:"view/viewData"})),mounted:function(){var e=this;this.$dgiotBus.$off("setViewData"),this.$dgiotBus.$on("setViewData",(function(t){e.setData(t)})),this.$dgiotBus.$off("submitCode"),this.$dgiotBus.$on("submitCode",(function(t){e.$dgiotBus.$emit("saveLowCode",{id:e.objectId,data:{data:t}})}))},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){},methods:Object(s["a"])({},Object(r["mapMutations"])({setData:"view/setData"}))},l=n,c=a("bdd7"),d=Object(c["a"])(l,o,i,!1,null,null,null);t["default"]=d.exports},9397:function(e,t,a){"use strict";a("7882")},"9bfd":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"TopoScale-container"},[a("div",{staticClass:"TopoScale-container-content"},[a("i",{staticClass:"el-icon-zoom-out",on:{click:function(t){return e.setSize("out")}}}),a("div",{staticClass:"scale"},[e._v(" "+e._s(e.scale)+" ")]),a("i",{staticClass:"el-icon-zoom-in",on:{click:function(t){return e.setSize("in")}}})])])},i=[],s=a("e97b"),r=a("5880"),n={name:"TopoScale",components:{},data:function(){return{infoData:"TopoScale"}},computed:Object(s["a"])({},Object(r["mapGetters"])({scale:"topo/Sale"})),mounted:function(){},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){},methods:Object(s["a"])(Object(s["a"])({},Object(r["mapActions"])({setSale:"topo/setSale"})),{},{setSize:function(e){"out"===e?this.setSale(this.scale-10>=40?this.scale-10:this.scale):this.setSale(this.scale+10<=200?this.scale+10:this.scale)}})},l=n,c=(a("83e5"),a("bdd7")),d=Object(c["a"])(l,o,i,!1,null,"3c8bea0d",null);t["default"]=d.exports},a058:function(e,t,a){},a0b4:function(e,t,a){"use strict";a("301d")},aafa:function(e,t,a){},b99f:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"TopoThing-container"},[a("div",{staticClass:"TopoThing-content"},[a("span",{staticClass:"material-icons"},[e._v("home")]),e._v(" "+e._s(e.infoData)+" "),a("md-icon",[e._v("favorite")]),a("i",{staticClass:"material-icons"},[e._v("account_balance_wallet")])],1)])},i=[],s={name:"TopoThing",components:{},data:function(){return{infoData:"TopoThing"}},computed:{},mounted:function(){},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){},methods:{}},r=s,n=(a("beb7"),a("bdd7")),l=Object(n["a"])(r,o,i,!1,null,"3f158633",null);t["default"]=l.exports},b9e1:function(e,t,a){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},bc00:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"_vuekonva"},[a("div",{staticClass:"_dialog"},[a("el-dialog",{staticClass:"_shape",attrs:{"append-to-body":!0,visible:e.ShapeVisible,width:"100vh"},on:{"update:visible":function(t){e.ShapeVisible=t}}},["ShapeJson"==e.tabsName?a("span",{attrs:{slot:"footer"},slot:"footer"}):e._e()])],1),a("div",{staticClass:"_header",style:{display:e.headevisible?"block":"none"}},[a("topo-header",{ref:"topoheader",attrs:{drawerflag:e.drawer,productid:e.productid,"stop-mqtt":e.stop_Mqtt,value:e.value},on:{ImageTable:e.ImageTable,messageData:e.set_mqttflag,removeShape:e.removeShape,uploadFinish:e.uploadFinishs}})],1),a("div",{staticClass:"_mian"},[a("el-row",{staticClass:"_row",attrs:{gutter:e.gutter}},[a("transition",{attrs:{name:"fade"}},[a("el-col",{directives:[{name:"show",rawName:"v-show",value:e.showTable,expression:"showTable"}],attrs:{span:e.leftrow}},[a("div",{staticClass:"_left"},[a("topo-allocation")],1)])],1),a("el-col",{staticClass:"_konvarow",attrs:{span:24-e.rightrow}},[a("div",{ref:"konva",class:e.konvaClass,attrs:{id:"konva"}}),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.isDevice&&e.productid,expression:"!isDevice && productid"}],staticClass:"_info",style:{display:(e.infoFlag,"block")}},[a("el-row",{staticStyle:{"text-align":"center"},attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("el-button",{attrs:{disabled:e.productid.length<1,icon:"el-icon-s-management",plain:"",type:"success"},on:{click:function(t){return e.regulate("save")}}},[e._v(" "+e._s(e.$translateTitle("konva.save"))+" ")]),a("el-button",{attrs:{icon:"el-icon-arrow-up",plain:"",type:"success"},on:{click:function(t){return e.regulate("top")}}},[e._v(" "+e._s(e.headevisible?e.$translateTitle("konva.hide"):e.$translateTitle("konva.show"))+e._s(e.$translateTitle("konva.top"))+" ")]),a("el-button",{attrs:{icon:"el-icon-arrow-right",plain:"",type:"success"},on:{click:function(t){return e.regulate("right")}}},[e._v(" "+e._s(e.rightrow?e.$translateTitle("konva.hide"):e.$translateTitle("konva.show"))+e._s(e.$translateTitle("konva.right"))+" ")])],1)],1)],1)]),a("el-col",{attrs:{span:e.rightrow}},[a("topo-operation",{ref:"operation",on:{clearImg:e.clearImg,handleCloseSub:e.handleCloseSub,upImg:e.upProduct,upconfig:e.saveKonvaitem}})],1)],1)],1)])},i=[],s=a("fb07"),r=a("e97b"),n=a("d0d7"),l=a.n(n),c=(a("7983"),a("3dec"),a("3eb0"),a("9c6a"),a("1227"),a("71ef"),a("c4bc"),a("e472"),a("1ec3"),a("1d17"),a("9f39"),a("4656"),a("04d6"),a("7690"),a("ebfe"),a("d6a4"),a("969d")),d=a.n(c),u=a("ed08"),p=a("d44d"),m=a("2b3e"),b=a("5880"),f=a("0e2a"),g=a("7a1d"),v=a("7212"),h={components:Object(r["a"])({},Object(p["default"])(a("614c"))),data:function(){return{per:"100",rightFlag:!1,paramsconfig:{},productconfig:{},backgroundImage:"",gutter:24,leftrow:0,rightrow:0,productid:this.$route.query.productid||"",isDevice:"device"==this.$route.query.type,konvaClass:["konva","_center"],drawer:!1,ShapeVisible:!1,arrowFlag:!1,headevisible:!1,infoFlag:!1,arrowClass:"arrowClass",topic:"",stop_Mqtt:!0,tabsName:"ShapeJson",globalStageid:"",value:!1,kovaUpType:"",showTable:!1}},computed:Object(r["a"])(Object(r["a"])({},Object(b["mapGetters"])({graphColor:"konva/graphColor",drawing:"konva/drawing",graphNow:"konva/graphNow",pointStart:"konva/pointStart",draw:"konva/draw",flag:"konva/flag",drawParams:"konva/drawParams"})),{},{stageConfig:function(){var e=document.getElementsByClassName("konva");return{width:e[0].clientWidth,height:e[0].clientHeight,container:"container",id:"container"}}}),watch:{rightrow:{deep:!0,handler:function(e){this.rightFlag=0!==e}}},mounted:function(){this.productid?this.handleCloseSub():this._initCreate()},destroyed:function(){this.$refs.topoheader&&this.handleCloseSub()},methods:Object(r["a"])(Object(r["a"])({},Object(b["mapMutations"])({setDrawing:"konva/setDrawing",setPointStart:"konva/setPointStart",setDraw:"konva/setDraw",setFlag:"konva/setFlag",setGraphNow:"konva/setGraphNow",setGraphColor:"konva/setGraphColor",setDrawParams:"konva/setDrawParams"})),{},{uploadFinishs:function(e){var t=this.stage.find("Image");t.forEach((function(t){t.setAttrs({source:e}),console.log("img node ",t),t.draw()})),console.log("this.stage",this.stage,JSON.parse(this.stage.toJSON())),this.updataProduct(this.productid)},_initCreate:function(){var e=d.a;this.$refs.konva.style.backgroundImage="url(".concat(e,")")},set_mqttflag:function(e){this.stop_Mqtt=e},removeShape:function(e){var t,a=this,o=a.stage.find("Layer")[0];console.log("删除的节点",e);for(var i=a.stage.find("Image"),s=[],r=0;r<s.length;r++)s[r].destroy();null!==e&&void 0!==e&&null!==(t=e.attrs)&&void 0!==t&&t.image&&(console.log("is img",e.attrs.id),i.each((function(t){console.log("图片相关",t),t.attrs.id==e.attrs.id&&(console.log(t,"shape.target 找到了这个node 节点"),console.log(e,"shape.target 找到了这个node 节点"),t.remove(),t.destroy(),e.remove(),e.destroy(),o.draw())}))),console.log("删除的节点",e.remove()),a.stage.find("Transformer").map((function(e){console.log(e,"_Transformer")})),console.log(a.stage.find("Transformer"),a.stage.find()),e.remove(),o.draw(),a.setGraphNow(""),e.attrs.id==a.$refs["operation"].Shapeconfig.attrs.id&&(a.$refs["operation"].Shapeconfig=[]),a.updataProduct(this.productid)},ImageTable:function(e){this.leftrow=e?3:0,this.showTable=e},saveKonvaitem:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{index:1,opacity:1},a=this;console.log(a.stage.find("#".concat(e.attrs.id))),console.log("config.attrs.id",e.attrs.id);var o=a.stage.find("Text"),i=a.stage.find("Image"),s=a.stage.find("Group"),r=a.stage.find(e.attrs.id),n=a.stage.find("Layer")[0],l=r;console.log("stage",r);for(var c=[],d=0;d<c.length;d++)c[d].destroy(),c[d].remove();i.each((function(o){o.attrs.id==e.attrs.id&&(console.log("updata type is image",o,e),l=o,a.kovaUpType="Image",l.zIndex(t.zIndex),l.opacity(t.opacity),n.draw(),c.push(new Konva.Tween({node:o,Opacity:t.opacity,duration:1,zIndex:t.zIndex,easing:Konva.Easings.ElasticEaseOut}).play()))})),s.each((function(t){t.attrs.id==e.attrs.id&&(a.kovaUpType="Group",l=t,c.push(new Konva.Tween({node:Object.assign(t,e),Opacity:.8,duration:1,easing:Konva.Easings.ElasticEaseOut}).play()))})),o.each((function(t){t.attrs.id==e.attrs.id&&(a.kovaUpType="Text",l=t,c.push(new Konva.Tween({node:Object.assign(t,e),Opacity:.8,duration:1,easing:Konva.Easings.ElasticEaseOut}).play()))})),"Image"!=a.kovaUpType&&(l.zIndex(t.index),l.opacity(t.opacity),n.draw()),a.stage.batchDraw(),a.stage.attrs.id==e.attrs.id&&(a.kovaUpType="Layer",a.stage=e),console.clear(),console.info("updata type is ".concat(a.kovaUpType)),console.log("konva数据更新成功"),a.updataProduct(a.productid)},regulate:function(e){switch(e){case"save":this.updataProduct(this.$route.query.productid);break;case"info":alert(this.stage.toJSON());break;case"top":this.headevisible=!this.headevisible;break;case"right":this.toggleClass("rightrow");break;case"search":this.$message.success("开发中");break}},toggleClass:function(e){"rightrow"==e?this.rightrow=6==this.rightrow?0:6:this.leftrow=3==this.leftrow?0:3},clearImg:function(e){var t=" ";e&&(t=this.backgroundImage),console.log(e),console.log(this.backgroundImage),this.$refs["operation"].bachgroundurl=t},upProduct:function(e){var t=this;return Object(s["a"])(l.a.mark((function a(){var o,i,s;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!Object(u["isImage"])(e)){a.next=11;break}return o=t.productconfig.config,o.konva.background=e,i={config:o},a.next=6,Object(v["putProduct"])(t.productid,i);case 6:s=a.sent,console.log(s),s&&t.$message.success(t.$translateTitle("组态背景更新成功")),a.next=12;break;case 11:t.$message.error(t.$translateTitle("非图片类型"));case 12:case"end":return a.stop()}}),a)})))()},updataProduct:function(e){var t=this;return Object(s["a"])(l.a.mark((function a(){var o,i,s,r;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(console.log("updatatopo"),o=t.productconfig.config,"Layer"==t.kovaUpType){a.next=8;break}if(t.stage.toJSON()){a.next=5;break}return a.abrupt("return");case 5:i=JSON.parse(t.stage.toJSON()),a.next=9;break;case 8:i=t.stage;case 9:return o.konva.Stage=i,s=Object.assign(o,t.paramsconfig),r={config:s},a.next=14,Object(v["putProduct"])(e,r).then((function(e){console.log(e,"产品组态更新成功"),t.$message.success(t.$translateTitle("产品组态更新成功"))}))["catch"]((function(e){t.$message.error(t.$translateTitle("".concat(e.error)))}));case 14:case"end":return a.stop()}}),a)})))()},handleMqttMsg:function(e){var t=this,a=this,o=new RegExp("thing/"+e+"/post");f["Websocket"].add_hook(o,(function(e){var o,i=[];if(console.log("收到消息",e),Object(u["isBase64"])(e)){o=JSON.parse(Base64.decode(e)),console.log("消息解密消息",o),console.log(o.konva);var s=o.konva,r=t.stage.find("Text");console.log(r);for(var n=[],l=0;l<n.length;l++)n[l].destroy();s.each((function(e){r.each((function(t){e.id==t.attrs.id?(console.log("更新节点",e),console.log(t),t.text(e.text),n.push(new Konva.Tween({node:t,duration:1,easing:Konva.Easings.ElasticEaseOut}).play())):i.push(e.id)}))})),i&&console.log("以下组态id未更新",i),a.stage.batchDraw(),console.log("konva数据更新成功")}else console.log("非base64数据类型")}))},handleCloseSub:function(){var e=this;return Object(s["a"])(l.a.mark((function t(){var a,o,i,s,r,n,c,d,u,p,m,b,f,h,y;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,"device"==a.$route.query.type&&(a.productid=a.$route.query.deviceid),a.handleMqttMsg(a.productid),a.stop_Mqtt=!0,o=JSON.stringify({action:"stop_logger"}),i={topic:"thing/"+a.productid+"/post",text:o,retained:!0,qos:2},console.log("sendInfo",i),a.$refs.topoheader&&(console.log("订阅mqtt"),a.$refs.topoheader.handleCloseSub(i)),s=a.$route.query,r=s.productid,n=s.devaddr,c=void 0===n?void 0:n,d={productid:r,devaddr:c},t.next=12,Object(g["_getTopo"])(d);case 12:return u=t.sent,p=u.message,m=void 0===p?"":p,b=u.data,t.next=18,Object(v["queryProduct"])({where:{objectId:a.$route.query.productid}});case 18:f=t.sent,h=f.results,y=void 0===h?[]:h,a.productconfig=y[0],console.log(a.productconfig),"SUCCESS"==m&&(a.$refs["operation"]?a.$refs["operation"].productconfig=y[0]:console.log(" _this.$refs['operation']",a.$refs["operation"]),console.log(b.Stage.attrs.id),a.globalStageid=b.Stage.attrs.id,a.createKonva(b,a.globalStageid,"create"),a.paramsconfig={konva:b});case 24:case"end":return t.stop()}}),t)})))()},createKonva:function(e,t,a){var o;console.log("type",a);var i=this;o="create"!=a?e:e.Stage,console.log(e),console.log(o.attrs.height,o.attrs.width,"450"),o.attrs.height=i.stageConfig.height,o.attrs.width=i.stageConfig.width,console.log(o.attrs.height,o.attrs.width,"453");var s=document.querySelectorAll("._center")[0],r=document.createElement("div");s.appendChild(r),r.setAttribute("id",t),console.log("globalStageid",t),console.log(JSON.stringify(o),"Stage"),i.stage=Konva.Node.create(o,t),i.$refs.topobase.createTopo(i.stage.toJSON(),moment(new Date).valueOf()),console.log("_this.$refs.topobase",i.$refs.topobase),console.log("data",e);var n=i.stage.find("Layer")[0];i.stage.on("click",(function(e){var t=e.target;if(console.log(e,"stage node"),console.log(t,"stage target"),i.isDevice&&(t.attrs.draggable=!1,console.log("isDevice",t)),t==i.stage&&n.draw(),console.log(t.toJSON()),!i.isDevice&&(i.setGraphNow(e.target),i.$refs["operation"].Shapeconfig=JSON.parse(t.toJSON()),i.flag)){console.log("类型",i.flag),console.log("this.draw",i.draw),console.log("color",i.graphColor),console.log("drawParams",i.drawParams);var a=i.graphColor,o=i.flag;console.log("params",i.drawParams);var s=i.stage.find("Group")[0],r=e.evt,l=r.offsetX,c=r.offsetY,d=Object(m["default"])(o,l,c,a,i.drawParams);console.log("createState",d),s.add(d),n.draw(),n.batchDraw(),i.setFlag(""),i.setDraw(!1)}}));var l=i.stage.find("Group"),c=i.stage.find("Text");console.log(c,"Text"),!i.isDevice&&null!==c&&void 0!==c&&c.length&&c.forEach((function(e){e.on("mouseenter",(function(e){console.log(e,"Text mouseenter"),i.stage.container().style.cursor="move"})),e.on("mouseleave",(function(e){console.log(e,"Text mouseleave"),i.stage.container().style.cursor="default"})),e.on("dblclick",(function(e){var t,a=this;console.log(e,"Text dblclick"),console.log(i.stage.find("Transformer"),i.stage.find()),null!==(t=i.stage.find("Transformer"))&&void 0!==t&&t.length?i.stage.find("Transformer").destroy():console.log("_this.stage.find('Transformer')",i.stage.find("Transformer"));var o=this.getAbsolutePosition(),s=i.stage.container().getBoundingClientRect();console.log("eeeeeeeeeeeeeeeee",e);var r={x:s.left+o.x,y:s.top+o.y,color:e.target.attrs.fill,text:e.target.attrs.text},l=document.createElement("textarea");document.body.appendChild(l);var c=this.text();"双击编辑文字"===c?(l.value="",l.setAttribute("placeholder","请输入文字")):l.value=c,l.style.position="absolute",l.style.top=r.y+"px",l.style.left=r.x+"px",l.style.background="none",l.style.border="1px dashed #000",l.style.outline="none",l.style.color=r.color,l.focus(),this.setAttr("text",""),n.draw();var d=function(e){a.text(e||"双击编辑文字"),n.draw(),l&&document.body.removeChild(l)},u=function(e){13===e.keyCode&&(l.removeEventListener("blur",p),d(l.value))},p=function(){l.removeEventListener("keydown",u),d(l.value)};l.addEventListener("keydown",u),l.addEventListener("blur",p)}))})),i.isDevice&&i.productconfig&&i.konvaClass.push("isDevice"),console.log(l,"Group"),!i.isDevice&&null!==l&&void 0!==l&&l.length&&l.forEach((function(e){e.on("dblclick",(function(e){console.log(e,"Group dblclick");var t=new Konva.Transformer({borderStroke:"#000",borderStrokeWidth:1,borderDash:[5],keepRatio:!1,id:"Transformer_".concat(Object(u["uuid"])(6))});n.add(t),t.attachTo(e.target),n.draw(),console.log("#".concat(e.target.attrs.id));var a=e.target;console.log("当前图层层级",Number(a.zIndex())),i.setGraphNow(e.target),i.$refs["operation"].ShapeIndex=Number(a.zIndex()),i.$refs["operation"].ShapeOpacity=a.opacity(),i.rightrow||i.isDevice||(i.rightrow=6)})),e.on("mouseup",(function(e){console.log(e,"_G mouseup"),!i.isDevice&&i.productid&&(i.headevisible=!0),document.body.style.cursor="pointer"})),e.on("mouseover",(function(e){console.log(e,"_G mouseover"),document.body.style.cursor="pointer"})),e.on("mouseout",(function(e){console.log(e,"_G mouseout");var t=e.target.id(),a=i.stage.find((function(e){return e.id===t}));a.x=e.target.x(),a.y=e.target.y(),document.body.style.cursor="default"}))}));var d=i.stage.find("Image");d.forEach((function(e){console.log("img node ",e);var t=new Image;t.src=e.getAttr("source");var a=e.getAttr("source")+"?"+Date.parse(new Date);console.log("img",t,"$('#konva')",$("#current1")),$("#current1").css("background-image","url(".concat(a,")")),$("#current1").css("background-repeat","no-repeat"),$("#current1").css("background-size","100%,100%")})),!i.isDevice&&null!==l&&void 0!==l&&l.length&&l.forEach((function(e){e.on("dblclick",(function(e){console.log(e,"Group dblclick");var t=new Konva.Transformer({borderStroke:"#000",borderStrokeWidth:1,borderDash:[5],keepRatio:!1,id:"Transformer_".concat(Object(u["uuid"])(6))});n.add(t),t.attachTo(e.target),n.draw(),console.log("#".concat(e.target.attrs.id));var a=e.target;console.log("当前图层层级",Number(a.zIndex())),i.setGraphNow(e.target),i.$refs["operation"].ShapeIndex=Number(a.zIndex()),i.$refs["operation"].ShapeOpacity=a.opacity(),i.rightrow||i.isDevice||(i.rightrow=6)})),e.on("mouseup",(function(e){console.log(e,"Group mouseup"),!i.isDevice&&i.productid&&(i.headevisible=!0),document.body.style.cursor="pointer"})),e.on("mouseover",(function(e){console.log(e,"Group mouseover"),document.body.style.cursor="pointer"})),e.on("mouseout",(function(e){console.log(e,"Group mouseout");var t=e.target.id(),a=i.stage.find((function(e){return e.id===t}));a.x=e.target.x(),a.y=e.target.y(),document.body.style.cursor="default"}))})),n.draw(),n.batchDraw(),console.log("绘制完成"),this.$refs.topoheader&&this.$refs.topoheader.subscribe(i.productid)}})},y=h,w=(a("f3ca"),a("bdd7")),F=Object(w["a"])(y,o,i,!1,null,"989631b8",null);t["default"]=F.exports},bd42:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"operation"},[e.Shapeconfig.attrs?a("el-tabs",{attrs:{stretch:""},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("div",{staticClass:"unvisible"},[a("el-upload",{ref:"upload",staticClass:"upload-demo",staticStyle:{display:"none"},attrs:{action:"https://jsonplaceholder.typicode.com/posts/","before-remove":e.beforeRemove,"file-list":e.fileList,limit:1,multiple:"","on-exceed":e.handleExceed,"on-preview":e.handlePreview,"on-remove":e.handleRemove}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1),a("el-tab-pane",{attrs:{label:e.$translateTitle("konva.Configuration"),name:"setting"}},[e._l(e.Shapeconfig.attrs,(function(t,o,i){return a("el-form",{key:i,ref:"numberValidateForm",refInFor:!0,staticClass:"demo-ruleForm",attrs:{disabled:e.disabledForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:e.$translateTitle("konva."+o)}},[e.$loadsh.isString(e.Shapeconfig.attrs[o])?a("el-input",{attrs:{disabled:e.disableKey.includes(o)},model:{value:e.Shapeconfig.attrs[o],callback:function(t){e.$set(e.Shapeconfig.attrs,o,t)},expression:"Shapeconfig.attrs[key]"}},["fill"==o?a("el-color-picker",{attrs:{slot:"append","show-alpha":"",size:"mini"},slot:"append",model:{value:e.Shapeconfig.attrs[o],callback:function(t){e.$set(e.Shapeconfig.attrs,o,t)},expression:"Shapeconfig.attrs[key]"}}):e._e()],1):e._e(),e.$loadsh.isNumber(e.Shapeconfig.attrs[o])?a("el-input-number",{staticStyle:{width:"100%"},model:{value:e.Shapeconfig.attrs[o],callback:function(t){e.$set(e.Shapeconfig.attrs,o,t)},expression:"Shapeconfig.attrs[key]"}}):e._e(),e.$loadsh.isBoolean(e.Shapeconfig.attrs[o])?a("el-switch",{staticStyle:{width:"100%"},attrs:{"active-text":e.$translateTitle("konva.draggable"),"inactive-text":e.$translateTitle("konva.undraggable")},model:{value:e.Shapeconfig.attrs[o],callback:function(t){e.$set(e.Shapeconfig.attrs,o,t)},expression:"Shapeconfig.attrs[key]"}}):e._e()],1)],1)})),a("div",{staticClass:"footer-panel"},[a("el-button",{attrs:{type:"success"},nativeOn:{click:function(t){e.disabledForm=!e.disabledForm}}},[e._v(" "+e._s(e.$translateTitle("developer.edit"))+" ")]),a("el-button",{attrs:{type:"info"},nativeOn:{click:function(t){return e.saveKonvaitem(e.Shapeconfig)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.handleModule(e.wmxdialogVisible)}}},[e._v(" "+e._s(e.$translateTitle("product.physicalmodel"))+" ")])],1)],2),a("div",{staticClass:"TopoArom"},[a("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.wmxhandleClose,"close-on-click-modal":!1,title:e.wmxSituation+"自定义属性",top:"5vh",visible:e.wmxdialogVisible,width:"60%"},on:{"update:visible":function(t){e.wmxdialogVisible=t}}},[a("wmxdetail",{ref:"sizeForm",attrs:{"size-form1":e.sizeForm},on:{addDomain:e.addDomain,removeDomain:e.removeDomain,submitForm:e.submitForm,updataForm:e.updataForm,wmxhandleClose:e.wmxhandleClose}})],1)],1)],1):a("a-empty")],1)},i=[],s=a("fb07"),r=a("e97b"),n=a("d0d7"),l=a.n(n),c=(a("e0e4"),a("e170"),a("c1ab"),a("16b8"),a("c4bc"),a("f764"),a("5662"),a("f1e1"),a("aed5")),d=a("7212"),u=a("7a1d"),p=a("5880"),m={name:"Operation",components:{wmxdetail:c["default"]},props:{stopMqtt:{type:Boolean,default:!1},drawerflag:{type:Boolean,default:!1},value:{type:Boolean,default:!1}},data:function(){return{disabledForm:!0,disableKey:["id","container","type"],ShapeIndex:0,ShapeOpacity:1,properties:[],wmxSituation:"",wmxdialogVisible:!1,disableLable:["id"],hideLable:["draggable"],ShowItem:["container"],collapseName:["1"],allunit:{},wmxData:[],showNewItem:!0,disabledModule:!1,options:[],sizeOption:[],wmxstart:1,wmxPageSize:2,isVisible:!0,showJson:!0,sizerule:{type:"int"},fileList:[{name:"food.jpeg",url:"https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100"},{name:"food2.jpeg",url:"https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100"}],Shapeconfig:{},productconfig:{},bachgroundurl:"",activeName:"setting"}},computed:Object(r["a"])({},Object(p["mapGetters"])({sizeForm:"konva/sizeForm"})),watch:{Shapeconfig:{deep:!0,handler:function(e){this.disabledModule="Stage"==e.className}}},mounted:function(){},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){},methods:Object(r["a"])(Object(r["a"])({},Object(p["mapMutations"])({setSizeForm:"konva/setSizeForm"})),{},{removeDomain:function(e){var t=this.sizeForm.struct.indexOf(e);-1!==t&&this.sizeForm.struct.splice(t,1)},addDomain:function(){this.sizeForm.struct.push({attribute:"",attributevalue:""})},reset:function(e){var t={name:"",identifier:"",strategy:"20",resource:1,dis:"",dinumber:"528590",type:"int",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",unit:"",string:"",date:"String类型的UTC时间戳 (毫秒)",specs:{},round:"all",struct:[{attribute:"",attributevalue:""}],rate:1,offset:0,byteorder:"big",protocol:"normal",operatetype:"holdingRegister",originaltype:"int16",slaveid:256,collection:"%s",control:"%q",nobound:e};this.setSizeForm(t)},setZIndex:function(e,t){var a=this;return Object(s["a"])(l.a.mark((function o(){return l.a.wrap((function(o){while(1)switch(o.prev=o.next){case 0:a.$emit("upconfig",e,t);case 1:case"end":return o.stop()}}),o)})))()},handleModule:function(e){var t=this;return Object(s["a"])(l.a.mark((function a(){var o,i,s,r,n,c,d,p,m,b,f;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return o=t.productconfig.thing,i=void 0===o?{properties:[]}:o,s=i.properties,t.properties=s,console.log("properties",s),console.log("Shapeconfig",t.Shapeconfig),r={productid:t.$route.query.productid,shapeid:t.Shapeconfig.attrs.id},a.next=8,Object(u["get_konva_thing"])(r);case 8:if(n=a.sent,c=n.data,d=c.konvathing,p=c.nobound,console.log(d,"konvathing"),console.log(p,"nobound"),Object.values(d).length>0){if(t.wmxSituation="修改",console.log("物模型存在这个属性",d),console.log("this.wmxSituation",t.wmxSituation),t.reset(p),m={},-1!=["float","double","int","long"].indexOf(d.dataType.type))m={name:d.name,devicetype:d.devicetype,type:d.dataType.type,endnumber:t.$objGet(d,"dataType.specs.max"),startnumber:t.$objGet(d,"dataType.specs.min"),step:t.$objGet(d,"dataType.specs.step"),unit:t.$objGet(d,"dataType.specs.unit"),precision:t.$objGet(d,"dataType.specs.precision"),dis:t.$objGet(d,"dataForm.address"),round:t.$objGet(d,"dataForm.round"),dinumber:t.$objGet(d,"dataForm.data"),rate:t.$objGet(d,"dataForm.rate"),offset:t.$objGet(d,"dataForm.offset"),order:t.$objGet(d,"dataForm.order"),protocol:t.$objGet(d,"dataForm.protocol"),operatetype:t.$objGet(d,"dataForm.operatetype"),originaltype:t.$objGet(d,"dataForm.originaltype"),iscount:t.$objGet(d,"dataForm.iscount"),countstrategy:t.$objGet(d,"dataForm.countstrategy"),countround:t.$objGet(d,"dataForm.countround"),countcollection:t.$objGet(d,"dataForm.countcollection"),slaveid:t.$objGet(d,"dataForm.slaveid"),collection:"",control:"",strategy:"",required:!0,ico:d.ico,isread:d.accessMode,isshow:d.isshow,identifier:d.identifier,editdatatype:!0},d.dataForm&&(m.collection=d.dataForm.collection,m.control=d.dataForm.control,m.strategy=d.dataForm.strategy);else if("bool"==d.dataType.type)m={name:d.name,devicetype:d.devicetype,type:d.dataType.type,true:d.dataType.specs[1],false:d.dataType.specs[0],startnumber:t.$objGet(d,"dataType.specs.min"),step:t.$objGet(d,"dataType.specs.step"),unit:t.$objGet(d,"dataType.specs.unit"),round:t.$objGet(d,"dataForm.round"),dis:t.$objGet(d,"dataForm.address"),dinumber:t.$objGet(d,"dataForm.data"),rate:t.$objGet(d,"dataForm.rate"),offset:t.$objGet(d,"dataForm.offset"),order:t.$objGet(d,"dataForm.order"),protocol:t.$objGet(d,"dataForm.protocol"),operatetype:t.$objGet(d,"dataForm.operatetype"),originaltype:t.$objGet(d,"dataForm.originaltype"),slaveid:t.$objGet(d,"dataForm.slaveid"),iscount:t.$objGet(d,"dataForm.iscount"),countstrategy:t.$objGet(d,"dataForm.countstrategy"),countround:t.$objGet(d,"dataForm.countround"),countcollection:t.$objGet(d,"dataForm.countcollection"),required:!1,ico:d.ico,isread:d.accessMode,isshow:d.isshow,identifier:d.identifier,collection:void 0==d.dataForm?"":d.dataForm.collection,control:void 0==d.dataForm?"":d.dataForm.control,strategy:void 0==d.dataForm?"":d.dataForm.strategy,editdatatype:!0};else if("image"==d.dataType.type)m={name:d.name,devicetype:d.devicetype,type:d.dataType.type,imagevalue:d.dataType.imagevalue,startnumber:t.$objGet(d,"dataType.specs.min"),step:t.$objGet(d,"dataType.specs.step"),unit:t.$objGet(d,"dataType.specs.unit"),round:t.$objGet(d,"dataForm.round"),dis:t.$objGet(d,"dataForm.address"),dinumber:t.$objGet(d,"dataForm.data"),rate:t.$objGet(d,"dataForm.rate"),offset:t.$objGet(d,"dataForm.offset"),order:t.$objGet(d,"dataForm.order"),protocol:t.$objGet(d,"dataForm.protocol"),operatetype:t.$objGet(d,"dataForm.operatetype"),originaltype:t.$objGet(d,"dataForm.originaltype"),slaveid:t.$objGet(d,"dataForm.slaveid"),iscount:t.$objGet(d,"dataForm.iscount"),countstrategy:t.$objGet(d,"dataForm.countstrategy"),countround:t.$objGet(d,"dataForm.countround"),countcollection:t.$objGet(d,"dataForm.countcollection"),required:!1,ico:d.ico,isread:d.accessMode,isshow:d.isshow,identifier:d.identifier,collection:void 0==d.dataForm?"":d.dataForm.collection,control:void 0==d.dataForm?"":d.dataForm.control,strategy:void 0==d.dataForm?"":d.dataForm.strategy,editdatatype:!0};else if("enum"==d.dataType.type){for(f in b=[],d.dataType.specs)b.push({attribute:f,attributevalue:d.dataType.specs[f]});m={name:d.name,devicetype:d.devicetype,type:d.dataType.type,specs:d.dataType.specs,struct:b,startnumber:t.$objGet(d,"dataType.specs.min"),step:t.$objGet(d,"dataType.specs.step"),unit:t.$objGet(d,"dataType.specs.unit"),round:t.$objGet(d,"dataForm.round"),dis:t.$objGet(d,"dataForm.address"),dinumber:t.$objGet(d,"dataForm.data"),rate:t.$objGet(d,"dataForm.rate"),offset:t.$objGet(d,"dataForm.offset"),order:t.$objGet(d,"dataForm.order"),protocol:t.$objGet(d,"dataForm.protocol"),operatetype:t.$objGet(d,"dataForm.operatetype"),originaltype:t.$objGet(d,"dataForm.originaltype"),slaveid:t.$objGet(d,"dataForm.slaveid"),iscount:t.$objGet(d,"dataForm.iscount"),countstrategy:t.$objGet(d,"dataForm.countstrategy"),countround:t.$objGet(d,"dataForm.countround"),countcollection:t.$objGet(d,"dataForm.countcollection"),required:!0,ico:d.ico,isread:d.accessMode,isshow:d.isshow,identifier:d.identifier,collection:void 0==d.dataForm?"":d.dataForm.collection,control:void 0==d.dataForm?"":d.dataForm.control,strategy:void 0==d.dataForm?"":d.dataForm.strategy,editdatatype:!0}}else"struct"==d.dataType.type?m={name:d.name,devicetype:d.devicetype,type:d.dataType.type,struct:d.dataType.specs,startnumber:t.$objGet(d,"dataType.specs.min"),step:t.$objGet(d,"dataType.specs.step"),unit:t.$objGet(d,"dataType.specs.unit"),round:t.$objGet(d,"dataForm.round"),dis:t.$objGet(d,"dataForm.address"),dinumber:t.$objGet(d,"dataForm.data"),rate:t.$objGet(d,"dataForm.rate"),offset:t.$objGet(d,"dataForm.offset"),order:t.$objGet(d,"dataForm.order"),protocol:t.$objGet(d,"dataForm.protocol"),operatetype:t.$objGet(d,"dataForm.operatetype"),originaltype:t.$objGet(d,"dataForm.originaltype"),slaveid:t.$objGet(d,"dataForm.slaveid"),iscount:t.$objGet(d,"dataForm.iscount"),countstrategy:t.$objGet(d,"dataForm.countstrategy"),countround:t.$objGet(d,"dataForm.countround"),countcollection:t.$objGet(d,"dataForm.countcollection"),required:!0,ico:d.ico,isread:d.accessMode,isshow:d.isshow,collection:void 0==d.dataForm?"":d.dataForm.collection,control:void 0==d.dataForm?"":d.dataForm.control,identifier:void 0==d.dataForm?"":d.identifier,strategy:void 0==d.dataForm?"":d.dataForm.strategy,editdatatype:!0}:"text"==d.dataType.type?m={name:d.name,devicetype:d.devicetype,type:d.dataType.type,collection:void 0==d.dataForm?"":d.dataForm.collection,control:void 0==d.dataForm?"":d.dataForm.control,string:d.dataType.size,startnumber:t.$objGet(d,"dataType.specs.min"),step:t.$objGet(d,"dataType.specs.step"),unit:t.$objGet(d,"dataType.specs.unit"),round:t.$objGet(d,"dataForm.round"),dis:t.$objGet(d,"dataForm.address"),dinumber:t.$objGet(d,"dataForm.data"),rate:t.$objGet(d,"dataForm.rate"),offset:t.$objGet(d,"dataForm.offset"),order:t.$objGet(d,"dataForm.order"),protocol:t.$objGet(d,"dataForm.protocol"),operatetype:t.$objGet(d,"dataForm.operatetype"),originaltype:t.$objGet(d,"dataForm.originaltype"),slaveid:t.$objGet(d,"dataForm.slaveid"),iscount:t.$objGet(d,"dataForm.iscount"),countstrategy:t.$objGet(d,"dataForm.countstrategy"),countround:t.$objGet(d,"dataForm.countround"),countcollection:t.$objGet(d,"dataForm.countcollection"),required:!0,ico:d.ico,isread:d.accessMode,isshow:d.isshow,identifier:d.identifier,strategy:void 0==d.dataForm?"":d.dataForm.strategy,editdatatype:!0}:"date"==d.dataType.type?m={name:d.name,devicetype:d.devicetype,type:d.dataType.type,collection:void 0==d.dataForm?"":d.dataForm.collection,control:void 0==d.dataForm?"":d.dataForm.control,strategy:void 0==d.dataForm?"":d.dataForm.strategy,startnumber:t.$objGet(d,"dataType.specs.min"),step:t.$objGet(d,"dataType.specs.step"),unit:t.$objGet(d,"dataType.specs.unit"),round:t.$objGet(d,"dataForm.round"),dis:t.$objGet(d,"dataForm.address"),order:t.$objGet(d,"dataForm.order"),dinumber:t.$objGet(d,"dataForm.data"),rate:t.$objGet(d,"dataForm.rate"),offset:t.$objGet(d,"dataForm.offset"),protocol:t.$objGet(d,"dataForm.protocol"),operatetype:t.$objGet(d,"dataForm.operatetype"),originaltype:t.$objGet(d,"dataForm.originaltype"),slaveid:t.$objGet(d,"dataForm.slaveid"),iscount:t.$objGet(d,"dataForm.iscount"),countstrategy:t.$objGet(d,"dataForm.countstrategy"),countround:t.$objGet(d,"dataForm.countround"),countcollection:t.$objGet(d,"dataForm.countcollection"),required:!0,ico:d.ico,isread:d.accessMode,isshow:d.isshow,identifier:d.identifier,editdatatype:!0}:"geopoint"==d.dataType.type&&(m={name:d.name,devicetype:d.devicetype,type:d.dataType.type,gpstype:d.dataType.gpstype,collection:void 0==d.dataForm?"":d.dataForm.collection,control:void 0==d.dataForm?"":d.dataForm.control,strategy:void 0==d.dataForm?"":d.dataForm.strategy,startnumber:t.$objGet(d,"dataType.specs.min"),step:t.$objGet(d,"dataType.specs.step"),unit:t.$objGet(d,"dataType.specs.unit"),round:t.$objGet(d,"dataForm.round"),dis:t.$objGet(d,"dataForm.address"),order:t.$objGet(d,"dataForm.order"),dinumber:t.$objGet(d,"dataForm.data"),rate:t.$objGet(d,"dataForm.rate"),offset:t.$objGet(d,"dataForm.offset"),protocol:t.$objGet(d,"dataForm.protocol"),operatetype:t.$objGet(d,"dataForm.operatetype"),originaltype:t.$objGet(d,"dataForm.originaltype"),slaveid:t.$objGet(d,"dataForm.slaveid"),iscount:t.$objGet(d,"dataForm.iscount"),countstrategy:t.$objGet(d,"dataForm.countstrategy"),countround:t.$objGet(d,"dataForm.countround"),countcollection:t.$objGet(d,"dataForm.countcollection"),required:!0,ico:d.ico,isread:d.accessMode,isshow:d.isshow,identifier:d.identifier,editdatatype:!0});m.nobound=[],t.setSizeForm(m)}else t.wmxSituation="新增",console.log("this.wmxSituation",t.wmxSituation),console.log("物模型不为空，但不存在这个属性",t.Shapeconfig),t.reset(p),t.wmxData=[],t.sizeForm.name=t.Shapeconfig.attrs.text,t.sizeForm.isdis=!0;t.wmxdialogVisible=!e;case 15:case"end":return a.stop()}}),a)})))()},wmxhandleClose:function(){this.wmxdialogVisible=!1,this.Shapeconfig={},this.setSizeForm({}),this.$dgiotBus.$emit("refresh",this.$route)},updataForm:function(e){console.log("子组件改变的值"),console.log(e),this.setSizeForm(e)},submitForm:function(e){var t=this;console.log("sizeForm",e);var a={name:e.name,devicetype:e.devicetype,dataForm:{round:e.round,data:e.dinumber,address:e.dis,rate:e.rate,offset:e.offset,order:e.order,protocol:e.protocol,operatetype:e.operatetype,originaltype:e.originaltype,slaveid:e.slaveid,collection:e.collection,control:e.control,strategy:e.strategy,iscount:e.iscount,countstrategy:e.countstrategy,countround:e.countround,countcollection:e.countcollection},ico:e.ico,required:!0,accessMode:e.isread,isshow:e.isshow,identifier:e.identifier};if("float"==e.type||"double"==e.type||"int"==e.type||"long"==e.type){var o={dataType:{type:e.type.toLowerCase(),specs:{max:e.endnumber,min:e.startnumber,step:e.step,unit:""==e.unit?"":e.unit}}};Object.assign(a,o),this.showNewItem||(delete a.dataForm.operatetype,delete a.dataForm.originaltype,delete a.dataForm.slaveid)}else if("image"==e.type){o={dataType:{type:e.type.toLowerCase(),imagevalue:e.imagevalue,specs:{}}};Object.assign(a,o)}else if("bool"==e.type){o={dataType:{type:e.type.toLowerCase(),specs:{0:e["false"],1:e["true"]}}};Object.assign(a,o)}else if("enum"==e.type){var i={};e.struct.map((function(e){var t=e["attribute"];i[t]=e["attributevalue"]}));o={dataType:{type:e.type.toLowerCase(),specs:i}};Object.assign(a,o)}else if("struct"==e.type){o={dataType:{type:e.type.toLowerCase(),specs:e.struct}};Object.assign(a,o)}else if("string"==e.type){o={dataType:{type:e.type.toLowerCase(),size:e.string}};Object.assign(a,o)}else if("text"==e.type){o={dataType:{type:e.type.toLowerCase(),size:e.string,specs:{}}};Object.assign(a,o)}else if("date"==e.type){o={dataType:{type:e.type.toLowerCase()}};Object.assign(a,o)}else if("geopoint"==e.type){o={dataType:{type:e.type.toLowerCase(),gpstype:e.gpstype,specs:{}}};Object.assign(a,o)}var s={item:a,productid:this.$route.query.productid};Object(d["putThing"])(s).then((function(e){if(console.log("编辑",e),200==e.code){t.$message({type:"success",message:"编辑成功"});var o={identifier:a.identifier,name:a.name,productid:t.$route.query.productid,shapeid:t.Shapeconfig.attrs.id};Object(u["edit_konva_thing"])(o).then((function(e){console.log(e),t.handleCloseSub()})),t.wmxhandleClose()}else t.$message({type:"warning",message:"编辑失败"+e.msg})}))},selectStruct:function(){},wmxCurrentChange:function(){},wmxSizeChange:function(){},isShowItem:function(e){return!this.ShowItem.includes(e)},isdisabled:function(e){return this.disableLable.includes(e)},isShowLable:function(e){return!this.hideLable.includes(e)},updataImg:function(e){this.$emit("upImg",e)},saveKonvaitem:function(e){console.log(e),this.$emit("upconfig",e)},handleCloseSub:function(){this.$emit("handleCloseSub")},clearImg:function(){this.isVisible=!this.isVisible,this.$emit("clearImg",this.isVisible)},upload:function(){this.$refs["upload"].$children[0].$refs.input.click()},handleRemove:function(e,t){console.log(e,t)},handlePreview:function(e){console.log(e)},handleExceed:function(e,t){this.$message.warning("当前限制选择 3 个文件，本次选择了 ".concat(e.length," 个文件，共选择了 ").concat(e.length+t.length," 个文件"))},beforeRemove:function(e,t){return this.$confirm("确定移除 ".concat(e.name,"？"))}})},b=m,f=(a("8aa3"),a("bdd7")),g=Object(f["a"])(b,o,i,!1,null,"0aa5ec35",null);t["default"]=g.exports},be2a:function(e,t,a){"use strict";a("aafa")},beb7:function(e,t,a){"use strict";a("a058")},bf14:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"thing"},[a("el-dialog",{attrs:{"append-to-body":"",title:e.$translateTitle("topo.topo")+e.$translateTitle("topo.thing"),top:"5vh",visible:e.thingDialog},on:{"update:visible":function(t){e.thingDialog=t}}},[a("wmxdetail",{ref:"sizeForm",attrs:{"size-form1":e.sizeForm},on:{addDas:e.addDas,addDomain:e.addDomain,removeDas:e.removeDas,removeDomain:e.removeDomain,submitForm:e.submitForm,updataForm:e.updataForm,wmxhandleClose:e.wmxhandleClose}})],1)],1)},i=[],s=a("fb07"),r=a("e97b"),n=(a("e0e4"),a("e170"),a("16b8"),a("1227"),a("71ef"),a("1d17"),a("4c87"),a("b037"),a("c1ab"),a("3eb0"),a("3dec"),a("9c6a"),a("d0d7")),l=a.n(n),c=a("aed5"),d=a("7212"),u=a("7a1d"),p=a("5880"),m=a("8ba7"),b={name:"Thing",components:{wmxdetail:c["default"]},data:function(){return{productconfig:{},thingDialog:!1,infoData:"Thing",thingArgs:{},text:"text",shapeid:"",viewInfo:{},das:[],daslist:[]}},computed:Object(r["a"])({},Object(p["mapGetters"])({sizeForm:"konva/sizeForm"})),mounted:function(){var e=this;this.$route.query.viewid&&this.view(this.$route.query.viewid),this.$dgiotBus.$off("busUpdata"),this.$dgiotBus.$on("busUpdata",(function(){e.updataTopo()})),this.$baseEventBus.$off(this.$dgiotBus.topicKey("dgiot_thing","dgiotThing")),this.$baseEventBus.$on(this.$dgiotBus.topicKey("dgiot_thing","dgiotThing"),(function(t){console.log("aaaaa",t),t&&"bind_topo"==t.type&&e.bindTopo(t)}))},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){},methods:Object(r["a"])(Object(r["a"])({},Object(p["mapMutations"])({setSizeForm:"konva/setSizeForm"})),{},{view:function(e){var t=this;return Object(s["a"])(l.a.mark((function a(){var o,i,s;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(m["getView"])(e);case 2:o=a.sent,i=o.data,s=void 0===i?{}:i,t.viewInfo=s;case 6:case"end":return a.stop()}}),a)})))()},wmxhandleClose:function(){this.wmxdialogVisible=!1,this.setSizeForm({}),this.$dgiotBus.$emit("refresh",this.$route)},updataForm:function(e){console.log("子组件改变的值"),console.log(e),this.setSizeForm(e)},addDas:function(){console.log(this.sizeForm),this.sizeForm.daslist.push({addr:""})},removeDas:function(e){var t=this.sizeForm.daslist.indexOf(e);-1!==t&&this.sizeForm.daslist.splice(t,1)},submitForm:function(e){var t=this;console.log("sizeForm",e);var a={item:e,productid:this.$route.query.productid};Object(d["putThing"])(a).then((function(a){if(console.log("编辑",a),200==a.code){t.$message({type:"success",message:"编辑成功"});var o={identifier:e.identifier,name:e.name,productid:t.$route.query.productid,shapeid:t.shapeid};Object(u["edit_konva_thing"])(o).then((function(e){console.log(e)})),t.wmxhandleClose()}else t.$message({type:"warning",message:"编辑失败"+a.msg})}))},removeDomain:function(e){var t=this.sizeForm.struct.indexOf(e);-1!==t&&this.sizeForm.struct.splice(t,1)},addDomain:function(){this.sizeForm.struct.push({attribute:"",attributevalue:""})},updataTopo:function(){var e=this;return Object(s["a"])(l.a.mark((function t(){var a,o;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.$baseLoading(),t.prev=1,localStorage.setItem("konvaStale",canvas.stage.toJSON()),o={config:_.merge(e.productconfig,{konva:{Stage:JSON.parse(canvas.stage.toJSON())}})},e.$message.success(e.$translateTitle("user.update completed")),"Evidence"!=e.$route.query.type){t.next=11;break}return t.next=8,Object(m["putView"])(e.$route.query.viewid,{data:_.merge({konva:{Stage:JSON.parse(canvas.stage.toJSON())}},e.viewInfo)});case 8:t.t0=t.sent,t.next=14;break;case 11:return t.next=13,Object(d["putProduct"])(e.$route.query.productid,o);case 13:t.t0=t.sent;case 14:t.t0,a.close(),t.next=22;break;case 18:t.prev=18,t.t1=t["catch"](1),a.close(),console.log(t.t1);case 22:case"end":return t.stop()}}),t,null,[[1,18]])})))()},bindTopo:function(e){var t=this;return Object(s["a"])(l.a.mark((function a(){var o,i,s,r,n,c,d,p,m,b,f,g,v,h,y,w;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return o=t.$baseLoading(),t.thingArgs={args:e,id:e.id,productid:e.id.split("_")[0],text:e.text},console.log("args",e),a.prev=3,i={productid:e.id.split("_")[0],shapeid:e.id.slice(11)},t.shapeid=e.id,a.next=8,Object(u["get_konva_thing"])(i);case 8:if(s=a.sent,r=s.data,n=s.code,c=void 0===n?200:n,d=s.message,p=void 0===d?"":d,m=s.error,b=void 0===m?"":m,204!=c&&!b){a.next=20;break}return t.$baseMessage(p||b,"error",!1,"vab-hey-message-error"),o.close(),a.abrupt("return");case 20:if(f=r.konvathing,g=r.nobound,console.log(f,"konvathing"),console.log(g,"nobound"),Object.values(f).length>0){if(console.log("物模型存在这个属性",f),t.reset(g),v={},h=[],f.dataType.das.forEach((function(e){h.push({addr:e})})),-1!=["float","double","int","long"].indexOf(f.dataType.type))v={name:f.name,devicetype:f.devicetype,type:f.dataType.type,daslist:h,endnumber:t.$objGet(f,"dataType.specs.max"),startnumber:t.$objGet(f,"dataType.specs.min"),step:t.$objGet(f,"dataType.specs.step"),unit:t.$objGet(f,"dataType.specs.unit"),precision:t.$objGet(f,"dataType.specs.precision"),dis:t.$objGet(f,"dataForm.address"),round:t.$objGet(f,"dataForm.round"),dinumber:t.$objGet(f,"dataForm.data"),rate:t.$objGet(f,"dataForm.rate"),offset:t.$objGet(f,"dataForm.offset"),order:t.$objGet(f,"dataForm.order"),protocol:t.$objGet(f,"dataForm.protocol"),operatetype:t.$objGet(f,"dataForm.operatetype"),originaltype:t.$objGet(f,"dataForm.originaltype"),iscount:t.$objGet(f,"dataForm.iscount"),countstrategy:t.$objGet(f,"dataForm.countstrategy"),countround:t.$objGet(f,"dataForm.countround"),countcollection:t.$objGet(f,"dataForm.countcollection"),slaveid:t.$objGet(f,"dataForm.slaveid"),collection:"",control:"",strategy:"",required:!0,ico:f.ico,isread:f.accessMode,isshow:f.isshow,identifier:f.identifier,editdatatype:!0},f.dataForm&&(v.collection=f.dataForm.collection,v.control=f.dataForm.control,v.strategy=f.dataForm.strategy);else if("bool"==f.dataType.type)v={name:f.name,devicetype:f.devicetype,type:f.dataType.type,daslist:h,true:f.dataType.specs[1],false:f.dataType.specs[0],startnumber:t.$objGet(f,"dataType.specs.min"),step:t.$objGet(f,"dataType.specs.step"),unit:t.$objGet(f,"dataType.specs.unit"),round:t.$objGet(f,"dataForm.round"),dis:t.$objGet(f,"dataForm.address"),dinumber:t.$objGet(f,"dataForm.data"),rate:t.$objGet(f,"dataForm.rate"),offset:t.$objGet(f,"dataForm.offset"),order:t.$objGet(f,"dataForm.order"),protocol:t.$objGet(f,"dataForm.protocol"),operatetype:t.$objGet(f,"dataForm.operatetype"),originaltype:t.$objGet(f,"dataForm.originaltype"),slaveid:t.$objGet(f,"dataForm.slaveid"),iscount:t.$objGet(f,"dataForm.iscount"),countstrategy:t.$objGet(f,"dataForm.countstrategy"),countround:t.$objGet(f,"dataForm.countround"),countcollection:t.$objGet(f,"dataForm.countcollection"),required:!1,ico:f.ico,isread:f.accessMode,isshow:f.isshow,identifier:f.identifier,collection:void 0==f.dataForm?"":f.dataForm.collection,control:void 0==f.dataForm?"":f.dataForm.control,strategy:void 0==f.dataForm?"":f.dataForm.strategy,editdatatype:!0};else if("image"==f.dataType.type)v={name:f.name,devicetype:f.devicetype,type:f.dataType.type,daslist:h,imagevalue:f.dataType.imagevalue,startnumber:t.$objGet(f,"dataType.specs.min"),step:t.$objGet(f,"dataType.specs.step"),unit:t.$objGet(f,"dataType.specs.unit"),round:t.$objGet(f,"dataForm.round"),dis:t.$objGet(f,"dataForm.address"),dinumber:t.$objGet(f,"dataForm.data"),rate:t.$objGet(f,"dataForm.rate"),offset:t.$objGet(f,"dataForm.offset"),order:t.$objGet(f,"dataForm.order"),protocol:t.$objGet(f,"dataForm.protocol"),operatetype:t.$objGet(f,"dataForm.operatetype"),originaltype:t.$objGet(f,"dataForm.originaltype"),slaveid:t.$objGet(f,"dataForm.slaveid"),iscount:t.$objGet(f,"dataForm.iscount"),countstrategy:t.$objGet(f,"dataForm.countstrategy"),countround:t.$objGet(f,"dataForm.countround"),countcollection:t.$objGet(f,"dataForm.countcollection"),required:!1,ico:f.ico,isread:f.accessMode,isshow:f.isshow,identifier:f.identifier,collection:void 0==f.dataForm?"":f.dataForm.collection,control:void 0==f.dataForm?"":f.dataForm.control,strategy:void 0==f.dataForm?"":f.dataForm.strategy,editdatatype:!0};else if("enum"==f.dataType.type){for(w in y=[],f.dataType.specs)y.push({attribute:w,attributevalue:f.dataType.specs[w]});v={name:f.name,devicetype:f.devicetype,type:f.dataType.type,daslist:h,specs:f.dataType.specs,struct:y,startnumber:t.$objGet(f,"dataType.specs.min"),step:t.$objGet(f,"dataType.specs.step"),unit:t.$objGet(f,"dataType.specs.unit"),round:t.$objGet(f,"dataForm.round"),dis:t.$objGet(f,"dataForm.address"),dinumber:t.$objGet(f,"dataForm.data"),rate:t.$objGet(f,"dataForm.rate"),offset:t.$objGet(f,"dataForm.offset"),order:t.$objGet(f,"dataForm.order"),protocol:t.$objGet(f,"dataForm.protocol"),operatetype:t.$objGet(f,"dataForm.operatetype"),originaltype:t.$objGet(f,"dataForm.originaltype"),slaveid:t.$objGet(f,"dataForm.slaveid"),iscount:t.$objGet(f,"dataForm.iscount"),countstrategy:t.$objGet(f,"dataForm.countstrategy"),countround:t.$objGet(f,"dataForm.countround"),countcollection:t.$objGet(f,"dataForm.countcollection"),required:!0,ico:f.ico,isread:f.accessMode,isshow:f.isshow,identifier:f.identifier,collection:void 0==f.dataForm?"":f.dataForm.collection,control:void 0==f.dataForm?"":f.dataForm.control,strategy:void 0==f.dataForm?"":f.dataForm.strategy,editdatatype:!0}}else"struct"==f.dataType.type?v={name:f.name,devicetype:f.devicetype,type:f.dataType.type,daslist:h,struct:f.dataType.specs,startnumber:t.$objGet(f,"dataType.specs.min"),step:t.$objGet(f,"dataType.specs.step"),unit:t.$objGet(f,"dataType.specs.unit"),round:t.$objGet(f,"dataForm.round"),dis:t.$objGet(f,"dataForm.address"),dinumber:t.$objGet(f,"dataForm.data"),rate:t.$objGet(f,"dataForm.rate"),offset:t.$objGet(f,"dataForm.offset"),order:t.$objGet(f,"dataForm.order"),protocol:t.$objGet(f,"dataForm.protocol"),operatetype:t.$objGet(f,"dataForm.operatetype"),originaltype:t.$objGet(f,"dataForm.originaltype"),slaveid:t.$objGet(f,"dataForm.slaveid"),iscount:t.$objGet(f,"dataForm.iscount"),countstrategy:t.$objGet(f,"dataForm.countstrategy"),countround:t.$objGet(f,"dataForm.countround"),countcollection:t.$objGet(f,"dataForm.countcollection"),required:!0,ico:f.ico,isread:f.accessMode,isshow:f.isshow,collection:void 0==f.dataForm?"":f.dataForm.collection,control:void 0==f.dataForm?"":f.dataForm.control,identifier:void 0==f.dataForm?"":f.identifier,strategy:void 0==f.dataForm?"":f.dataForm.strategy,editdatatype:!0}:"text"==f.dataType.type?v={name:f.name,devicetype:f.devicetype,type:f.dataType.type,daslist:h,collection:void 0==f.dataForm?"":f.dataForm.collection,control:void 0==f.dataForm?"":f.dataForm.control,string:f.dataType.size,startnumber:t.$objGet(f,"dataType.specs.min"),step:t.$objGet(f,"dataType.specs.step"),unit:t.$objGet(f,"dataType.specs.unit"),round:t.$objGet(f,"dataForm.round"),dis:t.$objGet(f,"dataForm.address"),dinumber:t.$objGet(f,"dataForm.data"),rate:t.$objGet(f,"dataForm.rate"),offset:t.$objGet(f,"dataForm.offset"),order:t.$objGet(f,"dataForm.order"),protocol:t.$objGet(f,"dataForm.protocol"),operatetype:t.$objGet(f,"dataForm.operatetype"),originaltype:t.$objGet(f,"dataForm.originaltype"),slaveid:t.$objGet(f,"dataForm.slaveid"),iscount:t.$objGet(f,"dataForm.iscount"),countstrategy:t.$objGet(f,"dataForm.countstrategy"),countround:t.$objGet(f,"dataForm.countround"),countcollection:t.$objGet(f,"dataForm.countcollection"),required:!0,ico:f.ico,isread:f.accessMode,isshow:f.isshow,identifier:f.identifier,strategy:void 0==f.dataForm?"":f.dataForm.strategy,editdatatype:!0}:"date"==f.dataType.type?v={name:f.name,devicetype:f.devicetype,type:f.dataType.type,daslist:h,collection:void 0==f.dataForm?"":f.dataForm.collection,control:void 0==f.dataForm?"":f.dataForm.control,strategy:void 0==f.dataForm?"":f.dataForm.strategy,startnumber:t.$objGet(f,"dataType.specs.min"),step:t.$objGet(f,"dataType.specs.step"),unit:t.$objGet(f,"dataType.specs.unit"),round:t.$objGet(f,"dataForm.round"),dis:t.$objGet(f,"dataForm.address"),order:t.$objGet(f,"dataForm.order"),dinumber:t.$objGet(f,"dataForm.data"),rate:t.$objGet(f,"dataForm.rate"),offset:t.$objGet(f,"dataForm.offset"),protocol:t.$objGet(f,"dataForm.protocol"),operatetype:t.$objGet(f,"dataForm.operatetype"),originaltype:t.$objGet(f,"dataForm.originaltype"),slaveid:t.$objGet(f,"dataForm.slaveid"),iscount:t.$objGet(f,"dataForm.iscount"),countstrategy:t.$objGet(f,"dataForm.countstrategy"),countround:t.$objGet(f,"dataForm.countround"),countcollection:t.$objGet(f,"dataForm.countcollection"),required:!0,ico:f.ico,isread:f.accessMode,isshow:f.isshow,identifier:f.identifier,editdatatype:!0}:"geopoint"==f.dataType.type&&(v={name:f.name,devicetype:f.devicetype,type:f.dataType.type,daslist:h,gpstype:f.dataType.gpstype,collection:void 0==f.dataForm?"":f.dataForm.collection,control:void 0==f.dataForm?"":f.dataForm.control,strategy:void 0==f.dataForm?"":f.dataForm.strategy,startnumber:t.$objGet(f,"dataType.specs.min"),step:t.$objGet(f,"dataType.specs.step"),unit:t.$objGet(f,"dataType.specs.unit"),round:t.$objGet(f,"dataForm.round"),dis:t.$objGet(f,"dataForm.address"),order:t.$objGet(f,"dataForm.order"),dinumber:t.$objGet(f,"dataForm.data"),rate:t.$objGet(f,"dataForm.rate"),offset:t.$objGet(f,"dataForm.offset"),protocol:t.$objGet(f,"dataForm.protocol"),operatetype:t.$objGet(f,"dataForm.operatetype"),originaltype:t.$objGet(f,"dataForm.originaltype"),slaveid:t.$objGet(f,"dataForm.slaveid"),iscount:t.$objGet(f,"dataForm.iscount"),countstrategy:t.$objGet(f,"dataForm.countstrategy"),countround:t.$objGet(f,"dataForm.countround"),countcollection:t.$objGet(f,"dataForm.countcollection"),required:!0,ico:f.ico,isread:f.accessMode,isshow:f.isshow,identifier:f.identifier,editdatatype:!0});v.nobound=[],t.setSizeForm(v)}else t.reset(g),t.wmxData=[],t.sizeForm.name=e.id.split("_")[1],t.sizeForm.isdis=!0;t.thingDialog=!0,o.close(),a.next=32;break;case 28:a.prev=28,a.t0=a["catch"](3),o.close(),console.log(a.t0);case 32:case"end":return a.stop()}}),a,null,[[3,28]])})))()},reset:function(e){var t={name:"",identifier:"",strategy:"20",resource:1,dis:"",dinumber:"528590",type:"int",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",unit:"",string:"",date:"String类型的UTC时间戳 (毫秒)",specs:{},das:[],daslist:[],round:"all",struct:[{attribute:"",attributevalue:""}],rate:1,offset:0,byteorder:"big",protocol:"normal",operatetype:"holdingRegister",originaltype:"int16",slaveid:256,collection:"%s",control:"%q",nobound:e};this.setSizeForm(t)}})},f=b,g=(a("664b"),a("bdd7")),v=Object(g["a"])(f,o,i,!1,null,"35b687b3",null);t["default"]=v.exports},c23b:function(e,t,a){e.exports=a.p+"static/img/image_black_24dp.3284fb79.svg"},c250:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"TopoEvidence"},[a("el-dialog",{attrs:{title:e.$translateTitle("topo.topo")+e.$translateTitle("topo.thing"),visible:e.evidenceDialog,"append-to-body":"",top:"5vh"},on:{"update:visible":function(t){e.evidenceDialog=t}}},[e.evidence.id?a("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("i",{staticClass:"material-icons"},[e._v(" "+e._s(e.evidence.node.attrs.icon)+" ")]),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"}},[e._v(" "+e._s(e.evidence.id?e.evidence.id.split("_")[0]:"")+" ")])],1),a("div",[e._v(" 类型的图元处理逻辑 "),a("br"),e._v(" 对应数据 "+e._s(e.evidence.evidenceList)+" "),"timeline"===e.evidence.node.attrs.icon?a("div",[a("vabChart",{ref:"charts",attrs:{"after-config":e.afterConfig,data:e.chartData,"data-zoom":e.chartDataZoom,extend:e.chartExtend,loading:e.loading,"set-option-opts":!1,settings:e.chartSettings,toolbox:e.toolbox,type:"line"}})],1):"live_tv"===e.evidence.node.attrs.icon||"videocam_black"===e.evidence.node.attrs.icon||"volume_mute"===e.evidence.node.attrs.icon?a("div"):"image"===e.evidence.node.attrs.icon?a("div",[a("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{"preview-src-list":e.srcList,src:e.url}})],1):"folder_black"===e.evidence.node.attrs.icon?a("div"):a("div",[e._v(" 无该类型取证类型 "+e._s(e.evidence)+" ")])])]):e._e(),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.evidenceDialog=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.evidenceDialog=!1}}},[e._v(" 确 定 ")])],1)],1),a("div",{staticClass:"TopoEvidence-content"},e._l(e.materialIcons,(function(t,o){return a("div",{key:o,staticClass:"TopoEvidence-content-icons"},[a("i",{directives:[{name:"dragBox",rawName:"v-dragBox"}],staticClass:"material-icons",attrs:{draggable:""},on:{click:function(a){return e.evidenceHandle(t,o)}}},[e._v(" "+e._s(t.icon)+" "),a("br"),a("el-link",{attrs:{underline:!1}},[e._v(e._s(t.text))])],1)])})),0)],1)},i=[],s=a("fb07"),r=a("e97b"),n=a("d0d7"),l=a.n(n),c=a("5880"),d={name:"TopoEvidence",components:{},directives:{dragBox:function(e){var t=e;t.onclick=function(e){},t.onmousedown=function(e){var a=e.clientX-t.offsetLeft,o=e.clientY-t.offsetTop;t.onmousemove=function(e){var i=e.clientX-a,s=e.clientY-o;t.style.left=i+"px",t.style.top=s+"px"},t.onmouseup=function(e){}}}},data:function(){return{url:"https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg",srcList:["https://fuss10.elemecdn.com/8/27/f01c15bb73e1ef3793e64e6b7bbccjpeg.jpeg","https://fuss10.elemecdn.com/1/8e/aeffeb4de74e2fde4bd74fc7b4486jpeg.jpeg"],loading:!1,evidence:{},chartSettings:{},chartExtend:{series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40}},dataEmpty:!0,chartDataZoom:[{type:"slider"}],chartData:{columns:["日期","销售额"],rows:[{"日期":"1月1日","销售额":123},{"日期":"1月2日","销售额":1223},{"日期":"1月3日","销售额":2123},{"日期":"1月4日","销售额":4123},{"日期":"1月5日","销售额":3123},{"日期":"1月6日","销售额":7123}]},toolbox:{orient:"vertical",right:-5,feature:{dataZoom:{yAxisIndex:"none"},magicType:{type:["line","bar","histogram","pie","ring","waterfall","funnel","radar","heatmap","scatter","candle","stack"]},dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0},restore:{show:!0}}},thingData:[],evidenceDialog:!1,coordinate:{client:{},elePosition:{}},materialIcons:[{icon:"videocam_black",type:"video",text:"视频",path:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"},{icon:"volume_mute",type:"audio",text:"音频",path:"M7 9v6h4l5 5V4l-5 5H7z"},{icon:"image",type:"image",text:"图片",path:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"},{icon:"folder_black",type:"file",text:"文件",path:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"}]}},mounted:function(){var e=this;this.$dgiotBus.$on(this.$dgiotBus.topicKey("dgiot_evidence","dgiotEvidence"),(function(t){e.dgiotEvidence(t)}))},methods:Object(r["a"])(Object(r["a"])({},Object(c["mapMutations"])({createdEvidence:"topo/createdEvidence"})),{},{afterConfig:function(e){return e.tooltip.showDelay=500,e},dgiotEvidence:function(e){var t=this;return Object(s["a"])(l.a.mark((function a(){return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.evidenceDialog=!0,t.evidence=e;case 2:case"end":return a.stop()}}),a)})))()},evidenceHandle:function(e,t){this.createdEvidence(_.merge(e,{index:t,fill:"orange",productid:this.$route.query.productid}))}})},u=d,p=(a("86c7"),a("be2a"),a("bdd7")),m=Object(p["a"])(u,o,i,!1,null,"3b7b9524",null);t["default"]=m.exports},c539:function(e,t,a){},ca4b:function(e,t,a){e.exports=a.p+"static/img/videocam_black_24dp.7834d8f5.svg"},d859:function(e,t,a){"use strict";a("b9e1")},d92c:function(e,t,a){},da59f:function(e,t,a){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},dbd4a:function(e,t,a){},dbf5:function(e,t,a){"use strict";a("dbd4a")},e8d2:function(e,t,a){e.exports=a.p+"static/img/folder_black_24dp.143fa2e1.svg"},eb54:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{"append-to-body":"",visible:e.dialogFormVisible,width:"100vh"},on:{"update:visible":function(t){e.dialogFormVisible=t},close:e.close},scopedSlots:e._u([{key:"footer",fn:function(){return[a("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v(" "+e._s(e.$translateTitle("button.determine"))+" ")])]},proxy:!0}])},[a("el-form",{ref:"form",attrs:{"label-width":"80px",model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:"表名",prop:"class"}},[a("el-input",{model:{value:e.form.class,callback:function(t){e.$set(e.form,"class",t)},expression:"form.class"}})],1),a("el-form-item",{attrs:{label:"类型",prop:"type"}},[a("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),a("el-form-item",{attrs:{label:"key",prop:"key"}},[a("el-input",{model:{value:e.form.key,callback:function(t){e.$set(e.form,"key","string"===typeof t?t.trim():t)},expression:"form.key"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.title"),prop:"title"}},[a("el-input",{model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("task.data"),prop:"data"}},[a("div",{staticStyle:{height:"30vh",overflow:"auto"}},[a("vab-monaco-plus",{ref:"monacoCode",attrs:{codes:e.codes,language:"json","read-only":!1,theme:"vs-dark"}})],1)])],1)],1)},i=[],s=a("fb07"),r=a("e97b"),n=a("d0d7"),l=a.n(n),c=(a("7690"),a("04d6"),a("8ba7")),d=a("5880"),u={name:"TableEdit",data:function(){return{activeName:"first",amisKey:moment(new Date).format("X"),type:"",codes:"",viewId:"",form:{title:"",author:""},rules:{title:[{required:!0,trigger:"blur",message:"请输入标题"}],author:[{required:!0,trigger:"blur",message:"请输入作者"}]},title:"",dialogFormVisible:!1}},computed:Object(r["a"])({},Object(d["mapGetters"])({amisJson:"amis/amisJson"})),watch:{"form.data":{handler:function(e){this.codes=JSON.stringify(e,null,4)},immediate:!0,deep:!0}},created:function(){},methods:Object(r["a"])(Object(r["a"])({},Object(d["mapMutations"])({set_amisJson:"amis/set_amisJson"})),{},{showEdit:function(e){this.form=e,this.dialogFormVisible=!0},close:function(){this.dialogFormVisible=!1},save:function(){var e=this;this.$refs["form"].validate(function(){var t=Object(s["a"])(l.a.mark((function t(a){var o,i,s,r,n,d;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a){t.next=17;break}if(o=e.form,i=o.title,s=o.type,r=o.key,n={data:JSON.parse(e.$refs.monacoCode.monacoEditor.getValue()),class:e.form["class"],title:i,type:s,key:r},"add"!=e.type){t.next=10;break}return t.next=6,Object(c["postView"])(n);case 6:t.sent,e.$message.success("".concat(e.$translateTitle("user.Save the template successfully"))),t.next=15;break;case 10:return t.next=12,Object(c["putView"])(e.viewId,n);case 12:d=t.sent,d.msg,e.$message.success("".concat(e.$translateTitle("user.Save the template successfully")));case 15:e.$emit("fetch-data"),e.close();case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}})},p=u,m=a("bdd7"),b=Object(m["a"])(p,o,i,!1,null,null,null);t["default"]=b.exports},f14e8:function(e,t,a){e.exports=a.p+"static/img/live_tv_black_24dp.3c9cb926.svg"},f20e:function(e,t,a){},f27c:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"topo"}})},i=[],s=a("e97b"),r=a("5880"),n={name:"DgiotKonva",components:{},props:{objectId:{default:"",required:!0,type:String},code:{default:function(){},required:!0,type:Object}},data:function(){return{infoData:"dgiotKonva"}},mounted:function(){this.initKonva({data:this.code.Stage,id:"topo"})},methods:Object(s["a"])({},Object(r["mapMutations"])({initKonva:"topo/initKonva"}))},l=n,c=(a("dbf5"),a("bdd7")),d=Object(c["a"])(l,o,i,!1,null,"f78589fc",null);t["default"]=d.exports},f3ca:function(e,t,a){"use strict";a("57b5")},fd2f:function(e){e.exports=JSON.parse('{"type":"page","body":[{"body":[{"mode":"inline","name":"deviceid","size":"lg","type":"input-text","label":"报告编号","value":"0d82547a51"},{"mode":"inline","name":"taskname","size":"lg","type":"input-text","label":"任务名称"},{"mode":"inline","name":"taskitems","size":"lg","type":"select","label":"质检项目","source":"","options":[{"label":"南方家用泵","value":"c5f31fa3a4"}],"autoFill":{},"checkAll":false,"autoComplete":""},{"mode":"inline","name":"starttime","size":"lg","type":"input-datetime","label":"开始时间"},{"mode":"inline","name":"endtime","size":"lg","type":"input-datetime","label":"结束时间"}],"type":"collapse","title":"检测任务基本信息","visible":"","className":"bg-white wrapper b-2x p-b-xs m-b-xs","collapsed":false,"bodyClassName":"m","headingClassName":"font-thin text-lg b-light m-t-xs","clearValueOnHidden":false},{"body":[{"mode":"inline","name":"product","size":"lg","type":"select","label":"测试台体","source":"","options":[{"label":"南方泵业台体","value":"0399cc8e58"}],"autoFill":{},"checkAll":false,"autoComplete":""},{"mode":"inline","name":"ack","size":"lg","type":"select","label":"所属组织","source":"","options":[{"label":"admin","value":"A"},{"label":"立欧泵业","value":"B"}],"autoFill":{},"checkAll":false,"autoComplete":""}],"type":"collapse","title":"检测资源信息","className":"bg-white wrapper b-2x p-b-xs m-b-xs","collapsed":false,"bodyClassName":"m","headingClassName":"font-thin text-lg b-light m-t-xs"},{"tabs":[{"body":[{"mode":"inline","name":"productname","size":"lg","type":"select","label":"产品名称","options":[{"label":"中开泵","value":"中开泵"},{"label":"多级泵","value":"多级泵"},{"label":"斜流泵","value":"斜流泵"},{"label":"长轴泵","value":"长轴泵"},{"label":"渣浆泵","value":"渣浆泵"},{"label":"中开多级泵","value":"中开多级泵"},{"label":"液下多级泵","value":"液下多级泵"},{"label":"离心泵","value":"离心泵"},{"label":"多级离心泵","value":"多级离心泵"}],"checkAll":false},{"mode":"inline","name":"pumptype","size":"lg","type":"input-text","label":"水泵型号"},{"mode":"inline","name":"factorynumber","size":"lg","type":"input-text","label":"出厂编号"},{"mode":"inline","name":"wordnumber","size":"lg","type":"input-text","label":"报告编号"},{"mode":"inline","name":"productnumber","size":"lg","type":"input-text","label":"产品编号"}],"title":"基本信息"},{"body":[{"mode":"inline","name":"select","size":"lg","type":"select","label":"测试点个数","options":[{"label":"1","value":1},{"label":"2","value":2},{"label":"3","value":3},{"label":"4","value":4},{"label":"5","value":5}],"checkAll":false}],"title":"规定点信息"},{"body":[{"name":"radios","type":"radios","label":"检测精度","options":[{"label":"一级","value":"A"},{"label":"二级","value":"B"},{"label":"三级","value":"C"}],"joinValues":true}],"title":"测试设置"}],"type":"tabs","tabsMode":"card","className":"","contentClassName":"m"},{"body":[{"body":[{"mode":"inline","name":"deviceid","size":"lg","type":"input-text","label":"报告编号","value":"0d82547a51"},{"mode":"inline","name":"taskname","size":"lg","type":"input-text","label":"任务名称"},{"mode":"inline","name":"taskitems","size":"lg","type":"select","label":"质检项目","source":"","options":[{"label":"南方家用泵","value":"c5f31fa3a4"}],"autoFill":{},"checkAll":false,"autoComplete":""},{"mode":"inline","name":"starttime","size":"lg","type":"input-datetime","label":"开始时间"},{"mode":"inline","name":"endtime","size":"lg","type":"input-datetime","label":"结束时间"}],"type":"collapse","title":"检测任务基本信息","visible":"","className":"bg-white wrapper b-2x p-b-xs m-b-xs","collapsed":false,"bodyClassName":"m","headingClassName":"font-thin text-lg b-light m-t-xs","clearValueOnHidden":false},{"body":[{"mode":"inline","name":"product","size":"lg","type":"select","label":"测试台体","source":"","options":[{"label":"南方泵业台体","value":"0399cc8e58"}],"autoFill":{},"checkAll":false,"autoComplete":""},{"mode":"inline","name":"ack","size":"lg","type":"select","label":"所属组织","source":"","options":[{"label":"admin","value":"A"},{"label":"立欧泵业","value":"B"}],"autoFill":{},"checkAll":false,"autoComplete":""}],"type":"collapse","title":"检测资源信息","className":"bg-white wrapper b-2x p-b-xs m-b-xs","collapsed":false,"bodyClassName":"m","headingClassName":"font-thin text-lg b-light m-t-xs"},{"tabs":[{"body":[{"mode":"inline","name":"productname","size":"lg","type":"select","label":"产品名称","options":[{"label":"中开泵","value":"中开泵"},{"label":"多级泵","value":"多级泵"},{"label":"斜流泵","value":"斜流泵"},{"label":"长轴泵","value":"长轴泵"},{"label":"渣浆泵","value":"渣浆泵"},{"label":"中开多级泵","value":"中开多级泵"},{"label":"液下多级泵","value":"液下多级泵"},{"label":"离心泵","value":"离心泵"},{"label":"多级离心泵","value":"多级离心泵"}],"checkAll":false},{"mode":"inline","name":"pumptype","size":"lg","type":"input-text","label":"水泵型号"},{"mode":"inline","name":"factorynumber","size":"lg","type":"input-text","label":"出厂编号"},{"mode":"inline","name":"wordnumber","size":"lg","type":"input-text","label":"报告编号"},{"mode":"inline","name":"productnumber","size":"lg","type":"input-text","label":"产品编号"}],"title":"基本信息"},{"body":[{"mode":"inline","name":"select","size":"lg","type":"select","label":"测试点个数","options":[{"label":"1","value":1},{"label":"2","value":2},{"label":"3","value":3},{"label":"4","value":4},{"label":"5","value":5}],"checkAll":false}],"title":"规定点信息"},{"body":[{"name":"radios","type":"radios","label":"检测精度","options":[{"label":"一级","value":"A"},{"label":"二级","value":"B"},{"label":"三级","value":"C"}],"joinValues":true}],"title":"测试设置"}],"type":"tabs","tabsMode":"card","className":"","contentClassName":"m"}],"type":"page","style":{},"title":"任务详情","initApi":{"url":"iotapi/classes/Device/${deviceid}","data":{},"method":"get","sendOn":"","adaptor":"return {\\r\\n  \\"status\\": 0,\\r\\n  \\"msg\\": \\"\\",\\r\\n  \\"data\\": {\\r\\n    \\"taskname\\":response.data.basedata.taskname,\\r\\n  }\\r\\n}","dataType":"json","requestAdaptor":"return {  \\r\\n  data{basedata:\\r\\n   ...api.data\\r\\n   }\\r\\n}\\r\\n  "},"regions":["header","body"],"messages":{},"className":"","bodyClassName":"","headerClassName":""}],"style":{},"title":"任务详情","initApi":{"url":"iotapi/classes/Device/${deviceid}","method":"get","adaptor":"return {\\r\\n    data:response.data.basedata\\r\\n}"},"regions":["header","body"],"messages":{},"className":"","bodyClassName":"","headerClassName":""}')},fe20:function(e,t,a){"use strict";a("3b9a")}}]);