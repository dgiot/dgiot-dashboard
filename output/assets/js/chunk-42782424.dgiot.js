/*!
 *  build: 杭州数蛙科技有限公司 
 *  copyright: dgiot-dashboard 
 *  author: h7ml(h7ml@qq.com) 
 *  Time: 2022-01-17 03:27:36
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-42782424"],{"076a":function(e,t,a){"use strict";a("e4b2c")},"0adb":function(e,t,a){"use strict";a("7dae")},"0b48":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"log log-container"},[a("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose,title:e.$translateTitle("node.joincluster"),visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("span",[e._v(e._s(e.$translateTitle("node.nodename")))]),a("el-input",{attrs:{type:"text"},model:{value:e.form.nodename,callback:function(t){e.$set(e.form,"nodename",t)},expression:"form.nodename"}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.join.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1)],1)},n=[],o=a("bb22"),i={data:function(){return{form:{nodename:""},height:this.$baseTableHeight(0)-25,tableData5:[],node:null,start:1,length:10,total:0,draw:1,search:"",dialogVisible:!1,installtion:[],selsectinstall:[{value:"info",label:"info"},{value:"error",label:"error"},{value:"warning",label:"warning"},{value:"debug",label:"debug"},{value:"mqtt",label:"mqtt"},{value:"kafka",label:"kafka"},{value:"alert",label:"alert"},{value:"critical",label:"critical"},{value:"emergency",label:"emergency"},{value:"notice",label:"notice"}]}},mounted:function(){this.Getinformation()},methods:{Getinformation:function(){var e=this;Object(o["getNode"])(this.start,this.lengt).then((function(t){t&&(e.tableData5=t.nodes,e.total=t.nodes.length)}))},handleSizeChange:function(e){this.length=e,this.start=1},handleCurrentChange:function(e){this.start=e},join:function(){var e=this;Object(o["joinNode"])("join",this.form.nodename).then((function(t){t&&(e.$message({type:"success",message:"加入成功"}),e.dialogVisible=!1,e.Getinformation())}))["catch"]((function(t){e.$message(t.error)}))},removeNode:function(e){var t=this;Object(o["joinNode"])("leave",e.node).then((function(e){e&&(t.$message({type:"success",message:"移除成功"}),t.Getinformation())}))["catch"]((function(e){t.$message(e.error)}))},install:function(){this.dialogVisible=!0},handleClose:function(){this.dialogVisible=!1}}},s=i,l=a("bdd7"),c=Object(l["a"])(s,r,n,!1,null,null,null);t["default"]=c.exports},"0eb6":function(e,t,a){},1458:function(e,t,a){"use strict";a("ea2b")},1855:function(e,t,a){},"1a2d5":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"custom-table",staticClass:"custom-table-container"},[r("el-drawer",{directives:[{name:"drawerDrag",rawName:"v-drawerDrag"}],attrs:{"append-to-body":"",size:"90%",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("iframe",{staticStyle:{width:"100%",height:"100%"},attrs:{src:e.officeapps}})]),r("el-drawer",{directives:[{name:"drawerDrag",rawName:"v-drawerDrag"}],attrs:{"append-to-body":"",size:"90%",visible:e.statisticsVisible},on:{"update:visible":function(t){e.statisticsVisible=t}}},[r("evidence-statistics",{ref:"statistics",attrs:{"evidence-id":e.evidenceId}})],1),r("div",{staticClass:"components"},[r("el-dialog",{attrs:{"append-to-body":"",visible:e.evidenceDialog},on:{"update:visible":function(t){e.evidenceDialog=t}}},[r("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[r("el-table",{attrs:{border:"",data:e.evidences,stripe:""}},[r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("cloudTest.number"),"show-overflow-tooltip":"",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.$index;return[e._v(" "+e._s(a+1)+" ")]}}])}),r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("cloudTest.evidence"),"min-width":"180",prop:"row.original.path","show-overflow-tooltip":"",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-link",{attrs:{href:e.$FileServe+a.original.path,target:"_blank"}},[e._v(" "+e._s(a.original.path.split("/")[""+(a.original.path.split("/").length-1)])+" ")])]}}])}),r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("deviceLog.type"),prop:"row.original.type","show-overflow-tooltip":"",sortable:"",width:180},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-tag",{attrs:{effect:"plain"}},[e._v(" "+e._s(e.$translateTitle("cloudTest."+a.original.type))+" ")])]}}])}),r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("cloudTest.single audit"),"show-overflow-tooltip":"",width:180},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-tag",{attrs:{effect:"dark",type:["","success","danger"][["未审核","通过审核","不通过审核"].indexOf(a.original.status)]}},[e._v(" "+e._s(a.original.status)+" ")])]}}])}),3==Number(e.$route.query.step)?r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("cloudTest.single audit opinion"),width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;t.$index;return[r("el-input",{attrs:{size:"mini"},model:{value:a.original.message,callback:function(t){e.$set(a.original,"message",t)},expression:"row.original.message"}})]}}],null,!1,847914733)}):e._e(),3==Number(e.$route.query.step)?r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("cloudTest.submit review"),width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-button",{attrs:{plain:""},nativeOn:{click:function(t){return e.changeItem(a)}}},[e._v(" "+e._s(e.$translateTitle("cloudTest.submit review"))+" ")])]}}],null,!1,3508204407)}):e._e()],1)],1)],1),r("vab-dialog",{attrs:{show:e.activePopShow},on:{"update:show":function(t){e.activePopShow=t}}},[r("h2",{attrs:{slot:"title"},slot:"title"},[e._v(" "+e._s(e.$translateTitle("cloudTest.addwordtask"))+" ")]),r("div",{staticClass:"content"},[r("el-divider",[e._v(" "+e._s(e.$translateTitle("cloudTest.Basic information of inspection tasks"))+" ")]),r("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{"element-loading-background":"rgba(0, 0, 0, 0.8)","element-loading-spinner":"el-icon-loading","element-loading-text":e.$translateTitle("developer.Waitingtoreturn"),"label-width":"100px",model:e.ruleForm,rules:e.rules,size:"mini"}},[r("el-form-item",{attrs:{label:e.$translateTitle("cloudTest.taskname"),prop:"name"}},[r("el-input",{model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),r("el-form-item",{attrs:{label:e.$translateTitle("cloudTest.wordtemplate"),prop:"templatename"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("task.Select"),"value-key":"objectId"},on:{change:e.categoryChange},model:{value:e.ruleForm.templatename,callback:function(t){e.$set(e.ruleForm,"templatename",t)},expression:"ruleForm.templatename"}},e._l(e.categorylist,(function(e){return r("el-option",{key:e.objectId,attrs:{label:e.name,value:e}})})),1)],1),r("el-form-item",{attrs:{label:e.$translateTitle("cloudTest.testbed"),prop:"testbed"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("task.Select"),"value-key":"objectId"},on:{change:e.testbedChange},model:{value:e.ruleForm.testbed,callback:function(t){e.$set(e.ruleForm,"testbed",t)},expression:"ruleForm.testbed"}},e._l(e.grouplist,(function(e){return r("el-option",{key:e.objectId,attrs:{label:e.name,value:e}})})),1)],1)],1),r("div",{staticStyle:{"text-align":"right"},attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return e.submitForm("ruleForm")}}},[r("i",{staticClass:"el-icon-finished"},[e._v(" "+e._s(e.$translateTitle("product.createnow"))+" ")])])],1)],1)])],1),r("vab-query-form",[r("vab-query-form-left-panel",[r("el-form",{ref:"form",attrs:{inline:!0,model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",[r("el-input",{attrs:{placeholder:e.$translateTitle("cloudTest.Please select review status")},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),r("el-form-item",[r("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},nativeOn:{click:function(t){return e.fetchData()}}},[e._v(" "+e._s(e.$translateTitle("cloudTest.search"))+" ")])],1)],1)],1)],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:e.border,data:e.list.examination,size:e.lineHeight,stripe:e.stripe},scopedSlots:e._u([{key:"empty",fn:function(){return[r("el-image",{staticClass:"vab-data-empty",attrs:{src:a("c2ad")}})]},proxy:!0}])},[r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("cloudTest.number"),"show-overflow-tooltip":"",width:"95"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.$index;return[e._v(" "+e._s(a+1)+" ")]}}])}),e._l(e.finallyColumns,(function(t,a){return r("el-table-column",{key:a,attrs:{align:"center",label:e.$translateTitle("cloudTest."+t.label),prop:t.prop,"show-overflow-tooltip":"",sortable:t.sortable,width:t.width}})})),r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("deviceLog.status"),"show-overflow-tooltip":"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:-1==a.profile.step,expression:"row.profile.step == -1"}],staticClass:"item",attrs:{content:a.profile.message,effect:"dark",placement:"top-start"}},[r("el-tag",{attrs:{effect:"dark",type:"warning"}},[e._v(" "+e._s(e.$translateTitle("cloudTest.notapproved"))+" ")])],1),r("el-tag",{directives:[{name:"show",rawName:"v-show",value:-1!=a.profile.step,expression:"row.profile.step != -1"}],attrs:{effect:"dark",type:["info","warning","primary","primary"][a.profile.step?a.profile.step:0]}},[e._v(" "+e._s([e.$translateTitle("product.notstarted"),e.$translateTitle("product.testing"),e.$translateTitle("product.pending review"),e.$translateTitle("product.review completed"),e.$translateTitle("product.report generated")][a.profile.step]||e.$translateTitle("product.finishtest"))+" ")])]}}])}),r("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("cloudTest.operate"),width:"480"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-button",{directives:[{name:"show",rawName:"v-show",value:2==a.profile.step,expression:"row.profile.step == 2"}],attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return e.handleUnderreview(a.objectId)}}},[e._v(" "+e._s(e.$translateTitle("product.Underreview"))+" ")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:3==a.profile.step,expression:"row.profile.step == 3"}],attrs:{size:"mini",type:"success"},nativeOn:{click:function(t){return e.handleReport(a)}}},[e._v(" "+e._s(e.$translateTitle("product.generate"))+" ")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:4==a.profile.step,expression:"row.profile.step == 4"}],attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return e.handleReport(a)}}},[e._v(" "+e._s(e.$translateTitle("application.preview report"))+" ")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:a.profile.step>=4,expression:"row.profile.step >= 4"}],attrs:{size:"mini",type:"info"},nativeOn:{click:function(t){return e.handleEvidence(a.objectId)}}},[e._v(" "+e._s(e.$translateTitle("application.List evidence"))+" ")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:a.profile.step>=4,expression:"row.profile.step >= 4"}],attrs:{size:"mini",type:"success"},nativeOn:{click:function(t){return e.handleRouter(a)}}},[e._v(" "+e._s(e.$translateTitle("application.evidence"))+" ")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!=a.profile.step,expression:"row.profile.step != -1"}],attrs:{size:"mini",type:"danger"},nativeOn:{click:function(t){return e.handleHistory(a)}}},[e._v(" 历史数据 ")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!=a.profile.step,expression:"row.profile.step != -1"}],attrs:{size:"mini",type:"success"},nativeOn:{click:function(t){return e.handleManagement(a)}}},[e._v(" "+e._s(e.$translateTitle("task.Configuration"))+" ")])]}}])})],2),r("vab-parser-pagination",{key:e.list.examination.length+"examination",ref:"examination",attrs:{pagination:e.paginations,"query-payload":e.queryPayload},on:{pagination:e.fetchData,paginationQuery:e.paginationQuery}}),r("lowcode-design",{ref:"lowcodeDesign",on:{objectId:e.lowcodeId}})],1)},n=[],o=a("fb07"),i=a("e97b"),s=a("d0d7"),l=a.n(s),c=(a("a0e0"),a("3dec"),a("f764"),a("5662"),a("16b8"),a("7690"),a("3eb0"),a("9c6a"),a("1d17"),a("4c87"),a("b8f1"),a("d6a4"),a("209d")),u=a("8387"),d=a("1285"),p=a("cdef"),m=a("289a"),g=a.n(m),f=a("5880"),h=a("7212"),b=a("8ba7"),v=a("c008"),y=window["vue-aliplayer-v2"]["default"],w={name:"ReviewIndex",components:{VabDraggable:g.a,lowcodeDesign:c["default"],evidenceStatistics:u["default"],"vue-aliplayer-v2":y},data:function(){var e,t;return{statisticsVisible:!1,evidenceId:"",aliplayer:{autoplay:!1,height:"200px"},types:{video:["video","videocam_black"],audio:["audio","volume_mute"],image:["image","image"],file:["file","archive"]},evidences:[],evidenceDialog:!1,activeName:null!==this&&void 0!==this&&null!==(e=this.$route)&&void 0!==e&&null!==(t=e.query)&&void 0!==t&&t.tabs&&"examination"==this.$route.query.tabs?"examination":"forensics",officeapps:"",dialogVisible:!1,paginations:{layout:"total, sizes, prev, pager, next, jumper"},queryPayload:{excludeKeys:"data",include:"",order:"-createdAt",limit:10,skip:0,count:"objectId"},lowcodeId:"",loading:!1,options:[{value:"Underreview",label:"审核中"},{value:"finishreview",label:"审核完成"}],rules:{testbed:[{required:!0,message:"请选择测试台体",trigger:"blur"}],name:[{required:!0,message:"请输入报告名称",trigger:"blur"}],templatename:[{required:!0,message:"请选择报告模板",trigger:"change"}]},activePopShow:!1,border:!0,height:980,stripe:!0,lineHeight:"medium",checkList:["mission name","Inspection number","Inspection template","testbed","Trade Names","Creation time","Starting time","end time"],columns:[{label:"mission name",width:"auto",prop:"name",sortable:!0},{label:"Inspection template",width:"auto",prop:"profile.wordtemplatename",sortable:!0},{label:"testbed",width:"auto",prop:"profile.testbed",sortable:!0},{label:"Starting time",width:"auto",prop:"starttime",sortable:!0},{label:"end time",width:"auto",prop:"endtime",sortable:!0}],list:{forensics:[],examination:[]},listLoading:!0,queryForm:{pageSizes:[10,20,30,50],limit:10,order:"-createdAt",keys:"count(*)",total:0,skip:0,pageNo:1,pageSize:10,name:""},categorylist:[],wordtemplist:[],grouplist:[],ruleForm:{name:"",templatename:"",testbed:"",testbedid:"",templatenameid:""}}},computed:Object(i["a"])(Object(i["a"])({},Object(f["mapGetters"])({currentDepartment:"user/currentDepartment"})),{},{dragOptions:function(){return{animation:600,group:"description"}},finallyColumns:function(){var e=this;return this.columns.filter((function(t){return e.checkList.includes(t.label)}))}}),created:function(){this.fetchData()},methods:{handleHistory:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:try{t.evidenceId=e.objectId,t.statisticsVisible=!0,t.$nextTick((function(){t.$refs["statistics"].evidence(e.objectId)}))}catch(r){console.log(r),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(r),"error","vab-hey-message-error")}case 1:case"end":return a.stop()}}),a)})))()},paginationQuery:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.queryPayload=e;case 1:case"end":return a.stop()}}),a)})))()},categoryChange:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.$set(t.ruleForm,"templatenameid",e.objectId);case 1:case"end":return a.stop()}}),a)})))()},testbedChange:function(e){this.$set(this.ruleForm,"testbedid",e.objectId),dgiotlog.log("src/views/CloudTest/js/task.js","this.ruleForm",this.ruleForm,e.objectId)},getwordtemp:function(){var e=this;return Object(o["a"])(l.a.mark((function t(){var a,r,n,o;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={skip:0,where:{netType:"Evidence",nodeType:1}},t.next=3,Object(h["queryProduct"])(a);case 3:r=t.sent,n=r.results,o=void 0===n?{}:n,e.categorylist=o;case 7:case"end":return t.stop()}}),t)})))()},getgroup:function(){var e=this;return Object(o["a"])(l.a.mark((function t(){var a,r,n;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={where:{"detail.category":"84abda3154"}},t.next=3,Object(d["queryDevice"])(a);case 3:r=t.sent,n=r.results,e.grouplist=n;case 6:case"end":return t.stop()}}),t)})))()},submitForm:function(e){var t=this,a="role:"+this.currentDepartment.name,r={};r[a]={read:!0,write:!0},this.$refs[e].validate(function(){var e=Object(o["a"])(l.a.mark((function e(a){var r,n;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!a){e.next=10;break}return r={profile:{testbedid:t.ruleForm.testbedid,testbed:t.ruleForm.testbed.name,wordtemplatename:t.ruleForm.templatename.name,reportId:t.ruleForm.templatenameid,identifier:"inspectionReportTemp",step:0},parentId:t.ruleForm.testbedid,name:t.ruleForm.name,product:t.ruleForm.templatenameid},n=t.$baseColorfullLoading(1),t.activePopShow=!1,e.next=6,Object(p["postreport"])(r);case 6:t.fetchData(),n.close(),e.next=12;break;case 10:return dgiotlog.log("error submit!!"),e.abrupt("return",!1);case 12:t.ruleForm={name:"",templatename:"",testbed:"",testbedid:"",templatenameid:""};case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},forensics:function(e){dgiotlog.warn(e),this.$router.push({path:"/cloudTest/evidence",query:{taskid:e.objectId,suite:0,state:"preview",step:1,back:e.profile.step,message:e.profile.message}})},taskEnd:function(e){var t=this;this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to end the current mission"),null,Object(o["a"])(l.a.mark((function a(){var r,n;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r=t.$baseColorfullLoading(),n={profile:_.merge(e.profile,{step:4,endtime:moment(new Date).format("x")})},a.next=5,Object(d["putDevice"])(e.objectId,n);case 5:a.sent,t.fetchData(),r.close(),a.next=14;break;case 10:a.prev=10,a.t0=a["catch"](0),dgiotlog.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 14:case"end":return a.stop()}}),a,null,[[0,10]])}))))},taskStart:function(e){var t=this;this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to start the current mission"),null,Object(o["a"])(l.a.mark((function a(){var r,n;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r=t.$baseColorfullLoading(),n={profile:_.merge(e.profile,{step:1,starttime:moment(new Date).format("x")})},a.next=5,Object(d["putDevice"])(e.objectId,n);case 5:a.sent,t.fetchData(),r.close(),a.next=14;break;case 10:a.prev=10,a.t0=a["catch"](0),dgiotlog.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 14:case"end":return a.stop()}}),a,null,[[0,10]])}))))},downDocx:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){var r;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:try{r=document.createElement("a"),r.setAttribute("href",t.$FileServe+e),r.setAttribute("download","download"),r.click()}catch(n){dgiotlog.log(n),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(n),"error","vab-hey-message-error")}case 1:case"end":return a.stop()}}),a)})))()},handleUnderreview:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:try{t.$router.push({path:"/cloudTest/evidence",query:{taskid:e,suite:0,state:"preview",step:3}})}catch(r){dgiotlog.log(r),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(r),"error","vab-hey-message-error")}case 1:case"end":return a.stop()}}),a)})))()},handleRouter:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:try{t.$router.push({path:"/cloudTest/evidence",query:{taskid:e.objectId,suite:0,state:"preview",step:e.profile.step,back:e.profile.step,message:e.profile.message,disable:!0}})}catch(r){console.log(r),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(r),"error","vab-hey-message-error")}case 1:case"end":return a.stop()}}),a)})))()},handleEvidence:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){var r,n,o,i;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.evidences=[],a.prev=1,r={order:"-createdAt",skip:0,where:{"original.taskid":e,reportId:{$ne:e}}},n=t.$baseColorfullLoading(),a.next=6,Object(v["queryEvidence"])(r);case 6:o=a.sent,i=o.results,null!==i&&void 0!==i&&i.length&&i.forEach((function(e){e.original.path="/dgiot_file"+e.original.path.split("/dgiot_file")[1]})),t.evidenceDialog=!0,t.evidences=i,console.log(i),t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),n.close(),a.next=20;break;case 16:a.prev=16,a.t0=a["catch"](1),console.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 20:case"end":return a.stop()}}),a,null,[[1,16]])})))()},handleReport:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){var r,n,o,i,s,c;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(4!=e.profile.step||!e.profile.docx){a.next=5;break}return r=t.$FileServe+e.profile.docx,t.dialogVisible=!0,t.officeapps="https://view.officeapps.live.com/op/view.aspx?src="+r,a.abrupt("return",!1);case 5:return a.prev=5,n=t.$baseColorfullLoading(),a.next=9,Object(v["generatereport"])(e.objectId);case 9:o=a.sent,i=o.code,s=o.msg,c=o.path,200==i&&c?(t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),setTimeout((function(){var a={profile:_.merge(e.profile,{step:4,docx:c})},r=(Object(d["putDevice"])(e.objectId,a),t.$FileServe+c);t.dialogVisible=!0,t.officeapps="https://view.officeapps.live.com/op/view.aspx?src="+r,t.fetchData()}),1200)):t.$baseMessage("".concat(s),"error","vab-hey-message-error"),n.close(),a.next=21;break;case 17:a.prev=17,a.t0=a["catch"](5),dgiotlog.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 21:case"end":return a.stop()}}),a,null,[[5,17]])})))()},handleManagement:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){var r,n,o,i;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.$refs["lowcodeDesign"].withHeader=!0,localStorage.setItem("parse_objectid",e.objectId),r={limit:1,where:{type:"amis_view",key:e.objectId}},a.next=5,Object(b["queryView"])(r);case 5:n=a.sent,o=n.results,i=void 0===o?[]:o,console.log(i),0==i.length&&t.$baseMessage("暂无配置","success","vab-hey-message-success"),t.lowcodeId=i[0].objectId,t.$dgiotBus.$emit("lowcodePreview",i[0]);case 12:case"end":return a.stop()}}),a)})))()},handleDelete:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){var r;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r=t.$baseColorfullLoading(),a.next=4,Object(d["delDevice"])(e);case 4:a.sent,t.$baseMessage(t.$translateTitle("user.successfully deleted"),"success","vab-hey-message-success"),r.close(),t.fetchData(),a.next=14;break;case 10:a.prev=10,a.t0=a["catch"](0),dgiotlog.log(a.t0),t.$baseMessage(t.$translateTitle("user.error deleted")+"".concat(a.t0),"error","vab-hey-message-error");case 14:case"end":return a.stop()}}),a,null,[[0,10]])})))()},fetchData:function(){var e=this;return Object(o["a"])(l.a.mark((function t(){var a,r,n,o,i;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.list={forensics:[],examination:[]},e.getwordtemp(),e.getgroup(),e.queryPayload.include="product,parentId",e.queryPayload.where={"profile.identifier":"inspectionReportTemp",name:e.queryForm.name.length?{$regex:e.queryForm.name}:{$ne:null},"profile.step":{$regex:"^(-1|[2-9]\\d*)$"}},e.listLoading=!0,t.next=8,Object(d["queryDevice"])(e.queryPayload);case 8:a=t.sent,r=a.count,n=void 0===r?0:r,o=a.results,i=void 0===o?[]:o,e.$refs["examination"].ination.total=n,i.forEach((function(t){t.endtime=t.profile.endtime?moment(Number(t.profile.endtime)).format("YYYY-MM-DD HH:mm:ss"):"",t.starttime=t.profile.starttime?moment(Number(t.profile.starttime)).format("YYYY-MM-DD HH:mm:ss"):"",t.createdAt=moment(t.createdAt).format("YYYY-MM-DD HH:mm:ss"),e.list.examination.push(t)})),e.listLoading=!1;case 16:case"end":return t.stop()}}),t)})))()}}},x=w,$=(a("f898"),a("bdd7")),k=Object($["a"])(x,r,n,!1,null,null,null);t["default"]=k.exports},"22a5":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"mqttws"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.msg,expression:"msg"}],attrs:{id:"msg",type:"text"},domProps:{value:e.msg},on:{input:function(t){t.target.composing||(e.msg=t.target.value)}}}),a("input",{attrs:{type:"button",value:"Send"},on:{click:e.send}}),a("input",{attrs:{type:"button",value:"Start"},on:{click:e.start}}),a("input",{attrs:{type:"button",value:"Stop"},on:{click:e.stop}})])},n=[],o=(a("7690"),a("b8f1"),a("441d"),{name:"Mqttws",data:function(){return{host:location.hostname,port:5080,clientId:"C_"+(new Date).getTime(),userName:"test",password:"test123",keepAlive:null,cleanSession:!0,useSSL:!1,client:{},options:{},msg:"order",count:0}},created:function(){this.client=new Paho.MQTT.Client(this.host,this.port,this.clientId),dgiotlog.log(this.client);var e=this.client,t=this.options={invocationContext:{host:this.host,port:this.port,path:e.path,clientId:this.clientId},timeout:5,keepAliveInterval:50,cleanSession:!1,useSSL:!1,userName:"test",password:"test123",onSuccess:function(){dgiotlog.log("onConnected"),e.subscribe("001/in")},onFailure:function(e){dgiotlog.log(e)}};this.client.connect(t),this.client.onConnectionLost=this.onConnectionLost,this.client.onMessageArrived=this.onMessageArrived},methods:{onConnectionLost:function(e){0!==e.errorCode&&(dgiotlog.log("onConnectionLost:"+e.errorMessage),dgiotlog.log("连接已断开"))},onMessageArrived:function(e){dgiotlog.log("收到消息:"+e.payloadString)},onConnect:function(){dgiotlog.log("onConnected"),this.client.subscribe("001/in")},send:function(){var e=this.msg;if(e){e="{Time:"+new Date+", content:"+e+", from: web console}";var t=new Paho.MQTT.Message(e);t.destinationName=this.topic,this.client.send(t),this.msg=""}},start:function(){window.tester=window.setInterval(function(){if(this.client.isConnected){var e="{Time:"+new Date+", content:"+this.count+++", from: web console}",t=new Paho.MQTT.Message(e);t.destinationName=this.topic,this.client.send(t)}}.bind(this),1e3)},stop:function(){window.clearInterval(window.tester)}}}),i=o,s=a("bdd7"),l=Object(s["a"])(i,r,n,!1,null,null,null);t["default"]=l.exports},2695:function(e,t,a){},"2b93":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"logs logs-container"},[a("a-row",{staticClass:"logs-row"},[a("a-col",{staticClass:"logs-row-tree",style:{height:Number(e.$baseTableHeight(0))+105+"px"},attrs:{lg:6,md:6,sm:24,xl:4,xs:24,xxl:4}},[e.logTree.length?a("a-tree",{staticClass:"logs-row-tree-antd",attrs:{"auto-expand-parent":!0,"block-node":!0,"default-expand-all":!0,"show-icon":!0,"show-line":!0,"tree-data":e.logTree},on:{rightClick:e.onRightClick,select:e.onSelect},scopedSlots:e._u([{key:"title",fn:function(t){var r=t.objectId,n=t.name,o=t.objectId,i=t.type;return[a("a-dropdown",{attrs:{disabled:!e.disableType.includes(i),trigger:["contextmenu"]},on:{click:function(t){return e.subLog()}},scopedSlots:e._u([{key:"overlay",fn:function(){return[a("a-menu",{key:o,attrs:{size:"mini"},on:{click:function(t){return t.target!==t.currentTarget?null:function(t){var a=t.key;return e.onContextMenuClick(r,a)}.apply(null,arguments)}}},[a("a-menu-item",[e._v(" "+e._s(e.$translateTitle("Logs.log lever"))+" "),a("el-select",{staticStyle:{width:"120px"},attrs:{size:"mini"},on:{change:e.handleChange},model:{value:e.defaultLever,callback:function(t){e.defaultLever=t},expression:"defaultLever"}},e._l(e.leverData,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1)]},proxy:!0}],null,!0)},[a("span",{attrs:{title:n}},[a("a-icon",{attrs:{slot:"icon",theme:"twoTone","two-tone-color":"#52c41a",type:"check-circle"},slot:"icon"}),e._v(" "+e._s(n)+" ")],1)])]}}],null,!1,740860110)}):e._e()],1),a("a-col",{staticClass:"logs-row-table",class:{"vab-fullscreen":e.isFullscreen},style:{height:Number(e.$baseTableHeight(0))+25+"px"},attrs:{lg:18,md:18,sm:24,xl:20,xs:24,xxl:20}},[a("a-tabs",{attrs:{"default-active-key":"editor"}},[a("a-tab-pane",{key:"editor"},[a("span",{attrs:{slot:"tab"},slot:"tab"},[a("dgiot-icon",{attrs:{icon:"aspect-ratio-fill"}}),e._v(" "+e._s(e.$translateTitle("Logs.console"))+" ")],1),a("vab-editor",{key:e.key,attrs:{height:e.isFullscreen?1080:1040,lang:"json","max-lines":(e.isFullscreen,1e3/12),"min-lines":(e.isFullscreen,1e3/12),theme:"gob"},model:{value:e.clickItem,callback:function(t){e.clickItem=t},expression:"clickItem"}})],1),a("a-tab-pane",{key:"table"},[a("span",{attrs:{slot:"tab"},slot:"tab"},[a("dgiot-icon",{attrs:{icon:"table-2"}}),e._v(" "+e._s(e.$translateTitle("Logs.table"))+" ")],1),a("vab-query-form",[a("vab-query-form-left-panel",[a("el-button",{staticStyle:{margin:"0 10px 10px 10px !important"},attrs:{type:"success"},on:{click:e.handleHeight}},[a("dgiot-icon",{attrs:{icon:e.isFullscreen?"fullscreen-exit-fill":"fullscreen-fill"}})],1),a("el-popover",{attrs:{trigger:"hover"},scopedSlots:e._u([{key:"reference",fn:function(){return[a("el-button",{staticStyle:{margin:"0 0 10px 0 !important"},attrs:{icon:"el-icon-setting",type:"primary"}},[e._v(" "+e._s(e.$translateTitle("Logs.Draggable column settings"))+" ")])]},proxy:!0}])},[a("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},[a("vue-draggable",e._b({attrs:{list:e.logcolumns}},"vue-draggable",e.dragOptions,!1),e._l(e.logcolumns,(function(t,r){return a("div",{key:t+r},[a("dgiot-icon",{attrs:{icon:"drag-drop-line"}}),a("el-checkbox",{attrs:{disabled:!0===t.disableCheck,label:t}},[e._v(" "+e._s(t)+" ")])],1)})),0)],1)],1)],1)],1),a("el-table",{key:e.key,ref:"dragTable",attrs:{border:"",data:e.scroketMsg.slice((e.currentPage-1)*e.pageSize,e.currentPage*e.pageSize),"default-expand-all":"",height:e.height,"highlight-current-row":"",resizable:"",size:"mini",stripe:""},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center",fixed:"left",label:e.$translateTitle("equipment.serialnumber"),"show-overflow-tooltip":"",width:"55"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.$index;return[e._v(" "+e._s(a+1)+" ")]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"left",label:"time",prop:"time","show-overflow-tooltip":"",sortable:"",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(" "+e._s(e.$moment(Number(r.time.toString().substring(0,13))).format("YYYY-MM-DD HH:mm:ss.SSS"))+" ")])]}}])}),e._l(e.finallyColumns,(function(t,r){return a("el-table-column",{directives:[{name:"show",rawName:"v-show",value:"msg"!=t,expression:"item != 'msg'"}],key:r,attrs:{align:"center",label:t,prop:t,"show-overflow-tooltip":"",sortable:"",width:e.w80.includes(t)?80:e.Wh120.includes(t)?120:180}})})),a("el-table-column",{attrs:{align:"center",fixed:"right",label:"msg",prop:"msg","show-overflow-tooltip":"",sortable:""}})],2),a("el-pagination",{attrs:{"current-page":e.currentPage,layout:"total, sizes, prev, pager, next, jumper","page-size":e.pageSize,"page-sizes":[10,20,30,50,100],total:e.scroketMsg.length},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)],1)],1)],1)],1)},n=[],o=a("fb07"),i=a("d0d7"),s=a.n(i),l=(a("7690"),a("a0e0"),a("3dec"),a("f764"),a("5662"),a("16b8"),a("04d6"),a("d292")),c={name:"RealLog",data:function(){return{logMqtt:{channeltopic:"",key:moment(new Date).valueOf()},key:moment(new Date).valueOf(),subtopic:"",topicKey:"",router:"",currentPage:1,pageSize:20,isFullscreen:!1,leverData:["debug","info","notice","warning","error","crtical","alert","emergency"],disableType:["system","app","module"],dataRef:{},defaultLever:"",queryForm:{},logTree:[],clickItem:"",height:this.$baseTableHeight(1),checkList:["pid","level","gl","mfa"],logcolumns:["topic","pid","peername","level","gl","clientid","mfa"],w80:["line","level"],Wh120:["pid","level","domain","gl"],Wh200:["time","clientid","peername"],scroketMsg:[]}},computed:{dragOptions:function(){return{animation:600,group:"description"}},finallyColumns:function(){var e=this;return this.logcolumns.filter((function(t){return e.checkList.includes(t)}))},treeQueryForm:function(){return{province:"",class:"LogLevel",filter:'{"keys":["parent","name","level","name","order","type","topic"],"where":{}}',parent:"parent"}}},watch:{},mounted:function(){this.router=this.$dgiotBus.router(this.$route.fullPath),this.getTree(this.treeQueryForm)},methods:{handleSizeChange:function(e){this.pageSize=e},handleCurrentChange:function(e){this.currentPage=e},onSelect:function(e,t){dgiotlog.log("selected",e,t.node.dataRef),this.dataRef=t.node.dataRef,dgiotlog.log(t.node.dataRef),this.defaultLever=this.dataRef.level,this.subLog()},handleHeight:function(){this.isFullscreen=!this.isFullscreen,this.isFullscreen?this.height=this.$baseTableHeight(1)+120:this.height=this.$baseTableHeight(1)},onRightClick:function(e){this.clickItem="",this.dataRef=e.node.dataRef,dgiotlog.log(e.node.dataRef),this.defaultLever=this.dataRef.level},onContextMenuClick:function(e,t){switch(t){case"Level":break}dgiotlog.log(e,t)},getTree:function(e){var t=this;return Object(o["a"])(s.a.mark((function a(){var r,n,o,i;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r=t.$baseColorfullLoading(),a.next=4,Object(l["post_tree"])(e);case 4:n=a.sent,o=n.results,i=void 0===o?[]:o,t.logTree=i,r.close(),t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),a.next=16;break;case 12:a.prev=12,a.t0=a["catch"](0),dgiotlog.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 16:case"end":return a.stop()}}),a,null,[[0,12]])})))()},handleChange:function(e){var t=this;return Object(o["a"])(s.a.mark((function a(){var r,n,o,i,c;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r=t.dataRef,n=r.type,o=r.name,i=t.$baseColorfullLoading(),c={type:n,name:o,level:e},a.next=6,Object(l["putLogLevel"])(c);case 6:a.sent,t.getTree(t.treeQueryForm),i.close(),a.next=15;break;case 11:a.prev=11,a.t0=a["catch"](0),dgiotlog.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 15:dgiotlog.log(e);case 16:case"end":return a.stop()}}),a,null,[[0,11]])})))()},subLog:function(){this.clickItem="",this.scroketMsg=[],this.key=moment(new Date).valueOf(),this.dataRef.objectId&&(this.subtopic="".concat(this.dataRef.topic),this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.$dgiotBus.$emit("MqttSubscribe",{router:this.router,topic:this.subtopic,qos:0,ttl:108e5}),this.$baseMessage(this.subtopic+this.$translateTitle("websocket.subscribeSuccess"),"success",!1,"vab-hey-message-success"),this.$baseNotify(this.subtopic,"topic:","success","",5e3),this.handleMqttMsg())},handleMqttMsg:function(){var e=this;this.scroketMsg=[],this.clickItem="",this.$dgiotBus.$off(this.topicKey),this.$dgiotBus.$on(this.topicKey,(function(t){dgiotlog.log("收到消息",t),t.payload&&(e.scroketMsg.push(JSON.parse(t.payload)),e.key=moment(new Date).valueOf(),e.clickItem=JSON.stringify(e.scroketMsg,null,2))}))}}},u=c,d=(a("0adb"),a("bdd7")),p=Object(d["a"])(u,r,n,!1,null,"ce3ada88",null);t["default"]=p.exports},"312d":function(e,t,a){"use strict";a("0eb6")},"351b":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"custom-table",staticClass:"custom-table-container"},[r("div",{staticClass:"components"},[r("a-drawer",{attrs:{"mask-closable":!1,placement:"right",visible:e.visible,width:"100%"},on:{close:function(t){return e.saveHistorical(e.collectionInfo,e.thingcolumns,e.thingdata,!0)}}},[r("el-row",{attrs:{gutter:24}},[r("el-col",{attrs:{span:12}},[r("el-divider",[e._v("采集数据")]),r("el-table",{key:e.thingdata.length,staticStyle:{"min-height":"280px"},attrs:{border:"",data:e.thingdata}},[r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("cloudTest.number"),"show-overflow-tooltip":"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.$index;return[e._v(" "+e._s(a+1)+" ")]}}])}),e._l(e.thingcolumns,(function(t,a){return r("el-table-column",{key:a,attrs:{align:"center",label:e.$translateTitle("cloudTest."+t.label),prop:t.prop,"show-overflow-tooltip":"",sortable:"",width:"auto"}})}))],2)],1),e.collectionInfo.name?r("el-col",{attrs:{span:12}},[r("el-divider",[e._v("检测信息")]),r("el-card",[r("div",{staticClass:"setting"},[r("el-button",{attrs:{type:"success"},nativeOn:{click:function(t){return e.collection(e.collectionInfo)}}},[e._v(" 采集数据 ")]),r("el-button",{attrs:{disabled:0==e.thingdata.length,type:"primary"},nativeOn:{click:function(t){return e.drawxnqx(e.collectionInfo.objectId,e.thingdata)}}},[e._v(" 存储数据 ")]),r("el-button",{attrs:{type:"info"},nativeOn:{click:function(t){return e.handleManagement(e.collectionInfo)}}},[e._v(" 任务配置 ")]),r("el-button",{nativeOn:{click:function(t){return e.startOpc(e.collectionInfo)}}},[e._v(" 任务下发 ")]),r("el-button",{attrs:{type:"warning"},nativeOn:{click:function(t){return e.saveHistorical(e.collectionInfo,e.thingcolumns,e.thingdata,!1)}}},[e._v(" 保存数据 ")]),r("el-button",{attrs:{type:"danger"},on:{click:function(t){e.visible=!1}}},[e._v(" 退出采集 ")])],1),r("a-descriptions",{attrs:{bordered:""}},[r("a-descriptions-item",{attrs:{label:"当前时间",span:12}},[e._v(" "+e._s(e.nowTime)+" ")]),r("a-descriptions-item",{attrs:{label:"检测台体",span:8}},[e._v(" "+e._s(e.collectionInfo.profile.testbed)+" ")]),r("a-descriptions-item",{attrs:{label:"检测任务",span:4}},[e._v(" "+e._s(e.collectionInfo.name)+" ")])],1)],1)],1):e._e()],1),r("el-row",{attrs:{gutter:24}},[r("el-col",{staticStyle:{"margin-top":"20px"},attrs:{span:12}},[r("el-divider",[e._v("存储的数据")]),r("el-table",{key:e.historyEvidence.length,staticStyle:{"min-height":"530px"},attrs:{border:"",data:e.historyEvidence}},[r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("cloudTest.number"),"show-overflow-tooltip":"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.$index;return[e._v(" "+e._s(a+1)+" ")]}}])}),e._l(e.historycolumns,(function(t,a){return r("el-table-column",{key:a,attrs:{align:"center",label:e.$translateTitle("cloudTest."+t.label),prop:t.prop,"show-overflow-tooltip":"",sortable:"",width:"auto"}})})),r("el-table-column",{attrs:{align:"center",label:"操作",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row,n=t.$index;return[r("el-button",{staticClass:"el-icon-delete",attrs:{type:"text"},nativeOn:{click:function(t){return e.deleteHistory(a,n)}}})]}}])})],2)],1),r("el-col",{staticStyle:{"margin-top":"20px"},attrs:{span:12}},[r("el-divider",[e._v("其他数据")]),r("el-tabs",{on:{"tab-click":e.tabHandleClick},model:{value:e.activeName1,callback:function(t){e.activeName1=t},expression:"activeName1"}},[r("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.realTime data"),name:"first"}},[r("div",{staticClass:"thirdtb"},[r("el-row",{key:e.thirdtbKey},e._l(e.machinelist,(function(t,a,n){return r("el-descriptions",{key:n,attrs:{border:"",column:4,title:a}},e._l(t,(function(t,a){return r("el-descriptions-item",{key:a},[r("div",{staticStyle:{height:"40px"}},[r("span",{staticStyle:{"font-size":"16px"}},[e._v(" "+e._s(t.name)+" ")]),r("span",{staticStyle:{float:"right","margin-top":"10px","margin-right":"15px"}},[r("el-image",{staticStyle:{width:"60px",height:"60px"},attrs:{src:t.imgurl}},[r("div",{staticClass:"image-slot",staticStyle:{width:"60px",height:"60px"},attrs:{slot:"error"},slot:"error"},[r("i",{staticClass:"el-icon-picture-outline"})])])],1)]),r("div",{staticClass:"stla"},[r("span",{attrs:{title:e._f("filterVal")(t.number)}},[e._v(" "+e._s(e._f("filterVal")(t.number))+" ")]),t.unit?r("span",{attrs:{title:t.unit}},[e._v(" "+e._s(t.unit)+" ")]):e._e()]),r("div",{staticClass:"ta"},[r("span",{staticClass:"fontSize"},[e._v(" "+e._s(e.$translateTitle("equipment.updatetime")+":")+" ")]),r("span",{staticClass:"fontSize",on:{click:function(t){return e.print(e.machinelist)}}},[e._v(" "+e._s(t.time)+" ")])])])})),1)})),1)],1)]),r("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.chart"),name:"second"}},[r("el-card",[r("el-image",{key:e.drawxnqxPath,attrs:{"preview-src-list":[e.$FileServe+e.drawxnqxPath],src:e.$FileServe+e.drawxnqxPath}},[r("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[r("el-image",{staticClass:"vab-data-empty",attrs:{src:a("c2ad")}})],1)])],1)],1)],1)],1)],1)],1),r("el-drawer",{directives:[{name:"drawerDrag",rawName:"v-drawerDrag"}],attrs:{"append-to-body":"",size:"80%",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("iframe",{staticStyle:{width:"100%",height:"100%"},attrs:{src:e.officeapps}})]),r("vab-dialog",{attrs:{show:e.activePopShow},on:{"update:show":function(t){e.activePopShow=t}}},[r("h2",{attrs:{slot:"title"},slot:"title"},[e._v(" "+e._s(e.$translateTitle("cloudTest.addwordtask"))+" ")]),r("div",{staticClass:"content"},[r("el-divider",[e._v(" "+e._s(e.$translateTitle("cloudTest.Basic information of inspection tasks"))+" ")]),r("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{"element-loading-background":"rgba(0, 0, 0, 0.8)","element-loading-spinner":"el-icon-loading","element-loading-text":e.$translateTitle("developer.Waitingtoreturn"),"label-width":"100px",model:e.ruleForm,rules:e.rules,size:"mini"}},[r("el-form-item",{attrs:{label:e.$translateTitle("cloudTest.taskname"),prop:"name"}},[r("el-input",{model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),r("el-form-item",{attrs:{label:e.$translateTitle("cloudTest.wordtemplate"),prop:"templatename"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("task.Select"),"value-key":"objectId"},on:{change:e.categoryChange},model:{value:e.ruleForm.templatename,callback:function(t){e.$set(e.ruleForm,"templatename",t)},expression:"ruleForm.templatename"}},e._l(e.categorylist,(function(e){return r("el-option",{key:e.objectId,attrs:{label:e.name,value:e}})})),1)],1),r("el-form-item",{attrs:{label:e.$translateTitle("cloudTest.testbed"),prop:"testbed"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("task.Select"),"value-key":"objectId"},on:{change:e.testbedChange},model:{value:e.ruleForm.testbed,callback:function(t){e.$set(e.ruleForm,"testbed",t)},expression:"ruleForm.testbed"}},e._l(e.grouplist,(function(e){return r("el-option",{key:e.objectId,attrs:{label:e.name,value:e}})})),1)],1)],1),r("div",{staticStyle:{"text-align":"right"},attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return e.submitForm("ruleForm")}}},[r("i",{staticClass:"el-icon-finished"},[e._v(" "+e._s(e.$translateTitle("product.createnow"))+" ")])])],1)],1)])],1),r("vab-query-form",[r("vab-query-form-left-panel",[r("el-form",{ref:"form",attrs:{inline:!0,model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",[r("el-input",{attrs:{placeholder:e.$translateTitle("cloudTest.Please select review status")},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),r("el-form-item",[r("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},nativeOn:{click:function(t){return e.fetchData()}}},[e._v(" "+e._s(e.$translateTitle("cloudTest.search"))+" ")]),r("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},nativeOn:{click:function(t){e.activePopShow=!e.activePopShow}}},[e._v(" "+e._s(e.$translateTitle("cloudTest.add task"))+" ")])],1)],1)],1)],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:e.border,data:e.list.forensics,size:e.lineHeight,stripe:e.stripe},scopedSlots:e._u([{key:"empty",fn:function(){return[r("el-image",{staticClass:"vab-data-empty",attrs:{src:a("c2ad")}})]},proxy:!0}])},[r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("cloudTest.number"),"show-overflow-tooltip":"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.$index;return[e._v(" "+e._s(a+1)+" ")]}}])}),e._l(e.finallyColumns,(function(t,a){return r("el-table-column",{key:a,attrs:{align:"center",label:e.$translateTitle("cloudTest."+t.label),prop:t.prop,"show-overflow-tooltip":"",sortable:t.sortable,width:t.width}})})),r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("deviceLog.status"),width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-popover",{directives:[{name:"show",rawName:"v-show",value:-1==a.profile.step,expression:"row.profile.step == -1"}],attrs:{placement:"top-start",trigger:"hover"},scopedSlots:e._u([{key:"reference",fn:function(){return[r("el-tag",{attrs:{effect:"dark",type:"danger"}},[e._v(" "+e._s(e.$translateTitle("cloudTest.notapproved"))+" ")])]},proxy:!0}],null,!0)},[e._v(" "+e._s(a.profile.message)+" ")]),r("el-tag",{directives:[{name:"show",rawName:"v-show",value:-1!=a.profile.step,expression:"row.profile.step != -1"}],attrs:{effect:"dark",type:["info","warning","primary","primary"][a.profile.step?a.profile.step:0]}},[e._v(" "+e._s([e.$translateTitle("product.notstarted"),e.$translateTitle("product.testing"),e.$translateTitle("product.pending review"),e.$translateTitle("product.finishtest"),e.$translateTitle("product.review completed")][a.profile.step]||e.$translateTitle("product.finishtest"))+" ")])]}}])}),r("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("cloudTest.operate"),width:"380"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-button",{directives:[{name:"show",rawName:"v-show",value:0==a.profile.step&&e.$loadsh.isEmpty(a.basedata),expression:"row.profile.step == 0 && $loadsh.isEmpty(row.basedata)"}],attrs:{size:"mini",type:"success"},nativeOn:{click:function(t){return e.handleManagement(a)}}},[e._v(" "+e._s(e.$translateTitle("task.Configuration"))+" ")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:0==a.profile.step&&!e.$loadsh.isEmpty(a.basedata),expression:"row.profile.step == 0 && !$loadsh.isEmpty(row.basedata)"}],attrs:{size:"mini",type:"info"},nativeOn:{click:function(t){return e.taskStart(a)}}},[e._v(" "+e._s(e.$translateTitle("task.start"))+" ")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:1==a.profile.step||-1==a.profile.step,expression:"row.profile.step == 1 || row.profile.step == -1"}],attrs:{size:"mini",type:"success"},nativeOn:{click:function(t){return e.visibleInfo(a)}}},[e._v(" "+e._s(e.$translateTitle("task.dataacquisition"))+" ")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:1==a.profile.step||-1==a.profile.step,expression:"row.profile.step == 1 || row.profile.step == -1"}],attrs:{size:"mini",type:"warning"},nativeOn:{click:function(t){return e.forensics(a)}}},[e._v(" "+e._s(1==a.profile.step?e.$translateTitle("cloudTest.forensics"):e.$translateTitle("cloudTest.re-review"))+" ")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:a.profile.step<=1,expression:"row.profile.step <= 1"}],attrs:{size:"mini",type:"danger"},nativeOn:{click:function(t){return e.handleDelete(a.objectId)}}},[e._v(" "+e._s(e.$translateTitle("cloudTest.delete"))+" ")])]}}])})],2),r("vab-parser-pagination",{key:e.list.forensics.length+"forensics",ref:"forensics",attrs:{pagination:e.paginations,"query-payload":e.queryPayload},on:{pagination:e.fetchData,paginationQuery:e.paginationQuery}}),r("lowcode-design",{ref:"lowcodeDesign",on:{objectId:e.lowcodeId}})],1)},n=[],o=a("fb07"),i=a("e97b"),s=a("d0d7"),l=a.n(s),c=(a("7690"),a("a0e0"),a("3dec"),a("f764"),a("5662"),a("b8f1"),a("16b8"),a("3eb0"),a("9c6a"),a("e170"),a("d6a4"),a("e0e4"),a("1d17"),a("4c87"),a("f1e1"),a("04d6"),a("c4bc"),a("5449"),a("20e3"),a("209d")),u=a("1285"),d=a("227e"),p=a("cdef"),m=a("289a"),g=a.n(m),f=a("5880"),h=a("7212"),b=a("8ba7"),v=a("c008"),y=a("c32d"),w=a.n(y),x={name:"TaskIndex",filters:{filterVal:function(e){return e||0==e?e:"--"}},components:{VabDraggable:g.a,lowcodeDesign:c["default"]},data:function(){var e,t;return{machinelist:{},historyEvidenceid:"",nowTime:window.datetime,historyEvidence:[],historyInfo:{},thirdtbKey:w()(new Date).valueOf(),original:{},collectionInfo:{},drawxnqxPath:"",thingdata:[],realtimedata:[],thingcolumns:[],historycolumns:[],visible:!1,router:"",topicKey:"",activeName1:"first",activeName:null!==this&&void 0!==this&&null!==(e=this.$route)&&void 0!==e&&null!==(t=e.query)&&void 0!==t&&t.tabs&&"examination"==this.$route.query.tabs?"examination":"forensics",officeapps:"",dialogVisible:!1,paginations:{layout:"total, sizes, prev, pager, next, jumper"},queryPayload:{excludeKeys:"data",include:"",order:"-createdAt",limit:10,skip:0,count:"objectId"},lowcodeId:"",loading:!1,options:[{value:"Underreview",label:"审核中"},{value:"finishreview",label:"审核完成"}],rules:{testbed:[{required:!0,message:"请选择测试台体",trigger:"blur"}],name:[{required:!0,message:"请输入报告名称",trigger:"blur"}],templatename:[{required:!0,message:"请选择报告模板",trigger:"change"}]},activePopShow:!1,border:!0,height:980,stripe:!0,lineHeight:"medium",checkList:["mission name","Inspection number","Inspection template","testbed","Trade Names","Creation time","Starting time","end time"],columns:[{label:"mission name",width:"auto",prop:"name",sortable:!0},{label:"Inspection template",width:"auto",prop:"profile.wordtemplatename",sortable:!0},{label:"testbed",width:"auto",prop:"profile.testbed",sortable:!0},{label:"Starting time",width:"auto",prop:"starttime",sortable:!0},{label:"end time",width:"auto",prop:"endtime",sortable:!0}],list:{forensics:[],examination:[]},listLoading:!0,queryForm:{pageSizes:[10,20,30,50],limit:10,order:"-createdAt",keys:"count(*)",total:0,skip:0,pageNo:1,pageSize:10,name:""},categorylist:[],wordtemplist:[],grouplist:[],ruleForm:{name:"",templatename:"",testbed:"",testbedid:"",templatenameid:""}}},computed:Object(i["a"])(Object(i["a"])({},Object(f["mapGetters"])({currentDepartment:"user/currentDepartment"})),{},{dragOptions:function(){return{animation:600,group:"description"}},finallyColumns:function(){var e=this;return this.columns.filter((function(t){return e.checkList.includes(t.label)}))}}),created:function(){this.fetchData()},mounted:function(){var e=this;this.historyEvidence=[],this.historyInfo={},this.router=this.$dgiotBus.router(this.$route.fullPath),this.$dgiotBus.$off("lowcodeClose"),this.$dgiotBus.$on("lowcodeClose",(function(t){e.fetchData()})),this.timer=setInterval((function(){e.datetime()}),1e3)},methods:{tabHandleClick:function(e){switch(e.name){case"first":break;case"second":break}},getCardDevice:function(e){var t=this;Object(u["getCardDevice"])(e).then((function(e){t.machinelist={},null!==e&&void 0!==e&&e.data&&t.renderCard(e.data)}))["catch"]((function(e){dgiotlog.log("update error 清除timer",e)}))},subRealtimedata:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){var r,n,o;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:r="thing/".concat(e.parentId.objectId,"/realtimedata/post"),n=t.$dgiotBus.router(location.href+t.$route.fullPath),o=t.$dgiotBus.topicKey(n,r);try{t.$dgiotBus.$emit("MqttSubscribe",{router:n,topic:r,qos:0,ttl:108e5}),console.groupCollapsed("%c mqtt 订阅日志","color:#009a61; font-size: 28px; font-weight: 300"),console.log("topic:",r),console.log("router:",n),console.groupEnd(),t.$dgiotBus.$off(o),t.$dgiotBus.$on(o,(function(e){console.groupCollapsed("%c mqttMsg消息回调","color:#009a61; font-size: 28px; font-weight: 300"),console.log(e),console.log(Base64.decode(e.payload)),console.log(JSON.parse(Base64.decode(e.payload)).data),console.log("Base64.decode(payload):",Base64.decode(e.payload)),console.groupEnd();var a=JSON.parse(Base64.decode(e.payload)),r=a.data,n=void 0===r?[]:r;n?t.renderCard(n):t.getCardDevice()}))}catch(i){console.log(i),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(i),"error","vab-hey-message-error")}case 4:case"end":return a.stop()}}),a)})))()},renderCard:function(e){var t=this,a=[];e.forEach((function(e){e.devicetype&&a.push(e.devicetype)})),a=_.uniqBy(a);var r={};a.forEach((function(t){var a=[];e.forEach((function(e){t==e.devicetype&&a.push(e)})),r[t]=a})),t.machinelist=r,t.thirdtbKey=w()(new Date).valueOf()},datetime:function(){this.nowTime=w()(new Date).format("YYYY-MM-DD HH:mm:ss")},paginationQuery:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.queryPayload=e;case 1:case"end":return a.stop()}}),a)})))()},categoryChange:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.$set(t.ruleForm,"templatenameid",e.objectId);case 1:case"end":return a.stop()}}),a)})))()},testbedChange:function(e){this.$set(this.ruleForm,"testbedid",e.objectId),console.log("src/views/CloudTest/js/task.js","this.ruleForm",this.ruleForm,e.objectId)},getwordtemp:function(){var e=this;return Object(o["a"])(l.a.mark((function t(){var a,r,n,o;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={skip:0,where:{netType:"Evidence",nodeType:1}},t.next=3,Object(h["queryProduct"])(a);case 3:r=t.sent,n=r.results,o=void 0===n?{}:n,e.categorylist=o;case 7:case"end":return t.stop()}}),t)})))()},getgroup:function(){var e=this;return Object(o["a"])(l.a.mark((function t(){var a,r,n;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={where:{"detail.category":"84abda3154"}},t.next=3,Object(u["queryDevice"])(a);case 3:r=t.sent,n=r.results,e.grouplist=n;case 6:case"end":return t.stop()}}),t)})))()},deleteHistory:function(e,t){var a=this;return Object(o["a"])(l.a.mark((function r(){return l.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,a.historyEvidence.splice(t,1);case 3:return console.log("deleteHistory",e,t,a.historyEvidence,a.historyEvidence.length),r.next=6,a.saveHistorical(a.collectionInfo,a.thingdata,a.historyEvidence,!1);case 6:return r.next=8,a.saveThingdata();case 8:r.next=14;break;case 10:r.prev=10,r.t0=r["catch"](0),console.log(r.t0),a.$baseMessage(a.$translateTitle("alert.Data request error")+"".concat(r.t0),"error","vab-hey-message-error");case 14:case"end":return r.stop()}}),r,null,[[0,10]])})))()},saveThingdata:function(){var e=this;return Object(o["a"])(l.a.mark((function t(){var a;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a={original:e.historyInfo.original},t.next=4,Object(v["putEvidence"])(e.historyInfo.objectId,a);case 4:t.sent,t.next=11;break;case 7:t.prev=7,t.t0=t["catch"](0),console.log(t.t0),e.$baseMessage(e.$translateTitle("alert.Data request error")+"".concat(t.t0),"error","vab-hey-message-error");case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))()},submitForm:function(e){var t=this,a="role:"+this.currentDepartment.name,r={};r[a]={read:!0,write:!0},this.$refs[e].validate(function(){var e=Object(o["a"])(l.a.mark((function e(a){var r,n;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!a){e.next=10;break}return r={profile:{testbedid:t.ruleForm.teestbedid,testbed:t.ruleForm.testbed.name,wordtemplatename:t.ruleForm.templatename.name,reportId:t.ruleForm.templatenameid,identifier:"inspectionReportTemp",step:0},parentId:t.ruleForm.testbedid,name:t.ruleForm.name,product:t.ruleForm.templatenameid},n=t.$baseColorfullLoading(1),t.activePopShow=!1,e.next=6,Object(p["postreport"])(r);case 6:t.fetchData(),n.close(),e.next=12;break;case 10:return console.log("error submit!!"),e.abrupt("return",!1);case 12:t.ruleForm={name:"",templatename:"",testbed:"",testbedid:"",templatenameid:""};case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},featHistoryEvidence:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){var r,n,o,i,s,c,u;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.historyEvidence=[],a.prev=1,r={order:"-createdAt",skip:0,where:{"original.taskid":e,"original.type":"avgs"}},n=t.$baseColorfullLoading(),a.next=6,Object(v["queryEvidence"])(r);case 6:o=a.sent,i=o.results,s=void 0===i?[]:i,null!==s&&void 0!==s&&s.length&&(t.historyEvidence=null!==(c=s[0].original.avgs)&&void 0!==c?c:[],t.collectionInfo.profile.historicaldata=t.historyEvidence,t.historyInfo=s[0],t.drawxnqxPath=null!==(u=s[0].original.path)&&void 0!==u?u:""),t.historycolumns=_.filter(t.thingcolumns,(function(e){return"timestamp"!==e.prop})),t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),n.close(),a.next=19;break;case 15:a.prev=15,a.t0=a["catch"](1),console.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 19:case"end":return a.stop()}}),a,null,[[1,15]])})))()},forensics:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$router.push({path:"/cloudTest/evidence",query:{taskid:e.objectId,suite:0,state:"preview",step:1,back:e.profile.step,message:e.profile.message}});case 3:a.next=9;break;case 5:a.prev=5,a.t0=a["catch"](0),console.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 9:case"end":return a.stop()}}),a,null,[[0,5]])})))()},taskEnd:function(e){var t=this;this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to end the current mission"),null,Object(o["a"])(l.a.mark((function a(){var r,n;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r=t.$baseColorfullLoading(),n={profile:_.merge(e.profile,{step:4,endtime:w()(new Date).format("x")})},a.next=5,Object(u["putDevice"])(e.objectId,n);case 5:a.sent,t.fetchData(),r.close(),a.next=14;break;case 10:a.prev=10,a.t0=a["catch"](0),console.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 14:case"end":return a.stop()}}),a,null,[[0,10]])}))))},taskStart:function(e){var t=this,a=this;a.$baseConfirm(a.$translateTitle("Maintenance.Are you sure you want to start the current mission"),null,Object(o["a"])(l.a.mark((function r(){var n,o;return l.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,n=a.$baseColorfullLoading(),r.next=4,a.startOpc(e);case 4:return r.next=6,Object(v["generatereport"])(e.objectId);case 6:return o={profile:_.merge(e.profile,{step:1,starttime:w()(new Date).format("x")})},r.next=9,Object(u["putDevice"])(e.objectId,o);case 9:r.sent,a.fetchData(),n.close(),r.next=18;break;case 14:r.prev=14,r.t0=r["catch"](0),console.log(r.t0),a.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(r.t0),"error","vab-hey-message-error");case 18:case"end":return r.stop()}}),r,null,[[0,14]])}))))},downDocx:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){var r;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:try{r=document.createElement("a"),r.setAttribute("href",t.$FileServe+e),r.setAttribute("download","download"),r.click()}catch(n){console.log(n),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(n),"error","vab-hey-message-error")}case 1:case"end":return a.stop()}}),a)})))()},handleUnderreview:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:try{t.$router.push({path:"/cloudTest/evidence",query:{taskid:e,suite:0,state:"preview",step:3}})}catch(r){console.log(r),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(r),"error","vab-hey-message-error")}case 1:case"end":return a.stop()}}),a)})))()},handleReport:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){var r,n,o,i,s,c;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(4!=e.profile.step||!e.profile.docx){a.next=5;break}return r=t.$FileServe+e.profile.docx,t.dialogVisible=!0,t.officeapps="https://view.officeapps.live.com/op/view.aspx?src="+r,a.abrupt("return",!1);case 5:return a.prev=5,n=t.$baseColorfullLoading(),a.next=9,Object(v["generatereport"])(e.objectId);case 9:o=a.sent,i=o.code,s=o.msg,c=o.path,200==i&&c?(t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),setTimeout((function(){var a={profile:_.merge(e.profile,{step:4,docx:c})},r=(Object(u["putDevice"])(e.objectId,a),t.$FileServe+c);t.dialogVisible=!0,t.officeapps="https://view.officeapps.live.com/op/view.aspx?src="+r}),1200)):t.$baseMessage("".concat(s),"error","vab-hey-message-error"),n.close(),a.next=21;break;case 17:a.prev=17,a.t0=a["catch"](5),console.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 21:case"end":return a.stop()}}),a,null,[[5,17]])})))()},handleManagement:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){var r,n,o;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.$refs["lowcodeDesign"].withHeader=!0,localStorage.setItem("parse_objectid",e.objectId),r={limit:1,where:{type:"amis",key:e.objectId}},a.next=5,Object(b["queryView"])(r);case 5:n=a.sent,o=n.results,console.log(o),t.lowcodeId=o[0].objectId,t.$dgiotBus.$emit("lowcodePreview",o[0]);case 10:case"end":return a.stop()}}),a)})))()},handleDelete:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){var r;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r=t.$baseColorfullLoading(),a.next=4,Object(u["delDevice"])(e);case 4:a.sent,t.$baseMessage(t.$translateTitle("user.successfully deleted"),"success","vab-hey-message-success"),r.close(),t.fetchData(),a.next=14;break;case 10:a.prev=10,a.t0=a["catch"](0),console.log(a.t0),t.$baseMessage(t.$translateTitle("user.error deleted")+"".concat(a.t0),"error","vab-hey-message-error");case 14:case"end":return a.stop()}}),a,null,[[0,10]])})))()},fetchData:function(){var e=this;return Object(o["a"])(l.a.mark((function t(){var a,r,n,o,i;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.list={forensics:[],examination:[]},e.getwordtemp(),e.getgroup(),e.queryPayload.include="product,parentId",e.queryPayload.where={"profile.identifier":"inspectionReportTemp",name:e.queryForm.name.length?{$regex:e.queryForm.name}:{$ne:null},"profile.step":{$regex:"^(-1|[0-9]\\d*)$"}},e.listLoading=!0,t.next=8,Object(u["queryDevice"])(e.queryPayload);case 8:a=t.sent,r=a.count,n=void 0===r?0:r,o=a.results,i=void 0===o?[]:o,e.$refs["forensics"]&&(e.$refs["forensics"].ination.total=n),e.list.forensics=i,i.forEach((function(e){e.profile.step||(e.profile.step=0),e.endtime=e.profile.endtime?w()(Number(e.profile.endtime)).format("YYYY-MM-DD HH:mm:ss"):"",e.starttime=e.profile.starttime?w()(Number(e.profile.starttime)).format("YYYY-MM-DD HH:mm:ss"):"",e.createdAt=w()(e.createdAt).format("YYYY-MM-DD HH:mm:ss")})),e.listLoading=!1;case 17:case"end":return t.stop()}}),t)})))()},visibleInfo:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){var r,n,o,i,s,c,u,p;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r=t,r.collectionInfo=e,r.getCardDevice(e.parentId.objectId),r.subRealtimedata(e),a.prev=4,n={},o=[],r.thingdata=[],r.realtimedata=[],r.thingcolumns=[],e.basedata)for(i in e.basedata)0==i.indexOf("dgiot_testing_equipment_")&&(s=i.split("dgiot_testing_equipment_")[1],n["".concat(s)]=s,o.push(e.basedata[i]));return console.groupCollapsed("%c send mqttMsg items","color:#009a61; font-size: 28px; font-weight: 300"),console.log(o),console.groupEnd(),a.next=16,Object(d["postHead"])({items:o,productid:e.parentId.product.objectId});case 16:c=a.sent,u=c.table,p=void 0===u?[]:u,r.thingcolumns=p,console.log(" _this.thingcolumns",r.thingcolumns),r.featHistoryEvidence(t.collectionInfo.objectId),r.visible=!0,a.next=29;break;case 25:a.prev=25,a.t0=a["catch"](4),console.log(a.t0),r.$baseMessage(r.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 29:case"end":return a.stop()}}),a,null,[[4,25]])})))()},startOpc:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){var r,n,o,i,s,c,d,p;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,n=[],a.next=4,Object(u["getDevice"])(e.objectId);case 4:if(o=a.sent,i=o.basedata,s=void 0===i?[]:i,!_.isEmpty(s))for(c in s)0==c.indexOf("dgiot_testing_equipment_")&&n.push(s[c]);return console.groupCollapsed("%c send mqttMsg items","color:#009a61; font-size: 28px; font-weight: 300"),console.log(n),console.groupEnd(),d="/".concat(e.parentId.product.objectId,"/").concat(e.parentId.devaddr,"/device/event"),p={cmd:"opc_items",groupid:e.parentId.objectId,opcserver:null!==(r=s.dgiot_testing_opcserver)&&void 0!==r?r:"Kepware.KEPServerEX.V6",items:n},console.groupCollapsed("%c 下发消息","color:#009a61; font-size: 28px; font-weight: 300"),console.log(p),console.log(d),console.groupEnd(),a.next=19,t.$dgiotBus.$emit("MqttPublish",d,JSON.stringify(p),0,!1);case 19:a.next=25;break;case 21:a.prev=21,a.t0=a["catch"](0),console.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 25:case"end":return a.stop()}}),a,null,[[0,21]])})))()},collection:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){var r,n,o,i,s,c,d,p,m;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=t,r.collectionInfo=e,r.featHistoryEvidence(t.collectionInfo.objectId),a.prev=3,{},o=[],r.thingdata=[],a.next=9,Object(u["getDevice"])(e.objectId);case 9:if(i=a.sent,s=i.basedata,c=void 0===s?[]:s,!_.isEmpty(c))for(d in c)0==d.indexOf("dgiot_testing_equipment_")&&o.push(c[d]);console.groupCollapsed("%c send mqttMsg items","color:#009a61; font-size: 28px; font-weight: 300"),console.log(o),console.groupEnd(),r.subtopic="topo/".concat(e.parentId.product.objectId,"/").concat(e.parentId.devaddr,"/post"),p="/".concat(e.parentId.product.objectId,"/").concat(e.parentId.devaddr,"/device/event"),m={cmd:"opc_report",duration:null!==(n=Number(c.dgiot_sampling_parametric_frequency))&&void 0!==n?n:5,groupid:e.parentId.objectId},console.groupCollapsed("%c 发送采集消息","color:#009a61; font-size: 28px; font-weight: 300"),console.log("message",m),console.log("pubTopic",p),console.groupEnd(),r.$dgiotBus.$emit("MqttPublish",p,JSON.stringify(m),0,!1),r.topicKey=r.$dgiotBus.topicKey(r.router,r.subtopic),r.$dgiotBus.$off(r.topicKey),r.$dgiotBus.$on(r.topicKey,(function(e){if(console.groupCollapsed("%c mqttMsg消息回调 \n".concat(r.topicKey),"color:#009a61; font-size: 28px; font-weight: 300"),console.log(e),console.log("payload:",e.payload),console.groupEnd(),null!==e&&void 0!==e&&e.payload){var t=JSON.parse(e.payload),a=t.thingdata,n=void 0===a?{}:a,o=t.timestamp;n.timestamp=w()(Number(o)).format("YYYY-MM-DD HH:mm:ss"),_.isEmpty(n)||0!=(null===n||void 0===n?void 0:n.dgiotcollectflag)?r.realtimedata.unshift(n):(console.log(n),r.thingdata[0]=n)}})),console.log("_this.thingdata",r.thingdata),r.$dgiotBus.$emit("MqttSubscribe",{router:r.router,topic:r.subtopic,qos:0,ttl:108e5}),a.next=35;break;case 31:a.prev=31,a.t0=a["catch"](3),console.log(a.t0),r.$baseMessage(r.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 35:r.subRealtimedata(e);case 36:case"end":return a.stop()}}),a,null,[[3,31]])})))()},saveHistorical:function(e,t,a,r){var n=this;return Object(o["a"])(l.a.mark((function o(){var i,s,c;return l.a.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return i={profile:_.merge(e.profile,{historicaldatacolumns:_.filter(t,(function(e){return"timestamp"!==e.prop})),historicaldata:a,drawxnqxPath:n.drawxnqxPath})},console.log(e,i),r&&(n.visible=!1),o.prev=3,s=n.$baseColorfullLoading(),o.next=7,Object(u["putDevice"])(e.objectId,i);case 7:c=o.sent,console.log(c),n.$baseMessage(n.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),s.close(),o.next=17;break;case 13:o.prev=13,o.t0=o["catch"](3),console.log(o.t0),n.$baseMessage(n.$translateTitle("alert.Data request error")+"".concat(o.t0),"error","vab-hey-message-error");case 17:case"end":return o.stop()}}),o,null,[[3,13]])})))()},drawxnqx:function(e,t){var a=this;return Object(o["a"])(l.a.mark((function r(){var n,o,i,s,c,u,d,p,m,g,f;return l.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a.drawxnqxPath="",r.prev=1,n=t,o={data:n,taskid:e},r.next=6,Object(v["postDrawxnqx"])(o);case 6:i=r.sent,s=i.code,c=i.error,u=void 0===c?"":c,d=i.original,p=void 0===d?{}:d,m=i.evidenceid,g=void 0===m?"":m,200==Number(s)?(a.historyEvidenceid=null!==g&&void 0!==g?g:"",a.historyEvidence=null!==(f=p.avgs)&&void 0!==f?f:[],a.drawxnqxPath="".concat(p.path,"?t=").concat(w()(new Date).format("x")),a.original=null!==p&&void 0!==p?p:{},a.historycolumns=_.filter(a.thingcolumns,(function(e){return"timestamp"!==e.prop}))):a.$baseMessage(a.$translateTitle("alert.Data request error")+"".concat(u),"error","vab-hey-message-error"),r.next=21;break;case 17:r.prev=17,r.t0=r["catch"](1),console.log(r.t0),a.$baseMessage(a.$translateTitle("alert.Data request error")+"".concat(r.t0),"error","vab-hey-message-error");case 21:case"end":return r.stop()}}),r,null,[[1,17]])})))()},getSummaries:function(e){console.log(e,"params");var t=e.columns,a=e.data,r=[];return t.forEach((function(e,t){if(0!==t){var n=a.map((function(t){return Number(t[e.property])}));if(n.every((function(e){return isNaN(e)})))r[t]=0;else{var o=0;r[t]=n.reduce((function(e,t){var a=Number(t);return isNaN(a)?e:(o++,e+t)}),0),r[t]=r[t]/o}}else r[t]="平均值"})),console.log(r),r}},beforeDestroy:function(){clearInterval(this.timer)}},$=x,k=(a("94eb"),a("bdd7")),C=Object(k["a"])($,r,n,!1,null,null,null);t["default"]=C.exports},"38bb":function(e,t,a){},4579:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"nodelist"},[a("div",{staticClass:"operation"},[a("el-button",{attrs:{icon:"el-icon-search",type:"primary"}}),a("el-button",{attrs:{icon:"el-icon-delete",type:"danger"}}),a("el-button",{attrs:{icon:"el-icon-date",type:"danger"}})],1)])},n=[],o={data:function(){return{}},mounted:function(){},methods:{}},i=o,s=(a("d4d8"),a("bdd7")),l=Object(s["a"])(i,r,n,!1,null,"045c1d7b",null);t["default"]=l.exports},"49ba1":function(e,t,a){},"4d5c":function(e,t,a){"use strict";a("c09b")},"55e02":function(e,t,a){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},"5b8e":function(e,t,a){"use strict";a("2695")},"60ed":function(e,t,a){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},"623f":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"resourcechannel resourcechannel-container"},[a("div",{staticClass:"firsttable"},[a("vab-input",{ref:"uploadFinish",attrs:{params:e.inputParams},on:{fileInfo:e.fileInfo,files:e.files}}),a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.fileParams,size:"small"}},[a("el-form-item",{attrs:{label:e.$translateTitle("application.scene")}},[a("el-input",{model:{value:e.fileParams.scene,callback:function(t){e.$set(e.fileParams,"scene",t)},expression:"fileParams.scene"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.path")}},[a("el-input",{attrs:{placeholder:e.$translateTitle("application.pathdescription")},model:{value:e.fileParams.path,callback:function(t){e.$set(e.fileParams,"path",t)},expression:"fileParams.path"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.uploadCkick()}}},[e._v(" "+e._s(e.$translateTitle("application.uploadfile"))+" ")])],1)],1),a("el-breadcrumb",{attrs:{separator:"/"}},[e._l(e.filebreadcrumb,(function(t,r){return[a("el-breadcrumb-item",{key:r,nativeOn:{click:function(a){return e.breadcrumbClick(t)}}},[e._v(" "+e._s(t.name)+" ")])]}))],2),a("h5"),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableRef",staticStyle:{width:"100%"},attrs:{"cell-style":{"text-align":"center"},data:e.filelist,"header-cell-style":{"text-align":"center"}},on:{"row-click":e.fileclick}},[a("el-table-column",{attrs:{label:e.$translateTitle("developer.filename"),prop:"name","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.filesize"),prop:"name","show-overflow-tooltip":"",sortable:"",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[r.is_dir?a("span",[e._v(e._s("-"))]):a("span",[e._v(e._s(Math.round(r.size/1024)+"kb"))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.filemtime"),prop:"name","show-overflow-tooltip":"",sortable:"",width:"260"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(" "+e._s(e.$moment(1e3*r.mtime).format("YYYY-MM-DD HH:mm:ss"))+" ")])]}}])}),a("el-table-column",{attrs:{fixed:"right",label:e.$translateTitle("developer.operation"),width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[r.is_dir?e._e():a("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return t.stopPropagation(),e.get_fileinfo(r)}}},[e._v(" "+e._s(e.$translateTitle("application.detail"))+" ")]),r.is_dir?e._e():a("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return t.stopPropagation(),e.download_file(r)}}},[e._v(" "+e._s(e.$translateTitle("application.preview"))+" ")]),r.is_dir?e._e():a("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},nativeOn:{click:function(t){return t.stopPropagation(),e.delete_file(r)}},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])]}}])})],1),a("el-dialog",{attrs:{"append-to-body":"",model:e.detailinfo,title:"文件信息",visible:e.detailView,width:"30%"},on:{"update:visible":function(t){e.detailView=t}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.ViewLoading,expression:"ViewLoading"}]},[a("el-form-item",{attrs:{label:"名称","label-width":"200"}},[a("span",[e._v(e._s(e.detailinfo.rename))])]),a("el-form-item",{attrs:{label:"路径","label-width":"200"}},[a("span",[e._v(e._s(e.detailinfo.path))])]),a("el-form-item",{attrs:{label:"url","label-width":"200"}},[a("span",[e._v(e._s(e.detailinfo.url))])]),a("el-form-item",{attrs:{label:"MD5","label-width":"200"}},[a("span",[e._v(e._s(e.detailinfo.md5))])]),a("el-form-item",{attrs:{label:"场景","label-width":"200"}},[a("span",[e._v(e._s(e.detailinfo.scene))])]),a("el-form-item",{attrs:{label:"大小","label-width":"200"}},[a("span",[e._v(e._s(Math.round(e.detailinfo.size/1024)+"kb"))])]),a("el-form-item",{attrs:{label:"日期","label-width":"200"}},[a("span",[e._v(" "+e._s(e.$moment(1e3*e.detailinfo.timeStamp).format("YYYY-MM-DD HH:mm:ss"))+" ")])])],1)],1)],1)])},n=[],o=(a("16b8"),a("e170"),a("7690"),a("3dec"),a("4656"),a("1ae2")),i={data:function(){return{filelist:[],filebreadcrumb:[{name:"全部文件",path:"dgiot_file",is_dir:!0}],fileParams:{scene:"app"},inputParams:{},parentfile:"dgiot_file",listLoading:!1,ViewLoading:!1,detailView:!1,detailinfo:{}}},watch:{},mounted:function(){this.get_filelist(this.parentfile)},methods:{breadcrumbClick:function(e){if("全部文件"==e.name)this.filebreadcrumb=[{name:"全部文件",path:"dgiot_file"}],this.get_filelist(e.path);else{if(e.child)for(var t=0;t<this.filebreadcrumb.length;t++)this.filebreadcrumb[t].path==e.child.path&&this.filebreadcrumb.splice(t,1);this.get_filelist(e.path+"/"+e.name)}},fileclick:function(e){if(dgiotlog.log(e),e.is_dir){this.get_filelist(e.path+"/"+e.name);var t=this.filebreadcrumb.length-1,a="child";this.filebreadcrumb[t][a]=e,this.filebreadcrumb.push(e)}else window.open(this.$FileServe+"/"+e.path+"/"+e.name)},uploadCkick:function(){this.loading=!0,this.$refs["uploadFinish"].$refs.uploader.dispatchEvent(new MouseEvent("click")),this.inputParams={file:"",scene:this.fileParams.scene?this.fileParams.scene:"default",path:this.fileParams.path?this.fileParams.path:"default",filename:moment(new Date).valueOf().toString()}},fileInfo:function(e){this.listLoading=!0,e.url?(this.$message({type:"success",message:"上传成功"}),this.get_filelist(this.parentfile)):this.$message({type:"error",message:"上传失败"}),this.listLoading=!1},files:function(e){this.inputParams.filename=e.name,this.inputParams.file=e},get_filelist:function(e){var t=this;this.listLoading=!0,Object(o["list_dir"])(e).then((function(e){"ok"==e.status?t.filelist=e.data:t.filelist=[],t.listLoading=!1}))},get_fileinfo:function(e){var t=this;this.detailView=!0,this.ViewLoading=!0,Object(o["file_info"])("files/"+e.path+"/"+e.name).then((function(a){t.detailinfo=a.data,t.detailinfo.url=t.$FileServe+"/"+e.path+"/"+e.name,t.ViewLoading=!1}))},delete_file:function(e){var t=this;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(o["delete_file"])("files/"+e.path+"/"+e.name).then((function(a){"ok"==a.status?(t.$message({type:"success",message:"删除成功"}),t.get_filelist(e.path)):t.$message({type:"error",message:a.message})}))["catch"]((function(){t.$message({type:"error",message:"删除失败"})}))}))["catch"]((function(){t.$message({type:"info",message:"已取消删除"})}))},download_file:function(e){window.open(this.$FileServe+"/"+e.path+"/"+e.name)}}},s=i,l=(a("ecf4"),a("4d5c"),a("bdd7")),c=Object(l["a"])(s,r,n,!1,null,"526a26a6",null);t["default"]=c.exports},6805:function(e,t,a){"use strict";a.r(t);var r=a("fb07"),n=a("e97b"),o=a("d0d7"),i=a.n(o),s=(a("a0e0"),a("3dec"),a("f764"),a("5662"),a("16b8"),a("7690"),a("3eb0"),a("9c6a"),a("1d17"),a("4c87"),a("b8f1"),a("d6a4"),a("209d")),l=a("8387"),c=a("1285"),u=a("cdef"),d=a("289a"),p=a.n(d),m=a("5880"),g=a("7212"),f=a("8ba7"),h=a("c008"),b=window["vue-aliplayer-v2"]["default"];t["default"]={name:"ReviewIndex",components:{VabDraggable:p.a,lowcodeDesign:s["default"],evidenceStatistics:l["default"],"vue-aliplayer-v2":b},data:function(){var e,t;return{statisticsVisible:!1,evidenceId:"",aliplayer:{autoplay:!1,height:"200px"},types:{video:["video","videocam_black"],audio:["audio","volume_mute"],image:["image","image"],file:["file","archive"]},evidences:[],evidenceDialog:!1,activeName:null!==this&&void 0!==this&&null!==(e=this.$route)&&void 0!==e&&null!==(t=e.query)&&void 0!==t&&t.tabs&&"examination"==this.$route.query.tabs?"examination":"forensics",officeapps:"",dialogVisible:!1,paginations:{layout:"total, sizes, prev, pager, next, jumper"},queryPayload:{excludeKeys:"data",include:"",order:"-createdAt",limit:10,skip:0,count:"objectId"},lowcodeId:"",loading:!1,options:[{value:"Underreview",label:"审核中"},{value:"finishreview",label:"审核完成"}],rules:{testbed:[{required:!0,message:"请选择测试台体",trigger:"blur"}],name:[{required:!0,message:"请输入报告名称",trigger:"blur"}],templatename:[{required:!0,message:"请选择报告模板",trigger:"change"}]},activePopShow:!1,border:!0,height:980,stripe:!0,lineHeight:"medium",checkList:["mission name","Inspection number","Inspection template","testbed","Trade Names","Creation time","Starting time","end time"],columns:[{label:"mission name",width:"auto",prop:"name",sortable:!0},{label:"Inspection template",width:"auto",prop:"profile.wordtemplatename",sortable:!0},{label:"testbed",width:"auto",prop:"profile.testbed",sortable:!0},{label:"Starting time",width:"auto",prop:"starttime",sortable:!0},{label:"end time",width:"auto",prop:"endtime",sortable:!0}],list:{forensics:[],examination:[]},listLoading:!0,queryForm:{pageSizes:[10,20,30,50],limit:10,order:"-createdAt",keys:"count(*)",total:0,skip:0,pageNo:1,pageSize:10,name:""},categorylist:[],wordtemplist:[],grouplist:[],ruleForm:{name:"",templatename:"",testbed:"",testbedid:"",templatenameid:""}}},computed:Object(n["a"])(Object(n["a"])({},Object(m["mapGetters"])({currentDepartment:"user/currentDepartment"})),{},{dragOptions:function(){return{animation:600,group:"description"}},finallyColumns:function(){var e=this;return this.columns.filter((function(t){return e.checkList.includes(t.label)}))}}),created:function(){this.fetchData()},methods:{handleHistory:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:try{t.evidenceId=e.objectId,t.statisticsVisible=!0,t.$nextTick((function(){t.$refs["statistics"].evidence(e.objectId)}))}catch(r){console.log(r),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(r),"error","vab-hey-message-error")}case 1:case"end":return a.stop()}}),a)})))()},paginationQuery:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.queryPayload=e;case 1:case"end":return a.stop()}}),a)})))()},categoryChange:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.$set(t.ruleForm,"templatenameid",e.objectId);case 1:case"end":return a.stop()}}),a)})))()},testbedChange:function(e){this.$set(this.ruleForm,"testbedid",e.objectId),dgiotlog.log("src/views/CloudTest/js/task.js","this.ruleForm",this.ruleForm,e.objectId)},getwordtemp:function(){var e=this;return Object(r["a"])(i.a.mark((function t(){var a,r,n,o;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={skip:0,where:{netType:"Evidence",nodeType:1}},t.next=3,Object(g["queryProduct"])(a);case 3:r=t.sent,n=r.results,o=void 0===n?{}:n,e.categorylist=o;case 7:case"end":return t.stop()}}),t)})))()},getgroup:function(){var e=this;return Object(r["a"])(i.a.mark((function t(){var a,r,n;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={where:{"detail.category":"84abda3154"}},t.next=3,Object(c["queryDevice"])(a);case 3:r=t.sent,n=r.results,e.grouplist=n;case 6:case"end":return t.stop()}}),t)})))()},submitForm:function(e){var t=this,a="role:"+this.currentDepartment.name,n={};n[a]={read:!0,write:!0},this.$refs[e].validate(function(){var e=Object(r["a"])(i.a.mark((function e(a){var r,n;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!a){e.next=10;break}return r={profile:{testbedid:t.ruleForm.testbedid,testbed:t.ruleForm.testbed.name,wordtemplatename:t.ruleForm.templatename.name,reportId:t.ruleForm.templatenameid,identifier:"inspectionReportTemp",step:0},parentId:t.ruleForm.testbedid,name:t.ruleForm.name,product:t.ruleForm.templatenameid},n=t.$baseColorfullLoading(1),t.activePopShow=!1,e.next=6,Object(u["postreport"])(r);case 6:t.fetchData(),n.close(),e.next=12;break;case 10:return dgiotlog.log("error submit!!"),e.abrupt("return",!1);case 12:t.ruleForm={name:"",templatename:"",testbed:"",testbedid:"",templatenameid:""};case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},forensics:function(e){dgiotlog.warn(e),this.$router.push({path:"/cloudTest/evidence",query:{taskid:e.objectId,suite:0,state:"preview",step:1,back:e.profile.step,message:e.profile.message}})},taskEnd:function(e){var t=this;this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to end the current mission"),null,Object(r["a"])(i.a.mark((function a(){var r,n;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r=t.$baseColorfullLoading(),n={profile:_.merge(e.profile,{step:4,endtime:moment(new Date).format("x")})},a.next=5,Object(c["putDevice"])(e.objectId,n);case 5:a.sent,t.fetchData(),r.close(),a.next=14;break;case 10:a.prev=10,a.t0=a["catch"](0),dgiotlog.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 14:case"end":return a.stop()}}),a,null,[[0,10]])}))))},taskStart:function(e){var t=this;this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to start the current mission"),null,Object(r["a"])(i.a.mark((function a(){var r,n;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r=t.$baseColorfullLoading(),n={profile:_.merge(e.profile,{step:1,starttime:moment(new Date).format("x")})},a.next=5,Object(c["putDevice"])(e.objectId,n);case 5:a.sent,t.fetchData(),r.close(),a.next=14;break;case 10:a.prev=10,a.t0=a["catch"](0),dgiotlog.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 14:case"end":return a.stop()}}),a,null,[[0,10]])}))))},downDocx:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){var r;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:try{r=document.createElement("a"),r.setAttribute("href",t.$FileServe+e),r.setAttribute("download","download"),r.click()}catch(n){dgiotlog.log(n),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(n),"error","vab-hey-message-error")}case 1:case"end":return a.stop()}}),a)})))()},handleUnderreview:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:try{t.$router.push({path:"/cloudTest/evidence",query:{taskid:e,suite:0,state:"preview",step:3}})}catch(r){dgiotlog.log(r),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(r),"error","vab-hey-message-error")}case 1:case"end":return a.stop()}}),a)})))()},handleRouter:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:try{t.$router.push({path:"/cloudTest/evidence",query:{taskid:e.objectId,suite:0,state:"preview",step:e.profile.step,back:e.profile.step,message:e.profile.message,disable:!0}})}catch(r){console.log(r),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(r),"error","vab-hey-message-error")}case 1:case"end":return a.stop()}}),a)})))()},handleEvidence:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){var r,n,o,s;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.evidences=[],a.prev=1,r={order:"-createdAt",skip:0,where:{"original.taskid":e,reportId:{$ne:e}}},n=t.$baseColorfullLoading(),a.next=6,Object(h["queryEvidence"])(r);case 6:o=a.sent,s=o.results,null!==s&&void 0!==s&&s.length&&s.forEach((function(e){e.original.path="/dgiot_file"+e.original.path.split("/dgiot_file")[1]})),t.evidenceDialog=!0,t.evidences=s,console.log(s),t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),n.close(),a.next=20;break;case 16:a.prev=16,a.t0=a["catch"](1),console.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 20:case"end":return a.stop()}}),a,null,[[1,16]])})))()},handleReport:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){var r,n,o,s,l,u;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(4!=e.profile.step||!e.profile.docx){a.next=5;break}return r=t.$FileServe+e.profile.docx,t.dialogVisible=!0,t.officeapps="https://view.officeapps.live.com/op/view.aspx?src="+r,a.abrupt("return",!1);case 5:return a.prev=5,n=t.$baseColorfullLoading(),a.next=9,Object(h["generatereport"])(e.objectId);case 9:o=a.sent,s=o.code,l=o.msg,u=o.path,200==s&&u?(t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),setTimeout((function(){var a={profile:_.merge(e.profile,{step:4,docx:u})},r=(Object(c["putDevice"])(e.objectId,a),t.$FileServe+u);t.dialogVisible=!0,t.officeapps="https://view.officeapps.live.com/op/view.aspx?src="+r,t.fetchData()}),1200)):t.$baseMessage("".concat(l),"error","vab-hey-message-error"),n.close(),a.next=21;break;case 17:a.prev=17,a.t0=a["catch"](5),dgiotlog.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 21:case"end":return a.stop()}}),a,null,[[5,17]])})))()},handleManagement:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){var r,n,o,s;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.$refs["lowcodeDesign"].withHeader=!0,localStorage.setItem("parse_objectid",e.objectId),r={limit:1,where:{type:"amis_view",key:e.objectId}},a.next=5,Object(f["queryView"])(r);case 5:n=a.sent,o=n.results,s=void 0===o?[]:o,console.log(s),0==s.length&&t.$baseMessage("暂无配置","success","vab-hey-message-success"),t.lowcodeId=s[0].objectId,t.$dgiotBus.$emit("lowcodePreview",s[0]);case 12:case"end":return a.stop()}}),a)})))()},handleDelete:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){var r;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r=t.$baseColorfullLoading(),a.next=4,Object(c["delDevice"])(e);case 4:a.sent,t.$baseMessage(t.$translateTitle("user.successfully deleted"),"success","vab-hey-message-success"),r.close(),t.fetchData(),a.next=14;break;case 10:a.prev=10,a.t0=a["catch"](0),dgiotlog.log(a.t0),t.$baseMessage(t.$translateTitle("user.error deleted")+"".concat(a.t0),"error","vab-hey-message-error");case 14:case"end":return a.stop()}}),a,null,[[0,10]])})))()},fetchData:function(){var e=this;return Object(r["a"])(i.a.mark((function t(){var a,r,n,o,s;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.list={forensics:[],examination:[]},e.getwordtemp(),e.getgroup(),e.queryPayload.include="product,parentId",e.queryPayload.where={"profile.identifier":"inspectionReportTemp",name:e.queryForm.name.length?{$regex:e.queryForm.name}:{$ne:null},"profile.step":{$regex:"^(-1|[2-9]\\d*)$"}},e.listLoading=!0,t.next=8,Object(c["queryDevice"])(e.queryPayload);case 8:a=t.sent,r=a.count,n=void 0===r?0:r,o=a.results,s=void 0===o?[]:o,e.$refs["examination"].ination.total=n,s.forEach((function(t){t.endtime=t.profile.endtime?moment(Number(t.profile.endtime)).format("YYYY-MM-DD HH:mm:ss"):"",t.starttime=t.profile.starttime?moment(Number(t.profile.starttime)).format("YYYY-MM-DD HH:mm:ss"):"",t.createdAt=moment(t.createdAt).format("YYYY-MM-DD HH:mm:ss"),e.list.examination.push(t)})),e.listLoading=!1;case 16:case"end":return t.stop()}}),t)})))()}}}},"6f237":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"logs logs-container",class:{"vab-fullscreen":e.isFullscreen}},[a("vab-query-form",[a("vab-query-form-top-panel",[a("el-form",{ref:"form",attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{staticClass:"item-time",attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{staticClass:"item-time-picker",attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:function(t){return e.queryTable({})}}}),a("el-button",{staticStyle:{margin:"0 10px 10px 10px !important"},attrs:{type:"success"},on:{click:e.handleHeight}},[a("dgiot-icon",{attrs:{icon:e.isFullscreen?"fullscreen-exit-fill":"fullscreen-fill"}})],1),a("el-popover",{attrs:{trigger:"hover"},scopedSlots:e._u([{key:"reference",fn:function(){return[a("el-button",{staticStyle:{margin:"0 0 10px 0 !important"},attrs:{icon:"el-icon-setting",type:"primary"}},[e._v(" "+e._s(e.$translateTitle("Logs.Draggable column settings"))+" ")])]},proxy:!0}])},[a("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},[a("vue-draggable",e._b({attrs:{list:e.logcolumns}},"vue-draggable",e.dragOptions,!1),e._l(e.logcolumns,(function(t,r){return a("div",{key:t+r},[a("dgiot-icon",{attrs:{icon:"drag-drop-line"}}),a("el-checkbox",{attrs:{disabled:!0===t.disableCheck,label:t}},[e._v(" "+e._s(t)+" ")])],1)})),0)],1)],1)],1)],1)],1)],1),a("el-table",{key:e.finallyColumns.length+e.momentKey,ref:"dragTable",staticClass:"logs-table",attrs:{border:"",data:e.logdata,height:e.height,"highlight-current-row":"",resizable:"","row-class-name":e.tableRowClassName,size:e.size,stripe:""},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-descriptions",{staticClass:"margin-top",attrs:{border:"",column:2,size:e.size}},e._l(t.row.body,(function(t,r,n){return a("el-descriptions-item",{directives:[{name:"show",rawName:"v-show",value:"elm"!=r,expression:"key != 'elm'"}],key:n,attrs:{label:r,"label-class-name":"my-label"}},[e._v(" "+e._s(t)+" ")])})),1)]}}])}),e._l(e.finallyColumns,(function(e,t){return a("el-table-column",{key:t,attrs:{align:"center",label:e,prop:e,"show-overflow-tooltip":"",sortable:""}})})),a("el-table-column",{attrs:{align:"center",fixed:"right",label:"msg",prop:"msg.body","show-overflow-tooltip":"",sortable:""}})],2),a("vab-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.queryForm.total>0,expression:"queryForm.total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.queryForm.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.queryTable}})],1)},n=[],o=a("fb07"),i=a("d0d7"),s=a.n(i),l=(a("7690"),a("a0e0"),a("3dec"),a("f764"),a("5662"),a("e170"),a("b8f1"),a("1d17"),a("4c87"),a("3eb0"),a("9c6a"),a("d6a4"),a("4656"),a("d292")),c={name:"AccessLog",data:function(){return{size:"",isFullscreen:!1,height:this.$baseTableHeight(0),logdata:[],momentKey:moment(new Date).valueOf(),checkList:["time","username","ip","method","path","code","reason","elapsedtime"],logcolumns:["time","username","ip","method","path","code","reason","elapsedtime"],queryForm:{total:0,count:"objectId",limit:20,pageNo:1,pageSize:20,skip:0,level:"",peername:"",pid:"",mfa:"",topic:"",domain:"parse_api",searchDate:[moment().subtract("days",7).format("YYYY-MM-DD"),moment(new Date).format("YYYY-MM-DD")],order:"-createdAt",keys:"count(*)"}}},computed:{dragOptions:function(){return{animation:600,group:"description"}},finallyColumns:function(){var e=this;return this.logcolumns.filter((function(t){return e.checkList.includes(t)}))}},created:function(){},mounted:function(){this.queryTable({}),this.rowDrop(),this.columnDrop()},methods:{handleHeight:function(){this.isFullscreen=!this.isFullscreen,this.isFullscreen?this.height=this.$baseTableHeight(0)+120:this.height=this.$baseTableHeight(0),this.momentKey=moment(new Date).valueOf()},tableRowClassName:function(e){var t=e.row;return t.disabled?"disabled":""},rowDrop:function(){var e=this.$refs.dragTable.$el.querySelector(".el-table__body-wrapper tbody"),t=this;Sortable.create(e,{draggable:".el-table__row",onEnd:function(e){var a=e.newIndex,r=e.oldIndex,n=t.logdata.splice(r,1)[0];t.logdata.splice(a,0,n)}})},columnDrop:function(){var e=this,t=this.$refs.dragTable.$el.querySelector(".el-table__header-wrapper tr");e.sortable=Sortable.create(t,{animation:180,delay:0,onEnd:function(t){var a=e.finallyColumns[t.oldIndex];e.finallyColumns.splice(t.oldIndex,1),e.finallyColumns.splice(t.newIndex,0,a),e.momentKey=moment(new Date).valueOf(),setTimeout((function(){e.rowDrop(),e.columnDrop()}),1500)}})},queryTable:function(){var e=arguments,t=this;return Object(o["a"])(s.a.mark((function a(){var r,n,o,i,c,u,d,p;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:{},r.limit||(r=t.queryForm),n=t.$baseColorfullLoading(),a.prev=3,n.close(),o={limit:r.limit,skip:r.skip,order:r.order,count:t.queryForm.count,keys:"time,msg",include:"",where:{domain:t.queryForm.domain?{$all:t.queryForm.domain.split(/,(?=(?:[^']*(?:'[^']*')?[^']*)*$)/)}:{$ne:""},createdAt:{$gte:{__type:"Date",iso:"".concat(t.queryForm.searchDate[0],"T00:00:00.000Z")},$lte:{__type:"Date",iso:"".concat(t.queryForm.searchDate[1],"T23:59:59.000Z")}}}},a.next=8,Object(l["queryLog"])(o);case 8:i=a.sent,c=i.results,u=void 0===c?[]:c,d=i.count,p=void 0===d?0:d,u.forEach((function(e,a){e.time=t.$moment(Number(e.time.toString().substring(0,13))).format("YYYY-MM-DD HH:mm:ss.SSS");var r=JSON.parse(e.msg);for(var n in r)"body"==n?e["body"]=r["body"]:e[n]=r[n];0==a&&(dgiotlog.log(e),dgiotlog.log(e.body))})),t.logdata=u,t.queryForm.total=p,t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),n.close(),a.next=24;break;case 20:a.prev=20,a.t0=a["catch"](3),n.close(),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 24:t.momentKey=moment(new Date).valueOf();case 25:case"end":return a.stop()}}),a,null,[[3,20]])})))()}}},u=c,d=(a("1458"),a("f4ab"),a("bdd7")),p=Object(d["a"])(u,r,n,!1,null,"00ae372e",null);t["default"]=p.exports},"7c56":function(e,t,a){"use strict";a("55e02")},"7da2":function(e,t,a){},"7dae":function(e,t,a){},"7e64":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"system-log-container"},[a("vab-query-form",[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"60px",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"账号"}},[a("el-input",{attrs:{clearable:"",placeholder:"请输入账号"},model:{value:e.queryForm.account,callback:function(t){e.$set(e.queryForm,"account","string"===typeof t?t.trim():t)},expression:"queryForm.account"}})],1),a("el-form-item",{attrs:{label:"周期"}},[a("el-date-picker",{attrs:{"end-placeholder":"结束日期",format:"yyyy-MM-dd","start-placeholder":"开始日期",type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",type:"primary"},nativeOn:{click:function(t){return e.queryData.apply(null,arguments)}}},[e._v(" 查询 ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.list},scopedSlots:e._u([{key:"empty",fn:function(){},proxy:!0}])},[a("el-table-column",{attrs:{align:"center",label:"日志类型",prop:"type","show-overflow-tooltip":"",width:"230px"}}),a("el-table-column",{attrs:{align:"center",label:"账号",prop:"account","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{align:"center",label:"执行结果",prop:"executeResult","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return["登录成功"===r.executeResult?a("span",[a("span",{staticClass:"vab-dot vab-dot-success"},[a("span")]),e._v(" "+e._s(r.executeResult)+" ")]):a("span",[a("span",{staticClass:"vab-dot vab-dot-error"},[a("span")]),e._v(" "+e._s(r.executeResult)+" ")])]}}])}),a("el-table-column",{attrs:{align:"center",label:"登录IP",prop:"ip"}}),a("el-table-column",{attrs:{align:"center",label:"访问时间",prop:"datetime","show-overflow-tooltip":""}})],1),a("el-pagination",{attrs:{background:"","current-page":e.queryForm.pageNo,layout:e.layout,"page-size":e.queryForm.pageSize,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)},n=[],o=a("fb07"),i=a("d0d7"),s=a.n(i),l=a("8781"),c={name:"SystemLog",data:function(){return{list:[],listLoading:!0,layout:"total, sizes, prev, pager, next, jumper",total:0,queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20}}},created:function(){this.fetchData()},methods:{handleSizeChange:function(e){this.queryForm.pageSize=e,this.fetchData()},handleCurrentChange:function(e){this.queryForm.pageNo=e,this.fetchData()},queryData:function(){this.queryForm.pageNo=1,this.fetchData()},fetchData:function(){var e=this;return Object(o["a"])(s.a.mark((function t(){var a,r,n,o;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.listLoading=!0,t.next=3,Object(l["getList"])(e.queryForm);case 3:a=t.sent,r=a.data,n=r.list,o=r.total,e.list=n,e.total=o,e.listLoading=!1;case 10:case"end":return t.stop()}}),t)})))()}}},u=c,d=a("bdd7"),p=Object(d["a"])(u,r,n,!1,null,null,null);t["default"]=p.exports},"7f2c":function(e,t,a){},8387:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"statistics-content"},[r("div",{staticClass:"statistics-content-chart"},[r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:12}},[r("el-divider",[e._v("历史数据")]),r("vab-chart",{ref:"charts",attrs:{"after-config":e.afterConfig,data:e.chartData,"data-empty":e.dataEmpty,"data-zoom":e.chartDataZoom,extend:e.chartExtend,loading:e.loading,"set-option-opts":!1,settings:e.chartSettings,toolbox:e.toolbox,type:e.params.style}})],1),r("el-col",{attrs:{span:12}},[r("el-divider",[e._v("存储的数据")]),r("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[r("el-tab-pane",{attrs:{label:"存储的数据",name:"first"}},[r("el-table",{key:e.historyEvidence.length,staticStyle:{"min-height":"530px"},attrs:{border:"",data:e.historyEvidence}},e._l(e.historycolumns,(function(t,a){return r("el-table-column",{key:a,attrs:{align:"center",label:e.$translateTitle("cloudTest."+t.label),prop:t.prop,"show-overflow-tooltip":"",sortable:"",width:"auto"}})})),1)],1),r("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.chart"),name:"second"}},[r("el-card",[r("el-image",{key:e.drawxnqxPath,attrs:{"preview-src-list":[e.$FileServe+e.drawxnqxPath],src:e.$FileServe+e.drawxnqxPath}},[r("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[r("el-image",{staticClass:"vab-data-empty",attrs:{src:a("c2ad")}})],1)])],1)],1)],1)],1)],1),r("div",{staticClass:"chartOther"},[r("el-row",{attrs:{gutter:20}},[e._l(e.chartData.child,(function(t,a){return r("el-col",{directives:[{name:"show",rawName:"v-show",value:"日期"!=t.columns[1],expression:"item.columns[1] != '日期'"}],key:a,attrs:{md:e.md,sm:e.sm,xl:e.xl,xs:e.xs}},[r("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[r("span",[e._v(e._s(t.columns[1])+" : "+e._s(t.unit))]),r("el-button-group",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"}},[r("el-button",{attrs:{icon:"el-icon-full-screen"},nativeOn:{click:function(t){return e.toggleCardRow(a,e.xs,e.sm,e.md,e.xl)}}})],1)],1),r("vab-chart",{ref:"charts",refInFor:!0,attrs:{"after-config":e.afterConfig,data:e.chartData.child[a],"data-empty":e.dataEmpty,"data-zoom":e.chartDataZoom,extend:e.chartExtend,height:"300px","legend-visible":!1,loading:e.loading,"set-option-opts":!1,settings:e.chartSettings,toolbox:e.toolbox,type:e.params.style}})],1)],1)})),r("el-col",{directives:[{name:"show",rawName:"v-show",value:!e.chartData.child,expression:"!chartData.child"}],attrs:{span:24}},[r("vab-empty")],1)],2)],1)],1)])},n=[],o=a("fb07"),i=a("d0d7"),s=a.n(i),l=(a("7690"),a("3eb0"),a("3dec"),a("9c6a"),a("d6a4"),a("79da"),a("ca7b")),c=a("1285"),u=(a("c008"),{name:"Statistics",components:{},props:{evidenceId:{type:String,default:"",require:!0}},data:function(){return this.toolbox={orient:"vertical",right:-5,feature:{dataZoom:{yAxisIndex:"none"},magicType:{type:["line","bar","histogram","pie","ring","waterfall","funnel","radar","heatmap","scatter","candle","stack"]},dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0},restore:{show:!0}}},this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40}},{activeName:"first",drawxnqxPath:"",xl:6,xs:24,sm:24,md:12,historyEvidence:[],historycolumns:[],params:{_function:"last",style:"",number:1,interval:"m",datetimerange:"",keys:"*",limit:100,endTime:new Date,startTime:(new Date).getTime()-6048e5},chartSettings:{},chartDataZoom:[{type:"slider"}],dataEmpty:!0,chartData:{identifier:[],columns:[],rows:[]},loading:!0,infoData:{}}},computed:{},mounted:function(){this.params.style=l["default"][0].type},methods:{resizeTheChart:function(){var e=this.$refs["charts"];e instanceof Array?e.forEach((function(e){e.$children[0].resize()})):e.$children[0].resize()},afterConfig:function(e){return e.tooltip.showDelay=500,e},toggleCardRow:function(e,t,a,r,n){var i=this;return Object(o["a"])(s.a.mark((function e(){return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:try{i.sm=24==a?12:24,i.md=12==r?24:12,i.xl=6==n?12:6,i.xs=24==t?12:24,i.$nextTick((function(e){i.resizeTheChart()}))}catch(o){console.log(o),i.$baseMessage(i.$translateTitle("alert.Data request error")+"".concat(o),"error","vab-hey-message-error")}case 1:case"end":return e.stop()}}),e)})))()},evidence:function(e){var t=this;return Object(o["a"])(s.a.mark((function a(){var r,n,o,i,l,u,d;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(c["getDevice"])(e);case 3:return o=a.sent,t.infoData=o,i=o.profile,l=void 0===i?{endtime:moment(Number(endTime)).valueOf(),drawxnqxPath:""}:i,u=o.parentId,d=void 0===u?{}:u,t.params.startTime=l.starttime,t.params.endTime=l.endtime,t.historycolumns=null!==(r=l.historicaldatacolumns)&&void 0!==r?r:[],t.historyEvidence=null!==(n=l.historicaldata)&&void 0!==n?n:[],t.drawxnqxPath=l.drawxnqxPath,a.next=13,t.queryStatistics(d.objectId);case 13:a.next=19;break;case 15:a.prev=15,a.t0=a["catch"](0),console.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 19:case"end":return a.stop()}}),a,null,[[0,15]])})))()},queryStatistics:function(e){var t=this;return Object(o["a"])(s.a.mark((function a(){var r,n,o,i,l,u,d,p,m,g,f,h,b,v,y;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=t.params,n=r.interval,o=r.keys,i=r.limit,l=r.number,u=r.style,d=r._function,p=r.startTime,m=r.endTime,g=void 0===m?moment(new Date).format("x"):m,f={starttime:moment(Number(p)).valueOf(),endtime:moment(Number(g)).valueOf(),interval:l+n,keys:o,limit:i,function:d,style:u},a.prev=2,h=t.$baseColorfullLoading(),a.next=6,Object(c["getDabDevice"])(e,f);case 6:b=a.sent,v=b.chartData,y=void 0===v?{}:v,t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),h.close(),t.chartData=y,t.loading=!1,_.isEmpty(y)||(t.dataEmpty=!1),a.next=20;break;case 16:a.prev=16,a.t0=a["catch"](2),console.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 20:case"end":return a.stop()}}),a,null,[[2,16]])})))()}}}),d=u,p=(a("312d"),a("bdd7")),m=Object(p["a"])(d,r,n,!1,null,"b76c7222",null);t["default"]=m.exports},"94eb":function(e,t,a){"use strict";a("dd8c")},"95f7":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"appmarage appmarage-container"},[a("div",{staticClass:"header"},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.checkupdateall}},[e._v(" "+e._s(e.$translateTitle("plugins.checkupdate"))+" ")])],1),a("div",{staticClass:"block",staticStyle:{"margin-top":"10px"}},[a("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.tableData.slice((e.start-1)*e.length,e.start*e.length),height:e.height}},[a("el-table-column",{attrs:{align:"center",label:"App"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",{style:{color:1==r.active?"green":"red"}},[e._v(" "+e._s(r.app)+" ")])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("plugins.version"),prop:"version",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.describe"),prop:"desc",sortable:""}}),a("el-table-column",{attrs:{align:"right",label:e.$translateTitle("developer.operation")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[0==r.active?a("el-button",{attrs:{plain:"",size:"small",type:"info"},on:{click:function(t){return e.startup(r.app)}}},[a("div",{staticStyle:{display:"inline-block",width:"10px",height:"10px","margin-right":"10px",background:"#00cc33","border-radius":"50%"}}),e._v(" "+e._s(e.$translateTitle("plugins.start"))+" ")]):e._e(),1==r.active?a("el-button",{attrs:{plain:"",size:"small",type:"info"},on:{click:function(t){return e.stopup(r.app)}}},[a("div",{staticStyle:{display:"inline-block",width:"10px",height:"10px","margin-right":"10px",background:"#a94442","border-radius":"50%"}}),e._v(" "+e._s(e.$translateTitle("plugins.stop"))+" ")]):e._e(),a("el-button",{attrs:{plain:"",size:"small",type:"info"},on:{click:function(t){return e.checkupdate(r.app)}}},[e._v(" "+e._s(e.$translateTitle("plugins.checkupdate"))+" ")])]}}])},[a("template",{slot:"header"},[a("el-input",{attrs:{placeholder:e.$translateTitle("plugins.enterappsearch"),size:"mini"},on:{change:e.changevalue},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)],2)],1)],1),a("div",{staticClass:"block"},[a("el-pagination",{staticStyle:{"margin-top":"30px"},attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper","page-size":e.length,"page-sizes":[10,25,50,100],total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1),a("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose,title:e.$translateTitle("plugins.modulelist"),visible:e.dialogVisible,width:"40%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",[a("el-table",{staticStyle:{width:"100%","margin-top":"20px","text-align":"center"},attrs:{data:e.tableData1.slice((e.start1-1)*e.length1,e.start1*e.length1),height:"300"}},[a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("plugins.modulename"),prop:"path",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("plugins.ischange"),prop:"is_changed",sortable:""}})],1),a("div",{staticClass:"block"},[a("el-pagination",{staticStyle:{"margin-top":"30px"},attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper","page-size":e.length1,"page-sizes":[10,25,50,100],total:e.total1},on:{"current-change":e.handleCurrentChange1,"size-change":e.handleSizeChange1}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticStyle:{float:"left"},on:{click:function(t){e.dialogVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary"},nativeOn:{click:function(t){return e.reupload.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)])],1)},n=[],o=(a("1d17"),a("df0e"),a("a0e0"),a("3dec"),a("f764"),a("5662"),a("c4bc"),a("bb22")),i=[],s=[],l={data:function(){return{height:this.$baseTableHeight(0)-15,tableData:[],total:0,start:1,length:10,node:null,dialogVisible:!1,start1:1,length1:10,total1:0,tableData1:[],app:"",version:"",searchvalue:"",search:""}},computed:{},mounted:function(){this.getInformation()},methods:{handleSizeChange:function(e){this.start=1,this.length=e},handleCurrentChange:function(e){this.start=e},handleSizeChange1:function(e){this.start1=1,this.length1=e},handleCurrentChange1:function(e){this.start1=e},getInformation:function(){var e=this;Object(o["Getapp"])(this.node,this.start,this.length).then((function(t){t&&(e.tableData=t.apps,i=t.apps,e.total=t.recordsTotal)}))["catch"]((function(t){e.$message({type:"error",message:t.error})}))},handleClose:function(){this.dialogVisible=!1},changevalue:function(){var e=this;""==this.search&&(this.tableData=i),this.tableData=this.tableData.filter((function(t){return!e.search||t.app.toLowerCase().includes(e.search.toLowerCase())}))},changedialog:function(){var e=this;""==this.searchvalue&&(this.tableData1=s),this.tableData1=tableData1.filter((function(t){return!e.searchvalue||t.path.toLowerCase().includes(searchvalue.toLowerCase())}))},checkupdate:function(e){var t=this;this.tableData1=[],this.searchvalue="",this.dialogVisible=!0,this.app=e,this.total1=0,Object(o["Getmodule"])(e).then((function(e){e&&(e.map((function(e){0==e.is_changed?e.is_changed="false":e.is_changed="true"})),t.tableData1=e,s=e,t.total1=e.length)}))},checkupdateall:function(){var e=this;this.searchvalue="",this.dialogVisible=!0,this.tableData1=[],this.total1=0,this.app="",Object(o["Getmodule"])("changed").then((function(t){t&&(t.map((function(e){0==e.is_changed?e.is_changed="false":e.is_changed="true"})),e.tableData1=t,s=t,e.total1=t.length)}))},startup:function(e){var t=this;Object(o["Getstart"])(e).then((function(e){e&&(t.$message({message:"启动成功",type:"success"}),t.getInformation())}))["catch"]((function(e){dgiotlog.log(e)}))},stopup:function(e){var t=this;Object(o["Getstop"])(e).then((function(e){e&&(t.$message({message:"停止成功",type:"success"}),t.getInformation())}))["catch"]((function(e){dgiotlog.log(e)}))},reupload:function(){var e=this;""==this.app?Object(o["GetReload"])("all").then((function(t){t&&(0==t.length?e.$message({message:"当前无更新",type:"warning"}):e.$message({message:"已更新模块"+t,type:"success"}))})):Object(o["GetReload"])(this.app).then((function(t){t&&(0==t.length?e.$message({message:"当前无更新",type:"warning"}):e.$message({message:"已更新模块"+t,type:"success"}),e.app)}))}}},c=l,u=a("bdd7"),d=Object(u["a"])(c,r,n,!1,null,null,null);t["default"]=d.exports},9643:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"logs logs-container",class:{"vab-fullscreen":e.isFullscreen}},[a("vab-query-form",[a("vab-query-form-top-panel",[a("el-form",{ref:"form",attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{staticClass:"item-time",attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{staticClass:"item-time-picker",attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",{attrs:{label:"level"}},[a("el-select",{attrs:{clearable:""},model:{value:e.queryForm.level,callback:function(t){e.$set(e.queryForm,"level",t)},expression:"queryForm.level"}},e._l(e.leverData,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}},[e._v(" "+e._s(t)+" ")])})),1)],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}],attrs:{label:"pid"}},[a("el-input",{attrs:{clearable:""},model:{value:e.queryForm.pid,callback:function(t){e.$set(e.queryForm,"pid",t)},expression:"queryForm.pid"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}],attrs:{label:"domain"}},[a("el-input",{attrs:{clearable:""},model:{value:e.queryForm.domain,callback:function(t){e.$set(e.queryForm,"domain",t)},expression:"queryForm.domain"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}],attrs:{label:"mfa"}},[a("el-input",{attrs:{clearable:""},model:{value:e.queryForm.mfa,callback:function(t){e.$set(e.queryForm,"mfa",t)},expression:"queryForm.mfa"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}],attrs:{label:"clientid"}},[a("el-input",{attrs:{clearable:""},model:{value:e.queryForm.clientid,callback:function(t){e.$set(e.queryForm,"clientid",t)},expression:"queryForm.clientid"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}],attrs:{label:"topic"}},[a("el-input",{attrs:{clearable:""},model:{value:e.queryForm.topic,callback:function(t){e.$set(e.queryForm,"topic",t)},expression:"queryForm.topic"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}],attrs:{label:"peername","label-width":"80px"}},[a("el-input",{attrs:{clearable:""},model:{value:e.queryForm.peername,callback:function(t){e.$set(e.queryForm,"peername",t)},expression:"queryForm.peername"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"text"},on:{click:function(t){e.fold=!e.fold}}},[e.fold?a("span",[e._v(" "+e._s(e.$translateTitle("Maintenance.Unfold"))+" ")]):a("span",[e._v(e._s(e.$translateTitle("Maintenance.merge")))]),a("dgiot-icon",{staticClass:"vab-dropdown",class:{"vab-dropdown-active":e.fold},attrs:{icon:"arrow-up-s-line"}})],1),a("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:function(t){return e.queryTable({})}}}),a("el-button",{staticStyle:{margin:"0 10px 10px 10px !important"},attrs:{type:"success"},on:{click:e.handleHeight}},[a("dgiot-icon",{attrs:{icon:e.isFullscreen?"fullscreen-exit-fill":"fullscreen-fill"}})],1),a("el-popover",{attrs:{trigger:"hover"},scopedSlots:e._u([{key:"reference",fn:function(){return[a("el-button",{staticStyle:{margin:"0 0 10px 0 !important"},attrs:{icon:"el-icon-setting",type:"primary"}},[e._v(" "+e._s(e.$translateTitle("Logs.Draggable column settings"))+" ")])]},proxy:!0}])},[a("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},[a("vue-draggable",e._b({attrs:{list:e.logcolumns}},"vue-draggable",e.dragOptions,!1),e._l(e.logcolumns,(function(t,r){return a("div",{key:t+r},[a("dgiot-icon",{attrs:{icon:"drag-drop-line"}}),a("el-checkbox",{attrs:{disabled:!0===t.disableCheck,label:t}},[e._v(" "+e._s(t)+" ")])],1)})),0)],1)],1)],1)],1)],1)],1),a("el-table",{key:e.finallyColumns.length+e.momentKey,ref:"dragTable",staticClass:"logs-table",attrs:{border:"",data:e.logdata,"default-expand-all":"",height:e.height,"highlight-current-row":"",resizable:"","row-class-name":e.tableRowClassName,stripe:""},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center",fixed:"left",label:"time",prop:"time","show-overflow-tooltip":"",sortable:"",width:"160"}}),e._l(e.finallyColumns,(function(t,r){return a("el-table-column",{key:r,attrs:{align:"center",label:t,prop:t,"show-overflow-tooltip":"",sortable:"",width:e.w80.includes(t)?80:e.Wh120.includes(t)?120:"auto"}})})),a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-descriptions",{staticClass:"margin-top",attrs:{border:"",column:2}},[a("el-descriptions-item",[a("template",{slot:"label"},[a("i",{directives:[{name:"copy",rawName:"v-copy",value:t.row.msg,expression:"props.row.msg"}],staticClass:"el-icon-copy-document"})]),e._v(" "+e._s(t.row.msg)+" ")],2)],1)]}}])})],2),a("vab-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.queryForm.total>0,expression:"queryForm.total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.queryForm.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.queryTable}})],1)},n=[],o=a("fb07"),i=a("d0d7"),s=a.n(i),l=(a("7690"),a("a0e0"),a("3dec"),a("f764"),a("5662"),a("e170"),a("b8f1"),a("1d17"),a("4c87"),a("3eb0"),a("9c6a"),a("d6a4"),a("4656"),a("d292")),c={name:"HistoryLog",data:function(){return{isFullscreen:!1,height:this.$baseTableHeight(0),logdata:[],momentKey:moment(new Date).valueOf(),checkList:["pid","level","mfa","line"],logcolumns:["pid","level","domain","mfa","line","clientid","topic","peername"],fold:!0,w80:["line","level"],Wh120:["pid","domain","gl"],Wh200:["time","clientid","peername"],leverData:["debug","info","notice","warning","error","crtical","alert","emergency"],queryForm:{total:0,count:"objectId",limit:20,pageNo:1,pageSize:20,skip:0,level:"",peername:"",pid:"",mfa:"",topic:"",domain:"",searchDate:[moment().subtract("days",7).format("YYYY-MM-DD"),moment(new Date).format("YYYY-MM-DD")],order:"-createdAt",keys:"count(*)"}}},computed:{dragOptions:function(){return{animation:600,group:"description"}},finallyColumns:function(){var e=this;return this.logcolumns.filter((function(t){return e.checkList.includes(t)}))}},created:function(){},mounted:function(){this.queryTable({}),this.rowDrop(),this.columnDrop()},methods:{handleHeight:function(){this.isFullscreen=!this.isFullscreen,this.isFullscreen?this.height=this.$baseTableHeight(0)+120:this.height=this.$baseTableHeight(0),this.momentKey=moment(new Date).valueOf()},tableRowClassName:function(e){var t=e.row;return t.disabled?"disabled":""},rowDrop:function(){var e=this.$refs.dragTable.$el.querySelector(".el-table__body-wrapper tbody"),t=this;Sortable.create(e,{draggable:".el-table__row",onEnd:function(e){var a=e.newIndex,r=e.oldIndex,n=t.logdata.splice(r,1)[0];t.logdata.splice(a,0,n)}})},columnDrop:function(){var e=this,t=this.$refs.dragTable.$el.querySelector(".el-table__header-wrapper tr");e.sortable=Sortable.create(t,{animation:180,delay:0,onEnd:function(t){var a=e.finallyColumns[t.oldIndex];e.finallyColumns.splice(t.oldIndex,1),e.finallyColumns.splice(t.newIndex,0,a),e.momentKey=moment(new Date).valueOf(),setTimeout((function(){e.rowDrop(),e.columnDrop()}),1500)}})},queryTable:function(){var e=arguments,t=this;return Object(o["a"])(s.a.mark((function a(){var r,n,o,i,c,u,d,p;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:{},r.limit||(r=t.queryForm),n=t.$baseColorfullLoading(),dgiotlog.log(t.queryForm,"queryForm",r),a.prev=4,n.close(),o={limit:r.limit,skip:r.skip,order:r.order,count:t.queryForm.count,include:"",where:{level:t.queryForm.level?t.queryForm.level:{$ne:"3333"},pid:t.queryForm.pid?{$regex:t.queryForm.pid,$options:"i"}:{$ne:"3333"},mfa:t.queryForm.mfa?{$regex:t.queryForm.mfa,$options:"i"}:{$ne:"3333"},domain:t.queryForm.domain?{$all:t.queryForm.domain.split(/,(?=(?:[^']*(?:'[^']*')?[^']*)*$)/)}:{$ne:""},topic:t.queryForm.topic?{$regex:t.queryForm.topic,$options:"i"}:{$ne:"3333"},peername:t.queryForm.peername?{$regex:t.queryForm.peername,$options:"i"}:{$ne:"3333"},clientid:t.queryForm.clientid?{$regex:t.queryForm.clientid,$options:"i"}:{$ne:"3333"},createdAt:{$gte:{__type:"Date",iso:"".concat(t.queryForm.searchDate[0],"T00:00:00.000Z")},$lte:{__type:"Date",iso:"".concat(t.queryForm.searchDate[1],"T23:59:59.000Z")}}}},a.next=9,Object(l["queryLog"])(o);case 9:i=a.sent,c=i.results,u=void 0===c?[]:c,d=i.count,p=void 0===d?0:d,u.forEach((function(e){e.time=t.$moment(Number(e.time.toString().substring(0,13))).format("YYYY-MM-DD HH:mm:ss.SSS")})),t.logdata=u,t.queryForm.total=p,t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),n.close(),a.next=26;break;case 21:a.prev=21,a.t0=a["catch"](4),n.close(),dgiotlog.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 26:t.momentKey=moment(new Date).valueOf();case 27:case"end":return a.stop()}}),a,null,[[4,21]])})))()}}},u=c,d=(a("d842"),a("bdd7")),p=Object(d["a"])(u,r,n,!1,null,"12629278",null);t["default"]=p.exports},a0e3:function(e,t,a){"use strict";a.r(t);var r=a("fb07"),n=a("e97b"),o=a("d0d7"),i=a.n(o),s=(a("7690"),a("a0e0"),a("3dec"),a("f764"),a("5662"),a("79da"),a("16b8"),a("3eb0"),a("9c6a"),a("04d6"),a("7212")),l=a("8ba7"),c=a("58dd"),u=a("289a"),d=a.n(u),p=a("5880"),m=a("bb22"),g=a("03b1"),f=a("ef68");a("c008");t["default"]={name:"ReportIndex",components:{VabDraggable:d.a},data:function(){var e=function(e,t,a){""===t?a(new Error("请上传文件")):a()};return{queryForm:{name:"",category:""},paginations:{},queryPayload:{include:"category",order:"-updatedAt",limit:10,skip:0,keys:"count(*)"},tableData:[],categoryTreeData:[],fileList:[],momentKey:moment(new Date).valueOf(),ruleForm:{file:null,name:"",category:"",factory:"",date2:""},rules:{name:[{required:!0,message:"请输入模板名称",trigger:"blur"}],categoryname:[{required:!0,message:"请选择所属品类",trigger:"blur"}],factory:[{required:!0,message:"请输入厂商名称",trigger:"blur"}],file:[{validator:e,trigger:"blur"}]},activePopShow:!1,tempPopShow:!1,isFullscreen:!1,border:!0,height:this.$baseTableHeight(0)-20,stripe:!0,lineHeight:"medium",checkList:["objectId","Template name","category","Trade Names","Creation time"],columns:[{label:"objectId",width:120,prop:"objectId",sortable:!0,disableCheck:!0},{label:"Template name",width:"auto",prop:"name",sortable:!0},{label:"category",width:"auto",prop:"category.name",sortable:!0},{label:"Trade Names",width:"auto",prop:"devType",sortable:!0},{label:"Creation time",width:"auto",prop:"createdAt",sortable:!0}],list:[],tempList:[],views:[],listLoading:!0,layout:"total, sizes, prev, pager, next, jumper",temprow:{},cascaderDrawer:!1}},computed:Object(n["a"])(Object(n["a"])({},Object(p["mapGetters"])({language:"settings/language",collapse:"settings/collapse"})),{},{dragOptions:function(){return{animation:600,group:"description"}},finallyColumns:function(){var e=this;return this.columns.filter((function(t){return e.checkList.includes(t.label)}))}}),watch:{language:{deep:!0,limit:!0,handler:function(e){dgiotlog.warn(e)}}},created:function(){},mounted:function(){this.categorytree(),this.fetchData()},methods:{paginationQuery:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.queryPayload=e;case 1:case"end":return a.stop()}}),a)})))()},handlecateClick:function(){this.categorytree(),this.cascaderDrawer=!0},queryProdut:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){var r,n,o,s,l,c,u,d;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.categorys,n=t.$baseColorfullLoading(),e.limit||(e=t.queryForm),o={limit:e.limit,order:e.order,skip:e.skip,keys:e.keys,include:"category",where:{category:r?{$in:r}:{$ne:null},name:e.name?{$regex:e.name,$options:"i"}:{$ne:null}}},a.prev=4,a.next=7,Object(f["queryProductTemplet"])(o);case 7:s=a.sent,l=s.results,c=void 0===l?[]:l,u=s.count,d=void 0===u?0:u,n.close(),t.tableData=c,t.queryForm.total=d,a.next=22;break;case 17:a.prev=17,a.t0=a["catch"](4),n.close(),dgiotlog.log(a.t0),t.$message.error("".concat(a.t0));case 22:case"end":return a.stop()}}),a,null,[[4,17]])})))()},handleCateSearch:function(e){var t=this;if(this.queryForm.category=e,this.showcateTree=!this.showcateTree,"a60a85475a"==e)this.queryProdut({});else{var a={keys:"objectId",where:{parent:{className:"Category",objectId:e,__type:"Pointer"}}};Object(g["queryCategory"])(a).then((function(a){var r=[];r.push(e),a.results.forEach((function(e){r.push(e.objectId)})),t.queryProdut({categorys:r})}))}},referenceHandle:function(e){dgiotlog.log("prodtemp",e)},chooseTemplate:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.$set(t.ruleForm,"categoryname",e.category.name),t.$set(t.ruleForm,"categoryid",e.category.objectId),t.$set(t.ruleForm,"producttempid",e.objectId),t.cascaderDrawer=!t.cascaderDrawer;case 4:case"end":return a.stop()}}),a)})))()},categorytree:function(){var e=this;return Object(r["a"])(i.a.mark((function t(){var a,r,n,o;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={class:"Category",filter:'{"order": "createdAt","keys":["parent","name","level"],"where":{"parent": "d6ad425529"}}',parent:"parent"},dgiotlog.log(a),t.prev=2,t.next=5,Object(m["post_tree"])(a);case 5:r=t.sent,n=r.results,o=void 0===n?[]:n,e.categoryTreeData=o,t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](2),dgiotlog.log("categorytree error",t.t0);case 14:case"end":return t.stop()}}),t,null,[[2,11]])})))()},onBeforeUploadImage:function(e){var t=["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"];dgiotlog.warn(e,e.size,e.size/1024/1024<30,t.includes(e.type),e.type);var a=t.includes(e.type),r=e.size/1024/1024<30;return a||this.$message.error("上传文件只能是doc/docx格式!"),r||this.$message.error("上传文件大小不能超过 30MB!"),this.momentKey=moment(new Date).valueOf(),a&&r},UploadImage:function(e){dgiotlog.warn(e,"param"),this.ruleForm.file=e.file},fileChange:function(e){this.$refs.upload.clearFiles(),this.logo=e.raw,this.fileList=[{name:e.name,url:e.url}]},submitUpload:function(){this.$refs.upload.submit()},handlePreview:function(e){dgiotlog.log(e)},submitForm:function(e){var t=this;this.$refs[e].validate(function(){var e=Object(r["a"])(i.a.mark((function e(a){var r,n,o,s,l;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!a){e.next=25;break}return r=new FormData,n={identifier:"inspectionReportTemp",client:t.ruleForm.factory,category:t.ruleForm.categoryid,producttemplet:t.ruleForm.producttempid},r.append("devType",t.ruleForm.factory),r.append("name",t.ruleForm.name),r.append("config",JSON.stringify(n)),r.append("file",t.ruleForm.file),o=t.$baseColorfullLoading(1),e.prev=8,e.next=11,Object(c["postReportFile"])(r);case 11:s=e.sent,l=s.result,dgiotlog.log(l),t.$message.success(t.$translateTitle("cloudTest.Template created successfully")),t.activePopShow=!1,t.fetchData(),e.next=22;break;case 19:e.prev=19,e.t0=e["catch"](8),t.$message.error(t.$translateTitle("cloudTest.Template creation failed"));case 22:o.close(),e.next=27;break;case 25:return dgiotlog.log("error submit!!"),e.abrupt("return",!1);case 27:case"end":return e.stop()}}),e,null,[[8,19]])})));return function(t){return e.apply(this,arguments)}}())},resetForm:function(e){this.ruleForm.file=null,this.fileList=[],this.$refs[e].resetFields()},clickFullScreen:function(){this.isFullscreen=!this.isFullscreen,this.handleHeight()},handleHeight:function(){this.isFullscreen?this.height=this.$baseTableHeight(1)+210:this.height=this.$baseTableHeight(1)},handleAdd:function(){this.activePopShow=!0},handlekonva:function(e,t){this.$router.push({path:"/Topo",query:{viewid:e.objectId,guide:!0,page:t,productid:e.key,type:"Evidence",noTools:!0,isDirver:!0,list:JSON.stringify(this.views),length:this.views.length-1}})},handleManagement:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){var r,n,o,s,c;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.temprow=e,r={limit:50,skip:0,keys:"count(*)",where:{type:"topo",class:"Product",key:e.objectId},order:"createdAt,title"},n=t.$baseColorfullLoading(1),a.prev=3,a.next=6,Object(l["queryView"])(r);case 6:o=a.sent,s=o.count,void 0===s?0:s,c=o.results,t.tempList=c,t.views=[],t.tempList.forEach((function(e,a){t.views.push({page:a,viewid:e.objectId})})),a.next=17;break;case 15:a.prev=15,a.t0=a["catch"](3);case 17:t.tempPopShow=!0,n.close();case 19:case"end":return a.stop()}}),a,null,[[3,15]])})))()},handleDelete:function(e,t){var a=this;this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,Object(r["a"])(i.a.mark((function r(){return i.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,Object(s["delProduct"])(e.objectId);case 2:if(r.sent,a.$baseMessage(a.$translateTitle("successfully deleted"),"success","vab-hey-message-success"),0!=t){r.next=9;break}return r.next=7,a.fetchData();case 7:r.next=11;break;case 9:return r.next=11,a.handleManagement(a.temprow);case 11:case"end":return r.stop()}}),r)}))))},fetchData:function(){var e=this;return Object(r["a"])(i.a.mark((function t(){var a,r,n,o,l;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.queryPayload.where={name:e.queryForm.name?{$regex:e.queryForm.name}:{$ne:null},netType:"Evidence",nodeType:1},dgiotlog.log(e.queryPayload),e.listLoading=!0,t.next=5,Object(s["queryProduct"])(e.queryPayload);case 5:a=t.sent,r=a.count,n=void 0===r?0:r,o=a.results,l=void 0===o?[]:o,e.$refs["paginations"].ination.total=n,l.forEach((function(e){e.createdAt=moment(e.createdAt).format("YYYY-MM-DD HH:mm:ss")})),e.list=l,e.listLoading=!1;case 14:case"end":return t.stop()}}),t)})))()}}}},a7cf:function(t,a,r){"use strict";r.r(a);var n,o,i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"things-parse"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("product.newapi"),visible:e.apiDialog,width:"30%"},on:{"update:visible":function(t){e.apiDialog=t}}},[a("el-form",{ref:"formLabelAlign",attrs:{"label-position":"left","label-width":"170px",model:e.formLabelAlign,rules:e.rules,size:"mini"}},[a("el-form-item",{attrs:{label:e.$translateTitle("plugins.modulename"),prop:"name"}},[a("el-input",{model:{value:e.formLabelAlign.name,callback:function(t){e.$set(e.formLabelAlign,"name",t)},expression:"formLabelAlign.name"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("plugins.programinglanguage"),prop:"language"}},[a("el-select",{attrs:{placeholder:e.$translateTitle("resource.zoneofaction")},model:{value:e.formLabelAlign.language,callback:function(t){e.$set(e.formLabelAlign,"language",t)},expression:"formLabelAlign.language"}},e._l(e.formLabelAlign.languageList,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.submitFormApi("formLabelAlign")}}},[e._v(" "+e._s(e.$translateTitle("developer.create"))+" ")]),a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.apiDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)],1),a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:7}},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addApi.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("product.newapi"))+" ")]),a("el-table",{ref:"singleTable",staticStyle:{width:"100%"},attrs:{data:e.AllDict,"highlight-current-row":""},on:{"current-change":e.handleCurrentChange}},[a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("rule.Type"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(r.type))])]}}])}),a("el-table-column",{attrs:{align:"center",label:"mod","show-overflow-tooltip":!0,width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(r.mod))])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("task.Operation")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row,n=t.$index;return[a("el-button",{attrs:{size:"mini",title:e.$translateTitle("rule.testnewequipment")},on:{click:function(t){return e.handleTest(n,r.type,r.mod)}}},[a("dgiot-icon",{attrs:{icon:"bug-line"}})],1),a("el-button",{attrs:{size:"mini",title:e.$translateTitle("product.pub"),type:"primary"},on:{click:function(t){return e.handleRelease(n,r.type,r.mod)}}},[a("dgiot-icon",{attrs:{icon:"run-line"}})],1),a("el-button",{attrs:{size:"mini",title:e.$translateTitle("equipment.Offtheshelf"),type:"danger"},on:{click:function(t){return e.handleDelete(n,r.type,r.mod)}}},[a("dgiot-icon",{attrs:{icon:"delete-bin-2-fill"}})],1)]}}])})],1)],1),a("el-col",{attrs:{span:17}},[a("div",{staticClass:"protolheader"},[a("el-tabs",{attrs:{size:"mini"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("product.Design"),name:"design"}},[a("VabJsonEditor",{ref:"jsonEdit",model:{value:e.itemSwagger,callback:function(t){e.itemSwagger=t},expression:"itemSwagger"}})],1),a("el-tab-pane",{attrs:{label:e.$translateTitle("product.code"),name:"code"}},[a("el-form",{ref:"thingsParseModel",attrs:{inline:!0,model:e.thingsParseModel,rules:e.thingsParseRules}}),a("div",[a("div",{staticStyle:{background:"#ffffff"}},[a("label",{attrs:{id:"plug-name"}})]),a("pre",{staticClass:"ace_editor",staticStyle:{"min-height":"480px","margin-bottom":"0"},attrs:{id:"editor"}},[a("textarea",{staticClass:"ace_text-input"})]),a("div",{staticStyle:{background:"#ffffff"}},[a("label",{attrs:{id:"plug-name"}})]),a("div",{staticStyle:{padding:"5px","margin-right":"80px",color:"#c2be9e",background:"#272822","border-top":"1px solid #dddddd"}},[a("span",[e._v(e._s(e.$translateTitle("product.controloutput")))])]),a("pre",{staticClass:"ace_editor",staticStyle:{"min-height":"200px","margin-top":"0","margin-bottom":"0"},attrs:{id:"editor2"}},[a("textarea",{staticClass:"ace_text-input"})])])],1),a("el-tab-pane",{attrs:{label:e.$translateTitle("rule.Test"),name:"swagger"}},[a("iframe",{attrs:{height:"700vh",src:e.swaggerPath,width:"100%"}})])],1)],1)])],1)],1)},s=[],l=r("fb07"),c=r("d0d7"),u=r.n(c),d=(r("1d17"),r("37c6"),r("e170"),r("16b8"),r("c4bc"),r("a0e0"),r("3dec"),r("f1e1"),r("0c40"),r("79da"),r("98da"),r("c147"),r("7690"),r("e0e9")),p=r("1285"),m=r("89e8"),g=r("4d2d"),f=r("bb22"),h="",b="",v={name:"ThingsParse",components:{},props:{},data:function(){var e=function(e,t,a){var r=/[0-9a-zA-Z]/;r.test(t)?a():a(new Error("协议名称由数字和字母组合"))};return{fullscreenLoading:!1,rules:{name:[{required:!0,validator:e,trigger:"blur"}],language:[{required:!0,message:"请选择编程语言",trigger:"change"}]},labelPosition:"right",formLabelAlign:{languageList:["python","java","ruby"],language:"python",name:"",region:"",type:""},apiDialog:!1,activeName:"design",itemSwagger:{},currentRow:null,AllDict:[],productName:"",form:{Productname:"",ProductKey:"",ProductAll:0},swaggerPath:"https://dev.iotn2n.com/swagger/#/",decoderstart:0,decodertotal:0,decoderlength:10,protolchannel:[],productdetail:{},thingsParseModel:{name:"",version:"",desc:"",resource:!1},thingsParseRules:{name:[{required:!0,message:"请输入协议名称",trigger:"blur"},{validator:e,trigger:"blur"}]},dialogTableVisible:!1,gridData:[],protoldialog:!1}},computed:{tableFilterData:function(){return null}},mounted:function(){o=ace.edit("editor2"),o.session.setMode("ace/mode/python"),o.setTheme("ace/theme/monokai"),o.setReadOnly(!0),o.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.getAllDict(),this.setPath(),this.$route.query.activeName&&(this.activeName=this.$route.query.activeName)},methods:{setPath:function(){dgiotlog.log("production"),this.swaggerPath=location.origin+"/swagger/#/"},handleDelete:function(e,t,a){var r=this;this.$confirm("确认要下架该api吗？").then(function(){var n=Object(l["a"])(u.a.mark((function n(o){var i;return u.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Object(g["delExproto"])({type:t,mod:a,version:"debug"});case 2:i=n.sent,i&&r.AllDict.splice(e,1);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())["catch"]((function(e){}))},handleTest:function(t,a,r){var i=this;return Object(l["a"])(u.a.mark((function t(){var s,l,c;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return s={code:Base64.encode(n.getValue()),mod:r,swagger:JSON.parse(i.itemSwagger),type:a},t.next=3,Object(g["putExproto"])(s);case 3:l=t.sent,c=l.results,c?(o.setValue(Base64.decode(c)),i.$message({showClose:!0,message:"调测api成功",type:"success"})):(dgiotlog.log(e),i.$message.error("api有错误,请检查"));case 6:case"end":return t.stop()}}),t)})))()},handleRelease:function(e,t,a){var r=this;return Object(l["a"])(u.a.mark((function e(){var o,i;return u.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o={code:Base64.encode(n.getValue()),mod:a,swagger:JSON.parse(r.itemSwagger),type:t},e.next=3,Object(g["postExproto"])(o);case 3:i=e.sent,i?r.$message({showClose:!0,message:"发布api成功",type:"success"}):r.$message.error("api有错误,请检查");case 5:case"end":return e.stop()}}),e)})))()},addApi:function(){this.apiDialog=!0},submitFormApi:function(t){var a=this;this.$refs[t].validate(function(){var t=Object(l["a"])(u.a.mark((function t(r){var n,o,i;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n={python:"IyBjb2Rpbmc9dXRmOAppbXBvcnQgb3MKCmRlZiBwb3N0KGFyZ3Msc2Vzc2lvbixlbnYpOgogICAgI2JvZHkgPSBqc29uLmxvYWRzKGJhc2U2NC5iNjRkZWNvZGUoYXJncykuZGVjb2RlKCJ1dGYtOCIpKQogICAgI3ByaW50KGJvZHkpCiAgICAjc3RyYm9keSA9ICd7fScuZm9ybWF0KGJvZHkpCiAgICAjZW5ib2R5ID0gIGJhc2U2NC5iNjRlbmNvZGUoc3RyYm9keS5lbmNvZGUoJ3V0Zi04JykpCiAgICAjcHJpbnQoZW5ib2R5KQogICAgI3N0YXRlID0ganNvbi5sb2FkcyhiYXNlNjQuYjY0ZGVjb2RlKGVudikuZGVjb2RlKCJ1dGYtOCIpKQogICAgI3ByaW50KHN0YXRlKQogICAgIyByZXN0dXJsID0gc3RhdGVbJ3JvbGVzJ11bMF1bJ3RhZyddWydhcHBjb25maWcnXVsncmVzdCddCiAgICAjIHByaW50KHJlc3R1cmwpCiAgICAjIHMuaGVhZGVycy51cGRhdGUoeyJzZXNzaW9uVG9rZW4iOiBzZXNzaW9uLCAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nfSkKICAgICMgcnQgPSBzLmdldCgne30vY2xhc3Nlcy9EZXZpY2U/b3JkZXI9Y3JlYXRlZEF0JmxpbWl0PTEwJnNraXA9MCcuZm9ybWF0KHJlc3R1cmwpLAogICAgIyAgICAgICAgICAgICAgcGFyYW1zPXsnb3JkZXInOiAnY3JlYXRlZEF0JywgfSkKICAgICMgZm9yIHJvdyBpbiAocnQuanNvbigpWydyZXN1bHRzJ10pOgogICAgIyAgICAgcHJpbnQocm93KQogICAgcHJpbnQoYXJncykKICAgIHByaW50KHNlc3Npb24pCiAgICBwcmludChlbnYpCiAgICByZXR1cm4gYXJncwoKZGVmIG1haW4oKToKICAgICN7Im5hbWUiOiJzaHV3YSJ9CiAgICBhcmd2cyA9ICdleUp1WVcxbElqb2ljMmgxZDJFaWZRPT0nCiAgICByZXR1cm4gIHBvc3QoYXJndnMsICdzZXNzaW9uJywnZW52JykKCmRlZiBleGl0KCk6CiAgICBvcy5fZXhpdCgwKQoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIG1haW4oKQ==",java:"",ruby:""},"/python_"+a.formLabelAlign.name,o={code:n[a.formLabelAlign.language],mod:a.formLabelAlign.name,swagger:{definitions:{},paths:{"/python_hello":{post:{description:"Python测试API",parameters:[{description:"生成报告",in:"body",name:"data",required:!0,schema:{properties:{name:{description:"姓名",example:"shuwa",required:!0,type:"string"}},type:"object"}}],responses:{200:{description:"Returns operation status"},400:{description:"Bad Request"},401:{description:"Unauthorized"},403:{description:"Forbidden"},500:{description:"Server Internal error"}},summary:"Python测试API",tags:["EXPROTO"]}}},tags:[{description:"扩展编程",name:"EXPROTO"}]},type:a.formLabelAlign.language},!r){t.next=8;break}return t.next=6,Object(g["getExproto"])(o);case 6:i=t.sent,i?(a.apiDialog=!1,a.$message({type:"success",message:"新增api成功"}),a.getAllDict()):a.$message({type:"error",message:"新增api失败"+e});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},handleCurrentChange:function(e){dgiotlog.log(e,"val");var t=e.swagger,a=void 0===t?{}:t;this.itemSwagger=a,n=ace.edit("editor"),n.session.setMode("ace/mode/python"),n.setTheme("ace/theme/monokai"),n.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),n.setValue(Base64.decode(e.code)),n.gotoLine(n.session.getLength())},toggle:function(e){dgiotlog.log(e)},getAllDict:function(){var e=this;return Object(l["a"])(u.a.mark((function t(){var a,r;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(g["getExproto"])({type:"python",mod:"all",version:"debug"});case 2:a=t.sent,r=a.results,r&&(e.AllDict=r,dgiotlog.log(e.AllDict),e.AllDict.length&&e.handleCurrentChange(r[0]));case 5:case"end":return t.stop()}}),t)})))()},Industry:function(){var e=this;return Object(l["a"])(u.a.mark((function t(){var a,r,n;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.option=[],a={limit:1e3,where:{"data.key":"category"}},t.next=4,Object(d["queryDict"])(a);case 4:r=t.sent,n=r.results,n.map((function(t){var a={};a.value=t.type,a.label=t.data.CategoryName,a.id=t.data.Id,a.parentid=t.data.SuperId,e.option.push(a)}));case 7:case"end":return t.stop()}}),t)})))()},getProDetail:function(e){var t=this;this.productId=e,n=ace.edit("editor"),n.session.setMode("ace/mode/erlang"),n.setTheme("ace/theme/monokai"),n.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.$get_object("Product",e).then((function(e){if(e){for(var a in t.productName=e.name,e)t.productdetail[a]=e[a];t.option.map((function(e){t.productdetail.category==e.value&&(t.productdetail.category=e.label)})),t.productdetail.createdAt=t.utc2beijing(e.createdAt),t.productdetail.id=e.id,t.dynamicReg=e.dynamicReg,t.productdetail.isshow=0,t.form.Productname=e.name,t.ProductSecret=e.productSecret,t.form.Productkey=t.productId,t.productimg=e.icon,e.decoder?(b=e.decoder.code,t.thingsParseModel.name=e.decoder.name,t.thingsParseModel.version=e.decoder.version,t.thingsParseModel.desc=e.decoder.desc):b="JSUlLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQolJSUgQGNvcHlyaWdodCAoQykgMjAxOCwgPHNodXdhPgolJSUgQGRvYwolJSUg5Y2P6K6u6Kej5p6QRGVtbwolJSUgQGVuZAolJSUgQ3JlYXRlZCA6IDA4LiDljYHkuIDmnIggMjAxOCAxNDo0OQolJSUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi1tb2R1bGUoc2h1d2FfZGVtb19kZWNvZGVyKS4KLWF1dGhvcigic2h1d2EiKS4KLWRlZmluZShNU0dfVFlQRSwgPDwiREVNTyI+PikuCi1wcm90b2NvbChbPDwiREVNTyI+Pl0pLgoKLWV4cG9ydChbcGFyc2VfZnJhbWUvMiwgdG9fZnJhbWUvMV0pLgoKCnBhcnNlX2ZyYW1lKEJ1ZmYsIE9wdHMpIC0+CiAgICBwYXJzZV9mcmFtZShCdWZmLCBbXSwgT3B0cykuCgoKcGFyc2VfZnJhbWUoPDw+PiwgQWNjLCBfT3B0cykgLT4KICAgIHs8PD4+LCBBY2N9OwpwYXJzZV9mcmFtZSg8PDE2IzY4LCBSZXN0L2JpbmFyeT4+ID0gQmluLCBBY2MsIF9PcHRzKSB3aGVuIGJ5dGVfc2l6ZShSZXN0KSA9PCA2IC0+CiAgICB7QmluLCBBY2N9OwpwYXJzZV9mcmFtZSg8PDE2IzY4LCBMZW46MTYvbGl0dGxlLWludGVnZXIsIExlbjoxNi9saXR0bGUtaW50ZWdlciwgMTYjNjgsIFJlc3QvYmluYXJ5Pj4gPSBCaW4sIEFjYywgT3B0cykgLT4KICAgIGNhc2UgYnl0ZV9zaXplKFJlc3QpIC0gMiA+PSBMZW4gb2YKICAgICAgICB0cnVlIC0+CiAgICAgICAgICAgIGNhc2UgUmVzdCBvZgogICAgICAgICAgICAgICAgPDxVc2VyWm9uZTpMZW4vYnl0ZXMsIENyYzo4LCAxNiMxNiwgUmVzdDEvYmluYXJ5Pj4gLT4KICAgICAgICAgICAgICAgICAgICBBY2MxID0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBzaHV3YV91dGlsczpnZXRfcGFyaXR5KFVzZXJab25lKSA9Oj0gQ3JjIG9mCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlIC0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRnJhbWUgPSAjewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8PCJtc2d0eXBlIj4+ID0+ID9NU0dfVFlQRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPDwiZGF0YSI+PiA9PiBVc2VyWm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWNjICsrIFtGcmFtZV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSAtPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFjYwogICAgICAgICAgICAgICAgICAgICAgICBlbmQsCiAgICAgICAgICAgICAgICAgICAgcGFyc2VfZnJhbWUoUmVzdDEsIEFjYzEsIE9wdHMpOwogICAgICAgICAgICAgICAgXyAtPgogICAgICAgICAgICAgICAgICAgIHBhcnNlX2ZyYW1lKFJlc3QsIEFjYywgT3B0cykKICAgICAgICAgICAgZW5kOwogICAgICAgIGZhbHNlIC0+CiAgICAgICAgICAgIHtCaW4sIEFjY30KICAgIGVuZDsKcGFyc2VfZnJhbWUoPDxfOjgsIFJlc3QvYmluYXJ5Pj4sIEFjYywgT3B0cykgLT4KICAgIHBhcnNlX2ZyYW1lKFJlc3QsIEFjYywgT3B0cykuCgoKJSUg57uE6KOF5oiQ5bCB5YyFLCDlj4LmlbDkuLpNYXDlvaLlvI8KdG9fZnJhbWUoI3s8PCJtc2d0eXBlIj4+IDo9ID9NU0dfVFlQRX0gPSBGcmFtZSkgLT4KICAgIFBheWxvYWQgPSB0ZXJtX3RvX2JpbmFyeShGcmFtZSksCiAgICA8PDE2IzAzLCBQYXlsb2FkL2JpbmFyeSwgMTYjMjM+Pi4=",t.productdetail.thing||(t.productdetail.thing={properties:[]}),t.wmxData=t.productdetail.thing.properties.filter((function(e){return e.name&&e.dataType})),n.setValue(Base64.decode(b)),n.gotoLine(n.session.getLength()),t.queryDeviceCount(t.productId)}}))},queryDeviceCount:function(e){var t=this;return Object(l["a"])(u.a.mark((function a(){return u.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(p["getDeviceCountByProduct"])(e);case 2:t.form.ProductAll=a.sent;case 3:case"end":return a.stop()}}),a)})))()},editordata:function(e){this.thingsParseModel.name=e.attributes.data.name,this.thingsParseModel.version=e.attributes.data.version,this.thingsParseModel.desc=e.attributes.data.desc,this.thingsParseModel.resource=e.attributes.data.enable,n.setValue(Base64.decode(e.attributes.data.code)),this.dialogTableVisible=!1},getAllunit:function(){var e=this;return Object(l["a"])(u.a.mark((function t(){var a,r;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.allunit=[],t.next=3,Object(d["getAllunit"])("unit",100);case 3:a=t.sent,r=a.results,e.allunit=r.concat([]),e.allunit.unshift({data:{Name:"无",Symbol:""}});case 7:case"end":return t.stop()}}),t)})))()},subAce:function(e,t){var a=this;this.$refs[e].validate((function(r){if(r){var i={name:e.name,version:e.version,code:Base64.encode(n.getValue()),desc:e.desc},s={decoder:i};a.$update_object("Product",a.productId,s).then((function(e){0==a.issub&&(a.$message({type:"success",message:"保存成功"}),1==t&&(h+="保存成功",o.setValue(h))),a.issub=!0}))["catch"]((function(e){dgiotlog.log(e)}))}else a.$message({type:"warning",message:"输入格式有误"})}))},subAce1:function(e){var t=this;this.$refs[e].validate((function(e){if(e){var a={where:{"data.name":t.formInline.name,"data.version":t.formInline.version}};t.$query_object("Dict",a).then((function(e){e.results&&e.results.length>=1?t.$message("此协议版本已存在"):t.$get_object("Product",t.productId).then((function(e){if(e){var a={name:t.formInline.name,version:t.formInline.version,code:Base64.encode(n.getValue()),desc:t.formInline.desc},r={key:t.formInline.name+":"+t.formInline.version,type:"decoder",data:a,ACL:e.ACL};t.$create_object("Dict",r).then((function(e){e.error?t.$message({type:"error",message:e.error}):t.$message({type:"success",message:"保存到公共协议库成功"})}))["catch"]((function(e){dgiotlog.log(e)}))}}))}))["catch"]((function(e){dgiotlog.log(e)}))}else t.$message({type:"warning",message:"输入格式有误"})}))},decoderSizeChange:function(e){this.decoder.length=e,this.chaxun()},devicerCurrentChange:function(e){this.decoderstart=(e-1)*this.decoderlength,this.chaxun()},updateAllChannel:function(){var e=this;if(0==this.multipleSelection.length)this.protoldialog=!1;else{var t=[];this.multipleSelection.map((function(e){t.push(new Promise((function(t,a){return Object(f["subupadte"])(e.id,"update").then((function(e){e&&t(e)}))["catch"]((function(e){a(e)}))})))})),Promise.all(t).then((function(t){e.$message({message:"热加载成功",type:"success"}),t.length==e.multipleSelection.length&&(e.protoldialog=!1)}))["catch"]((function(t){e.$message({message:t,type:"error"})}))}},handleSelectionChange:function(e){this.multipleSelection=e},utc2beijing:function(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},getChannelEnable:function(e,t){return 1==e.row.attributes.isEnable?"green_active":"red_active"},deletedata:function(e){var t=this;this.$del_object("Dict",e).then((function(e){e&&(t.$message("成功删除"),t.chaxun())}))["catch"]((function(e){dgiotlog.log(e)}))},updatesubdialog:function(){var e=this;return Object(l["a"])(u.a.mark((function t(){var a,r;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.protoldialog=!0,a="1",r={__type:"Pointer",className:"Product",objectId:e.productId},Object(m["getChannelCountByProduct"])(e.channellength,e.channelstart,r,a).then((function(t){e.protolchannel=t.results,e.$refs.multipleTable.toggleAllSelection()}))["catch"]((function(t){dgiotlog.log(t),e.$baseMessage("请求出错",t.error,3e3)}));case 4:case"end":return t.stop()}}),t)})))()},chaxun:function(){var e=this,t={count:"objectId",skip:this.decoderstart,limit:this.decoderlength,where:{type:"decoder"}};this.dialogTableVisible=!0,this.$query_object("Dict",t).then((function(t){t&&(e.decodertotal=t.count,e.gridData=t.results)}))["catch"]((function(e){dgiotlog.log(e)}))},protol:function(){var e=this,t="";Object(f["Compile"])(Base64.encode(n.getValue())).then((function(a){a&&(e.$message({type:"success",message:"编译成功"}),t="编译成功"+a.mod+"\r\n",e.warningeditror=a.warnings,e.warningeditror.map((function(e){t+=e+"\r\n"})),h+=t,o.setValue(h))}))["catch"]((function(a){e.warningeditror=a.error,e.warningeditror.map((function(e){t+=e+"\r\n"})),h+=t,o.setValue(h)}))}}},y=v,w=(r("7c56"),r("bdd7")),x=Object(w["a"])(y,i,s,!1,null,null,null);a["default"]=x.exports},b89a:function(e,t,a){},c09b:function(e,t,a){},c26ac:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"logs logs-container",class:{"vab-fullscreen":e.isFullscreen}},[a("vab-query-form",[a("vab-query-form-top-panel",[a("el-form",{ref:"form",attrs:{inline:!0,"label-width":"100px",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{staticClass:"item-time",attrs:{label:e.$translateTitle("device.Log type")}},[a("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:e.queryForm.domain,callback:function(t){e.$set(e.queryForm,"domain",t)},expression:"queryForm.domain"}},e._l(e.domainOptions,(function(t){return a("el-option",{key:t,attrs:{label:e.$translateTitle("deviceLog."+t),value:t}})})),1)],1),a("el-form-item",{staticClass:"item-time",attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{staticClass:"item-time-picker",attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.isDeviceInfo,expression:"!isDeviceInfo"}],attrs:{label:e.$translateTitle("equipment.Products")}},[a("el-select",{attrs:{clearable:""},model:{value:e.queryForm.productid,callback:function(t){e.$set(e.queryForm,"productid",t)},expression:"queryForm.productid"}},e._l(e.proTableData,(function(t,r){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=t.objectId,expression:"item.objectId != 0"}],key:r,attrs:{label:e.$translateTitle("deviceLog."+t.name),value:t.objectId}})})),1)],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.isDeviceInfo,expression:"!isDeviceInfo"}],attrs:{label:e.$translateTitle("equipment.devicenumber")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("equipment.enterdevicenumber")},model:{value:e.queryForm.devaddr,callback:function(t){e.$set(e.queryForm,"devaddr",t)},expression:"queryForm.devaddr"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:function(t){return e.queryTable({})}}}),a("el-button",{staticStyle:{margin:"0 10px 10px 10px !important"},attrs:{type:"success"},on:{click:e.handleHeight}},[a("dgiot-icon",{attrs:{icon:e.isFullscreen?"fullscreen-exit-fill":"fullscreen-fill"}})],1),a("el-popover",{attrs:{trigger:"hover"},scopedSlots:e._u([{key:"reference",fn:function(){return[a("el-button",{staticStyle:{margin:"0 0 10px 0 !important"},attrs:{icon:"el-icon-setting",type:"primary"}},[e._v(" "+e._s(e.$translateTitle("Logs.Draggable column settings"))+" ")])]},proxy:!0}])},[a("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},[a("vue-draggable",e._b({attrs:{list:e.logcolumns}},"vue-draggable",e.dragOptions,!1),e._l(e.logcolumns,(function(t,r){return a("div",{key:t+r},[a("dgiot-icon",{attrs:{icon:"drag-drop-line"}}),a("el-checkbox",{attrs:{disabled:!0===t.disableCheck,label:t}},[e._v(" "+e._s(e.$translateTitle("deviceLog."+t))+" ")])],1)})),0)],1)],1)],1)],1)],1)],1),a("el-dialog",{attrs:{"append-to-body":"",visible:e.preDialog},on:{"update:visible":function(t){e.preDialog=t}}},[a("vab-editor",{key:e.refreshFlag,attrs:{height:e.isFullscreen?380:340,lang:"json","max-lines":e.isFullscreen?50:1e3/12,"min-lines":e.isFullscreen?50:1e3/12,theme:"gob"},model:{value:e.msg,callback:function(t){e.msg=t},expression:"msg"}})],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],key:e.finallyColumns.length+e.momentKey,ref:"dragTable",staticClass:"block",attrs:{border:"",data:e.logdata,"element-loading-background":"rgba(0, 0, 0, 0.8)","element-loading-spinner":"el-icon-loading","element-loading-text":e.$translateTitle("developer.Waitingtoreturn"),height:e.height,"highlight-current-row":"",resizable:"","row-class-name":e.tableRowClassName,size:"mini",stripe:""},scopedSlots:e._u([{key:"empty",fn:function(){return[a("vab-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-descriptions",{staticClass:"margin-top",attrs:{border:"",column:2,size:e.size}},e._l(t.row,(function(t,r,n){return a("el-descriptions-item",{key:n,attrs:{label:e.$translateTitle("deviceLog."+r),"label-class-name":"my-label"}},[e._v(" "+e._s(t)+" ")])})),1)]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("device.Log type")},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$translateTitle("deviceLog."+a.domain))+" ")]}}])}),e._l(e.finallyColumns,(function(t,r){return a("el-table-column",{key:r,attrs:{align:"center",label:e.$translateTitle("deviceLog."+t),prop:t,"show-overflow-tooltip":"",sortable:""}})})),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("concentrator.operation")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.showDetail(r)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.detail"))+" ")])]}}])})],2),a("vab-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.queryForm.total>0,expression:"queryForm.total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.queryForm.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.queryTable}})],1)},n=[],o=a("fb07"),i=a("d0d7"),s=a.n(i),l=(a("7690"),a("a0e0"),a("3dec"),a("f764"),a("5662"),a("e170"),a("b8f1"),a("04d6"),a("3eb0"),a("9c6a"),a("d6a4"),a("4656"),a("d292")),c=a("7212"),u={name:"AccessLog",props:{productid:{type:String,default:""},devaddr:{type:String,default:""},deviceid:{type:String,default:""},isDeviceInfo:{type:Boolean,default:!0}},data:function(){return{preDialog:!1,msg:"",loading:!1,size:"",domainOptions:["device_statuslog","device_operationlog","transparent","event","tcp_send","tcp_receive","readProperty","writeProperty","reportProperty","child","childReply","functionInvoke","readPropertyReply","writePropertyReply","functionReply","register","unregister","offline","online","other","parse_api"],isFullscreen:!1,height:this.$baseTableHeight(0),logdata:[],refreshFlag:moment(new Date).valueOf(),momentKey:moment(new Date).valueOf(),checkList:["time","msg"],logcolumns:["devaddr","time","msg","username","productname","devicename","status","protocol","thingname","identifier","value"],proTableData:[],activeName:"second",queryForm:{total:0,count:"objectId",limit:20,pageNo:1,pageSize:20,skip:0,level:"",peername:"",pid:"",mfa:"",topic:"",domain:[],searchDate:[moment().subtract("days",7).format("YYYY-MM-DD"),moment(new Date).format("YYYY-MM-DD")],order:"-createdAt",keys:"count(*)",productid:"",devaddr:""}}},computed:{dragOptions:function(){return{animation:600,group:"description"}},finallyColumns:function(){var e=this;return this.logcolumns.filter((function(t){return e.checkList.includes(t)}))}},created:function(){},mounted:function(){this.productid&&(this.queryForm.productid=this.productid),this.deviceid&&(this.queryForm.deviceid=this.deviceid),this.$route.query.deviceid&&(this.queryForm.deviceid=this.$route.query.deviceid),this.queryTable({}),this.rowDrop(),this.queryProduct(),this.columnDrop()},methods:{queryProduct:function(){var e=this;return Object(o["a"])(s.a.mark((function t(){var a,r,n;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.proTableData=[],t.next=3,Object(c["queryProduct"])({count:"objectId",order:"-updatedAt",where:{category:"IotHub"}});case 3:a=t.sent,r=a.results,n=void 0===r?[]:r,e.proTableData=n;case 7:case"end":return t.stop()}}),t)})))()},handleHeight:function(){this.isFullscreen=!this.isFullscreen,this.isFullscreen?this.height=this.$baseTableHeight(0)+120:this.height=this.$baseTableHeight(0),this.momentKey=moment(new Date).valueOf()},tableRowClassName:function(e){var t=e.row;return t.disabled?"disabled":""},rowDrop:function(){var e=this.$refs.dragTable.$el.querySelector(".el-table__body-wrapper tbody"),t=this;Sortable.create(e,{draggable:".el-table__row",onEnd:function(e){var a=e.newIndex,r=e.oldIndex,n=t.logdata.splice(r,1)[0];t.logdata.splice(a,0,n)}})},columnDrop:function(){var e=this,t=this.$refs.dragTable.$el.querySelector(".el-table__header-wrapper tr");e.sortable=Sortable.create(t,{animation:180,delay:0,onEnd:function(t){var a=e.finallyColumns[t.oldIndex];e.finallyColumns.splice(t.oldIndex,1),e.finallyColumns.splice(t.newIndex,0,a),e.momentKey=moment(new Date).valueOf(),setTimeout((function(){e.rowDrop(),e.columnDrop()}),1500)}})},showDetail:function(e){this.preDialog=!0,console.log(e),this.msg=JSON.stringify(e,null,2),this.refreshFlag=moment(new Date).valueOf()},queryTable:function(){var e=arguments,t=this;return Object(o["a"])(s.a.mark((function a(){var r,n,o,i,c,u,d,p;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:{},t.loading=!0,dgiotlog.log(t.queryForm.domain),r.limit||(r=t.queryForm),n=t.$baseColorfullLoading(),a.prev=5,n.close(),o={limit:r.limit,skip:r.skip,order:r.order,count:t.queryForm.count,include:"",where:{deviceid:t.deviceid?t.deviceid:"",domain:t.queryForm.domain.length?{$in:t.queryForm.domain}:{$ne:""},createdAt:{$gte:{__type:"Date",iso:"".concat(t.queryForm.searchDate[0],"T00:00:00.000Z")},$lte:{__type:"Date",iso:"".concat(t.queryForm.searchDate[1],"T23:59:59.000Z")}}}},a.next=10,Object(l["queryLog"])(o);case 10:i=a.sent,c=i.results,u=void 0===c?[]:c,d=i.count,p=void 0===d?0:d,u.forEach((function(e){if(e.time=t.$moment(Number(e.time.toString().substring(0,13))).format("YYYY-MM-DD HH:mm:ss"),"text"!=e.type){var a=JSON.parse(e.msg);for(var r in a)e[r]=a[r]}})),t.logdata=u,t.queryForm.total=p,t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),n.close(),a.next=26;break;case 22:a.prev=22,a.t0=a["catch"](5),n.close(),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 26:t.loading=!1;case 27:case"end":return a.stop()}}),a,null,[[5,22]])})))()}}},d=u,p=(a("5b8e"),a("bdd7")),m=Object(p["a"])(d,r,n,!1,null,"05eacc3c",null);t["default"]=m.exports},c8a8:function(e,t,a){"use strict";a("38bb")},cb5a:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"custom-table",staticClass:"custom-table-container",class:{"vab-fullscreen":e.isFullscreen}},[r("div",[r("el-dialog",{attrs:{"append-to-body":"",visible:e.activePopShow},on:{"update:visible":function(t){e.activePopShow=t}}},[r("h3",{attrs:{slot:"title"},slot:"title"},[e._v(" "+e._s(e.$translateTitle("cloudTest.add"))+e._s(e.$translateTitle("cloudTest.report template"))+" ")]),r("div",{staticClass:"content"},[r("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{"label-width":"100px",model:e.ruleForm,rules:e.rules}},[r("el-form-item",{attrs:{label:e.$translateTitle("cloudTest.Template name"),prop:"name"}},[r("el-input",{model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),r("el-form-item",{attrs:{label:e.$translateTitle("cloudTest.category"),prop:"categoryname"}},[r("el-input",{attrs:{readonly:""},model:{value:e.ruleForm.categoryname,callback:function(t){e.$set(e.ruleForm,"categoryname",t)},expression:"ruleForm.categoryname"}},[r("el-icon",{staticClass:"el-icon-edit el-input__icon",attrs:{slot:"append",size:"mini"},nativeOn:{click:function(t){return e.handlecateClick.apply(null,arguments)}},slot:"append"})],1)],1),r("el-form-item",{attrs:{label:e.$translateTitle("cloudTest.Trade Names"),prop:"factory",required:""}},[r("el-input",{model:{value:e.ruleForm.factory,callback:function(t){e.$set(e.ruleForm,"factory",t)},expression:"ruleForm.factory"}})],1),r("el-form-item",{attrs:{label:e.$translateTitle("cloudTest.Template file"),prop:"file",required:""}},[r("el-upload",{key:e.momentKey,ref:"upload",staticClass:"upload-demo",attrs:{accept:".doc,.docx",action:"string","before-upload":e.onBeforeUploadImage,"file-list":e.fileList,"http-request":e.UploadImage,limit:1,"list-type":"text","on-change":e.fileChange},model:{value:e.ruleForm.file,callback:function(t){e.$set(e.ruleForm,"file",t)},expression:"ruleForm.file"}},[r("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v(" "+e._s(e.$translateTitle("application.selectfile"))+" ")])],1)],1)],1)],1),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(" "+e._s(e.$translateTitle("product.createnow"))+" ")]),r("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v(" "+e._s(e.$translateTitle("zetadevices.reset"))+" ")])],1),r("el-drawer",{attrs:{"append-to-body":"",size:"40%",visible:e.cascaderDrawer},on:{"update:visible":function(t){e.cascaderDrawer=t}}},[r("div",[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:24}},[r("vab-query-form",[r("vab-query-form-top-panel",[r("el-form",{attrs:{inline:!0,"label-width":"100px"},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",{attrs:{label:e.$translateTitle("product.classification")}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("task.Select")},on:{change:e.handleCateSearch},model:{value:e.queryForm.category,callback:function(t){e.$set(e.queryForm,"category",t)},expression:"queryForm.category"}},e._l(e.categoryTreeData,(function(e,t){return r("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),r("el-form-item",{attrs:{label:e.$translateTitle("developer.Templatename")}},[r("el-input",{attrs:{clearable:"",placeholder:"请输入模板名称"},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),r("el-form-item",{attrs:{"label-width":"0"}},[r("el-button",{staticClass:"el-icon-search",attrs:{"native-type":"submit",type:"primary"},on:{click:function(t){return e.queryProdut({})}}})],1)],1)],1)],1)],1)],1),r("el-table",{staticStyle:{width:"100%"},attrs:{border:"","cell-style":{"text-align":"center"},data:e.tableData,"header-cell-style":{"text-align":"center"},size:"mini"}},[r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.Templatename")},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.name)+" "),r("el-popover",{attrs:{placement:"left",trigger:"click",width:"800"}},[r("i",{staticClass:"el-icon-info",attrs:{slot:"reference"},on:{click:function(t){return e.referenceHandle(a)}},slot:"reference"})])]}}])}),r("el-table-column",{attrs:{label:e.$translateTitle("department.category"),prop:"categoryname"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.category.name)+" ")]}}])}),r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.operation")},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.chooseTemplate(a)}}},[e._v(" "+e._s(e.$translateTitle("product.choose"))+" ")])]}}])})],1)],1)])],1),r("vab-dialog",{attrs:{show:e.tempPopShow},on:{"update:show":function(t){e.tempPopShow=t}}},[r("h3",{attrs:{slot:"title"},slot:"title"},[e._v(" "+e._s(e.$translateTitle("cloudTest.report template"))+" ")]),r("div",{staticClass:"content"},[r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:e.border,data:e.tempList,size:e.lineHeight,stripe:e.stripe},scopedSlots:e._u([{key:"empty",fn:function(){return[r("el-image",{staticClass:"vab-data-empty",attrs:{src:a("c2ad")}})]},proxy:!0}])},[r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("cloudTest.number"),prop:"title","show-overflow-tooltip":"",width:"80"}}),r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("cloudTest.Template content"),width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-image",{staticStyle:{width:"40px",height:"40px"},attrs:{"preview-src-list":[e.$FileServe+a.data.icon],src:e.$FileServe+a.data.icon}})]}}])}),r("el-table-column",{attrs:{align:"center",flex:"right",label:e.$translateTitle("product.Template management"),"show-overflow-tooltip":"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row,n=t.$index;return[r("el-button",{attrs:{type:"success"},on:{click:function(t){return e.handlekonva(a,n)}}},[e._v(" "+e._s(e.$translateTitle("developer.task mapping"))+" ")]),r("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.handleDelete(a,1)}}},[e._v(" "+e._s(e.$translateTitle("cloudTest.delete"))+" ")])]}}])})],1)],1)])],1),r("vab-query-form",[r("vab-query-form-left-panel",[r("el-form",{ref:"form",attrs:{inline:!0,"label-width":"0",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",[r("el-input",{attrs:{placeholder:e.$translateTitle("cloudTest.Please enter the query content")},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),r("el-form-item",[r("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("cloudTest.search"))+" ")]),r("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},on:{click:e.handleAdd}},[e._v(" "+e._s(e.$translateTitle("cloudTest.template"))+" ")])],1)],1)],1)],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:e.border,data:e.list,size:e.lineHeight,stripe:e.stripe},scopedSlots:e._u([{key:"empty",fn:function(){return[r("el-image",{staticClass:"vab-data-empty",attrs:{src:a("c2ad")}})]},proxy:!0}])},[r("el-table-column",{attrs:{align:"center",label:e.$translateTitle("cloudTest.number"),"show-overflow-tooltip":"",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.$index;return[e._v(" "+e._s(a+1)+" ")]}}])}),e._l(e.finallyColumns,(function(t,a){return r("el-table-column",{key:a,attrs:{align:"center",label:e.$translateTitle("cloudTest."+t.label),prop:t.prop,"show-overflow-tooltip":"",sortable:t.sortable,width:t.width}})})),r("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("cloudTest.operate"),"show-overflow-tooltip":"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.handleManagement(a)}}},[e._v(" "+e._s(e.$translateTitle("product.task management"))+" ")]),r("el-button",{staticStyle:{color:"red"},attrs:{size:"mini",type:"text"},on:{click:function(t){return e.handleDelete(a,0)}}},[e._v(" "+e._s(e.$translateTitle("cloudTest.delete"))+" ")])]}}])})],2),r("vab-parser-pagination",{ref:"paginations",attrs:{pagination:e.paginations,"query-payload":e.queryPayload},on:{pagination:e.fetchData,paginationQuery:e.paginationQuery}})],1)},n=[],o=a("fb07"),i=a("e97b"),s=a("d0d7"),l=a.n(s),c=(a("7690"),a("a0e0"),a("3dec"),a("f764"),a("5662"),a("79da"),a("16b8"),a("3eb0"),a("9c6a"),a("04d6"),a("7212")),u=a("8ba7"),d=a("58dd"),p=a("289a"),m=a.n(p),g=a("5880"),f=a("bb22"),h=a("03b1"),b=a("ef68"),v=(a("c008"),{name:"ReportIndex",components:{VabDraggable:m.a},data:function(){var e=function(e,t,a){""===t?a(new Error("请上传文件")):a()};return{queryForm:{name:"",category:""},paginations:{},queryPayload:{include:"category",order:"-updatedAt",limit:10,skip:0,keys:"count(*)"},tableData:[],categoryTreeData:[],fileList:[],momentKey:moment(new Date).valueOf(),ruleForm:{file:null,name:"",category:"",factory:"",date2:""},rules:{name:[{required:!0,message:"请输入模板名称",trigger:"blur"}],categoryname:[{required:!0,message:"请选择所属品类",trigger:"blur"}],factory:[{required:!0,message:"请输入厂商名称",trigger:"blur"}],file:[{validator:e,trigger:"blur"}]},activePopShow:!1,tempPopShow:!1,isFullscreen:!1,border:!0,height:this.$baseTableHeight(0)-20,stripe:!0,lineHeight:"medium",checkList:["objectId","Template name","category","Trade Names","Creation time"],columns:[{label:"objectId",width:120,prop:"objectId",sortable:!0,disableCheck:!0},{label:"Template name",width:"auto",prop:"name",sortable:!0},{label:"category",width:"auto",prop:"category.name",sortable:!0},{label:"Trade Names",width:"auto",prop:"devType",sortable:!0},{label:"Creation time",width:"auto",prop:"createdAt",sortable:!0}],list:[],tempList:[],views:[],listLoading:!0,layout:"total, sizes, prev, pager, next, jumper",temprow:{},cascaderDrawer:!1}},computed:Object(i["a"])(Object(i["a"])({},Object(g["mapGetters"])({language:"settings/language",collapse:"settings/collapse"})),{},{dragOptions:function(){return{animation:600,group:"description"}},finallyColumns:function(){var e=this;return this.columns.filter((function(t){return e.checkList.includes(t.label)}))}}),watch:{language:{deep:!0,limit:!0,handler:function(e){dgiotlog.warn(e)}}},created:function(){},mounted:function(){this.categorytree(),this.fetchData()},methods:{paginationQuery:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.queryPayload=e;case 1:case"end":return a.stop()}}),a)})))()},handlecateClick:function(){this.categorytree(),this.cascaderDrawer=!0},queryProdut:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){var r,n,o,i,s,c,u,d;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.categorys,n=t.$baseColorfullLoading(),e.limit||(e=t.queryForm),o={limit:e.limit,order:e.order,skip:e.skip,keys:e.keys,include:"category",where:{category:r?{$in:r}:{$ne:null},name:e.name?{$regex:e.name,$options:"i"}:{$ne:null}}},a.prev=4,a.next=7,Object(b["queryProductTemplet"])(o);case 7:i=a.sent,s=i.results,c=void 0===s?[]:s,u=i.count,d=void 0===u?0:u,n.close(),t.tableData=c,t.queryForm.total=d,a.next=22;break;case 17:a.prev=17,a.t0=a["catch"](4),n.close(),dgiotlog.log(a.t0),t.$message.error("".concat(a.t0));case 22:case"end":return a.stop()}}),a,null,[[4,17]])})))()},handleCateSearch:function(e){var t=this;if(this.queryForm.category=e,this.showcateTree=!this.showcateTree,"a60a85475a"==e)this.queryProdut({});else{var a={keys:"objectId",where:{parent:{className:"Category",objectId:e,__type:"Pointer"}}};Object(h["queryCategory"])(a).then((function(a){var r=[];r.push(e),a.results.forEach((function(e){r.push(e.objectId)})),t.queryProdut({categorys:r})}))}},referenceHandle:function(e){dgiotlog.log("prodtemp",e)},chooseTemplate:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.$set(t.ruleForm,"categoryname",e.category.name),t.$set(t.ruleForm,"categoryid",e.category.objectId),t.$set(t.ruleForm,"producttempid",e.objectId),t.cascaderDrawer=!t.cascaderDrawer;case 4:case"end":return a.stop()}}),a)})))()},categorytree:function(){var e=this;return Object(o["a"])(l.a.mark((function t(){var a,r,n,o;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={class:"Category",filter:'{"order": "createdAt","keys":["parent","name","level"],"where":{"parent": "d6ad425529"}}',parent:"parent"},dgiotlog.log(a),t.prev=2,t.next=5,Object(f["post_tree"])(a);case 5:r=t.sent,n=r.results,o=void 0===n?[]:n,e.categoryTreeData=o,t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](2),dgiotlog.log("categorytree error",t.t0);case 14:case"end":return t.stop()}}),t,null,[[2,11]])})))()},onBeforeUploadImage:function(e){var t=["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"];dgiotlog.warn(e,e.size,e.size/1024/1024<30,t.includes(e.type),e.type);var a=t.includes(e.type),r=e.size/1024/1024<30;return a||this.$message.error("上传文件只能是doc/docx格式!"),r||this.$message.error("上传文件大小不能超过 30MB!"),this.momentKey=moment(new Date).valueOf(),a&&r},UploadImage:function(e){dgiotlog.warn(e,"param"),this.ruleForm.file=e.file},fileChange:function(e){this.$refs.upload.clearFiles(),this.logo=e.raw,this.fileList=[{name:e.name,url:e.url}]},submitUpload:function(){this.$refs.upload.submit()},handlePreview:function(e){dgiotlog.log(e)},submitForm:function(e){var t=this;this.$refs[e].validate(function(){var e=Object(o["a"])(l.a.mark((function e(a){var r,n,o,i,s;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!a){e.next=25;break}return r=new FormData,n={identifier:"inspectionReportTemp",client:t.ruleForm.factory,category:t.ruleForm.categoryid,producttemplet:t.ruleForm.producttempid},r.append("devType",t.ruleForm.factory),r.append("name",t.ruleForm.name),r.append("config",JSON.stringify(n)),r.append("file",t.ruleForm.file),o=t.$baseColorfullLoading(1),e.prev=8,e.next=11,Object(d["postReportFile"])(r);case 11:i=e.sent,s=i.result,dgiotlog.log(s),t.$message.success(t.$translateTitle("cloudTest.Template created successfully")),t.activePopShow=!1,t.fetchData(),e.next=22;break;case 19:e.prev=19,e.t0=e["catch"](8),t.$message.error(t.$translateTitle("cloudTest.Template creation failed"));case 22:o.close(),e.next=27;break;case 25:return dgiotlog.log("error submit!!"),e.abrupt("return",!1);case 27:case"end":return e.stop()}}),e,null,[[8,19]])})));return function(t){return e.apply(this,arguments)}}())},resetForm:function(e){this.ruleForm.file=null,this.fileList=[],this.$refs[e].resetFields()},clickFullScreen:function(){this.isFullscreen=!this.isFullscreen,this.handleHeight()},handleHeight:function(){this.isFullscreen?this.height=this.$baseTableHeight(1)+210:this.height=this.$baseTableHeight(1)},handleAdd:function(){this.activePopShow=!0},handlekonva:function(e,t){this.$router.push({path:"/Topo",query:{viewid:e.objectId,guide:!0,page:t,productid:e.key,type:"Evidence",noTools:!0,isDirver:!0,list:JSON.stringify(this.views),length:this.views.length-1}})},handleManagement:function(e){var t=this;return Object(o["a"])(l.a.mark((function a(){var r,n,o,i,s;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.temprow=e,r={limit:50,skip:0,keys:"count(*)",where:{type:"topo",class:"Product",key:e.objectId},order:"createdAt,title"},n=t.$baseColorfullLoading(1),a.prev=3,a.next=6,Object(u["queryView"])(r);case 6:o=a.sent,i=o.count,void 0===i?0:i,s=o.results,t.tempList=s,t.views=[],t.tempList.forEach((function(e,a){t.views.push({page:a,viewid:e.objectId})})),a.next=17;break;case 15:a.prev=15,a.t0=a["catch"](3);case 17:t.tempPopShow=!0,n.close();case 19:case"end":return a.stop()}}),a,null,[[3,15]])})))()},handleDelete:function(e,t){var a=this;this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,Object(o["a"])(l.a.mark((function r(){return l.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,Object(c["delProduct"])(e.objectId);case 2:if(r.sent,a.$baseMessage(a.$translateTitle("successfully deleted"),"success","vab-hey-message-success"),0!=t){r.next=9;break}return r.next=7,a.fetchData();case 7:r.next=11;break;case 9:return r.next=11,a.handleManagement(a.temprow);case 11:case"end":return r.stop()}}),r)}))))},fetchData:function(){var e=this;return Object(o["a"])(l.a.mark((function t(){var a,r,n,o,i;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.queryPayload.where={name:e.queryForm.name?{$regex:e.queryForm.name}:{$ne:null},netType:"Evidence",nodeType:1},dgiotlog.log(e.queryPayload),e.listLoading=!0,t.next=5,Object(c["queryProduct"])(e.queryPayload);case 5:a=t.sent,r=a.count,n=void 0===r?0:r,o=a.results,i=void 0===o?[]:o,e.$refs["paginations"].ination.total=n,i.forEach((function(e){e.createdAt=moment(e.createdAt).format("YYYY-MM-DD HH:mm:ss")})),e.list=i,e.listLoading=!1;case 14:case"end":return t.stop()}}),t)})))()}}}),y=v,w=(a("db74"),a("bdd7")),x=Object(w["a"])(y,r,n,!1,null,null,null);t["default"]=x.exports},cee2:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"CloudTest-container"},[a("div",{staticClass:"CloudTest-content"},[e._v(" "+e._s(e.infoData)+" ")])])},n=[],o={name:"CloudTest",components:{},data:function(){return{infoData:"CloudTest"}},computed:{},mounted:function(){},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){},methods:{}},i=o,s=(a("c8a8"),a("bdd7")),l=Object(s["a"])(i,r,n,!1,null,"eb51b004",null);t["default"]=l.exports},d4d8:function(e,t,a){"use strict";a("1855")},d842:function(e,t,a){"use strict";a("fde4")},db74:function(e,t,a){"use strict";a("7da2")},dd8c:function(e,t,a){},dded:function(e,t,a){"use strict";a("7f2c")},e185:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"modules"},[a("el-dialog",{attrs:{"append-to-body":!0,title:"修改物模型",visible:e.edit_module,width:"17%"},on:{"update:visible":function(t){e.edit_module=t}}},[a("el-form",{ref:"editForm",staticClass:"demo-editForm",attrs:{"label-width":"100px",model:e.editForm,rules:e.rules}},[a("el-form-item",{attrs:{label:"产品名称",prop:"name"}},[a("el-input",{model:{value:e.editForm.name,callback:function(t){e.$set(e.editForm,"name",t)},expression:"editForm.name"}})],1),a("el-form-item",{attrs:{label:"产品类型",prop:"devType"}},[a("el-input",{model:{value:e.editForm.devType,callback:function(t){e.$set(e.editForm,"devType",t)},expression:"editForm.devType"}})],1),a("el-form-item",{attrs:{label:"所属分类",prop:"category"}},[a("el-cascader",{attrs:{options:e.categoryListOptions},model:{value:e.editForm.category,callback:function(t){e.$set(e.editForm,"category",t)},expression:"editForm.category"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.editPostForm("editForm")}}},[e._v(" 修改 ")]),a("el-button",{on:{click:function(t){return e.resetForm("editForm")}}},[e._v("重置")])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,title:"新增物模型",visible:e.add_module,width:"17%"},on:{"update:visible":function(t){e.add_module=t}}},[a("el-form",{ref:"moduleForm",staticClass:"demo-moduleForm",attrs:{"label-width":"100px",model:e.moduleForm,rules:e.rules}},[a("el-form-item",{attrs:{label:"产品名称",prop:"name"}},[a("el-input",{model:{value:e.moduleForm.name,callback:function(t){e.$set(e.moduleForm,"name",t)},expression:"moduleForm.name"}})],1),a("el-form-item",{attrs:{label:"产品类型",prop:"devType"}},[a("el-input",{model:{value:e.moduleForm.devType,callback:function(t){e.$set(e.moduleForm,"devType",t)},expression:"moduleForm.devType"}})],1),a("el-form-item",{attrs:{label:"所属分类",prop:"category"}},[a("el-cascader",{attrs:{options:e.categoryListOptions},model:{value:e.moduleForm.category,callback:function(t){e.$set(e.moduleForm,"category",t)},expression:"moduleForm.category"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("moduleForm")}}},[e._v(" 立即创建 ")]),a("el-button",{on:{click:function(t){return e.resetForm("moduleForm")}}},[e._v("重置")])],1)],1),a("header",[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:20}},[a("el-button",{attrs:{icon:"el-icon-plus",size:"mini",type:"primary"},on:{click:function(t){e.add_module=!0}}},[e._v(" 新增 ")])],1),a("el-col",{attrs:{span:4}},[a("el-input",{attrs:{placeholder:"请输入产品名称",size:"mini"},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search",size:"mini",type:"primary"},on:{click:function(t){return e.searchModule(e.searchText)}},slot:"append"},[e._v(" 搜索 ")])],1)],1)],1)],1),a("center",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.pictLoading,expression:"pictLoading"}],staticStyle:{width:"100%","min-height":"583px"},attrs:{data:e.tableData.filter((function(t){return!e.search||t.name.toLowerCase().includes(e.search.toLowerCase())})),"element-loading-background":"rgba(0, 0, 0, 0.5)","element-loading-spinner":"el-icon-loading","element-loading-text":"数据正在加载中","max-height":"583"}},[a("el-table-column",{attrs:{label:"objectId",prop:"objectId"}}),a("el-table-column",{attrs:{label:"产品名称"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.data.name)+" ")]}}])}),a("el-table-column",{attrs:{label:"产品类型"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.data.devType)+" ")]}}])}),a("el-table-column",{attrs:{label:"key",prop:"key"}}),a("el-table-column",{attrs:{label:"所属分类"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.data.category)+" ")]}}])}),a("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row,n=t.$index;return[a("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleEdit(n,r)}}},[e._v(" 修改 ")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(n,r.tableData)}}},[e._v(" 删除 ")])]}}])},[a("template",{slot:"header"},[a("el-input",{attrs:{placeholder:"输入关键字搜索",size:"mini"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)],2)],1)],1),a("footer",[a("el-pagination",{attrs:{"current-page":e.currentPage,layout:"total, sizes, prev, pager, next, jumper","page-size":10,"page-sizes":[10,20,50,100],total:e.pageTotal},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1),e._v(" Parse ")],1)},n=[],o=a("fb07"),i=(a("04d6"),a("a0e0"),a("3dec"),a("c4bc"),a("16b8"),a("e170"),a("d0d7")),s=a.n(i),l=a("e0e9"),c=a("7212"),u=a("7497"),d={name:"Modules",components:{},data:function(){return{productObj:[],pictLoading:!1,categoryListOptions:[],limit:10,skip:0,add_module:!1,edit_module:!1,searchText:"",hashkey:"",categoryList:[],infoData:"物模型管理",currentPage:1,pageTotal:0,tableData:[],search:"",editForm:{name:"物模型管理",devType:"物模型管理",category:"",type:"Product"},moduleForm:{name:"物模型管理",devType:"物模型管理",category:"",type:"Product"},rules:{name:[{required:!0,message:"请输入产品名称",trigger:"blur"}],devType:[{required:!0,message:"请输入产品类型",trigger:"blur"}],category:[{required:!0,message:"请选择模型所属分类",trigger:"blur"}]}}},computed:{},mounted:function(){this.searchModule(""),this.Industry()},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){},methods:{getProduct:function(){var e=this;return Object(o["a"])(s.a.mark((function t(){var a,r;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(c["queryProduct"])();case 2:a=t.sent,r=a.results,r&&(e.productObj=r);case 5:case"end":return t.stop()}}),t)})))()},treeData:function(e){var t=JSON.parse(JSON.stringify(e));return t.filter((function(e){var a=t.filter((function(t){return e.id==t.parentid}));return a.length>0&&(e.children=a),0==e.parentid}))},Industry:function(){var e=this;this.categoryList=[],this.getProduct();var t={limit:10,where:{"data.key":"category"}};this.$query_object("Dict",t).then((function(t){t.results&&(t.results.map((function(t){var a={};a.value=t.type,a.label=t.data.CategoryName,a.id=t.data.Id,a.parentid=t.data.SuperId,e.categoryList.push(a)})),e.categoryListOptions=e.treeData(e.categoryList))}))["catch"]((function(e){dgiotlog.log(e,"error")}))},blackDict:function(e,t,a){var r=this;return Object(o["a"])(s.a.mark((function n(){var o,i;return s.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o={data:t,key:e,type:a},n.next=3,Object(l["postDict"])(o);case 3:i=n.sent,i?(r.$message({type:"success",message:"新建物模型成功"}),r.add_module=!1,r.searchModule("")):r.$message({type:"error",message:"新建物模型失败"});case 5:case"end":return n.stop()}}),n)})))()},submitForm:function(e){var t=this;this.$refs[e].validate(function(){var e=Object(o["a"])(s.a.mark((function e(a){var r,n,o,i;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!a){e.next=8;break}return r={category:t.moduleForm.category[0],devType:t.moduleForm.devType,name:t.moduleForm.name},e.next=4,Object(u["getHashClass"])("Product",r);case 4:n=e.sent,o=n.objectId,i=n.code,200==i&&t.blackDict(o,r,t.moduleForm.type);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},resetForm:function(e){this.$refs[e].resetFields()},searchModule:function(e){var t=this;return Object(o["a"])(s.a.mark((function a(){var r,n,o,i,c;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.pictLoading=!0,r=e.length?{order:"-createdAt",count:"objectId",limit:t.limit,skip:t.skip,where:{type:"Module",key:{$regex:"".concat(e)}}}:{order:"-createdAt",count:"objectId",limit:t.limit,skip:t.skip,where:{type:"Product"}},a.next=4,Object(l["getDictCount"])(r);case 4:n=a.sent,o=n.results,i=n.count,c=void 0===i?0:i,t.pictLoading=!1,o&&(t.tableData=o,t.pageTotal=c);case 10:case"end":return a.stop()}}),a)})))()},handleSizeChange:function(e){dgiotlog.log("每页 ".concat(e," 条")),this.limit=e,this.searchModule(this.searchText)},handleCurrentChange:function(e){dgiotlog.log("当前页: ".concat(e)),this.skip=this.limit*(e-1),this.searchModule(this.searchText)},handleEdit:function(e,t){this.edit_module=!0,this.editForm=t.data,dgiotlog.log(e,t)},editPostForm:function(e){dgiotlog.log(e)},handleDelete:function(e,t,a){var r=this;return Object(o["a"])(s.a.mark((function n(){var o;return s.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Object(l["delDict"])(t.objectId);case 2:o=n.sent,o?(a.splice(e,1),r.$message({type:"success",message:"删除成功"})):r.$message({type:"error",message:"删除失败"});case 4:case"end":return n.stop()}}),n)})))()}}},p=d,m=(a("076a"),a("bdd7")),g=Object(m["a"])(p,r,n,!1,null,"7ef6b2ee",null);t["default"]=g.exports},e4b2c:function(e,t,a){},e5e0:function(e,t,a){"use strict";a.r(t);var r=a("fb07"),n=a("e97b"),o=a("d0d7"),i=a.n(o),s=(a("7690"),a("a0e0"),a("3dec"),a("f764"),a("5662"),a("b8f1"),a("16b8"),a("3eb0"),a("9c6a"),a("e170"),a("d6a4"),a("e0e4"),a("1d17"),a("4c87"),a("f1e1"),a("04d6"),a("c4bc"),a("5449"),a("20e3"),a("209d")),l=a("1285"),c=a("227e"),u=a("cdef"),d=a("289a"),p=a.n(d),m=a("5880"),g=a("7212"),f=a("8ba7"),h=a("c008"),b=a("c32d"),v=a.n(b);t["default"]={name:"TaskIndex",filters:{filterVal:function(e){return e||0==e?e:"--"}},components:{VabDraggable:p.a,lowcodeDesign:s["default"]},data:function(){var e,t;return{machinelist:{},historyEvidenceid:"",nowTime:window.datetime,historyEvidence:[],historyInfo:{},thirdtbKey:v()(new Date).valueOf(),original:{},collectionInfo:{},drawxnqxPath:"",thingdata:[],realtimedata:[],thingcolumns:[],historycolumns:[],visible:!1,router:"",topicKey:"",activeName1:"first",activeName:null!==this&&void 0!==this&&null!==(e=this.$route)&&void 0!==e&&null!==(t=e.query)&&void 0!==t&&t.tabs&&"examination"==this.$route.query.tabs?"examination":"forensics",officeapps:"",dialogVisible:!1,paginations:{layout:"total, sizes, prev, pager, next, jumper"},queryPayload:{excludeKeys:"data",include:"",order:"-createdAt",limit:10,skip:0,count:"objectId"},lowcodeId:"",loading:!1,options:[{value:"Underreview",label:"审核中"},{value:"finishreview",label:"审核完成"}],rules:{testbed:[{required:!0,message:"请选择测试台体",trigger:"blur"}],name:[{required:!0,message:"请输入报告名称",trigger:"blur"}],templatename:[{required:!0,message:"请选择报告模板",trigger:"change"}]},activePopShow:!1,border:!0,height:980,stripe:!0,lineHeight:"medium",checkList:["mission name","Inspection number","Inspection template","testbed","Trade Names","Creation time","Starting time","end time"],columns:[{label:"mission name",width:"auto",prop:"name",sortable:!0},{label:"Inspection template",width:"auto",prop:"profile.wordtemplatename",sortable:!0},{label:"testbed",width:"auto",prop:"profile.testbed",sortable:!0},{label:"Starting time",width:"auto",prop:"starttime",sortable:!0},{label:"end time",width:"auto",prop:"endtime",sortable:!0}],list:{forensics:[],examination:[]},listLoading:!0,queryForm:{pageSizes:[10,20,30,50],limit:10,order:"-createdAt",keys:"count(*)",total:0,skip:0,pageNo:1,pageSize:10,name:""},categorylist:[],wordtemplist:[],grouplist:[],ruleForm:{name:"",templatename:"",testbed:"",testbedid:"",templatenameid:""}}},computed:Object(n["a"])(Object(n["a"])({},Object(m["mapGetters"])({currentDepartment:"user/currentDepartment"})),{},{dragOptions:function(){return{animation:600,group:"description"}},finallyColumns:function(){var e=this;return this.columns.filter((function(t){return e.checkList.includes(t.label)}))}}),created:function(){this.fetchData()},mounted:function(){var e=this;this.historyEvidence=[],this.historyInfo={},this.router=this.$dgiotBus.router(this.$route.fullPath),this.$dgiotBus.$off("lowcodeClose"),this.$dgiotBus.$on("lowcodeClose",(function(t){e.fetchData()})),this.timer=setInterval((function(){e.datetime()}),1e3)},methods:{tabHandleClick:function(e){switch(e.name){case"first":break;case"second":break}},getCardDevice:function(e){var t=this;Object(l["getCardDevice"])(e).then((function(e){t.machinelist={},null!==e&&void 0!==e&&e.data&&t.renderCard(e.data)}))["catch"]((function(e){dgiotlog.log("update error 清除timer",e)}))},subRealtimedata:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){var r,n,o;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:r="thing/".concat(e.parentId.objectId,"/realtimedata/post"),n=t.$dgiotBus.router(location.href+t.$route.fullPath),o=t.$dgiotBus.topicKey(n,r);try{t.$dgiotBus.$emit("MqttSubscribe",{router:n,topic:r,qos:0,ttl:108e5}),console.groupCollapsed("%c mqtt 订阅日志","color:#009a61; font-size: 28px; font-weight: 300"),console.log("topic:",r),console.log("router:",n),console.groupEnd(),t.$dgiotBus.$off(o),t.$dgiotBus.$on(o,(function(e){console.groupCollapsed("%c mqttMsg消息回调","color:#009a61; font-size: 28px; font-weight: 300"),console.log(e),console.log(Base64.decode(e.payload)),console.log(JSON.parse(Base64.decode(e.payload)).data),console.log("Base64.decode(payload):",Base64.decode(e.payload)),console.groupEnd();var a=JSON.parse(Base64.decode(e.payload)),r=a.data,n=void 0===r?[]:r;n?t.renderCard(n):t.getCardDevice()}))}catch(i){console.log(i),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(i),"error","vab-hey-message-error")}case 4:case"end":return a.stop()}}),a)})))()},renderCard:function(e){var t=this,a=[];e.forEach((function(e){e.devicetype&&a.push(e.devicetype)})),a=_.uniqBy(a);var r={};a.forEach((function(t){var a=[];e.forEach((function(e){t==e.devicetype&&a.push(e)})),r[t]=a})),t.machinelist=r,t.thirdtbKey=v()(new Date).valueOf()},datetime:function(){this.nowTime=v()(new Date).format("YYYY-MM-DD HH:mm:ss")},paginationQuery:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.queryPayload=e;case 1:case"end":return a.stop()}}),a)})))()},categoryChange:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.$set(t.ruleForm,"templatenameid",e.objectId);case 1:case"end":return a.stop()}}),a)})))()},testbedChange:function(e){this.$set(this.ruleForm,"testbedid",e.objectId),console.log("src/views/CloudTest/js/task.js","this.ruleForm",this.ruleForm,e.objectId)},getwordtemp:function(){var e=this;return Object(r["a"])(i.a.mark((function t(){var a,r,n,o;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={skip:0,where:{netType:"Evidence",nodeType:1}},t.next=3,Object(g["queryProduct"])(a);case 3:r=t.sent,n=r.results,o=void 0===n?{}:n,e.categorylist=o;case 7:case"end":return t.stop()}}),t)})))()},getgroup:function(){var e=this;return Object(r["a"])(i.a.mark((function t(){var a,r,n;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={where:{"detail.category":"84abda3154"}},t.next=3,Object(l["queryDevice"])(a);case 3:r=t.sent,n=r.results,e.grouplist=n;case 6:case"end":return t.stop()}}),t)})))()},deleteHistory:function(e,t){var a=this;return Object(r["a"])(i.a.mark((function r(){return i.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,a.historyEvidence.splice(t,1);case 3:return console.log("deleteHistory",e,t,a.historyEvidence,a.historyEvidence.length),r.next=6,a.saveHistorical(a.collectionInfo,a.thingdata,a.historyEvidence,!1);case 6:return r.next=8,a.saveThingdata();case 8:r.next=14;break;case 10:r.prev=10,r.t0=r["catch"](0),console.log(r.t0),a.$baseMessage(a.$translateTitle("alert.Data request error")+"".concat(r.t0),"error","vab-hey-message-error");case 14:case"end":return r.stop()}}),r,null,[[0,10]])})))()},saveThingdata:function(){var e=this;return Object(r["a"])(i.a.mark((function t(){var a;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a={original:e.historyInfo.original},t.next=4,Object(h["putEvidence"])(e.historyInfo.objectId,a);case 4:t.sent,t.next=11;break;case 7:t.prev=7,t.t0=t["catch"](0),console.log(t.t0),e.$baseMessage(e.$translateTitle("alert.Data request error")+"".concat(t.t0),"error","vab-hey-message-error");case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))()},submitForm:function(e){var t=this,a="role:"+this.currentDepartment.name,n={};n[a]={read:!0,write:!0},this.$refs[e].validate(function(){var e=Object(r["a"])(i.a.mark((function e(a){var r,n;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!a){e.next=10;break}return r={profile:{testbedid:t.ruleForm.teestbedid,testbed:t.ruleForm.testbed.name,wordtemplatename:t.ruleForm.templatename.name,reportId:t.ruleForm.templatenameid,identifier:"inspectionReportTemp",step:0},parentId:t.ruleForm.testbedid,name:t.ruleForm.name,product:t.ruleForm.templatenameid},n=t.$baseColorfullLoading(1),t.activePopShow=!1,e.next=6,Object(u["postreport"])(r);case 6:t.fetchData(),n.close(),e.next=12;break;case 10:return console.log("error submit!!"),e.abrupt("return",!1);case 12:t.ruleForm={name:"",templatename:"",testbed:"",testbedid:"",templatenameid:""};case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},featHistoryEvidence:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){var r,n,o,s,l,c,u;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.historyEvidence=[],a.prev=1,r={order:"-createdAt",skip:0,where:{"original.taskid":e,"original.type":"avgs"}},n=t.$baseColorfullLoading(),a.next=6,Object(h["queryEvidence"])(r);case 6:o=a.sent,s=o.results,l=void 0===s?[]:s,null!==l&&void 0!==l&&l.length&&(t.historyEvidence=null!==(c=l[0].original.avgs)&&void 0!==c?c:[],t.collectionInfo.profile.historicaldata=t.historyEvidence,t.historyInfo=l[0],t.drawxnqxPath=null!==(u=l[0].original.path)&&void 0!==u?u:""),t.historycolumns=_.filter(t.thingcolumns,(function(e){return"timestamp"!==e.prop})),t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),n.close(),a.next=19;break;case 15:a.prev=15,a.t0=a["catch"](1),console.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 19:case"end":return a.stop()}}),a,null,[[1,15]])})))()},forensics:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$router.push({path:"/cloudTest/evidence",query:{taskid:e.objectId,suite:0,state:"preview",step:1,back:e.profile.step,message:e.profile.message}});case 3:a.next=9;break;case 5:a.prev=5,a.t0=a["catch"](0),console.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 9:case"end":return a.stop()}}),a,null,[[0,5]])})))()},taskEnd:function(e){var t=this;this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to end the current mission"),null,Object(r["a"])(i.a.mark((function a(){var r,n;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r=t.$baseColorfullLoading(),n={profile:_.merge(e.profile,{step:4,endtime:v()(new Date).format("x")})},a.next=5,Object(l["putDevice"])(e.objectId,n);case 5:a.sent,t.fetchData(),r.close(),a.next=14;break;case 10:a.prev=10,a.t0=a["catch"](0),console.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 14:case"end":return a.stop()}}),a,null,[[0,10]])}))))},taskStart:function(e){var t=this,a=this;a.$baseConfirm(a.$translateTitle("Maintenance.Are you sure you want to start the current mission"),null,Object(r["a"])(i.a.mark((function r(){var n,o;return i.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,n=a.$baseColorfullLoading(),r.next=4,a.startOpc(e);case 4:return r.next=6,Object(h["generatereport"])(e.objectId);case 6:return o={profile:_.merge(e.profile,{step:1,starttime:v()(new Date).format("x")})},r.next=9,Object(l["putDevice"])(e.objectId,o);case 9:r.sent,a.fetchData(),n.close(),r.next=18;break;case 14:r.prev=14,r.t0=r["catch"](0),console.log(r.t0),a.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(r.t0),"error","vab-hey-message-error");case 18:case"end":return r.stop()}}),r,null,[[0,14]])}))))},downDocx:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){var r;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:try{r=document.createElement("a"),r.setAttribute("href",t.$FileServe+e),r.setAttribute("download","download"),r.click()}catch(n){console.log(n),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(n),"error","vab-hey-message-error")}case 1:case"end":return a.stop()}}),a)})))()},handleUnderreview:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:try{t.$router.push({path:"/cloudTest/evidence",query:{taskid:e,suite:0,state:"preview",step:3}})}catch(r){console.log(r),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(r),"error","vab-hey-message-error")}case 1:case"end":return a.stop()}}),a)})))()},handleReport:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){var r,n,o,s,c,u;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(4!=e.profile.step||!e.profile.docx){a.next=5;break}return r=t.$FileServe+e.profile.docx,t.dialogVisible=!0,t.officeapps="https://view.officeapps.live.com/op/view.aspx?src="+r,a.abrupt("return",!1);case 5:return a.prev=5,n=t.$baseColorfullLoading(),a.next=9,Object(h["generatereport"])(e.objectId);case 9:o=a.sent,s=o.code,c=o.msg,u=o.path,200==s&&u?(t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),setTimeout((function(){var a={profile:_.merge(e.profile,{step:4,docx:u})},r=(Object(l["putDevice"])(e.objectId,a),t.$FileServe+u);t.dialogVisible=!0,t.officeapps="https://view.officeapps.live.com/op/view.aspx?src="+r}),1200)):t.$baseMessage("".concat(c),"error","vab-hey-message-error"),n.close(),a.next=21;break;case 17:a.prev=17,a.t0=a["catch"](5),console.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 21:case"end":return a.stop()}}),a,null,[[5,17]])})))()},handleManagement:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){var r,n,o;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.$refs["lowcodeDesign"].withHeader=!0,localStorage.setItem("parse_objectid",e.objectId),r={limit:1,where:{type:"amis",key:e.objectId}},a.next=5,Object(f["queryView"])(r);case 5:n=a.sent,o=n.results,console.log(o),t.lowcodeId=o[0].objectId,t.$dgiotBus.$emit("lowcodePreview",o[0]);case 10:case"end":return a.stop()}}),a)})))()},handleDelete:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){var r;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r=t.$baseColorfullLoading(),a.next=4,Object(l["delDevice"])(e);case 4:a.sent,t.$baseMessage(t.$translateTitle("user.successfully deleted"),"success","vab-hey-message-success"),r.close(),t.fetchData(),a.next=14;break;case 10:a.prev=10,a.t0=a["catch"](0),console.log(a.t0),t.$baseMessage(t.$translateTitle("user.error deleted")+"".concat(a.t0),"error","vab-hey-message-error");case 14:case"end":return a.stop()}}),a,null,[[0,10]])})))()},fetchData:function(){var e=this;return Object(r["a"])(i.a.mark((function t(){var a,r,n,o,s;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.list={forensics:[],examination:[]},e.getwordtemp(),e.getgroup(),e.queryPayload.include="product,parentId",e.queryPayload.where={"profile.identifier":"inspectionReportTemp",name:e.queryForm.name.length?{$regex:e.queryForm.name}:{$ne:null},"profile.step":{$regex:"^(-1|[0-9]\\d*)$"}},e.listLoading=!0,t.next=8,Object(l["queryDevice"])(e.queryPayload);case 8:a=t.sent,r=a.count,n=void 0===r?0:r,o=a.results,s=void 0===o?[]:o,e.$refs["forensics"]&&(e.$refs["forensics"].ination.total=n),e.list.forensics=s,s.forEach((function(e){e.profile.step||(e.profile.step=0),e.endtime=e.profile.endtime?v()(Number(e.profile.endtime)).format("YYYY-MM-DD HH:mm:ss"):"",e.starttime=e.profile.starttime?v()(Number(e.profile.starttime)).format("YYYY-MM-DD HH:mm:ss"):"",e.createdAt=v()(e.createdAt).format("YYYY-MM-DD HH:mm:ss")})),e.listLoading=!1;case 17:case"end":return t.stop()}}),t)})))()},visibleInfo:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){var r,n,o,s,l,u,d,p;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r=t,r.collectionInfo=e,r.getCardDevice(e.parentId.objectId),r.subRealtimedata(e),a.prev=4,n={},o=[],r.thingdata=[],r.realtimedata=[],r.thingcolumns=[],e.basedata)for(s in e.basedata)0==s.indexOf("dgiot_testing_equipment_")&&(l=s.split("dgiot_testing_equipment_")[1],n["".concat(l)]=l,o.push(e.basedata[s]));return console.groupCollapsed("%c send mqttMsg items","color:#009a61; font-size: 28px; font-weight: 300"),console.log(o),console.groupEnd(),a.next=16,Object(c["postHead"])({items:o,productid:e.parentId.product.objectId});case 16:u=a.sent,d=u.table,p=void 0===d?[]:d,r.thingcolumns=p,console.log(" _this.thingcolumns",r.thingcolumns),r.featHistoryEvidence(t.collectionInfo.objectId),r.visible=!0,a.next=29;break;case 25:a.prev=25,a.t0=a["catch"](4),console.log(a.t0),r.$baseMessage(r.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 29:case"end":return a.stop()}}),a,null,[[4,25]])})))()},startOpc:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){var r,n,o,s,c,u,d,p;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,n=[],a.next=4,Object(l["getDevice"])(e.objectId);case 4:if(o=a.sent,s=o.basedata,c=void 0===s?[]:s,!_.isEmpty(c))for(u in c)0==u.indexOf("dgiot_testing_equipment_")&&n.push(c[u]);return console.groupCollapsed("%c send mqttMsg items","color:#009a61; font-size: 28px; font-weight: 300"),console.log(n),console.groupEnd(),d="/".concat(e.parentId.product.objectId,"/").concat(e.parentId.devaddr,"/device/event"),p={cmd:"opc_items",groupid:e.parentId.objectId,opcserver:null!==(r=c.dgiot_testing_opcserver)&&void 0!==r?r:"Kepware.KEPServerEX.V6",items:n},console.groupCollapsed("%c 下发消息","color:#009a61; font-size: 28px; font-weight: 300"),console.log(p),console.log(d),console.groupEnd(),a.next=19,t.$dgiotBus.$emit("MqttPublish",d,JSON.stringify(p),0,!1);case 19:a.next=25;break;case 21:a.prev=21,a.t0=a["catch"](0),console.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 25:case"end":return a.stop()}}),a,null,[[0,21]])})))()},collection:function(e){var t=this;return Object(r["a"])(i.a.mark((function a(){var r,n,o,s,c,u,d,p,m;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=t,r.collectionInfo=e,r.featHistoryEvidence(t.collectionInfo.objectId),a.prev=3,{},o=[],r.thingdata=[],a.next=9,Object(l["getDevice"])(e.objectId);case 9:if(s=a.sent,c=s.basedata,u=void 0===c?[]:c,!_.isEmpty(u))for(d in u)0==d.indexOf("dgiot_testing_equipment_")&&o.push(u[d]);console.groupCollapsed("%c send mqttMsg items","color:#009a61; font-size: 28px; font-weight: 300"),console.log(o),console.groupEnd(),r.subtopic="topo/".concat(e.parentId.product.objectId,"/").concat(e.parentId.devaddr,"/post"),p="/".concat(e.parentId.product.objectId,"/").concat(e.parentId.devaddr,"/device/event"),m={cmd:"opc_report",duration:null!==(n=Number(u.dgiot_sampling_parametric_frequency))&&void 0!==n?n:5,groupid:e.parentId.objectId},console.groupCollapsed("%c 发送采集消息","color:#009a61; font-size: 28px; font-weight: 300"),console.log("message",m),console.log("pubTopic",p),console.groupEnd(),r.$dgiotBus.$emit("MqttPublish",p,JSON.stringify(m),0,!1),r.topicKey=r.$dgiotBus.topicKey(r.router,r.subtopic),r.$dgiotBus.$off(r.topicKey),r.$dgiotBus.$on(r.topicKey,(function(e){if(console.groupCollapsed("%c mqttMsg消息回调 \n".concat(r.topicKey),"color:#009a61; font-size: 28px; font-weight: 300"),console.log(e),console.log("payload:",e.payload),console.groupEnd(),null!==e&&void 0!==e&&e.payload){var t=JSON.parse(e.payload),a=t.thingdata,n=void 0===a?{}:a,o=t.timestamp;n.timestamp=v()(Number(o)).format("YYYY-MM-DD HH:mm:ss"),_.isEmpty(n)||0!=(null===n||void 0===n?void 0:n.dgiotcollectflag)?r.realtimedata.unshift(n):(console.log(n),r.thingdata[0]=n)}})),console.log("_this.thingdata",r.thingdata),r.$dgiotBus.$emit("MqttSubscribe",{router:r.router,topic:r.subtopic,qos:0,ttl:108e5}),a.next=35;break;case 31:a.prev=31,a.t0=a["catch"](3),console.log(a.t0),r.$baseMessage(r.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 35:r.subRealtimedata(e);case 36:case"end":return a.stop()}}),a,null,[[3,31]])})))()},saveHistorical:function(e,t,a,n){var o=this;return Object(r["a"])(i.a.mark((function r(){var s,c,u;return i.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return s={profile:_.merge(e.profile,{historicaldatacolumns:_.filter(t,(function(e){return"timestamp"!==e.prop})),historicaldata:a,drawxnqxPath:o.drawxnqxPath})},console.log(e,s),n&&(o.visible=!1),r.prev=3,c=o.$baseColorfullLoading(),r.next=7,Object(l["putDevice"])(e.objectId,s);case 7:u=r.sent,console.log(u),o.$baseMessage(o.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),c.close(),r.next=17;break;case 13:r.prev=13,r.t0=r["catch"](3),console.log(r.t0),o.$baseMessage(o.$translateTitle("alert.Data request error")+"".concat(r.t0),"error","vab-hey-message-error");case 17:case"end":return r.stop()}}),r,null,[[3,13]])})))()},drawxnqx:function(e,t){var a=this;return Object(r["a"])(i.a.mark((function r(){var n,o,s,l,c,u,d,p,m,g,f;return i.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a.drawxnqxPath="",r.prev=1,n=t,o={data:n,taskid:e},r.next=6,Object(h["postDrawxnqx"])(o);case 6:s=r.sent,l=s.code,c=s.error,u=void 0===c?"":c,d=s.original,p=void 0===d?{}:d,m=s.evidenceid,g=void 0===m?"":m,200==Number(l)?(a.historyEvidenceid=null!==g&&void 0!==g?g:"",a.historyEvidence=null!==(f=p.avgs)&&void 0!==f?f:[],a.drawxnqxPath="".concat(p.path,"?t=").concat(v()(new Date).format("x")),a.original=null!==p&&void 0!==p?p:{},a.historycolumns=_.filter(a.thingcolumns,(function(e){return"timestamp"!==e.prop}))):a.$baseMessage(a.$translateTitle("alert.Data request error")+"".concat(u),"error","vab-hey-message-error"),r.next=21;break;case 17:r.prev=17,r.t0=r["catch"](1),console.log(r.t0),a.$baseMessage(a.$translateTitle("alert.Data request error")+"".concat(r.t0),"error","vab-hey-message-error");case 21:case"end":return r.stop()}}),r,null,[[1,17]])})))()},getSummaries:function(e){console.log(e,"params");var t=e.columns,a=e.data,r=[];return t.forEach((function(e,t){if(0!==t){var n=a.map((function(t){return Number(t[e.property])}));if(n.every((function(e){return isNaN(e)})))r[t]=0;else{var o=0;r[t]=n.reduce((function(e,t){var a=Number(t);return isNaN(a)?e:(o++,e+t)}),0),r[t]=r[t]/o}}else r[t]="平均值"})),console.log(r),r}},beforeDestroy:function(){clearInterval(this.timer)}}},ea2b:function(e,t,a){},ecf4:function(e,t,a){"use strict";a("60ed")},f4ab:function(e,t,a){"use strict";a("b89a")},f5a9:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"system-log-container"},[a("vab-query-form",[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"60px",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"账号"}},[a("el-input",{attrs:{clearable:"",placeholder:"请输入账号"},model:{value:e.queryForm.account,callback:function(t){e.$set(e.queryForm,"account","string"===typeof t?t.trim():t)},expression:"queryForm.account"}})],1),a("el-form-item",{attrs:{label:"周期"}},[a("el-date-picker",{attrs:{"end-placeholder":"结束日期",format:"yyyy-MM-dd","start-placeholder":"开始日期",type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",type:"primary"},nativeOn:{click:function(t){return e.queryData.apply(null,arguments)}}},[e._v(" 查询 ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.list},scopedSlots:e._u([{key:"empty",fn:function(){},proxy:!0}])},[a("el-table-column",{attrs:{align:"center",label:"日志类型",prop:"type","show-overflow-tooltip":"",width:"230px"}}),a("el-table-column",{attrs:{align:"center",label:"账号",prop:"account","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{align:"center",label:"执行结果",prop:"executeResult","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return["登录成功"===r.executeResult?a("span",[a("span",{staticClass:"vab-dot vab-dot-success"},[a("span")]),e._v(" "+e._s(r.executeResult)+" ")]):a("span",[a("span",{staticClass:"vab-dot vab-dot-error"},[a("span")]),e._v(" "+e._s(r.executeResult)+" ")])]}}])}),a("el-table-column",{attrs:{align:"center",label:"登录IP",prop:"ip"}}),a("el-table-column",{attrs:{align:"center",label:"访问时间",prop:"datetime","show-overflow-tooltip":""}})],1),a("el-pagination",{attrs:{background:"","current-page":e.queryForm.pageNo,layout:e.layout,"page-size":e.queryForm.pageSize,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)},n=[],o=a("fb07"),i=a("d0d7"),s=a.n(i),l=a("8781"),c={name:"SystemLog",data:function(){return{list:[],listLoading:!0,layout:"total, sizes, prev, pager, next, jumper",total:0,queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20}}},created:function(){this.fetchData()},methods:{handleSizeChange:function(e){this.queryForm.pageSize=e,this.fetchData()},handleCurrentChange:function(e){this.queryForm.pageNo=e,this.fetchData()},queryData:function(){this.queryForm.pageNo=1,this.fetchData()},fetchData:function(){var e=this;return Object(o["a"])(s.a.mark((function t(){var a,r,n,o;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.listLoading=!0,t.next=3,Object(l["getList"])(e.queryForm);case 3:a=t.sent,r=a.data,n=r.list,o=r.total,e.list=n,e.total=o,e.listLoading=!1;case 10:case"end":return t.stop()}}),t)})))()}}},u=c,d=a("bdd7"),p=Object(d["a"])(u,r,n,!1,null,null,null);t["default"]=p.exports},f898:function(e,t,a){"use strict";a("49ba1")},fde4:function(e,t,a){},fe50:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"CloudSystem-container"},[a("div",{staticClass:"CloudSystem-content"},[e._v(" "+e._s(e.infoData)+" ")])])},n=[],o={name:"CloudSystem",components:{},data:function(){return{infoData:"CloudSystem"}},computed:{},mounted:function(){},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){},methods:{}},i=o,s=(a("dded"),a("bdd7")),l=Object(s["a"])(i,r,n,!1,null,"6af26652",null);t["default"]=l.exports}}]);