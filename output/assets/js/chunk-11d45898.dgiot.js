/*!
 *  build: 杭州数蛙科技有限公司 
 *  copyright: dgiot-dashboard 
 *  author: h7ml(h7ml@qq.com) 
 *  Time: 2021-12-31 11:18:57
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-11d45898"],{"1c75":function(e,t,a){"use strict";a("8b057")},3024:function(e,t,a){"use strict";a.r(t);var i,o,r,s,n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"onlinetest"},[a("div",{staticClass:"onlinetest_top"},[a("div",[a("el-form",{attrs:{inline:!0,model:e.devices,size:"mini"}},[a("el-form-item",{attrs:{label:"请选择设备"}},[a("el-select",{on:{change:e.selsectProduct},model:{value:e.devices.productid,callback:function(t){e.$set(e.devices,"productid",t)},expression:"devices.productid"}},e._l(e.productlist,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",[a("el-select",{directives:[{name:"el-select-loadmore",rawName:"v-el-select-loadmore",value:e.loadmore,expression:"loadmore"}],model:{value:e.devices.devicedevaddr,callback:function(t){e.$set(e.devices,"devicedevaddr",t)},expression:"devices.devicedevaddr"}},e._l(e.devicelist,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.devaddr}})})),1)],1),a("el-form-item",{attrs:{label:"服务通道"}},[a("el-select",{model:{value:e.devices.subtopic,callback:function(t){e.$set(e.devices,"subtopic",t)},expression:"devices.subtopic"}},e._l(e.channellist,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.subTopic.apply(null,arguments)}}},[e._v("订阅")])],1)],1)],1),a("div",{staticClass:"top_content"},[a("span",{staticStyle:{display:"inline-block","font-size":"20px","font-weight":"900"}},[e._v(" 实时日志 ")]),a("span",{staticClass:"status",class:e.status}),a("div",{staticStyle:{float:"right"}},[a("el-switch",{staticStyle:{display:"inline-block","margin-right":"10px"},attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","inactive-text":"自动刷新"},on:{change:e.isInterval},model:{value:e.value4,callback:function(t){e.value4=t},expression:"value4"}}),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.sendTrueInterval}},[e._v(" 刷新 ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.clearTopic}},[e._v(" 清屏 ")])],1),e._m(0)])]),a("div",{staticClass:"onlinetest_bottom"},[a("el-tabs",{attrs:{type:"border-card"}},[a("el-tab-pane",{attrs:{label:"调试真实设备"}},[a("div",{staticClass:"bottom1_top"},[a("div",[a("div",{staticClass:"editorheader"},[a("el-form",{attrs:{inline:!0,"label-width":"80px",model:e.editor1,size:"mini"}},[a("el-form-item",{attrs:{label:"调试功能"}},[a("el-select",{on:{change:e.selectMessage},model:{value:e.editor1.function,callback:function(t){e.$set(e.editor1,"function",t)},expression:"editor1.function"}},e._l(e.dataslist,(function(e,t){return a("el-option",{key:t,attrs:{label:e.data.name,value:e.objectId}})})),1)],1),a("el-form-item",[a("el-button",{attrs:{circle:"",icon:"el-icon-plus",type:"primary"},on:{click:e.addMessage}}),a("el-button",{attrs:{circle:"",disabled:""==e.editor1.function,icon:"el-icon-delete",type:"danger"},on:{click:e.deleteMessage}})],1),a("div",{staticStyle:{"margin-top":"10px"}},[""==e.editor1.function?a("el-tooltip",{staticClass:"item",attrs:{content:"请选择功能",effect:"dark",placement:"top-start"}},[a("span",[a("el-button",{attrs:{disabled:""==e.editor1.function,size:"mini",type:"primary"},on:{click:e.sendMessage1}},[e._v(" 发送指令 ")])],1)]):a("el-button",{attrs:{disabled:""==e.editor1.function,size:"mini",type:"primary"},on:{click:e.sendMessage1}},[e._v(" 发送指令 ")]),a("el-button",{attrs:{disabled:""==e.editor1.function,icon:"el-icon-edit",size:"mini",type:"primary"},on:{click:e.editorMessage}},[e._v(" 更新 ")]),a("el-button",{attrs:{disabled:""==e.editor1.function,plain:"",size:"mini",type:"info"}},[e._v(" 重置 ")])],1)],1)],1),a("div",{staticStyle:{background:"#ffffff"}},[a("label",{attrs:{id:"plug-name"}})]),a("pre",{staticClass:"ace_editor",staticStyle:{"min-height":"300px"},attrs:{id:"editor1"}},[a("textarea",{staticClass:"ace_text-input"})])])])]),a("el-tab-pane",{attrs:{label:"调试虚拟设备"}},[a("div",{staticClass:"editor2header"},[1==e.isactive?a("div",{staticClass:"editor2show animated fadeIn"},[a("el-button-group",[a("el-button",{attrs:{plain:"",size:"mini",type:1==e.primary1?"primary":"info"},on:{click:function(t){e.primary1=1}}},[e._v(" 属性上报 ")]),a("el-button",{attrs:{plain:"",size:"mini",type:2==e.primary1?"primary":"info"},on:{click:function(t){e.primary1=2}}},[e._v(" 事件上报 ")]),a("el-button",{attrs:{plain:"",size:"mini",type:3==e.primary1?"primary":"info"},on:{click:e.functionClick}},[e._v(" 属性调试 ")]),a("el-button",{attrs:{plain:"",size:"mini",type:4==e.primary1?"primary":"info"},on:{click:function(t){e.primary1=4}}},[e._v(" 服务调用 ")])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:1==e.primary1,expression:"primary1 == 1"}],staticClass:"primary1"},[a("el-form",{attrs:{model:e.primary1form,size:"mini"}},[a("el-form-item",{attrs:{label:"lightStatus"}},[a("el-select",{model:{value:e.primary1form.status,callback:function(t){e.$set(e.primary1form,"status",t)},expression:"primary1form.status"}},[a("el-option",{attrs:{label:"11111",value:"2222"}})],1)],1),a("div",{staticClass:"primary1content"}),a("div",{staticClass:"primary1bottom"},[a("el-button",{attrs:{size:"mini",type:"primary"}},[e._v("推送")]),a("el-button",{attrs:{plain:"",size:"mini",type:"info"}},[e._v(" 策略推送 ")]),a("el-button",{attrs:{plain:"",size:"mini",type:"info"},on:{click:function(t){e.isactive=!1}}},[e._v(" 关闭虚拟设备 ")]),a("el-button",{attrs:{plain:"",size:"mini",type:"info"}},[e._v(" 查看数据 ")])],1)],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:2==e.primary1,expression:"primary1 == 2"}],staticClass:"primary2 animated fadeInUp"},[a("div",{staticStyle:{"margin-top":"20px","margin-bottom":"20px","font-size":"20px",color:"#73777a"}},[e._v(" 暂无数据 ")]),a("div",[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("编辑物模型")]),a("el-button",{attrs:{size:"small",type:"info"},on:{click:function(t){e.isactive=!1}}},[e._v(" 关闭设备 ")])],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:3==e.primary1||4==e.primary1,expression:"primary1 == 3 || primary1 == 4"}],staticClass:"primary3"},[a("div",{staticClass:"editorheader"},[a("el-form",{attrs:{inline:!0,"label-width":"80px",model:e.editor2,size:"mini"}},[a("el-form-item",{attrs:{label:"调试功能"}},[a("el-select",{model:{value:e.editor2.function,callback:function(t){e.$set(e.editor2,"function",t)},expression:"editor2.function"}},[a("el-option",{attrs:{label:"11111",value:"2222"}})],1)],1),3==e.primary1?a("div",{staticStyle:{display:"inline-block"}},[a("el-form-item",{attrs:{label:"功能"}},[a("el-select",{model:{value:e.editor2.method,callback:function(t){e.$set(e.editor2,"method",t)},expression:"editor2.method"}},[a("el-option")],1)],1)],1):e._e()],1)],1),a("div",{staticStyle:{background:"#ffffff"}},[a("label",{attrs:{id:"plug-name"}})]),a("pre",{staticClass:"ace_editor",staticStyle:{"min-height":"300px"},attrs:{id:"editor2"}},[a("textarea",{staticClass:"ace_text-input"})]),a("div",[""==e.editor2.function?a("el-tooltip",{staticClass:"item",attrs:{content:"请选择功能",effect:"dark",placement:"top-start"}},[a("span",[a("el-button",{attrs:{disabled:""==e.editor2.function,plain:"",size:"mini",type:"info"}},[e._v(" 发送指令 ")])],1)]):a("el-button",{attrs:{plain:"",size:"mini",type:"info"}},[e._v(" 发送指令 ")]),a("el-button",{attrs:{plain:"",size:"mini",type:"info"}},[e._v("重置")])],1)])],1):a("div",{staticClass:"editor2hidden animated fadeInDown"},[a("div",{staticStyle:{"margin-top":"20px","font-size":"20px"}},[e._v("调试虚拟设备")]),a("div",{staticStyle:{"margin-top":"8px","margin-bottom":"20px","font-size":"14px",color:"#73777a","text-align":"center"}},[e._v(" 虚拟设备可以模拟真实设备在云端建立连接，上报定义的属性及事件处理， "),a("br"),e._v(" 这样可以不依赖真实设备快速开发应用 ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){e.isactive=!0}}},[e._v(" 启动真实设备 ")])],1)])])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,"close-on-click-modal":!1,title:"新建功能",visible:e.messageDialogVisible,width:"50%"},on:{"update:visible":function(t){e.messageDialogVisible=t}}},[a("el-form",{attrs:{inline:!0,model:e.messageform,size:"small"}},[a("el-form-item",{attrs:{label:"功能名称"}},[a("el-input",{attrs:{type:"text"},model:{value:e.messageform.name,callback:function(t){e.$set(e.messageform,"name",t)},expression:"messageform.name"}})],1)],1),a("label",{attrs:{id:"plug-name"}},[e._v("消息体")]),a("pre",{staticClass:"ace_editor",staticStyle:{"min-height":"300px"},attrs:{id:"message"}},[a("textarea",{staticClass:"ace_text-input"})]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.messageDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addCmd.apply(null,arguments)}}},[e._v("确 定")])],1)],1)],1)},c=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{"margin-top":"20px"}},[a("pre",{staticClass:"ace_editor",staticStyle:{width:"100%","min-height":"300px"},attrs:{id:"subprodevice"}},[e._v("          "),a("textarea",{staticClass:"ace_text-input",staticStyle:{overflow:"scroll"}}),e._v("        ")])])}],l=a("e97b"),d=(a("e472"),a("1ec3"),a("1d17"),a("9f39"),a("4656"),a("04d6"),a("c4bc"),a("16b8"),a("0e2a")),u=a("7212"),p=a("e0e9"),m=a("89e8"),h="",g={name:"OnlineTest",directives:{"el-select-loadmore":{bind:function(e,t){var a=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");a.addEventListener("scroll",(function(){var e=this.scrollHeight-this.scrollTop<=this.clientHeight;e&&t.value()}))}}},data:function(){return{primary:!0,status:"active",value4:!0,contentData:[],devices:{devicedevaddr:"",productid:"",subtopic:""},editor1:{function:"",method:""},editor2:{function:"",method:""},messageDialogVisible:!1,primary2active:!0,primary1:1,isactive:!1,primary1form:{status:""},productlist:[],devicelist:[],formData:{pageIndex:1,pageSize:20},channellist:[],subdialogtimer:null,messageform:{name:""},dataslist:[],sendindex:0,detaildatas:{}}},mounted:function(){i=ace.edit("editor1"),i.session.setMode("ace/mode/json"),i.setTheme("ace/theme/eclipse"),i.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),r=ace.edit("subprodevice"),r.session.setMode("ace/mode/text"),r.setTheme("ace/theme/gob"),r.setReadOnly(!0),r.setOptions({enableBasicAutocompletion:!1,enableSnippets:!0,enableLiveAutocompletion:!0}),this.getProduct()},beforeDestroy:function(){var e={topic:"log/channel/"+this.devices.subtopic+"/"+this.devices.productid+"/"+this.devices.devicedevaddr,qos:2};d["Websocket"].unsubscribe(e,(function(e){e.result&&dgiotlog.log("取消订阅")})),r.setValue(""),h=""},methods:{sendZl:function(){},setJson:function(){},nowtime:function(){var e=Date.parse(new Date),t=new Date(e),a=(t.getFullYear(),t.getMonth()+1<=10?t.getMonth():t.getMonth(),t.getDate()+1<=10?t.getDate():t.getDate(),(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":"),i=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",o=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return a+i+o+" "},subTopic:function(){this.sendindex++;var e={topic:"log/channel/"+this.devices.subtopic+"/"+this.devices.productid+"/"+this.devices.devicedevaddr,qos:2},t=new RegExp("log/channel/"+this.devices.subtopic+"/"+this.devices.productid+"/"+this.devices.devicedevaddr),a=this;d["Websocket"].add_hook(t,(function(e){r.session.getLength()>=1e3?h="":h+=a.nowtime()+e+"\n",r.setValue(h),r.gotoLine(r.session.getLength())}));var i=JSON.stringify({action:"start_logger"});d["Websocket"].subscribe(e,(function(t){if(t.result){dgiotlog.log(e),dgiotlog.log("订阅成功");var o={topic:"channel/"+a.devices.subtopic+"/"+a.devices.productid+"/"+a.devices.devicedevaddr,text:i,retained:!0,qos:2};d["Websocket"].sendMessage(o),a.subdialogtimer=window.setInterval((function(){d["Websocket"].sendMessage(o)}),6e5)}}))},addMessage:function(){this.messageDialogVisible=!0,setTimeout((function(){s=ace.edit("message"),s.session.setMode("ace/mode/json"),s.setTheme("ace/theme/eclipse"),s.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),r=ace.edit("subprodevice"),r.session.setMode("ace/mode/text"),r.setTheme("ace/theme/gob"),r.setOptions({enableBasicAutocompletion:!1,enableSnippets:!0,enableLiveAutocompletion:!0})}))},selectMessage:function(e){var t=this;this.dataslist.map((function(a){a.objectId==e&&(i.setValue(JSON.stringify(a.data.commond)),t.detaildatas=JSON.parse(JSON.stringify(a.data)))}))},sendMessage1:function(){if(""!=this.editor1.function){0==this.sendindex&&this.subTopic();var e=this,t={topic:"thing/"+e.devices.productid+"/"+e.devices.devicedevaddr,text:i.getValue(),retained:!0,qos:2};d["Websocket"].sendMessage(t)}else this.$message("请挑选调试功能")},addCmd:function(){var e=this;""!=this.messageform.name?""!=s.getValue()?Object(u["getProduct"])(this.devices.productid).then((function(t){if(t){var a={};a=Object(l["a"])(Object(l["a"])({},a),JSON.parse(s.getValue()));var i={};i.name=e.messageform.name,i.type=t.devType,i.productid=t.objectId,i.commond=a;var o={ACL:t.ACL,data:i,type:"CMD"};Object(p["postDict"])(o).then((function(t){t&&(e.$message("创建成功"),e.messageDialogVisible=!1,e.getDict())})).catch((function(e){dgiotlog.log("postDict ",e.error)}))}})).catch((function(e){dgiotlog.log("getProduct ",e.error)})):this.$message("请输入功能"):this.$message("请输入功能名称")},getDict:function(){var e=this,t={limit:100,where:{type:"CMD","data.productid":this.devices.productid}};Object(p["queryDict"])(t).then((function(t){t&&(e.dataslist=t.results)})).catch((function(e){dgiotlog.log("queryDict ",e.error)}))},isInterval:function(e){var t="",a=this;t=0==e?JSON.stringify({action:"stop_logger"}):JSON.stringify({action:"start_logger"});var i={topic:"channel/"+a.devices.subtopic+"/"+a.devices.productid+"/"+a.devices.devicedevaddr,text:t,retained:!0,qos:2};d["Websocket"].sendMessage(i)},sendTrueInterval:function(){var e=this,t=JSON.stringify({action:"start_logger"}),a={topic:"channel/"+e.devices.subtopic+"/"+e.devices.productid+"/"+e.devices.devicedevaddr,text:t,retained:!0,qos:2};d["Websocket"].sendMessage(a)},clearTopic:function(){r.setValue(""),h=""},loadmore:function(){this.formData.pageIndex++,this.selsectProduct(this.productid)},deleteMessage:function(){var e=this;Object(p["delDict"])(this.editor1.function).then((function(t){t&&(e.$message("删除成功"),e.getDict(),e.editor1.function="",i.setValue(""))})).catch((function(e){dgiotlog.log("delDict ",e.error)}))},editorMessage:function(){var e=this;this.detaildatas.commond=JSON.parse(i.getValue());var t={data:this.detaildatas};Object(p["putDict"])(this.editor1.function,t).then((function(t){t&&(e.$message("编辑成功"),e.getDict())})).catch((function(e){dgiotlog.log("putDict "+e.error)}))},getProduct:function(){var e=this,t={limit:100};Object(u["queryProduct"])(t).then((function(t){e.productlist=t.results,e.devices.productid=e.$route.query.productid,e.getDevices(e.devices.productid,!0),e.getChannel(e.devices.productid),e.getDict()})).catch((function(e){dgiotlog.log("queryProduct ",e.error)}))},getChannel:function(e){var t=this,a="1",i={__type:"Pointer",className:"Product",objectId:e};Object(m["getChannelCountByProduct"])(this.channellength,this.channelstart,i,a).then((function(e){e.count>0?(t.channellist=e.results,t.devices.subtopic=e.results[0].objectId):(t.channellist={},t.devices.subtopic="")})).catch((function(e){dgiotlog.log(e),t.$baseMessage("请求出错",e.error,3e3)}))},getDevices:function(e,t){var a=this,i={limit:this.formData.pageSize,skip:(this.formData.pageIndex-1)*this.formData.pageSize,count:"objectId",include:"product",where:{product:e}};this.$queryDevice(i).then((function(e){e.count>0&&(a.devicelist=e.results,a.devices.devicedevaddr=e.results[0].devaddr),t&&(a.devices.devicedevaddr=a.$route.query.deviceid)})).catch((function(e){dgiotlog.log(e),a.$baseMessage("请求出错",e.error,3e3)}))},selsectProduct:function(e){this.formData.pageIndex=1,this.devicelist=[],this.devices.productid=e,this.devices.devicedevaddr="",this.getDevices(e),this.getChannel(e)},functionClick:function(){this.primary1=3,setTimeout((function(){o=ace.edit("editor2"),o.session.setMode("ace/mode/json"),o.setTheme("ace/theme/eclipse"),o.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0})}),300)}}},f=g,b=(a("bb09"),a("bdd7")),v=Object(b["a"])(f,n,c,!1,null,"6dcb276a",null);t["default"]=v.exports},4095:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"gateway"},[a("el-card",{staticClass:"wayheader",attrs:{shadow:"always"}},[a("div",{staticClass:"wayheaderone"},[a("span",{staticClass:"oneheader"},[e._v("网络设备")]),a("span",{staticClass:"twoheader"},[e._v("网络层级:"+e._s(e.cengji))]),a("span",{staticClass:"threeheader"})])])],1)},o=[],r={data:function(){return{cengji:2}},mounted:function(){},methods:{}},s=r,n=(a("1c75"),a("bdd7")),c=Object(n["a"])(s,i,o,!1,null,"421e4474",null);t["default"]=c.exports},4113:function(e,t,a){},5887:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"devproduct"},[a("div",{staticClass:"prosecond"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline,size:"small"}},[a("el-form-item",[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("product.searchproductname")},model:{value:e.formInline.productname,callback:function(t){e.$set(e.formInline,"productname",t)},expression:"formInline.productname"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.searchProduct(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1),a("el-form-item",{staticStyle:{float:"right","text-align":"right"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:""!=e.projectid,expression:"projectid != ''"}],attrs:{type:"primary"},on:{click:e.addproduct}},[e._v(" "+e._s(e.$translateTitle("product.createproduct"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addgroup.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("product.newlyadded"))+" ")])],1)],1),a("div",{staticClass:"protable"},[a("el-table",{staticStyle:{width:"100%"},attrs:{"cell-style":{"text-align":"center"},data:e.groupData,"header-cell-style":{"text-align":"center"}}},[a("el-table-column",{attrs:{label:"ProductID",prop:"objectId"}}),a("el-table-column",{attrs:{label:e.$translateTitle("product.productname")},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(i.name))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.productgrouping")},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(i.devType))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.nodetype")},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[1==i.nodeType?a("span",[e._v(" "+e._s(e.$translateTitle("product.gateway"))+" ")]):e._e(),0==i.nodeType?a("span",[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]):e._e(),2==i.nodeType?a("span",[e._v(" "+e._s(e.$translateTitle("product.grouping"))+" ")]):e._e()]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.classification")},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(i.category.name))])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.addingtime"),prop:"row.createdAt","show-overflow-tooltip":"",sortable:"",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(e.utc2beijing(i.createdAt)))])]}}])}),a("el-table-column",{attrs:{fixed:"right",label:e.$translateTitle("developer.operation"),width:"420"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row,o=t.$index;return[a("el-button",{attrs:{size:"mini",type:"primary",underline:!1},on:{click:function(t){return e.deviceToDetail(i)}}},[e._v(" "+e._s(e.$translateTitle("product.config"))+" ")]),a("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.goKonva(i.objectId)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.konva"))+" ")]),a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.GoTodevices(i)}}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]),a("el-popover",{ref:"popover-"+o,staticStyle:{"margin-left":"10px"},attrs:{placement:"top"}},[a("p",[e._v(" "+e._s(e.$translateTitle("product.qdsczg"))+e._s(i.name)+e._s(e.$translateTitle("equipment.cpm"))+" ")]),a("div",{staticStyle:{margin:"0","text-align":"right"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){i._self.$refs["popover-"+o].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.makeSure(i)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),a("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)]}}])})],1)],1),a("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":e.length,"page-sizes":[10,20,30,50],total:e.total},on:{"current-change":e.productCurrentChange,"size-change":e.productSizeChange}})],1)],1),a("div",{staticClass:"prodialog"},[a("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose,"close-on-click-modal":!1,title:e.$translateTitle("product.createproduct"),top:"5vh",visible:e.dialogFormVisible,width:"50%"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",{staticClass:"content"},[a("div",{staticClass:"contentone"},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(e._s(e.$translateTitle("product.productinformation")))]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"name"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.productgrouping"),prop:"devType"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.devType,callback:function(t){e.$set(e.form,"devType",t)},expression:"form.devType"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.classification")}},[a("el-cascader",{attrs:{options:e.categoryListOptions},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("application.applicationtype"),rules:[{required:!0,message:"请选择所属应用",trigger:"blur"}]}},[a("el-select",{attrs:{disabled:""},on:{change:e.selectApp},model:{value:e.form.relationApp,callback:function(t){e.$set(e.form,"relationApp",t)},expression:"form.relationApp"}},e._l(e.allApps,(function(e,t){return a("el-option",{key:t,attrs:{label:e.title,value:e.title}})})),1)],1)],1)],1),a("div",{staticClass:"contenttwo",staticStyle:{"margin-top":"20px"}},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(e._s(e.$translateTitle("product.nodetype")))]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.nodetype"),prop:"nodeType"}},[a("el-radio-group",{on:{change:e.changeNode},model:{value:e.form.nodeType,callback:function(t){e.$set(e.form,"nodeType",t)},expression:"form.nodeType"}},[a("el-radio",{attrs:{label:0}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]),a("el-radio",{attrs:{label:1}},[e._v(" "+e._s(e.$translateTitle("product.gateway"))+" ")]),a("el-radio",{attrs:{label:2}},[e._v(" "+e._s(e.$translateTitle("product.grouping"))+" ")])],1)],1)],1)],1),a("div",{staticClass:"contentthird",staticStyle:{"margin-top":"20px"}},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(" "+e._s(e.$translateTitle("product.networkinganddescription"))+" ")]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.networking")+"(共"+e.channel.length+"项)",prop:"netType"}},[a("el-select",{attrs:{placeholder:e.$translateTitle("product.selectgateway")},model:{value:e.form.netType,callback:function(t){e.$set(e.form,"netType",t)},expression:"form.netType"}},e._l(e.channel,(function(e,t){return a("el-option",{key:t,attrs:{label:t+1+":"+e.label,title:"当前第"+(t+1)+"项",value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.productmodel")}},[e.imageUrl?a("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):a("i",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"el-icon-plus avatar-uploader-icon"}),a("form",{ref:"uploadform",staticStyle:{position:"absolute"},attrs:{enctype:"multipart/form-data",method:"POST"}},[a("input",{staticStyle:{position:"relative",top:"-100px","z-index":"5",width:"100px",height:"100px",cursor:"pointer",opacity:"0"},attrs:{type:"file"},on:{change:function(t){return e.upload(t)}}})]),e.imageUrl?a("el-button",{staticStyle:{"vertical-align":"text-bottom"},attrs:{size:"mini",type:"danger"},on:{click:e.deleteImgsrc}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]):e._e()],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.describe"),prop:"desc"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1)],1)]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)])],1),a("div",{staticClass:"add-group"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("developer.newvirtualgroup"),visible:e.groupform,width:"30%"},on:{"update:visible":function(t){e.groupform=t}}},[a("el-form",{ref:"addGroup",staticClass:"demo-ruleForm",attrs:{"label-width":"80px",model:e.addGroup}},[a("el-row",[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:e.$translateTitle("developer.groupname"),prop:"name",rules:[{required:!0,message:e.$translateTitle("developer.cannotbeempty")}]}})],1),a("el-col",{attrs:{span:18}},[a("el-input",{attrs:{autocomplete:"off",type:"text"},model:{value:e.addGroup.name,callback:function(t){e.$set(e.addGroup,"name",t)},expression:"addGroup.name"}})],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addDeviceGroup()}}},[e._v(" "+e._s(e.$translateTitle("product.newlyadded"))+" ")]),a("el-button",{on:{click:function(t){return e.resetForm()}}},[e._v(" "+e._s(e.$translateTitle("zetadevices.reset"))+" ")])],1)],1)],1),a("div",{staticClass:"import-dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("product.importpro"),visible:e.importDialogShow,width:"25%"},on:{"update:visible":function(t){e.importDialogShow=t}}},[a("el-form",{ref:"uploadProForm",attrs:{model:e.formPro}},[a("el-upload",{ref:"fileUpload",staticClass:"upload-demo",attrs:{accept:".xls, .xlsx, .zip",action:e.uploadAction,"auto-upload":!1,data:e.uploadData,"file-list":e.fileList,headers:e.uploadHeaders,"on-change":e.handleChange,"on-error":e.handleUploadError,"on-success":e.handleUploadSuccess,"with-credentials":!0}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v(" "+e._s(e.$translateTitle("application.selectfiles"))+" ")])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-left",attrs:{size:"small",type:"primary"},on:{click:e.submitUpload}},[e._v(" "+e._s(e.$translateTitle("application.upload"))+" ")]),a("el-button",{staticClass:"btn-right",attrs:{size:"small"},on:{click:function(t){e.importDialogShow=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)],1)],1)])},o=[],r=a("fb07"),s=a("d0d7"),n=a.n(s),c=(a("16b8"),a("04d6"),a("a0e0"),a("3dec"),a("1d17"),a("4c87"),a("b463"),a("a44e"),a("4ccb"),a("3559"),a("d06e"),a("b340"),a("6924"),a("472c"),a("256c"),a("de71"),a("7876"),a("37a7"),a("d2d8"),a("e2e1"),a("2c1e"),a("26c7"),a("ee7e"),a("f05b"),a("6a4d"),a("11de"),a("172c"),a("0c75"),a("69a3"),a("d30f"),a("3b7f"),a("aadd"),a("98da"),a("c4bc"),a("f1e1"),a("7212")),l=a("5da9"),d=a("1285"),u=a("7497"),p=a("e0e9"),m=a("d0fd"),h=a("be65"),g=a.n(h),f=a("5638"),b={data:function(){return{category:[],hashkey:"",addGroup:{name:""},groupform:!1,length:10,total:0,start:0,activeName:"first",formInline:{productname:""},uploadHeaders:{sessionToken:g.a.get("access_token")},uploadAction:"",uploadData:{},fileList:[],productIdentifier:"",groupData:[],formLabelWidth:"80px",dialogFormVisible:!1,importDialogShow:!1,form:{name:"",category:[],nodeType:0,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},formPro:{name:"",url:""},rules:{roles:[{required:!0,message:"请选择所属应用",trigger:"blur"}],name:[{required:!0,message:"请输入产品",trigger:"blur"}],devType:[{required:!0,message:"请输入产品标识，用于区分不同设备",trigger:"blur"}],category:[{required:!0,message:"请选择所属分类",trigger:"change"}],nodeType:[{required:!0,message:"请选择节点类型",trigger:"change"}],netType:[{required:!0,message:"请选择联网方式",trigger:"change"}],relationApp:[{required:!0,message:"请选择产品可见角色",trigger:"change"}]},option:[],ruleoptions:[],channel:[{label:"蜂窝(2G/3G/4G)(直连)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道(直连)",value:"5G"},{label:"WIFI通道(直连)",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"Modbus",value:"Modbus"},{label:"LoRa(WAN)(直连)",value:"LoRaWAN"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接(直连)",value:"网线连接"},{label:"自定义",value:"OTHER"}],imageUrl:"",productid:"",loading:!1,allApps:[],categoryList:[],categoryListOptions:[],fileServer:"",access_token:"",projectid:"",projectName:"",allTableDate:[]}},computed:{},mounted:function(){this.Industry(),this.searchProduct(0)},beforeDestroy:function(){this.projectName=""},methods:{addDeviceGroup:function(){var e=this;this.$refs["addGroup"].validate((function(t){if(!t)return!1;Object(f["addGroup"])(e.addGroup.name).then((function(t){e.$message({message:"新建设备分组成功",type:"success"}),e.searchProduct(),e.groupform=!1})).catch((function(t){e.$message({message:"新建设备分组失败"+t.computed,type:"error"}),e.groupform=!1}))}))},resetForm:function(){this.$refs["addGroup"].resetFields()},changeNode:function(e,t){0!=t&&(this.form.netType=""),this.channel=0==e?[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道",value:"5G"},{label:"WIFI通道",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"LoRa(WAN)",value:"LoRaWAN"},{label:"Modbus",value:"Modbus"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接",value:"网线连接"},{label:"自定义",value:"OTHER"}]:[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"5G通道",value:"5G"},{label:"WIFI通道",value:"WIFI"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"LoRaWAN",value:"LoRaWAN"},{label:"网线连接",value:"网线连接"},{label:"自定义",value:"OTHER"}]},selectApp:function(e){var t=this;e&&Object(l["getRole"])(e).then((function(e){e&&(t.fileServer=e.file,t.access_token=e.access_token)}))},treeData:function(e){var t=JSON.parse(JSON.stringify(e));return t.filter((function(e){var a=t.filter((function(t){return e.id==t.parentid}));return a.length>0&&(e.children=a),0==e.parentid}))},deleteImgsrc:function(){event.stopPropagation(),this.imageUrl=""},upload:function(e){if(this.loading=!0,e){var t=e.target.files[0],a=t.name,i=e.target.files[0].type,o=(t.type.split("/")[0],"image/jpeg"===i||"image/JPEG"===i||"image/png"===i||"image/PNG"===i||"image/bpm"===i||"image/BPM"===i);if(!o)return this.$message({message:"请上传图片",type:"error"}),!1;var r=new FileReader;r.readAsDataURL(t);var s=this;r.onloadend=function(){var e=r.result,t=s.dataURItoBlob(e);s.uploadFile(t,a)}}},dataURItoBlob:function(e){for(var t=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),o=new Uint8Array(i),r=0;r<t.length;r++)o[r]=t.charCodeAt(r);return new Blob([i],{type:a})},uploadFile:function(e,t){var a=this,i=new FormData;i.append("file",e,t),i.append("output","json"),i.append("path",this.form.relationApp),i.append("auth_token",this.access_token);this.$http.post(this.fileServer,i).then((function(e){e&&(a.imageUrl=e.body.url,a.loading=!1)})).catch((function(e){a.loading=!1,a.$message(e.bodyText)}))},submitUpload:function(){var e=this;this.uploadAction="/product",this.$nextTick((function(){e.uploadData.appid=g.a.get("appids"),e.$refs.fileUpload.submit()}))},handleUploadSuccess:function(e,t,a){this.$message({type:"success",message:"产品导入成功"}),this.importDialogShow=!1,this.$refs["uploadProForm"].resetFields(),this.searchProduct()},handleUploadError:function(e,t,a){this.$message({showClose:!0,message:e})},handleChange:function(e,t){t.length>0&&(this.fileList=[t[t.length-1]])},utc2beijing:function(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},getDict:function(e,t){return Object(r["a"])(n.a.mark((function e(){var t,a;return n.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={limit:1e3,where:{"data.key":"category"}},e.next=3,Object(p["queryDict"])(t);case 3:a=e.sent,a.results;case 5:case"end":return e.stop()}}),e)})))()},searchProduct:function(e){var t=this;return Object(r["a"])(n.a.mark((function a(){var i,o,r,s;return n.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return 0==e&&(t.start=0),i={order:"-updatedAt",skip:t.start,limit:t.length,include:"category",where:{nodeType:"2",name:t.formInline.productname.length?{$regex:t.formInline.productname}:{$ne:null}}},a.next=4,Object(c["queryProduct"])(i);case 4:return o=a.sent,r=o.results,t.groupData=r,t.total=t.groupData.length,a.next=10,Object(l["queryRole"])({limit:100});case 10:s=a.sent,t.allApps=s.results;case 12:case"end":return a.stop()}}),a)})))()},handleClose:function(){this.dialogFormVisible=!1},addproduct:function(){this.dialogFormVisible=!0},addgroup:function(){this.groupform=!0},getParent:function(e,t,a){var i=this;return t.map((function(o){e==o.id?(a.unshift(o.value),i.getParent(o.parentid,t,a)):0==o.parentid&&o.id==e&&a.unshift(o.value)})),this.form.category=a,a},getIndustryParent:function(e,t){var a=this;t.map((function(i){i.value==e&&a.getParent(i.id,t,[])}))},editorProduct:function(e){for(var t in this.form.relationApp="",this.dialogFormVisible=!0,this.productid=e.id,this.getIndustryParent(e.attributes.category,this.categoryList),this.form.desc=e.attributes.desc,this.form.name=e.attributes.name,this.form.nodeType=e.attributes.nodeType,this.form.netType=e.attributes.netType,this.form.devType=e.attributes.devType,this.form.productSecret=e.attributes.productSecret,this.changeNode(e.attributes.nodeType,0),e.attributes.icon&&(this.imageUrl=e.attributes.icon),e.attributes.ACL.permissionsById)this.form.relationApp=t?t.substr(5):"";this.selectApp(this.form.relationApp)},Industry:function(){var e=this;return Object(r["a"])(n.a.mark((function t(){var a,i,o;return n.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.categoryList=[],a={limit:1e3,where:{"data.key":"category"}},t.next=4,Object(p["queryDict"])(a);case 4:i=t.sent,o=i.results,o.map((function(t){var a={};a.value=t.type,a.label=t.data.CategoryName,a.id=t.data.Id,a.parentid=t.data.SuperId,e.categoryList.push(a)})),e.categoryListOptions=e.treeData(e.categoryList);case 8:case"end":return t.stop()}}),t)})))()},submitForm:function(e){},resetProductForm:function(){this.form={name:"",category:[],nodeType:0,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},this.imageUrl=""},deviceToDetail:function(e){this.$router.push({path:"/roles/detailproduct",query:{id:e.objectId}})},goKonva:function(e){this.$router.push({path:"/Topo?productid",query:{productid:e}})},GoTodevices:function(e){this.$router.push({path:"/roles/thing",query:{productid:e.objectId}})},makeSure:function(e){var t=this,a={count:"objectId",skip:0,limit:1,where:{product:e.objectId}};Object(d["queryDevice"])(a).then((function(a){a.count>0?t.$message("请先删除该产品下设备"):Object(c["getProduct"])(e.objectId).then((function(a){Object(c["delProduct"])(e.objectId).then((function(a){a&&(t.$message({type:"success",message:"删除成功"}),e._self.$refs["popover-".concat($index)].doClose(),t.searchProduct())})).catch((function(e){dgiotlog.log("delProduct ",e.error)}))})).catch((function(e){dgiotlog.log("getProduct ",e.error)}))})).catch((function(e){dgiotlog.log("queryDevice ",e.error)}))},productSizeChange:function(e){this.length=e,this.searchProduct()},productCurrentChange:function(e){this.start=(e-1)*this.length,this.searchProduct()},blackDict:function(e,t){var a=this;return Object(r["a"])(n.a.mark((function i(){var o,r;return n.a.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return o={data:t,key:e,type:"Product"},i.next=3,Object(p["postDict"])(o);case 3:r=i.sent,r?a.$message({type:"success",message:"备份成功"}):a.$message({type:"error",message:"备份失败"});case 5:case"end":return i.stop()}}),i)})))()},CloneData:function(e){var t=this;return Object(r["a"])(n.a.mark((function a(){var i,o,r,s;return n.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i={category:e.attributes.category,devType:e.attributes.devType,name:e.attributes.name,thing:e.attributes.thing},a.next=3,Object(u["getHashClass"])("Product",i);case 3:o=a.sent,r=o.objectId,s=o.code,200==s&&t.blackDict(r,i);case 7:case"end":return a.stop()}}),a)})))()},proudctClone:function(e){var t=this;return Object(r["a"])(n.a.mark((function a(){var i,o;return n.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:e.attributes.config.cloneState=!0,i=e,o=Object(c["putProduct"])(e.id,i),o&&t.CloneData(e);case 4:case"end":return a.stop()}}),a)})))()},proudctEdit:function(e){var t=window.location.origin+"/spa",a="production";t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var i="".concat(t,"/#?drawProudctid=").concat(e.objectId,"&proudctid=").concat(e.objectId);localStorage.setItem("rowId",e.objectId),window.open(i,"__blank")},proudctView:function(e){var t=window.location.origin+"/spa",a="production";t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var i="".concat(t,"/#/views/").concat(e.objectId);window.open(i,"__blank")},exportpro:function(){this.allTableDate?Object(m["export_txt_to_zip"])(JSON.stringify(this.allTableDate),"Dict","Dict"):this.$message({type:"warning",message:"数据为空,无法导出"})}}},v=b,y=(a("9763"),a("a73e"),a("bdd7")),w=Object(y["a"])(v,i,o,!1,null,"0c26d424",null);t["default"]=w.exports},"655c":function(e,t,a){},"68d7":function(e,t,a){"use strict";var i=a("fb07"),o=a("e97b"),r=(a("f1e1"),a("16b8"),a("d6a4"),a("3dec"),a("9c6a"),a("79da"),a("c4bc"),a("0c40"),a("04d6"),a("d0d7")),s=a.n(r),n=a("c4e6"),c=a("59ef"),l=a("c26ac"),d=a("5880"),u=a("1285"),p=a("7dd9"),m=a("ca7b"),h=[{title:"图片",width:120,dataIndex:"imgurl",fixed:"left",key:"imgurl",scopedSlots:{customRender:"imgurl"}},{title:"时间",dataIndex:"time",key:"time"},{title:"名称",dataIndex:"name",key:"name"},{title:"值",dataIndex:"number",key:"number"},{title:"单位",dataIndex:"unit",key:"unit"}],g={components:{Instruct:p["default"],info:n["default"],deviceLog:l["default"],SceneLog:c["default"]},filters:{filterVal:function(e){return e||0==e?e:"--"}},directives:{"el-select-loadmore":{bind:function(e,t){var a=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");a.addEventListener("scroll",(function(){var e=this.scrollHeight-this.scrollTop<=this.clientHeight;e&&t.value()}))}}},data:function(){return this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40}},this.toolbox={orient:"vertical",right:-5,feature:{dataZoom:{yAxisIndex:"none"},magicType:{type:["line","bar","histogram","pie","ring","waterfall","funnel","radar","heatmap","scatter","candle","stack"]},dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0},restore:{show:!0}}},{mapCenter:{lng:116.404,lat:39.915},mapLabel:{content:"",style:{color:"red",fontSize:"24px"},position:{lng:116.404,lat:39.915},title:""},router:"",chartKey:moment(new Date).valueOf(),machinelist:{},thirdtbKey:moment(new Date).valueOf(),deviceInfo:{},columns:h,productId:this.$route.query.productid,activeNames:["1"],queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20},buttonactive:1,loading:!0,xl:6,xs:24,sm:24,md:12,dataEmpty:!0,chartDataZoom:[{type:"slider"}],pickerOptions:{shortcuts:[{text:this.$translateTitle("developer.LastWeek"),onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:this.$translateTitle("developer.LastMonth"),onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:this.$translateTitle("developer.LastThreeMonths"),onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]},pickerOptionsDay:{shortcuts:[{text:this.$translateTitle("developer.today"),onClick:function(e){e.$emit("pick",new Date)}},{text:this.$translateTitle("developer.yesterday"),onClick:function(e){var t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:this.$translateTitle("developer.A week ago"),onClick:function(e){var t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},chartData:{identifier:[],columns:[],rows:[]},params:{_function:"last",style:"",number:1,interval:"h",datetimerange:"",keys:"*",limit:100,endTime:new Date,startTime:(new Date).getTime()-6048e5},interval:[{type:"y",name:"年"},{type:"n",name:"月"},{type:"w",name:"周"},{type:"d",name:"日"},{type:"h",name:"时"},{type:"m",name:"分"},{type:"s",name:"秒"},{type:"a",name:"毫秒"},{type:"u",name:"微秒"}],functionarr:["count","avg","sum","stddev","min","max","first","last"],disabledChart:["map","sankey","wordcloud","liquidfill","tree","gauge"],chartType:m["default"],options:[{value:"选项1",label:"黄金糕"},{value:"选项2",label:"双皮奶"},{value:"选项3",label:"蚵仔煎"},{value:"选项4",label:"龙须面"},{value:"选项5",label:"北京烤鸭"}],value:"",chartSettings:{},queryFlag:!0,width:0,lineChartData:"",datafordetail:[],datadialogVisible:!1,childDialog:!1,ninthform:{product:"",devices:""},wmxform:{product:"",devices:""},tableData:[],activeName:"first",text:"1111111",deviceid:"",topicData:[],thirdstart:1,thirdlength:10,thirdtotal:0,topic:[{topic:"thing/${ProductId}/${DevAddr}/post",type:"pub",desc:"设备上报",isdef:!0},{topic:"thing/${ProductId}/${DevAddr}",type:"sub",desc:"消息下发",isdef:!0}],thirdData:[],thirdDatas:[],ispushdata:!0,timer:null,isshowtable:!1,childrendevices:{devicesname:""},multipleTable:[],devicesTableData:[],childrenDeviceLength:10,childrenDeviceStart:0,childrenDeviceTotal:0,childrenForm:{product:"",device:"",route:""},isshowchild:!1,allProudct:[],productDevices:[],ischange:!1,ischildren:!1,productid:"",dataDeviceTotal:0,dataDeviceLength:10,dataDeviceStart:1,devicedevaddr:"",dirstart:1,dirlength:20,selectproduct:"",watchNum:0}},computed:Object(o["a"])({},Object(d["mapGetters"])({Device:"settings/device"})),watch:{sm:function(e){var t=this;this.$nextTick((function(e){t.resizeTheChart(),setTimeout((function(){t.loading=!1}),2e3)}))}},mounted:function(){this.setTreeFlag(!1),this.params.style=this.chartType[0].type,console.log(" this.params.style",this.params.style),this.subtopic="thing/".concat(this.$route.query.deviceid,"/realtimedata/post"),this.router=this.$dgiotBus.router(location.href+this.$route.fullPath),this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.$route.query.deviceid&&(this.subRealtimedata(),this.deviceid=this.$route.query.deviceid,this.initChart(),this.getDeviceInfo(this.deviceid),window.addEventListener("resize",this.resizeTheChart))},destroyed:function(){this.Unbscribe()},beforeDestroy:function(){window.removeEventListener("resize",this.resizeTheChart),this.Unbscribe()},methods:Object(o["a"])(Object(o["a"])({subRealtimedata:function(){var e=this;return Object(i["a"])(s.a.mark((function t(){return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:try{e.$dgiotBus.$emit("MqttSubscribe",{router:e.router,topic:e.subtopic,qos:0,ttl:108e5}),console.groupCollapsed("%c mqtt 订阅日志","color:#009a61; font-size: 28px; font-weight: 300"),console.log("topic:",e.subtopic),console.log("router:",e.router),console.groupEnd(),e.$dgiotBus.$off(e.topicKey),e.$dgiotBus.$on(e.topicKey,(function(t){console.groupCollapsed("%c mqttMsg消息回调","color:#009a61; font-size: 28px; font-weight: 300"),console.log(t),console.log(Base64.decode(t.payload)),console.log(JSON.parse(Base64.decode(t.payload)).data),console.log("Base64.decode(payload):",Base64.decode(t.payload)),console.groupEnd();var a=JSON.parse(Base64.decode(t.payload)),i=a.data,o=void 0===i?[]:i;o?e.renderCard(o):e.getCardDevice()}))}catch(error){console.log(error),e.$baseMessage(e.$translateTitle("alert.Data request error")+"".concat(error),"error","vab-hey-message-error")}case 1:case"end":return t.stop()}}),t)})))()}},Object(d["mapActions"])({setTreeFlag:"settings/setTreeFlag"})),{},{Unbscribe:function(){console.error("Unbscribe");var e="logger_trace/trace/"+this.deviceInfo.objectId+"/#",t=this.$dgiotBus.topicKey(this.router,e);this.$dgiotBus.$emit("MqttUnbscribe",t,e),this.$dgiotBus.$emit("MqttUnbscribe",this.topicKey,this.subtopic)},getDeviceInfo:function(e){var t=this;return Object(i["a"])(s.a.mark((function a(){var i,o,r,n,c,l,d,p,m,h;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,n=t.$baseColorfullLoading(),a.next=4,Object(u["getDevice"])(e);case 4:c=a.sent,l="",l=null!==c&&void 0!==c&&null!==(i=c.product)&&void 0!==i&&i.objectId?c.product.objectId:"",d=c.devaddr,p=[{topic:"thing/".concat(l,"/").concat(d,"/post"),type:"pub",desc:"设备上报",isdef:!0},{topic:"thing/".concat(l,"/").concat(d),type:"sub",desc:"消息下发",isdef:!0}],c.product.topics?c.topicData=c.product.topics.concat(p):c.topicData=p,t.deviceInfo=c,null!==(o=t.deviceInfo)&&void 0!==o&&null!==(r=o.location)&&void 0!==r&&r.latitude&&(t.mapLabel={content:c.name,style:{color:"red",fontSize:"24px"},position:{lng:null!==(m=Number(c.location.longitude))&&void 0!==m?m:116.404,lat:null!==(h=Number(c.location.latitude))&&void 0!==h?h:39.915},title:c.name},t.mapCenter=t.mapLabel.position,console.info("this.mapLabel\n",t.mapLabel)),t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),n.close(),a.next=20;break;case 16:a.prev=16,a.t0=a["catch"](0),console.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 20:case"end":return a.stop()}}),a,null,[[0,16]])})))()},toggleChart:function(e){this.chartKey=moment(new Date).valueOf(),this.loading=!1,dgiotlog.log(e),this.chartExtend={},this.chartDataZoom=[];var t=["funnel","radar","radar"];-1!=t.indexOf(e)?(this.chartExtend={},this.chartDataZoom=[]):(this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40},yAxis:[{type:"value",axisLabel:{formatter:"{value} %"}}]},this.chartDataZoom=[{type:"slider"}]),this.resizeTheChart()},resizeTheChart:function(){var e=this.$refs["charts"];e instanceof Array?(e.forEach((function(e){e.$children[0].resize()})),dgiotlog.log("重绘完成",e)):e.$children[0].resize()},toggleCardRow:function(e,t,a,i,o){this.sm=24==a?12:24,this.md=12==i?24:12,this.xl=6==o?12:6,this.loading=!0},afterConfig:function(e){return e.tooltip.showDelay=500,e},initChart:function(){var e=this,t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),this.params.datetimerange=[a,t],this.queryFlag=!1,this.$queryProduct({}).then((function(t){e.allProudct=t.results}))},queryChart:function(){var e=this;return Object(i["a"])(s.a.mark((function t(){var a,i,o,r,n,c,l,d,p,m,h;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.chartData={identifier:[],columns:[],rows:[]},!e.params.startTime||!e.params.endTime){t.next=12;break}return e.$baseColorfullLoading(1,e.$translateTitle("home.messag_loding")),a=e.$route.query.deviceid,dgiotlog.log("endTime",m),dgiotlog.log("startTime",p),i=e.params,o=i.interval,r=i.keys,n=i.limit,c=i.number,l=i.style,d=i._function,p=i.startTime,m=i.endTime,h={starttime:moment(p).valueOf(),endtime:moment(m).valueOf(),interval:c+o,keys:r,limit:n,function:d,style:l},t.next=10,Object(u["getDabDevice"])(a,h).then((function(t){if(e.$baseColorfullLoading().close(),dgiotlog.log(t,"res charts"),null!==t&&void 0!==t&&t.chartData){var a=t.chartData,i=void 0===a?{}:a;e.chartData=i,e.$nextTick((function(){setTimeout((function(){e.loading=!0,e.toggleChart("line")}),1e3)}))}dgiotlog.log("this.chartData",e.chartData),e.loading=!1,e.dataEmpty=!1})).catch((function(t){dgiotlog.log(t),e.loading=!1,e.$baseColorfullLoading().close()}));case 10:t.next=13;break;case 12:e.$message.error(e.$translateTitle("developer.Please select the query Time"));case 13:case"end":return t.stop()}}),t)})))()},print:function(e){dgiotlog.log(e)},tabHandleClick:function(e){switch(this.$dgiotBus.$emit("MqttUnbscribe",this.topicKey,this.subtopic),e.name){case"ninth":this.$router.push({path:"/roles/onlinetest",query:{deviceid:this.devicedevaddr,productid:this.productid}});break;case"children":this.getDevices();break;case"third":this.queryChart();break;case"right":this.toggleClass("rightrow");break;case"task":this.$refs.SceneLog.get_topic();break;case"first1":this.subRealtimedata(),this.getCardDevice();break}},timestampToTime:function(e){var t=new Date(1e3*e),a=t.getFullYear()+"-",i=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",o=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",r=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",s=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",n=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return a+i+o+r+s+n},getDevices:function(e){var t=this;0==e&&(this.childrenDeviceStart=0),this.devicesTableData=[];var a={limit:this.childrenDeviceLength,skip:this.childrenDeviceStart,count:"objectId",include:"product",where:{parentId:this.deviceInfo.objectId}};""!=this.childrendevices.devicesname&&(a.where.devaddr=this.childrendevices.devicesname),dgiotlog.log("this.params",a),this.$queryDevice(a).then((function(e){t.childrenDeviceTotal=e.count,e.results&&e.results.map((function(e){var a={};a.objectId=e.objectId,a.name=e.name,a.status=e.status,a.originstatus=e.status,a.nodeType=e.product.nodeType,a.productName=e.product.name,a.devaddr=e.devaddr,a.isEnable=e.isEnable,a.route=e.route,t.devicesTableData.push(a)}))})).catch((function(e){dgiotlog.log(e),t.$baseMessage("请求出错11",e.error,3e3)}))},getCardDevice:function(){var e=this;Object(u["getCardDevice"])(e.deviceid).then((function(t){e.machinelist={},null!==t&&void 0!==t&&t.data&&e.renderCard(t.data)})).catch((function(e){dgiotlog.log("update error 清除timer",e)}))},renderCard:function(e){var t=this,a=[];e.forEach((function(e){e.devicetype&&a.push(e.devicetype)})),a=_.uniqBy(a);var i={};a.forEach((function(t){var a=[];e.forEach((function(e){t==e.devicetype&&a.push(e)})),i[t]=a})),t.machinelist=i,t.thirdtbKey=moment(new Date).valueOf()},dataDeviceSizeChange:function(e){this.dataDeviceStart=1},dataDeviceCurrentChange:function(e){this.dataDeviceStart=e},handleSizeChange1:function(e){this.thirdstart=1,this.thirdlength=e},handleCurrentChange1:function(e){this.thirdstart=e},DevicesSelectionChange:function(e){this.multipleTable=e},childrenDeviceCurrentChange:function(e){this.childrenDeviceStart=(e-1)*this.childrenDeviceLength,this.getDevices()},childrenDeviceSizeChange:function(e){this.childrenDeviceLength=e,this.getDevices()},checkProduct:function(e){var t=this;this.ischange=!0,this.selectproduct=e;var a={limit:this.dirlength,skip:(this.dirstart-1)*this.dirlength,count:"objectId",where:{product:e}};this.$queryDevice(a).then((function(e){e.results&&e.results.length>0?t.productDevices=e.results:t.productDevices=[],t.childrenForm.device=""}))},deviceToDetail:function(e){dgiotlog.log("row",e),this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,ischildren:"false"}})},loadmore:function(){this.dirstart++,this.checkProduct(this.selectproduct)},submitDevice:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return dgiotlog.log("error submit!!"),!1;var a={};a[t.deviceInfo.devaddr]=t.childrenForm.route;var i={parentId:{__type:"Pointer",className:"Device",objectId:t.deviceid},route:a};t.$putDevice(t.childrenForm.device,i).then((function(e){e&&(t.$message({type:"success",message:"添加成功"}),t.childDialog=!1,t.getDevices(),t.$refs["childrenForm"].resetFields())}))}))},deleteDevcie:function(e){var t=this;Promise.all([this.multipleTable.map((function(e){var a={parentId:null};t.$putDevice(e.objectId,a).then((function(e){}))}))]).then((function(e){e&&0!=e.length?(t.$message({message:"解除关联成功",type:"success"}),t.getDevices()):t.$message({message:"解除关联失败",type:"error"})})).catch((function(e){dgiotlog.log(e)}))},unactiveDevice:function(e){var t=this;Promise.all([this.multipleTable.map((function(e){var a={isEnable:!1};t.$putDevice(e.objectId,a).then((function(e){}))}))]).then((function(e){e&&0!=e.length?(t.$message({message:"禁用成功",type:"success"}),t.getDevices()):t.$message({message:"禁用失败",type:"error"})})).catch((function(e){dgiotlog.log(e)}))},activeDevice:function(e){var t=this;Promise.all([this.multipleTable.map((function(e){var a={isEnable:!0};t.$putDevice(e.objectId,a).then((function(e){}))}))]).then((function(e){e&&0!=e.length?(t.$message({message:"启用成功",type:"success"}),t.getDevices()):t.$message({message:"启用失败",type:"error"})})).catch((function(e){dgiotlog.log(e)}))},makeSure:function(e,t){var a=this,i=JSON.parse(JSON.stringify(row.route)),o=this.deviceInfo.devaddr;delete i[o];var r={parentId:null,route:i};this.$putDevice(row.objectId,r).then((function(i){i&&(a.$message({type:"success",message:"解除关联成功"}),e._self.$refs["popover-".concat(t)].doClose(),a.getDevices())}))},handelUpdate:function(e,t,a){var i=this,o={};for(var r in t)o[r]=t[r];o.isEnable=1!=o.isEnable,this.devicesTableData[a]=o,this.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e={};for(var a in t)e[a]=t[a];e.isEnable=1==e.isEnable;var o={isEnable:e.isEnable};i.$putDevice(t.objectId,o).then((function(e){i.$message({type:"success",message:"状态修改成功"})})),i.getDevices()})).catch((function(){i.$message({type:"info",message:"已取消修改"});var e=t;e.isEnable=1!=e.isEnable,i.devicesTableData[a]=e}))}})};t["a"]=g},7030:function(e,t,a){"use strict";a.r(t);var i=a("fb07"),o=a("e97b"),r=(a("f1e1"),a("16b8"),a("d6a4"),a("3dec"),a("9c6a"),a("79da"),a("c4bc"),a("0c40"),a("04d6"),a("d0d7")),s=a.n(r),n=a("c4e6"),c=a("59ef"),l=a("c26ac"),d=a("5880"),u=a("1285"),p=a("7dd9"),m=a("ca7b"),h=[{title:"图片",width:120,dataIndex:"imgurl",fixed:"left",key:"imgurl",scopedSlots:{customRender:"imgurl"}},{title:"时间",dataIndex:"time",key:"time"},{title:"名称",dataIndex:"name",key:"name"},{title:"值",dataIndex:"number",key:"number"},{title:"单位",dataIndex:"unit",key:"unit"}];t["default"]={components:{Instruct:p["default"],info:n["default"],deviceLog:l["default"],SceneLog:c["default"]},filters:{filterVal:function(e){return e||0==e?e:"--"}},directives:{"el-select-loadmore":{bind:function(e,t){var a=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");a.addEventListener("scroll",(function(){var e=this.scrollHeight-this.scrollTop<=this.clientHeight;e&&t.value()}))}}},data:function(){return this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40}},this.toolbox={orient:"vertical",right:-5,feature:{dataZoom:{yAxisIndex:"none"},magicType:{type:["line","bar","histogram","pie","ring","waterfall","funnel","radar","heatmap","scatter","candle","stack"]},dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0},restore:{show:!0}}},{mapCenter:{lng:116.404,lat:39.915},mapLabel:{content:"",style:{color:"red",fontSize:"24px"},position:{lng:116.404,lat:39.915},title:""},router:"",chartKey:moment(new Date).valueOf(),machinelist:{},thirdtbKey:moment(new Date).valueOf(),deviceInfo:{},columns:h,productId:this.$route.query.productid,activeNames:["1"],queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20},buttonactive:1,loading:!0,xl:6,xs:24,sm:24,md:12,dataEmpty:!0,chartDataZoom:[{type:"slider"}],pickerOptions:{shortcuts:[{text:this.$translateTitle("developer.LastWeek"),onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:this.$translateTitle("developer.LastMonth"),onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:this.$translateTitle("developer.LastThreeMonths"),onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]},pickerOptionsDay:{shortcuts:[{text:this.$translateTitle("developer.today"),onClick:function(e){e.$emit("pick",new Date)}},{text:this.$translateTitle("developer.yesterday"),onClick:function(e){var t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:this.$translateTitle("developer.A week ago"),onClick:function(e){var t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},chartData:{identifier:[],columns:[],rows:[]},params:{_function:"last",style:"",number:1,interval:"h",datetimerange:"",keys:"*",limit:100,endTime:new Date,startTime:(new Date).getTime()-6048e5},interval:[{type:"y",name:"年"},{type:"n",name:"月"},{type:"w",name:"周"},{type:"d",name:"日"},{type:"h",name:"时"},{type:"m",name:"分"},{type:"s",name:"秒"},{type:"a",name:"毫秒"},{type:"u",name:"微秒"}],functionarr:["count","avg","sum","stddev","min","max","first","last"],disabledChart:["map","sankey","wordcloud","liquidfill","tree","gauge"],chartType:m["default"],options:[{value:"选项1",label:"黄金糕"},{value:"选项2",label:"双皮奶"},{value:"选项3",label:"蚵仔煎"},{value:"选项4",label:"龙须面"},{value:"选项5",label:"北京烤鸭"}],value:"",chartSettings:{},queryFlag:!0,width:0,lineChartData:"",datafordetail:[],datadialogVisible:!1,childDialog:!1,ninthform:{product:"",devices:""},wmxform:{product:"",devices:""},tableData:[],activeName:"first",text:"1111111",deviceid:"",topicData:[],thirdstart:1,thirdlength:10,thirdtotal:0,topic:[{topic:"thing/${ProductId}/${DevAddr}/post",type:"pub",desc:"设备上报",isdef:!0},{topic:"thing/${ProductId}/${DevAddr}",type:"sub",desc:"消息下发",isdef:!0}],thirdData:[],thirdDatas:[],ispushdata:!0,timer:null,isshowtable:!1,childrendevices:{devicesname:""},multipleTable:[],devicesTableData:[],childrenDeviceLength:10,childrenDeviceStart:0,childrenDeviceTotal:0,childrenForm:{product:"",device:"",route:""},isshowchild:!1,allProudct:[],productDevices:[],ischange:!1,ischildren:!1,productid:"",dataDeviceTotal:0,dataDeviceLength:10,dataDeviceStart:1,devicedevaddr:"",dirstart:1,dirlength:20,selectproduct:"",watchNum:0}},computed:Object(o["a"])({},Object(d["mapGetters"])({Device:"settings/device"})),watch:{sm:function(e){var t=this;this.$nextTick((function(e){t.resizeTheChart(),setTimeout((function(){t.loading=!1}),2e3)}))}},mounted:function(){this.setTreeFlag(!1),this.params.style=this.chartType[0].type,console.log(" this.params.style",this.params.style),this.subtopic="thing/".concat(this.$route.query.deviceid,"/realtimedata/post"),this.router=this.$dgiotBus.router(location.href+this.$route.fullPath),this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.$route.query.deviceid&&(this.subRealtimedata(),this.deviceid=this.$route.query.deviceid,this.initChart(),this.getDeviceInfo(this.deviceid),window.addEventListener("resize",this.resizeTheChart))},destroyed:function(){this.Unbscribe()},beforeDestroy:function(){window.removeEventListener("resize",this.resizeTheChart),this.Unbscribe()},methods:Object(o["a"])(Object(o["a"])({subRealtimedata:function(){var e=this;return Object(i["a"])(s.a.mark((function t(){return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:try{e.$dgiotBus.$emit("MqttSubscribe",{router:e.router,topic:e.subtopic,qos:0,ttl:108e5}),console.groupCollapsed("%c mqtt 订阅日志","color:#009a61; font-size: 28px; font-weight: 300"),console.log("topic:",e.subtopic),console.log("router:",e.router),console.groupEnd(),e.$dgiotBus.$off(e.topicKey),e.$dgiotBus.$on(e.topicKey,(function(t){console.groupCollapsed("%c mqttMsg消息回调","color:#009a61; font-size: 28px; font-weight: 300"),console.log(t),console.log(Base64.decode(t.payload)),console.log(JSON.parse(Base64.decode(t.payload)).data),console.log("Base64.decode(payload):",Base64.decode(t.payload)),console.groupEnd();var a=JSON.parse(Base64.decode(t.payload)),i=a.data,o=void 0===i?[]:i;o?e.renderCard(o):e.getCardDevice()}))}catch(error){console.log(error),e.$baseMessage(e.$translateTitle("alert.Data request error")+"".concat(error),"error","vab-hey-message-error")}case 1:case"end":return t.stop()}}),t)})))()}},Object(d["mapActions"])({setTreeFlag:"settings/setTreeFlag"})),{},{Unbscribe:function(){console.error("Unbscribe");var e="logger_trace/trace/"+this.deviceInfo.objectId+"/#",t=this.$dgiotBus.topicKey(this.router,e);this.$dgiotBus.$emit("MqttUnbscribe",t,e),this.$dgiotBus.$emit("MqttUnbscribe",this.topicKey,this.subtopic)},getDeviceInfo:function(e){var t=this;return Object(i["a"])(s.a.mark((function a(){var i,o,r,n,c,l,d,p,m,h;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,n=t.$baseColorfullLoading(),a.next=4,Object(u["getDevice"])(e);case 4:c=a.sent,l="",l=null!==c&&void 0!==c&&null!==(i=c.product)&&void 0!==i&&i.objectId?c.product.objectId:"",d=c.devaddr,p=[{topic:"thing/".concat(l,"/").concat(d,"/post"),type:"pub",desc:"设备上报",isdef:!0},{topic:"thing/".concat(l,"/").concat(d),type:"sub",desc:"消息下发",isdef:!0}],c.product.topics?c.topicData=c.product.topics.concat(p):c.topicData=p,t.deviceInfo=c,null!==(o=t.deviceInfo)&&void 0!==o&&null!==(r=o.location)&&void 0!==r&&r.latitude&&(t.mapLabel={content:c.name,style:{color:"red",fontSize:"24px"},position:{lng:null!==(m=Number(c.location.longitude))&&void 0!==m?m:116.404,lat:null!==(h=Number(c.location.latitude))&&void 0!==h?h:39.915},title:c.name},t.mapCenter=t.mapLabel.position,console.info("this.mapLabel\n",t.mapLabel)),t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),n.close(),a.next=20;break;case 16:a.prev=16,a.t0=a["catch"](0),console.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 20:case"end":return a.stop()}}),a,null,[[0,16]])})))()},toggleChart:function(e){this.chartKey=moment(new Date).valueOf(),this.loading=!1,dgiotlog.log(e),this.chartExtend={},this.chartDataZoom=[];var t=["funnel","radar","radar"];-1!=t.indexOf(e)?(this.chartExtend={},this.chartDataZoom=[]):(this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40},yAxis:[{type:"value",axisLabel:{formatter:"{value} %"}}]},this.chartDataZoom=[{type:"slider"}]),this.resizeTheChart()},resizeTheChart:function(){var e=this.$refs["charts"];e instanceof Array?(e.forEach((function(e){e.$children[0].resize()})),dgiotlog.log("重绘完成",e)):e.$children[0].resize()},toggleCardRow:function(e,t,a,i,o){this.sm=24==a?12:24,this.md=12==i?24:12,this.xl=6==o?12:6,this.loading=!0},afterConfig:function(e){return e.tooltip.showDelay=500,e},initChart:function(){var e=this,t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),this.params.datetimerange=[a,t],this.queryFlag=!1,this.$queryProduct({}).then((function(t){e.allProudct=t.results}))},queryChart:function(){var e=this;return Object(i["a"])(s.a.mark((function t(){var a,i,o,r,n,c,l,d,p,m,h;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.chartData={identifier:[],columns:[],rows:[]},!e.params.startTime||!e.params.endTime){t.next=12;break}return e.$baseColorfullLoading(1,e.$translateTitle("home.messag_loding")),a=e.$route.query.deviceid,dgiotlog.log("endTime",m),dgiotlog.log("startTime",p),i=e.params,o=i.interval,r=i.keys,n=i.limit,c=i.number,l=i.style,d=i._function,p=i.startTime,m=i.endTime,h={starttime:moment(p).valueOf(),endtime:moment(m).valueOf(),interval:c+o,keys:r,limit:n,function:d,style:l},t.next=10,Object(u["getDabDevice"])(a,h).then((function(t){if(e.$baseColorfullLoading().close(),dgiotlog.log(t,"res charts"),null!==t&&void 0!==t&&t.chartData){var a=t.chartData,i=void 0===a?{}:a;e.chartData=i,e.$nextTick((function(){setTimeout((function(){e.loading=!0,e.toggleChart("line")}),1e3)}))}dgiotlog.log("this.chartData",e.chartData),e.loading=!1,e.dataEmpty=!1})).catch((function(t){dgiotlog.log(t),e.loading=!1,e.$baseColorfullLoading().close()}));case 10:t.next=13;break;case 12:e.$message.error(e.$translateTitle("developer.Please select the query Time"));case 13:case"end":return t.stop()}}),t)})))()},print:function(e){dgiotlog.log(e)},tabHandleClick:function(e){switch(this.$dgiotBus.$emit("MqttUnbscribe",this.topicKey,this.subtopic),e.name){case"ninth":this.$router.push({path:"/roles/onlinetest",query:{deviceid:this.devicedevaddr,productid:this.productid}});break;case"children":this.getDevices();break;case"third":this.queryChart();break;case"right":this.toggleClass("rightrow");break;case"task":this.$refs.SceneLog.get_topic();break;case"first1":this.subRealtimedata(),this.getCardDevice();break}},timestampToTime:function(e){var t=new Date(1e3*e),a=t.getFullYear()+"-",i=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",o=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",r=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",s=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",n=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return a+i+o+r+s+n},getDevices:function(e){var t=this;0==e&&(this.childrenDeviceStart=0),this.devicesTableData=[];var a={limit:this.childrenDeviceLength,skip:this.childrenDeviceStart,count:"objectId",include:"product",where:{parentId:this.deviceInfo.objectId}};""!=this.childrendevices.devicesname&&(a.where.devaddr=this.childrendevices.devicesname),dgiotlog.log("this.params",a),this.$queryDevice(a).then((function(e){t.childrenDeviceTotal=e.count,e.results&&e.results.map((function(e){var a={};a.objectId=e.objectId,a.name=e.name,a.status=e.status,a.originstatus=e.status,a.nodeType=e.product.nodeType,a.productName=e.product.name,a.devaddr=e.devaddr,a.isEnable=e.isEnable,a.route=e.route,t.devicesTableData.push(a)}))})).catch((function(e){dgiotlog.log(e),t.$baseMessage("请求出错11",e.error,3e3)}))},getCardDevice:function(){var e=this;Object(u["getCardDevice"])(e.deviceid).then((function(t){e.machinelist={},null!==t&&void 0!==t&&t.data&&e.renderCard(t.data)})).catch((function(e){dgiotlog.log("update error 清除timer",e)}))},renderCard:function(e){var t=this,a=[];e.forEach((function(e){e.devicetype&&a.push(e.devicetype)})),a=_.uniqBy(a);var i={};a.forEach((function(t){var a=[];e.forEach((function(e){t==e.devicetype&&a.push(e)})),i[t]=a})),t.machinelist=i,t.thirdtbKey=moment(new Date).valueOf()},dataDeviceSizeChange:function(e){this.dataDeviceStart=1},dataDeviceCurrentChange:function(e){this.dataDeviceStart=e},handleSizeChange1:function(e){this.thirdstart=1,this.thirdlength=e},handleCurrentChange1:function(e){this.thirdstart=e},DevicesSelectionChange:function(e){this.multipleTable=e},childrenDeviceCurrentChange:function(e){this.childrenDeviceStart=(e-1)*this.childrenDeviceLength,this.getDevices()},childrenDeviceSizeChange:function(e){this.childrenDeviceLength=e,this.getDevices()},checkProduct:function(e){var t=this;this.ischange=!0,this.selectproduct=e;var a={limit:this.dirlength,skip:(this.dirstart-1)*this.dirlength,count:"objectId",where:{product:e}};this.$queryDevice(a).then((function(e){e.results&&e.results.length>0?t.productDevices=e.results:t.productDevices=[],t.childrenForm.device=""}))},deviceToDetail:function(e){dgiotlog.log("row",e),this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,ischildren:"false"}})},loadmore:function(){this.dirstart++,this.checkProduct(this.selectproduct)},submitDevice:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return dgiotlog.log("error submit!!"),!1;var a={};a[t.deviceInfo.devaddr]=t.childrenForm.route;var i={parentId:{__type:"Pointer",className:"Device",objectId:t.deviceid},route:a};t.$putDevice(t.childrenForm.device,i).then((function(e){e&&(t.$message({type:"success",message:"添加成功"}),t.childDialog=!1,t.getDevices(),t.$refs["childrenForm"].resetFields())}))}))},deleteDevcie:function(e){var t=this;Promise.all([this.multipleTable.map((function(e){var a={parentId:null};t.$putDevice(e.objectId,a).then((function(e){}))}))]).then((function(e){e&&0!=e.length?(t.$message({message:"解除关联成功",type:"success"}),t.getDevices()):t.$message({message:"解除关联失败",type:"error"})})).catch((function(e){dgiotlog.log(e)}))},unactiveDevice:function(e){var t=this;Promise.all([this.multipleTable.map((function(e){var a={isEnable:!1};t.$putDevice(e.objectId,a).then((function(e){}))}))]).then((function(e){e&&0!=e.length?(t.$message({message:"禁用成功",type:"success"}),t.getDevices()):t.$message({message:"禁用失败",type:"error"})})).catch((function(e){dgiotlog.log(e)}))},activeDevice:function(e){var t=this;Promise.all([this.multipleTable.map((function(e){var a={isEnable:!0};t.$putDevice(e.objectId,a).then((function(e){}))}))]).then((function(e){e&&0!=e.length?(t.$message({message:"启用成功",type:"success"}),t.getDevices()):t.$message({message:"启用失败",type:"error"})})).catch((function(e){dgiotlog.log(e)}))},makeSure:function(e,t){var a=this,i=JSON.parse(JSON.stringify(row.route)),o=this.deviceInfo.devaddr;delete i[o];var r={parentId:null,route:i};this.$putDevice(row.objectId,r).then((function(i){i&&(a.$message({type:"success",message:"解除关联成功"}),e._self.$refs["popover-".concat(t)].doClose(),a.getDevices())}))},handelUpdate:function(e,t,a){var i=this,o={};for(var r in t)o[r]=t[r];o.isEnable=1!=o.isEnable,this.devicesTableData[a]=o,this.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e={};for(var a in t)e[a]=t[a];e.isEnable=1==e.isEnable;var o={isEnable:e.isEnable};i.$putDevice(t.objectId,o).then((function(e){i.$message({type:"success",message:"状态修改成功"})})),i.getDevices()})).catch((function(){i.$message({type:"info",message:"已取消修改"});var e=t;e.isEnable=1!=e.isEnable,i.devicesTableData[a]=e}))}})}},"89c0":function(e,t,a){"use strict";a("e2d2")},"8b057":function(e,t,a){},"96e1":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"group"},[a("el-container",[a("el-container",[a("el-main",[a("div",{staticClass:"main"},[a("el-drawer",{attrs:{direction:"ltr",visible:e.drawer},on:{"update:visible":function(t){e.drawer=t}}},[e.showTree?a("div",{staticClass:"tree"},[e._v(" 搜索 : "),a("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),a("el-tree",{ref:"tree",staticClass:"treeitems",attrs:{"allow-drag":e.allowDrag,"allow-drop":e.allowDrop,data:e.treeData,"default-expand-all":"",draggable:"","filter-node-method":e.filterNode,"node-key":"id",props:e.defaultProps},on:{"node-drop":e.handleDrop},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node,o=t.data;return a("span",{staticClass:"custom-tree-node"},[1==o.roles.seen?a("span",[a("el-input",{staticStyle:{width:"80%"},model:{value:e.editLabel,callback:function(t){e.editLabel=t},expression:"editLabel"}})],1):a("span",{staticStyle:{color:"#409eff"}},[e._v(e._s(i.label))]),0==o.roles.seen?a("span",{staticStyle:{"margin-left":"5px"}},[a("i",{staticClass:"el-icon-plus",staticStyle:{color:"#67c23a"},attrs:{title:"新增"},on:{click:function(t){return t.stopPropagation(),e.append(o)}}}),a("i",{staticClass:"el-icon-delete",staticStyle:{color:"red"},attrs:{title:"删除"},on:{click:function(t){return t.stopPropagation(),e.deletes(o)}}}),a("i",{staticClass:"el-icon-edit",staticStyle:{color:"#909399"},attrs:{title:"编辑"},on:{click:function(t){return t.stopPropagation(),e.rename(o)}}})]):a("span",[a("i",{staticClass:"el-icon-check",attrs:{slot:"suffix",title:"保存"},on:{click:function(t){return t.stopPropagation(),e.savename(o)}},slot:"suffix"})])])}}],null,!1,3055715610)})],1):e._e()]),a("el-tabs",{staticStyle:{display:"none"},on:{"tab-click":e.goTo},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.tabsNav,(function(e){return a("el-tab-pane",{key:e.url,attrs:{label:e.label,name:e.url}})})),1),a("router-view")],1),a("div",{staticClass:"setting"},[a("i",{class:[e.drawer?"el-icon-s-fold":"el-icon-s-unfold"],on:{click:function(t){return e.toggleTree()}}})])])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,center:"",title:"添加角色",visible:e.centerDialogRole,width:"35%"},on:{close:e.closeDialogRole}},[a("addroles",{ref:"addRoleRef"})],1)],1)},o=[],r=a("71bc"),s=(a("1d17"),a("98da"),a("a0e0"),a("3dec"),a("16b8"),a("5da9")),n=a("5638"),c=a("d10c"),l={name:"Group",components:{addroles:c["default"]},data:function(){return{drawer:!1,tabsNav:[{label:"统计预览",url:"platform"},{label:"虚拟分组",url:"devproduct"},{label:"通道列表",url:"resourcechannel"},{label:"设备列表",url:"devicelist"},{label:"产品列表",url:"productlist"},{label:"规则列表",url:"engine"}],numberValidateForm:{name:""},centerDialogRole:!1,editLabel:"",filterText:"",addForm:{seen:!1,date:"",name:"",address:""},treeData:[],defaultProps:{children:"children",label:"alias",isLeaf:"leaf"},showTree:!0}},computed:{activeName:{get:function(){return""!=this.$route.path.replace("/dashboard/","")?this.$route.path.replace("/dashboard/",""):"platform"},set:function(){}}},watch:{filterText:function(e){this.$refs.tree.filter(e)}},mounted:function(){var e=this;this.$dgiotBus.$on("dialogHide",(function(){e.centerDialogRole=!1,e.getTree()})),this.getTree()},methods:{goTo:function(e){this.$router.push({path:"/dashboard/"+e.name})},toggleTree:function(){this.drawer=!this.drawer},getTree:function(){var e=this;function t(e){var a=Array.isArray(e)?[]:{};if(e&&"object"===Object(r["a"])(e))for(var i in e)e.roles&&(e.roles.seen=!1),e.hasOwnProperty(i)&&(e[i]&&"object"===Object(r["a"])(e[i])?a[i]=t(e[i]):a[i]=e[i]);return a}Object(s["roletree"])().then((function(a){e.treeData=t(a.results),dgiotlog.log(e.treeData)})).catch((function(t){dgiotlog.log(t),e.treeData=[]}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;Object(n["addGroup"])(t.numberValidateForm.name).then((function(e){t.$message({message:"新建设备分组成功",type:"success"})})).catch((function(e){t.$message({message:"新建设备分组失败"+e.computed,type:"error"})}))}))},resetForm:function(e){this.$refs[e].resetFields()},append:function(e){var t=this;this.centerDialogRole=!0,this.$nextTick((function(){t.$refs["addRoleRef"].getData(e)}))},closeDialogRole:function(){this.centerDialogRole=!1,this.getTree()},deletes:function(e){var t=this;this.$confirm("此操作将永久删除该节点,包括其子节点","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(s["delRole"])(e.objectId).then((function(e){t.getTree(),t.$message({type:"success",message:"删除成功!"})})).catch((function(e){t.$message({type:"error",message:"删除失败"+e.error})}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},rename:function(e){this.editLabel=e.alias,e.roles.seen=!0},savename:function(e){var t=this;e.alias!=this.editLabel&&Object(s["putRole"])(e.objectId,this.editLabel).then((function(a){t.$message({type:"success",message:"编辑成功"}),e.alias=t.editLabel})).catch((function(e){dgiotlog.log(e)})),e.roles.seen=!1},allowDrop:function(e,t,a){return e.level===t.level&&(e.data.parentId===t.data.parentId?"prev"===a||"next"===a:void 0)},allowDrag:function(e){return 1!==e.level},handleDrop:function(e,t,a,i){var o=[],r=t.parent.childNodes;for(var s in r)o.push({id:r[s].data.id})},filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)}}},d=l,u=(a("e629"),a("bdd7")),p=Object(u["a"])(d,i,o,!1,null,"fbe7890a",null);t["default"]=p.exports},9763:function(e,t,a){"use strict";a("cce6")},a5cd:function(e,t,a){"use strict";a("655c")},a73e:function(e,t,a){"use strict";a("dfab")},a858:function(e,t,a){"use strict";a.r(t);var i,o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"equipment equipment-container"},[a("div",{staticClass:"dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,top:"5vh",visible:e.popoverVisible,width:"40vh"},on:{"update:visible":function(t){e.popoverVisible=t}}},[a("div",{staticClass:"deviceTree"},[a("p",{staticStyle:{"text-align":"center"}},[e._v(" "+e._s(e.$translateTitle("developer.Company"))+" : "+e._s(e.deciceCompany)+" ")]),a("el-tree",{attrs:{data:e.roleTree,"default-expand-all":"","expand-on-click-node":!1,"node-key":"index",props:e.roleProps},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node,o=t.data;return a("div",{staticClass:"custom-tree-node"},[a("span",{class:{selected:o.objectId==e.curDepartmentId},on:{click:function(t){return e.transferAcl(o)}}},[e._v(" "+e._s(i.label)+" ")])])}}])})],1)]),a("el-dialog",{attrs:{"append-to-body":!0,top:"5vh",visible:e.mapDialog,width:"80vh"},on:{"update:visible":function(t){e.mapDialog=t}}},[a("baidu-map",{staticStyle:{height:"80vh"},attrs:{ak:e.secret.baidu.map,center:e.center,"map-click":!1,"scroll-wheel-zoom":!0,zoom:e.zoom},on:{click:e.mapClick,ready:e.handler}},[a("bm-marker",{attrs:{animation:"BMAP_ANIMATION_BOUNCE",dragging:!0,position:e.center}},[a("bm-label",{attrs:{content:e.deviceId,"label-style":{color:"red",fontSize:"12px"},offset:{width:-25,height:30}}})],1),a("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}})],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,title:e.devicedetail.name,top:"5vh",visible:e.InfoDialog,width:"80%"},on:{"update:visible":function(t){e.InfoDialog=t}}},[a("el-tabs",{attrs:{size:"mini",type:"border-card"},on:{"tab-click":e.handleTabClick},model:{value:e.activeparseTbas,callback:function(t){e.activeparseTbas=t},expression:"activeparseTbas"}},e._l(e.parseTbas,(function(t){return a("el-tab-pane",{key:t.name,attrs:{label:t.name,name:t.name}},[a("ele-form",e._b({attrs:{"request-fn":e.handleSubmit},on:{"request-success":function(a){return e.handleSuccess(t)}},model:{value:t.config,callback:function(a){e.$set(t,"config",a)},expression:"item.config"}},"ele-form",t.config,!1))],1)})),1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.InfoDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.InfoDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.CloseState,title:e.stateDialog.name,top:"5vh",visible:e.stateDialog,width:"80%"},on:{"update:visible":function(t){e.stateDialog=t}}},[a("deviceState",{attrs:{devicedetail:e.stateDetail},on:{ParserSave:e.ParserSave}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.stateDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.stateDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1)],1),a("div",{staticClass:"equtabs"},[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("div",{staticClass:"equdevices"},[a("vab-query-form",[a("vab-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"100px",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products")}},[a("el-select",{attrs:{clearable:"",disabled:!e.productenable},on:{change:e.selectProdChange},model:{value:e.equvalue,callback:function(t){e.equvalue=t},expression:"equvalue"}},e._l(e.proTableData,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.device status")}},[a("el-select",{staticStyle:{width:"100px"},attrs:{clearable:""},model:{value:e.onlinedevices,callback:function(t){e.onlinedevices=t},expression:"onlinedevices"}},[a("el-option",{attrs:{value:e.$translateTitle("zetadevices.online")}}),a("el-option",{attrs:{value:e.$translateTitle("zetadevices.offline")}})],1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.condition")}},[e.selectdevice==e.$translateTitle("equipment.devicename")?a("el-input",{attrs:{placeholder:e.$translateTitle("equipment.enterproductname")},model:{value:e.deviceinput,callback:function(t){e.deviceinput=t},expression:"deviceinput"}},[a("el-select",{staticStyle:{width:"140px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:e.selectdevice,callback:function(t){e.selectdevice=t},expression:"selectdevice"}},[a("el-option",{attrs:{value:e.$translateTitle("equipment.devicename")}}),a("el-option",{attrs:{value:e.$translateTitle("equipment.devicenumber")}})],1),a("i",{staticClass:"el-icon-search",staticStyle:{"line-height":"32px",color:"#606266",cursor:"pointer"},attrs:{slot:"suffix"},on:{click:function(t){return e.getDevices({start:0})}},slot:"suffix"})],1):a("el-input",{attrs:{placeholder:e.$translateTitle("equipment.enterdevicenumber")},model:{value:e.deviceinput,callback:function(t){e.deviceinput=t},expression:"deviceinput"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:e.selectdevice,callback:function(t){e.selectdevice=t},expression:"selectdevice"}},[a("el-option",{attrs:{value:e.$translateTitle("equipment.devicename")}}),a("el-option",{attrs:{value:e.$translateTitle("equipment.devicenumber")}})],1),a("el-button",{attrs:{slot:"append",icon:"el-icon-search",size:"mini"},on:{click:function(t){return e.getDevices({start:0})}},slot:"append"})],1)],1),a("el-form-item",[a("el-button",{staticClass:"el-icon-plus",attrs:{size:"small",title:e.$translateTitle("equipment.adddevice"),type:"primary"},on:{click:e.addDeviceForm}}),a("el-button",{staticClass:"el-icon-delete",attrs:{disabled:!e.selectedList.length,size:"small",title:e.$translateTitle("aintenance.batch deletion"),type:"danger"},on:{click:function(t){return e.handleDelete(e.selectedList,1)}}})],1),a("el-form-item",{staticStyle:{display:"none"}},[a("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:e.deleteDevcie}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]),a("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:function(t){return e.unactiveDevice(!1)}}},[e._v(" "+e._s(e.$translateTitle("developer.prohibit"))+" ")]),a("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:function(t){return e.unactiveDevice(!0)}}},[e._v(" "+e._s(e.$translateTitle("developer.enable"))+" ")]),a("el-button",{attrs:{size:"small"}},[e._v(" "+e._s(e.$translateTitle("equipment.batchaddition"))+" ")])],1)],1)],1)],1)],1),a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.list"),name:"first"}},[a("div",{staticClass:"tabstable"},[a("el-table",{directives:[{name:"show",rawName:"v-show",value:e.isALL,expression:"isALL"},{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"filterTable",staticClass:"tab_wrap_1",staticStyle:{"margin-top":"20px","text-align":"center"},attrs:{border:e.border,data:e.tableData,"row-style":e.rowClass,size:e.lineHeight,stripe:e.stripe},on:{"selection-change":e.changeBox}},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",sortable:"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.devicenumber"),prop:"devaddr","show-overflow-tooltip":"",sortable:"",width:"100"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.name"),prop:"name","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.state"),prop:"status","show-overflow-tooltip":"",sortable:"",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return["ONLINE"==i.status?a("span",{class:i.status},[e._v(" "+e._s(e.$translateTitle("product.online"))+" ")]):e._e(),"ONLINE"==i.status?a("el-tooltip",{attrs:{content:e.$translateTitle("equipment.thedeviceisonline"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"==i.status?a("span",{class:i.status},[e._v(" "+e._s(e.$translateTitle("product.offline"))+" ")]):e._e(),"OFFLINE"==i.status?a("el-tooltip",{attrs:{content:e.$translateTitle("equipment.thedeviceisoffline"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"!=i.status&&"ONLINE"!=i.status?a("span",{class:i.status},[e._v(" "+e._s(e.$translateTitle("product.unregistered"))+" ")]):e._e()]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.product"),prop:"product.name","show-overflow-tooltip":"",sortable:"",width:"auto"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.Company"),prop:"Company","show-overflow-tooltip":"",sortable:"",width:"auto"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.enable")+"/"+e.$translateTitle("developer.prohibit"),prop:"isEnable","show-overflow-tooltip":"",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row,o=t.$index;return[a("el-switch",{attrs:{"active-color":"#5eb058","inactive-color":"#cccccc"},on:{change:function(t){return e.handelUpdate(t,i,o)}},model:{value:i.isEnable,callback:function(t){e.$set(i,"isEnable",t)},expression:"row.isEnable"}})]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.createdAt"),prop:"createdAt","show-overflow-tooltip":"",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(e.utc2beijing(i.createdAt)))])]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("developer.operation"),"min-width":"220",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.deviceToDetail(i)}}},[e._v(" "+e._s(e.$translateTitle("product.details"))+" ")]),a("el-button",{staticStyle:{"text-align":"center"},attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.showInfo(i)}}},[e._v(" "+e._s(e.$translateTitle("product.parser"))+" ")]),a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.konvaDevice(i)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.konva"))+" ")]),a("el-dropdown",{staticStyle:{margin:"0 10px"}},[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){e.isFullscreen=!e.isFullscreen}}},[e._v(" "+e._s(e.$translateTitle("concentrator.more"))+" ")]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",[a("el-link",{attrs:{size:"info",type:"success"},on:{click:function(t){return e.editorDevice(i)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.edit"))+" ")])],1),a("el-dropdown-item",[a("el-link",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showTree(i.objectId,i.Company)}}},[e._v(" "+e._s(e.$translateTitle("equipment.move"))+" ")])],1),a("el-dropdown-item",[a("el-link",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.goLink("video",i)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.video"))+" ")])],1),a("el-dropdown-item",[a("el-link",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(i,2)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)],1)],1)]}}])})],1),a("el-table",{directives:[{name:"show",rawName:"v-show",value:!e.isALL,expression:"!isALL"},{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"filterTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-style":e.rowClass},on:{"selection-change":e.changeBox}},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",sortable:"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.devicenumber"),prop:"devaddr","show-overflow-tooltip":"",sortable:"",width:"auto"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.name"),prop:"name","show-overflow-tooltip":"",sortable:"",width:"auto"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.state"),"show-overflow-tooltip":"",sortable:"",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return["ONLINE"==i.status?a("span",{class:i.status},[e._v(" "+e._s(e.$translateTitle("product.online"))+" ")]):e._e(),"ONLINE"==i.status?a("el-tooltip",{attrs:{content:e.$translateTitle("equipment.thedeviceisonline"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"==i.status?a("span",{class:i.status},[e._v(" "+e._s(e.$translateTitle("product.offline"))+" ")]):e._e(),"OFFLINE"==i.status?a("el-tooltip",{attrs:{content:e.$translateTitle("equipment.thedeviceisoffline"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"!=i.status&&"ONLINE"!=i.status?a("span",{class:i.status},[e._v(" "+e._s(e.$translateTitle("product.unregistered"))+" ")]):e._e()]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.product"),"show-overflow-tooltip":"",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[i.product&&i.product.name?a("span",[e._v(" "+e._s(i.product.name)+" ")]):e._e()]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.Company"),"show-overflow-tooltip":"",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(" "+e._s(i.Company)+" ")])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.enable")+"/"+e.$translateTitle("developer.prohibit"),"show-overflow-tooltip":"",sortable:"",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row,o=t.$index;return[a("el-switch",{attrs:{"active-color":"#5eb058","inactive-color":"#cccccc"},on:{change:function(t){return e.handelUpdate(t,i,o)}},model:{value:i.isEnable,callback:function(t){e.$set(i,"isEnable",t)},expression:"row.isEnable"}})]}}])}),e._l(e.dialogtempconfig,(function(t,i){return["bool"==t.type&&t.isshow?a("el-table-column",{key:i,attrs:{align:"center",label:t.name,prop:t.identifier},scopedSlots:e._u([{key:"default",fn:function(i){var o=i.row;return[o[t.default]?a("span",[e._v(" "+e._s(e.$translateTitle("product.yes"))+" ")]):a("span",[e._v(" "+e._s(e.$translateTitle("product.no"))+" ")])]}}],null,!0)}):"enum"==t.type&&t.isshow?a("el-table-column",{key:i,attrs:{align:"center",label:t.name},scopedSlots:e._u([{key:"default",fn:function(i){var o=i.row;return[a("span",[e._v(" "+e._s(t.struct[o[t.identifier]])+" ")])]}}],null,!0)}):t.isshow?a("el-table-column",{key:i,attrs:{align:"center",label:t.name,prop:t.identifier},scopedSlots:e._u([{key:"default",fn:function(i){var o=i.row;return[a("span",[e._v(e._s(o[t.identifier])+" "+e._s(t.unit))])]}}],null,!0)}):e._e()]})),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.createdAt"),width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(e.utc2beijing(i.createdAt)))])]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("developer.operation"),width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.deviceToDetail(i)}}},[e._v(" "+e._s(e.$translateTitle("product.details"))+" ")]),a("el-button",{staticStyle:{"text-align":"center"},attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.showInfo(i)}}},[e._v(" "+e._s(e.$translateTitle("product.parser"))+" ")]),a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.konvaDevice(i)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.konva"))+" ")]),a("el-dropdown",{staticStyle:{margin:"0 10px"}},[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){e.isFullscreen=!e.isFullscreen}}},[e._v(" "+e._s(e.$translateTitle("concentrator.more"))+" ")]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",[a("el-link",{attrs:{size:"info",type:"success"},on:{click:function(t){return e.editorDevice(i)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.edit"))+" ")])],1),a("el-dropdown-item",[a("el-link",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showTree(i.objectId,i.Company)}}},[e._v(" "+e._s(e.$translateTitle("equipment.move"))+" ")])],1),a("el-dropdown-item",[a("el-link",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.goLink("video",i)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.video"))+" ")])],1),a("el-dropdown-item",[a("el-link",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(i,2)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)],1)],1)]}}])})],2),a("div",{staticClass:"elpagination"},[a("vab-parser-pagination",{key:e.devicetotal.length+"forensics",ref:"devicePagination",attrs:{pagination:e.paginations,"query-payload":e.queryPayload},on:{pagination:e.getDevices,paginationQuery:e.paginationQuery}})],1)],1)]),a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.map"),name:"second"}},[a("baidu-map",{staticClass:"map",staticStyle:{height:"67vh"},attrs:{ak:e.secret.baidu.map,center:{lng:116.404,lat:39.915},"scroll-wheel-zoom":!0,zoom:e.sizeZoom}},[a("bm-control",[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.sizeZoom=19}}},[e._v(" 缩放至最大 ")]),a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.sizeZoom=10}}},[e._v("还原")]),a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.sizeZoom=3}}},[e._v(" 缩放至最小 ")]),a("bm-panorama",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT",offset:{width:460,height:0}}}),a("bm-overview-map",{attrs:{"is-open":!0}}),a("bm-scale",{attrs:{offset:{width:200,height:0}}}),a("bm-city-list",{attrs:{offset:{width:280,height:0}}}),a("bm-map-type",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT","map-types":["BMAP_HYBRID_MAP","BMAP_NORMAL_MAP"],offset:{width:360,height:0}}})],1),e._l(e.tableData,(function(t){return a("bm-marker",{key:t.objectId,attrs:{animation:"BMAP_ANIMATION_BOUNCE",content:t.name,dragging:!0,position:{lng:t.location.longitude,lat:t.location.latitude}}},[a("bm-label",{attrs:{content:t.name,"label-style":{color:"red",fontSize:"24px"},offset:{width:-35,height:30}},on:{click:function(a){return e.deviceToDetail(t)}}})],1)})),a("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),a("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT","auto-location":!0,"show-address-bar":!0}})],2)],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose,"close-on-click-modal":!1,title:e.$translateTitle("product.edit")+e.equipmentEditor,visible:e.devicedialogVisible,width:"70%"},on:{"update:visible":function(t){e.devicedialogVisible=t}}},[a("div",{staticClass:"header-title",attrs:{slot:"title"},slot:"title"},[a("span",{staticClass:"title-name"},[e._v(" "+e._s("设备"+e.equipmentEditor)+" "),a("el-tooltip",{staticStyle:{"margin-left":"5px"},attrs:{content:e.$translateTitle("equipment.text"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})])],1)]),a("div",{staticClass:"devicecontent"},[a("el-tabs",{model:{value:e.imeideviceName,callback:function(t){e.imeideviceName=t},expression:"imeideviceName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.commdevice"),name:"first"}},[a("el-form",{ref:"deviceform",attrs:{"label-width":"150px",model:e.deviceform,rules:e.rules}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicename"),prop:"name"}},[a("el-input",{model:{value:e.deviceform.name,callback:function(t){e.$set(e.deviceform,"name",t)},expression:"deviceform.name"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicenumber"),prop:"devaddr"}},[a("el-input",{attrs:{disabled:"编辑"==e.equipmentEditor},model:{value:e.deviceform.devaddr,callback:function(t){e.$set(e.deviceform,"devaddr",t)},expression:"deviceform.devaddr"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"productName"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"编辑"==e.equipmentEditor,placeholder:e.$translateTitle("equipment.entername")},on:{change:e.selectChange},model:{value:e.deviceform.productName,callback:function(t){e.$set(e.deviceform,"productName",t)},expression:"deviceform.productName"}},e._l(e.proTableData1,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.assetnumber")}},[a("el-input",{model:{value:e.deviceform.assetNum,callback:function(t){e.$set(e.deviceform,"assetNum",t)},expression:"deviceform.assetNum"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.equipmenttype")}},[a("el-input",{model:{value:e.deviceform.devModel,callback:function(t){e.$set(e.deviceform,"devModel",t)},expression:"deviceform.devModel"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.equipmentbrand")}},[a("el-input",{model:{value:e.deviceform.brand,callback:function(t){e.$set(e.deviceform,"brand",t)},expression:"deviceform.brand"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.installationlocation")}},[a("el-input",{on:{focus:e.updateLocation},model:{value:e.deviceform.address,callback:function(t){e.$set(e.deviceform,"address",t)},expression:"deviceform.address"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.videoSrc")}},[a("el-input",{model:{value:e.deviceform.videoSrc,callback:function(t){e.$set(e.deviceform,"videoSrc",t)},expression:"deviceform.videoSrc"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.videoType")}},[a("el-select",{staticStyle:{width:"100%"},model:{value:e.deviceform.videoType,callback:function(t){e.$set(e.deviceform,"videoType",t)},expression:"deviceform.videoType"}},e._l(e.videoOptions,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),e._l(e.arrlist,(function(t,i){return a("el-col",{key:i,attrs:{span:12}},[a("el-form-item",{attrs:{label:t.name,prop:t.identifier,required:t.required}},["bool"==t.type?a("el-select",{staticClass:"notauto",staticStyle:{width:"100%"},attrs:{disabled:t.readonly},model:{value:e.deviceform[t.identifier],callback:function(a){e.$set(e.deviceform,t.identifier,a)},expression:"deviceform[item.identifier]"}},[a("el-option",{attrs:{label:e.$translateTitle("product.yes"),value:!0}}),a("el-option",{attrs:{label:e.$translateTitle("product.no"),value:!1}})],1):"enum"==t.type?a("el-select",{staticClass:"notauto",staticStyle:{width:"100%"},attrs:{disabled:t.readonly},model:{value:e.deviceform[t.identifier],callback:function(a){e.$set(e.deviceform,t.identifier,a)},expression:"deviceform[item.identifier]"}},e._l(t.specs,(function(e,t){return a("el-option",{key:t,attrs:{label:e.attributevalue,value:e.attribute?e.attribute:""}})})),1):"switch"==t.type?a("el-switch",{attrs:{"active-color":"#13ce66","active-value":t.activevalue,"inactive-color":"#ff4949","inactive-value":t.inactivevalue},model:{value:e.deviceform[t.identifier],callback:function(a){e.$set(e.deviceform,t.identifier,a)},expression:"deviceform[item.identifier]"}}):t.readonly?a("el-input",{attrs:{disabled:t.readonly,value:e.deviceform[t.identifier]?e.deviceform[t.identifier]:""}},[a("el-button",{attrs:{slot:"append"},slot:"append"},[e._v(" "+e._s(t.unit?t.unit:"")+" ")])],1):a("el-input",{attrs:{disabled:t.readonly},model:{value:e.deviceform[t.identifier],callback:function(a){e.$set(e.deviceform,t.identifier,a)},expression:"deviceform[item.identifier]"}},[a("el-button",{attrs:{slot:"append"},slot:"append"},[e._v(" "+e._s(t.unit?t.unit:"")+" ")])],1)],1)],1)})),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("developer.describe")}},[a("el-input",{attrs:{autosize:{minRows:4,maxRows:4},type:"textarea"},model:{value:e.deviceform.desc,callback:function(t){e.$set(e.deviceform,"desc",t)},expression:"deviceform.desc"}})],1)],1)],2)],1),a("div",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("deviceform")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),a("el-button",{on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)],1),"编辑"!=e.equipmentEditor?a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.imeidevice"),name:"second"}},[a("el-form",{ref:"imeiform",attrs:{"label-width":"150px",model:e.imeiform,rules:e.rules}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"IMEI",prop:"devimei"}},[a("el-input",{model:{value:e.imeiform.devimei,callback:function(t){e.$set(e.imeiform,"devimei",t)},expression:"imeiform.devimei"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"productName"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("equipment.entername")},on:{change:e.selectChange},model:{value:e.imeiform.productName,callback:function(t){e.$set(e.imeiform,"productName",t)},expression:"imeiform.productName"}},e._l(e.proTableData1,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.installationlocation")}},[a("el-input",{on:{focus:e.updateLocation},model:{value:e.imeiform.address,callback:function(t){e.$set(e.imeiform,"address",t)},expression:"imeiform.address"}})],1)],1)],1)],1),a("div",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitimeiForm("imeiform")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),a("el-button",{on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)],1):e._e()],1)],1)]),a("el-dialog",{directives:[{name:"drag-dialog",rawName:"v-drag-dialog"}],attrs:{"append-to-body":!0,"before-close":e.handleClosebmap,"close-on-click-modal":!1,title:e.$translateTitle("developer.equipmentinstallationaddress"),visible:e.bmapdialogVisible,width:"50%"},on:{"update:visible":function(t){e.bmapdialogVisible=t}}},[a("div",[a("el-form",{attrs:{inline:!0,model:e.bmapform,size:"small"}},[a("el-form-item",{attrs:{label:e.$translateTitle("developer.addressname")}},[a("el-input",{model:{value:e.bmapform.keyword,callback:function(t){e.$set(e.bmapform,"keyword",t)},expression:"bmapform.keyword"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.selectaddress")}},[a("el-input",{attrs:{readonly:""},model:{value:e.bmapform.address,callback:function(t){e.$set(e.bmapform,"address",t)},expression:"bmapform.address"}})],1)],1),a("baidu-map",{staticStyle:{height:"300px"},attrs:{ak:e.secret.baidu.map,center:e.center,"map-click":!1,"scroll-wheel-zoom":!0,zoom:e.zoom},on:{click:e.mapClick,ready:e.handler}},[a("bm-local-search",{staticStyle:{display:"none"},attrs:{"auto-viewport":!0,keyword:e.bmapform.keyword,location:e.bmapform.location,zoom:"12.8"}}),a("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),a("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT","auto-location":!0,"show-address-bar":!0}}),a("bm-city-list",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addressSure.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("product.preservation"))+" ")]),a("el-button",{on:{click:function(t){e.bmapdialogVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)])],1)])},r=[],s=a("71bc"),n=a("4490"),c=a("fb07"),l=a("e97b"),d=a("d0d7"),u=a.n(d),p=(a("1d17"),a("37c6"),a("3dec"),a("9c6a"),a("f1e1"),a("04d6"),a("a0e0"),a("16b8"),a("d6a4"),a("c4bc"),a("f764"),a("5662"),a("df0e"),a("5ac5"),a("98da"),a("3de5"),a("2db0")),m=a("5880"),h=(a("ce31"),a("dcc6")),g=a("adc7"),f=a("7212"),b=a("cb88"),v=a("926a"),y=a("1285"),w=a("bc35"),T=a("14ba"),I={components:{BmScale:b["BmScale"],BmMapType:b["BmMapType"],BmOverviewMap:b["BmOverviewMap"],BmPanorama:b["BmPanorama"],BmControl:b["BmControl"],BmLabel:b["BmLabel"],BaiduMap:b["BaiduMap"],BmLocalSearch:b["BmLocalSearch"],BmNavigation:b["BmNavigation"],BmGeolocation:b["BmGeolocation"],BmCityList:b["BmCityList"],BmMarker:b["BmMarker"],deviceState:p["default"]},data:function(){var e=/^[0-9]{15}$/,t=function(t,a,i){if(!e.test(a))return i(new Error("请输入15位IMEI"));i()};this.chartSettings={radius:[5,40],offsetY:70},this.chartExtend={yAxisType:["percent"],tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"}};var a=function(e,t,a){var i=/[0-9A-Za-z]$/;""==t?a(new Error("设备地址不能为空")):i.test(t)?a():a(new Error("设备地址必须为大小写字母数字"))};return{paginations:{layout:"total, sizes, prev, pager, next, jumper"},queryPayload:{excludeKeys:"data",include:"",order:"-createdAt",limit:10,skip:0,count:"objectId"},secret:T["secret"],productDetail:{},addACL:{},videoOptions:["m3u8","mp4","flv","mp3"],queryInfo:{},isFullscreen:!1,border:!0,stripe:!0,lineHeight:"medium",aclObj:{},editRow:{},selectedList:[],formData:{},topicData:[],InfoDialog:!1,devicedetail:{},stateDialog:!1,stateDetail:{},chartOnlone:{columns:["状态","数量"],rows:[{"状态":"在线","数量":0},{"状态":"离线","数量":0}]},chartwaring:{},parseTbas:[],activeparseTbas:"",chartProduct:{},queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20,workGroupName:"",workGroupTreeShow:!1,statusFlag:!1,status:"",number:"",product:"",type:"",limit:20,skip:0,order:"-createdAt",keys:"count(*)"},treeDataValue:"",isALL:!0,sizeZoom:10,activeName:"first",imeideviceName:"first",mapDialog:!1,dialogtempconfig:[],arrlist:[],deviceId:"",deciceCompany:"",gutter:24,leftRow:3,rightRow:21,popoverVisible:!1,vabicon:"ancient-gate-fill",Company:sessionStorage.getItem("title")||"",curDepartmentId:"",roleProps:{children:"children",label:"name"},listLoading:!1,productimg:"",bmapdialogVisible:!1,onlineall:0,activeall:0,userId:"",batchid:"",pcdialogVisible:!0,devicedialogVisible:!1,equvalue:"",cities:[],selectdevice:"",onlinedevices:"",deviceinput:"",devicenumber:"",multipleTable:[],selectRow:[],devicelength:10,devicestart:0,devicetotal:0,visible2:!1,imeiform:{devimei:"",productName:"",address:""},deviceform:{videoSrc:"",videoType:"m3u8",name:"",devaddr:"",batchId:"",desc:"",nodeType:0,devType:"",netType:"",assetNum:"",devModel:"",address:"",productName:"",status:"",isEnable:"",brand:""},rules:{name:[{required:!0,message:"请输入设备名称",trigger:"blur"}],devaddr:[{required:!0,message:"请输入设备编号",trigger:"blur"},{validator:a}],devimei:[{required:!0,message:"请输入设备IMEI",trigger:"blur"},{validator:t}],batchId:[{required:!0,message:"请输入设备批次",trigger:"blur"}],nodeType:[{required:!0,message:"请输入设备类型",trigger:"blur"}],netType:[{required:!0,message:"请选择网络格式",trigger:"change"}],devType:[{required:!0,message:"请选择设备类型",trigger:"change"}],productName:[{required:!0,message:"请选择产品名称",trigger:"change"}]},pcformrule:{pcname:[{required:!0,message:"请输入批次名称",trigger:"blur"}],createdtime:[{type:"date",required:!0,message:"请选择创建时间",trigger:"change"}]},pcformInline:{pcnumber:"",pcname:"",createdtime:""},pctableData:[],equipmentEditor:"添加",tableData:[],options:[],proTableData:[],proTableData1:[],activelength:[],onlinelength:[],center:{lng:0,lat:0},zoom:13,bmapform:{keyword:"",location:"",address:""},deviceid:"",map:null,addresspointer:"",productenable:!0,changeproduct:!0,tagsid:"",productroleslist:[]}},computed:Object(l["a"])({},Object(m["mapGetters"])({_tableDict:"global/_tableDict",token:"user/token",roleTree:"user/roleTree",language:"settings/language",_product:"user/_Product",_role:"acl/role"})),watch:{multipleTable:function(e){var t=this;this.selectRow=[],e.length>0&&e.forEach((function(e,a){t.selectRow.push(t.tableData.indexOf(e))}))}},mounted:function(){this.onlinedevices="dev_online"==this.$route.query.deciceType?"在线":"dev_unline"==this.$route.query.deciceType?"离线":"",this.selectdevice="zh"==this.language?"设备名称":"devicename",this.queryProduct(),this.getDevices(),this.aclObj=this.$aclObj(this._role),dgiotlog.log("this.aclObj",this.aclObj)},methods:Object(l["a"])(Object(l["a"])({paginationQuery:function(e){var t=this;return Object(c["a"])(u.a.mark((function a(){return u.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.queryPayload=e;case 1:case"end":return a.stop()}}),a)})))()},goLink:function(e,t){var a,i=t.basedata;if(null===i||void 0===i||null===(a=i.videoSrc)||void 0===a||!a.length)return this.$message.info(this.$translateTitle("equipment.The device is not bound to the video address yet")),!1;this.$router.push({path:"/Tools/player",query:{type:i.videoType||"m3u8",url:i.videoSrc}})},handleTabClick:function(e,t){dgiotlog.log(this.activeparseTbas),dgiotlog.log(this.parseTbas)},updateParse:function(e,t,a,i){var o=arguments,r=this;return Object(c["a"])(u.a.mark((function s(){var n,c,l,d,p,m,h;return u.a.wrap((function(s){while(1)switch(s.prev=s.next){case 0:for(d in n=o.length>4&&void 0!==o[4]?o[4]:{},console.clear(),dgiotlog.log("字段",t),n["".concat(t)]={},c=[],l=[],dgiotlog.log(r.queryInfo),dgiotlog.log("frender ",i),i.config)r.queryInfo["".concat(d)]?(dgiotlog.log(i.config["".concat(d)],d),n["".concat(t)]["".concat(d)]=i.config["".concat(d)]):(dgiotlog.log(i.config["".concat(d)],"字段不存在"),l.push[i.config["".concat(d)]]);return dgiotlog.log("isField",c),dgiotlog.log("noField",l),dgiotlog.log("params",n.field),p={},p["".concat(t)]=r.queryInfo,m=_.merge(p,n),dgiotlog.log(m,"合并后的數據"),dgiotlog.log({field:m["".concat(t)]}),s.prev=17,s.next=20,r.$update_object(e,a,m);case 20:h=s.sent,dgiotlog.log(h),r.$message.success(r.$translateTitle("user.update completed")),s.next=29;break;case 25:s.prev=25,s.t0=s["catch"](17),dgiotlog.log(s.t0),r.$message.error("".concat(s.t0));case 29:case"end":return s.stop()}}),s,null,[[17,25]])})))()}},Object(m["mapMutations"])({set_tableDict:"global/set_tableDict",set_tableParser:"global/set_tableParser"})),{},{handleSubmit:function(e){return dgiotlog.log("data",e),g["Promise"].resolve()},handleSuccess:function(e){var t=this;e.table&&e.field&&e.config.order?this.$get_object(e.table,this.deviceId).then((function(a){dgiotlog.log(a),t.queryInfo=a["".concat(e.field)],t.queryInfo?t.updateParse(e.table,e.field,t.deviceId,e):t.$message.error("".concat(e.table," no field ").concat(e.field))})):this.$message.error("".concat(e.table," no field ").concat(e.field))},changeBox:function(e){var t=this;this.selectedList=[],e.forEach((function(e){t.selectedList.push(e)})),dgiotlog.log(this.selectedList)},handleDelete:function(e,t){var a=this,i=[];2==t?i.push({method:"DELETE",path:"/classes/Device/".concat(e.objectId),body:{}}):e.forEach((function(e){i.push({method:"DELETE",path:"/classes/Device/".concat(e.objectId),body:{}})})),dgiotlog.log(i,"batchParams"),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,Object(c["a"])(u.a.mark((function e(){return u.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(h["batch"])(i);case 2:e.sent,a.$baseMessage(a.$translateTitle("Maintenance.successfully deleted"),"success","vab-hey-message-success"),setTimeout((function(){a.getDevices({start:0})}),1500);case 5:case"end":return e.stop()}}),e)}))))},ParserSave:function(e){dgiotlog.log("如果监听到有修改,则更新vuex 并 存入到数据库 ".concat(JSON.stringify(e)))},queryProduct:function(){var e=this;return Object(c["a"])(u.a.mark((function t(){var a,i,o;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.proTableData=[],e.proTableData1=[],t.next=4,Object(f["queryProduct"])({count:"objectId",order:"-updatedAt",where:{}});case 4:a=t.sent,i=a.results,o=void 0===i?[]:i,e.proTableData=o,dgiotlog.log(e.proTableData,"  this.proTableData"),e.$route.query.product&&e.proTableData.forEach((function(t,a){t.objectId==e.$route.query.product&&(e.equvalue=e.proTableData[a].objectId,e.productenable=!0,e.queryForm.access_token=e.token,e.$nextTick((function(){e.selectProdChange(e.$route.query.product)})))})),e.proTableData1=o.filter((function(e){return"0"!=e.objectId})),e.$route.query.productid&&(e.equvalue=e.$route.query.productid,e.productenable=!1),dgiotlog.log("this.equvalue",e.equvalue);case 13:case"end":return t.stop()}}),t)})))()},change:function(e){dgiotlog.log(e),e&&$(".el-tree").css({height:"120px",display:"block"})},selectProdChange:function(e){var t=this;return Object(c["a"])(u.a.mark((function a(){var i,o,r,s,n,c;return u.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e){a.next=2;break}return a.abrupt("return");case 2:if(t.listLoading=!0,"0"!=e){a.next=7;break}t.isALL=!0,a.next=30;break;case 7:return a.next=9,Object(f["getProduct"])(e).then((function(e){t.listLoading=!1;var a=e.config,i=void 0===a?{basedate:{}}:a,o=i.basedate,r=void 0===o?{params:[]}:o;dgiotlog.log(e,r),t.dialogtempconfig=[],"undefined"!=r.params&&(t.dialogtempconfig=r.params,dgiotlog.log("this.dialogtempconfig",t.dialogtempconfig))}));case 9:return t.isALL=!1,t.tableData=[],i={limit:t.devicelength,skip:t.devicestart,order:"-createdAt",count:"objectId",include:"product,name",where:{product:{$ne:null},name:{$ne:null,$exists:!0}}},""!=t.deviceinput&&("设备名称"==t.selectdevice?i.where.name=t.deviceinput:i.where.devaddr=t.deviceinput),""!=t.onlinedevices&&("在线"==t.onlinedevices?i.where.status="ONLINE":i.where.status="OFFLINE"),""!=t.devicenumber&&(i.where.devaddr=t.devicenumber),i.where.product=e,t.devicestart=0,a.next=19,Object(y["querycompanyDevice"])(i,t.queryForm.access_token);case 19:o=a.sent,r=o.results,s=void 0===r?[]:r,n=o.count,c=void 0===n?0:n,s.forEach((function(e){if(e.ACL)for(var t in e.ACL)e.Company=t.substr(5);else e.Company="";if(e.profile)for(var t in e.profile)e[t]=e.profile[t]})),dgiotlog.log(s),t.tableData=s,t.devicetotal=c,t.chartOnlone.rows[1]["数量"]=t.devicetotal,dgiotlog.log("tableData",t.tableData);case 30:t.listLoading=!1;case 31:case"end":return a.stop()}}),a)})))()},showTree:function(e,t){this.deviceId=e,this.deciceCompany=t,this.popoverVisible=!this.popoverVisible},CloseState:function(){this.stateDialog=!1},showInfo:function(e){var t=this;this.deviceId=e.objectId;var a,i,o={isArr:[],obj:[]},r=[];(dgiotlog.log(e),this.devicedetail=e,e.product.config.parser)&&(a=r).push.apply(a,Object(n["a"])(e.product.config.parser));e.product.config.profile&&(i=r).push.apply(i,Object(n["a"])(e.product.config.profile));this.devicedetail={},r=r.filter((function(e){return e.visible})),dgiotlog.log(this.parseTbas),this.devicedetail&&r.length?(r.forEach((function(t){if(dgiotlog.log(t.class),dgiotlog.info("%c%s","color: #fff; background: #20B2AA; font-size: 16px;","原始关联".concat(t.table,"表中").concat(t.class,"字段的值为")),dgiotlog.info("%c%s","color: #fff; background: #20B2AA; font-size: 16px;","".concat(JSON.stringify(t.config))),e["".concat(t.class)]){for(var a in e["".concat(t.class)])for(var i in t.config)if(a==i)"object"==Object(s["a"])(t.config.formDesc["".concat(a)])?(dgiotlog.log(a,i,"f ==== v object",t.config.formDesc["".concat(a)].label,t.config.formDesc["".concat(a)].default,"data[`${from.class}`][`${v}`] 为 "+e["".concat(t.class)]["".concat(i)]),o.obj.push(a),t.config.formDesc["".concat(a)]["default"]=e["".concat(t.class)]["".concat(i)],dgiotlog.log(t.config.formDesc["".concat(a)].label,e["".concat(t.class)],t.config.formDesc["".concat(a)].default)):(o.isArr.push(i),t.config["".concat(a)]=e["".concat(t.class)]["".concat(i)]);else for(var r in t.config.formDesc)a==r&&(o.obj.push(a),t.config.formDesc["".concat(r)]["default"]=e["".concat(t.class)]["".concat(a)]);dgiotlog.log("对象数据".concat(o.obj)),dgiotlog.log("数组数据".concat(o.isArr)),dgiotlog.info("%c%s","color: #fff; background: #20B2AA; font-size: 16px;","修改后".concat(t.table,"表中").concat(t.class,"字段的值为")),dgiotlog.info("%c%s","color: #fff; background: #20B2AA; font-size: 16px;","".concat(JSON.stringify(t.config)))}})),this.parseTbas=r,this.$nextTick((function(){t.activeparseTbas=t.parseTbas[0].name,t.InfoDialog=!0}))):this.$baseMessage(this.$translateTitle("product.No device template configured yet"),"error","vab-hey-message-error")},showMap:function(e,t){this.deviceId=t;var a=e.latitude,i=void 0===a?0:a,o=e.longitude,r=void 0===o?0:o;Number(i)&&Number(r)?(this.mapDialog=!0,this.center.lng=r,this.center.lat=i):this.$message.error("位置信息获取失败")},transferAcl:function(e){var t=this,a="role:"+e.name,i={};i[a]={read:!0,write:!0};var o={ACL:i,detail:{factory:e.depname}};this.$confirm(this.$translateTitle("确定要将设备迁移到"+e.name+"吗"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(c["a"])(u.a.mark((function e(){return u.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(y["putDevice"])(t.deviceId,o).then((function(e){e.updatedAt?(t.popoverVisible=!1,t.$message({type:"success",message:t.$translateTitle("迁移成功")})):t.$message({type:"success",message:t.$translateTitle("迁移成功")})}));case 2:case"end":return e.stop()}}),e)})))).catch((function(e){dgiotlog.log(e)})),dgiotlog.log(e.name)},handleNodeClick:function(e,t){var a=this;return Object(c["a"])(u.a.mark((function i(){var o,r,s,n,c;return u.a.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(o=a._role.map((function(e){return e.name})),$(".el-tree").css({height:"0px",display:"none","overflow-x":"auto"}),$(".el-select-dropdown").css({display:"none"}),a.queryForm.workGroupName=e.label,e.name,r=e.objectId,a.curDepartmentId=r,!o.includes(e.name)){i.next=10;break}a.queryForm.access_token=a.token,i.next=20;break;case 10:if(1==t.level){i.next=19;break}return i.next=13,Object(w["getToken"])(e.name);case 13:s=i.sent,n=s.access_token,c=void 0===n?"":n,a.queryForm.access_token=c,i.next=20;break;case 19:a.queryForm.access_token=a.token;case 20:a.getDevices({start:0});case 21:case"end":return i.stop()}}),i)})))()},rolesSelect:function(e){var t=this;return Object(c["a"])(u.a.mark((function a(){var i;return u.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.productroleslist=[],a.next=3,t.$get_object("Product",e);case 3:i=a.sent,i.results;case 5:case"end":return a.stop()}}),a)})))()},goEdit:function(e){var t=window.location.origin+"/spa",a="production";t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var i="".concat(t,"/#?devaddr=").concat(e.devaddr,"&proudctid=").concat(e.productid);window.open(i,"__blank"),localStorage.setItem("topoData",JSON.stringify(e.config))},addressSure:function(){var e=new BMap.LocalSearch(this.map);e.enableAutoViewport();""==this.bmapform.address&&(this.deviceform.address=this.bmapform.keyword,this.imeiform.address=this.bmapform.keyword),e.search(this.bmapform.keyword),this.bmapdialogVisible=!1},handler:function(e){e.BMap;var t=e.map;this.center.lng=120.2,this.center.lat=30.26667,this.zoom=this.zoom,this.map=t},mapClick:function(e){var t=this;this.center.lng=e.point.lng,this.center.lat=e.point.lat,this.addresspointer=e.point.lng.toFixed(6)+","+e.point.lat.toFixed(6);var a=new BMap.Geocoder;a.getLocation(e.point,(function(e){t.bmapform.address=e.address,t.deviceform.address=e.address,t.imeiform.address=e.address}))},updateLocation:function(){this.bmapdialogVisible=!0},handleClosebmap:function(){this.bmapdialogVisible=!1},getOnlineDevices:function(){var e=this;return Object(c["a"])(u.a.mark((function t(){var a,i,o,r;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.chartOnlone={columns:["状态","数量"],rows:[{"状态":"在线","数量":0},{"状态":"离线","数量":0}]},a={limit:1,count:"objectId",include:"product,name",keys:"name",where:{status:"ONLINE",product:{$ne:null},name:{$ne:null,$exists:!0}}},""!=e.deviceinput&&("设备名称"==e.selectdevice?a.where.name={$regex:e.deviceinput}:a.where.devaddr={$regex:e.deviceinput}),""!=e.devicenumber&&(a.where.devaddr=e.devicenumber),0!=e.equvalue&&e.selectProdChange(e.equvalue),t.prev=5,t.next=8,Object(y["querycompanyDevice"])(a,e.queryForm.access_token);case 8:i=t.sent,o=i.count,r=void 0===o?0:o,e.chartOnlone.rows[1]["数量"]=e.devicetotal-r,e.chartOnlone.rows[0]["数量"]=r,t.next=19;break;case 15:t.prev=15,t.t0=t["catch"](5),dgiotlog.log(t.t0),e.$message.error("".concat(t.t0));case 19:case"end":return t.stop()}}),t,null,[[5,15]])})))()},getDevices:function(){var e=arguments,t=this;return Object(c["a"])(u.a.mark((function a(){var i,o,r,s,n,c,l;return u.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=e.length>0&&void 0!==e[0]?e[0]:{},t.listLoading=!0,o=t.$baseColorfullLoading(3),t.tableData=[],t.queryPayload.include="product,name",t.queryPayload.where={product:{$ne:null},name:"设备名称"===t.selectdevice&&t.deviceinput?{$regex:t.deviceinput}:{$ne:null,$exists:!0},devaddr:"设备编号"===t.selectdevice&&t.deviceinput?{$regex:t.deviceinput}:{$ne:null},status:"在线"==t.onlinedevices?"ONLINE":"离线"==t.onlinedevices?"OFFLINE":{$ne:null}},0!=t.equvalue&&t.selectProdChange(t.equvalue),0==i.start&&(t.devicestart=0),a.prev=8,a.next=11,Object(y["querycompanyDevice"])(t.queryPayload,t.queryForm.access_token);case 11:if(r=a.sent,s=r.results,n=void 0===s?[]:s,c=r.count,l=void 0===c?0:c,t.listLoading=!1,o.close(),null!==n&&void 0!==n&&n.length){a.next=20;break}return a.abrupt("return");case 20:n.forEach((function(e){if(e.location||(e.location={longitude:0,latitude:0}),e.ACL)for(var t in e.ACL)e.Company=t.substr(5);else e.Company=""})),t.tableData=n,t.devicetotal=l,t.$refs["devicePagination"].ination.total=l,a.next=34;break;case 26:a.prev=26,a.t0=a["catch"](8),dgiotlog.log(a.t0),t.listLoading=!1,o.close(),t.tableData=[],t.devicetotal=0,t.$message.error("".concat(a.t0));case 34:case"end":return a.stop()}}),a,null,[[8,26]])})))()},handelUpdate:function(e,t,a){var i=this;return Object(c["a"])(u.a.mark((function o(){var r,s;return u.a.wrap((function(o){while(1)switch(o.prev=o.next){case 0:for(s in r={},i,t)r[s]=t[s];r.isEnable=1!=r.isEnable,i.tableData[a]=r,i.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(c["a"])(u.a.mark((function a(){var o;return u.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return console.log("row",t),a.next=3,i.$update_object("Device",t.objectId,{isEnable:e});case 3:o=a.sent,void 0!=o?(i.$message({type:"success",message:"状态修改成功"}),i.getDevices()):(dgiotlog.log("Device error",error),Object(v["returnLogin"])(error));case 5:case"end":return a.stop()}}),a)})))).catch(Object(c["a"])(u.a.mark((function e(){var o;return u.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:i.$message({type:"info",message:"已取消修改"}),o=t,o.isEnable=1!=o.isEnable,i.tableData[a]=o;case 4:case"end":return e.stop()}}),e)}))));case 6:case"end":return o.stop()}}),o)})))()},timestampToTime:function(e){var t=new Date(1200*e),a=t.getFullYear()+"-",i=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",o=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",r=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",s=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",n=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return a+i+o+r+s+n},utc2beijing:function(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},filterTag:function(e,t){return t.tag===e},deleteDevcie:function(e){var t=this;return Object(c["a"])(u.a.mark((function e(){return u.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.multipleTable.map(function(){var e=Object(c["a"])(u.a.mark((function e(a){return u.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$del_object("Device",a.objectId);case 2:e.sent;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.$message({message:"删除成功",type:"success"}),t.getDevices();case 3:case"end":return e.stop()}}),e)})))()},editDevice:function(){var e=this;return Object(c["a"])(u.a.mark((function t(){var a;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$update_object("Device",item.objectId,params);case 2:a=t.sent,a.updatedAt?e.initQuery("设备修改成功","success"):e.$message({type:"error",message:a.error});case 4:case"end":return t.stop()}}),t)})))()},unactiveDevice:function(e){var t=this;return Object(c["a"])(u.a.mark((function a(){var i,o,r,s;return u.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=[],o=[],t.multipleTable.map((function(e){i.push(e.objectId)})),r={isEnable:e},a.next=6,Object(h["Batchdelete"])("PUT","Device",i,r);case 6:s=a.sent,s&&(s.forEach((function(e,t){e.objectId=i[t],e.sortIndex=t+1,"success"==Object.keys(s[t])[0]?(e.msg="edit success",e.dangerouslyUseHTMLString=!1):(e.msg="<ol>\n            edit error <br>\n            message: ".concat(e.error.error," <br>\n            code: ").concat(e.error.code," <ol>"),e.dangerouslyUseHTMLString=!0),o.push({type:Object.keys(s[t])[0],message:e.msg,dangerouslyUseHTMLString:e.dangerouslyUseHTMLString})})),o.forEach((function(e,a){t.$baseNotify(e.message,"".concat(i[a]),e.type,"top-right",5e3*e.sortIndex,e.dangerouslyUseHTMLString)})),t.getDevices());case 8:case"end":return a.stop()}}),a)})))()},rowClass:function(e){e.row;var t=e.rowIndex;if(this.selectRow.includes(t))return{"background-color":"rgba(185, 221, 249, 0.3)"}},deviceSizeChange:function(e){this.devicelength=e,this.getDevices()},deviceCurrentChange:function(e){this.devicestart=(e-1)*this.devicelength,this.getDevices()},handleClose:function(){this.deviceid="",this.deviceform={name:"",devaddr:"",batchId:"",desc:"",nodeType:0,devType:"",netType:"",assetNum:"",devModel:"",address:"",videoSrc:"",productName:"",status:"",isEnable:"",brand:"",auth:"",yysId:""},this.$refs["deviceform"].resetFields(),this.devicedialogVisible=!1,this.equipmentEditor="添加"},addDeviceForm:function(){this.devicedialogVisible=!0,this.arrlist=[],this.equipmentEditor="添加",this.$route.query.productid?this.deviceform.productName=this.$route.query.productid:0!=this.equvalue?(this.changeproduct=!1,this.deviceform.productName=this.equvalue,this.selectChange(this.equvalue,"add")):this.deviceform.productName=""},handleClose1:function(){this.pcdialogVisible=!1,this.batchid="",this.pcformInline={pcname:"",createdtime:""}},makeSure:function(e,t){var a=this;return Object(c["a"])(u.a.mark((function i(){var o;return u.a.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,a.$del_object("Device",row.objectId);case 2:o=i.sent,o.error?a.$message({type:"error",message:"删除失败"}):(a.$message({type:"success",message:"删除成功"}),a.getDevices()),e._self.$refs["popover-".concat(t)].doClose();case 5:case"end":return i.stop()}}),i)})))()},editorDevice:function(e){var t=this;return Object(c["a"])(u.a.mark((function a(){var i;return u.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:for(i in t.editRow={},t.selectChange(e.product.objectId,"edit"),t.deviceform={},dgiotlog.log("row",e),t.editRow=e,t.deviceid=e.objectId,t.devicedialogVisible=!0,t.imeideviceName="first",t.deviceform={devaddr:e.devaddr,name:e.name,assetNum:e.detail.assetNum,devModel:e.detail.devModel,desc:e.detail.desc,productid:e.product.objectId,brand:e.detail.brand,productName:e.product.objectId,status:e.status,isEnable:e.isEnable,videoType:e.detail.videoType,videoSrc:e.detail.videoSrc,address:e.detail.address},dgiotlog.log("this.deviceform12131",t.deviceform),dgiotlog.log("row.basedata",e.basedata),e.basedata)t.$set(t.deviceform,i,e.basedata[i]);dgiotlog.log("this.deviceform",t.deviceform),t.bmapform={address:e.detail.address},t.center={lat:location.latitude,lng:location.longitude},t.addresspointer=void 0==e.detail||void 0==location||location.latitude+e.detail==void 0?"":location.longitude,t.equipmentEditor="编辑";case 17:case"end":return a.stop()}}),a)})))()},getBatch:function(){return new g["Promise"]((function(e,t){i.length>0?e(i):t(!1)}))},initQuery:function(e,t){this.$message({type:t||"info",message:e}),this.dialogFormVisible=!1,this.getDevices({start:0})},updateDevice:function(e){var t=this;return Object(c["a"])(u.a.mark((function a(){var i;return u.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$update_object("Device",t.deviceid,e);case 2:i=a.sent,i.updatedAt||i.devaddr?t.initQuery("设备更新成功","success"):t.$message({type:"error",message:i.error});case 4:case"end":return a.stop()}}),a)})))()},createDevice:function(e){var t=this;return Object(c["a"])(u.a.mark((function a(){var i;return u.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$create_object("Device",e);case 2:i=a.sent,i.objectId?(t.deviceform={},t.handleClose(),t.initQuery("设备创建成功","success")):t.$message({type:"error",message:i});case 4:case"end":return a.stop()}}),a)})))()},selectChange:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"add";this.arrlist=[],Object(f["getProduct"])(e).then((function(e){var i=e.config,o=void 0===i?{basedate:{}}:i,r=e.ACL;t.productDetail=e,t.addACL=r,o.basedate&&o.basedate.params.length>0&&(t.arrlist=o.basedate.params,"add"==a&&t.arrlist.map((function(e){var a;if("bool"==e.type)t.$set(t.deviceform,e.identifier?e.identifier:"",null!==(a=e.default)&&void 0!==a&&a.length?e.default:"");else if("enum"==e.type){var i,o,r;t.$set(t.deviceform,e.identifier?e.identifier:"",null!==(i=e.specs)&&void 0!==i&&null!==(o=i[0])&&void 0!==o&&null!==(r=o.attribute)&&void 0!==r&&r.length?e.specs[0].attribute:"")}else{var s;t.$set(t.deviceform,e.identifier?e.identifier:"",null!==(s=e.default)&&void 0!==s&&s.length?e.default:"")}e.required&&("bool"==e.type?t.rules[e.identifier]=[{required:!0,message:"请选择"+e.name,trigger:"change"}]:t.rules[e.identifier]=[{required:!0,message:"请输入"+e.name,trigger:"blur"}])})),dgiotlog.log("afd",t.arrlist),dgiotlog.log("deviceform",t.deviceform),dgiotlog.log("rules",t.rules))}))},submitForm:function(e){var t=this;return Object(c["a"])(u.a.mark((function a(){return u.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.$refs[e].validate(function(){var e=Object(c["a"])(u.a.mark((function e(a){var i,o,r,s,n,c;return u.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!a){e.next=23;break}for(s in i={__type:"GeoPoint",latitude:t.center.lat?t.center.lat:0,longitude:t.center.lng?t.center.lng:0},o={assetNum:t.deviceform.assetNum,devModel:t.deviceform.devModel,brand:t.deviceform.brand,address:t.bmapform.address,desc:t.deviceform.desc,videoType:t.deviceform.videoType,videoSrc:t.deviceform.videoSrc},r={},t.deviceform)r[s]=t.deviceform[s];t.$delete(r,"address"),t.$delete(r,"assetNum"),t.$delete(r,"batchId"),t.$delete(r,"brand"),t.$delete(r,"desc"),t.$delete(r,"devModel"),t.$delete(r,"devType"),t.$delete(r,"devaddr"),t.$delete(r,"isEnable"),t.$delete(r,"name"),t.$delete(r,"netType"),t.$delete(r,"nodeType"),t.$delete(r,"productName"),t.$delete(r,"status"),t.$delete(r,"productid"),""!=t.deviceid?(n={name:t.deviceform.name,devaddr:t.deviceform.devaddr,product:{__type:"Pointer",className:"Product",objectId:t.editRow.product.objectId},detail:o,location:i,basedata:r,profile:r},t.updateDevice(n),t.handleClose(),t.getDevices({start:0})):(c={count:"objectId",where:{name:{$in:[t.deviceform.name]},devaddr:{$in:[t.deviceform.devaddr]}}},t.$query_object("Device",c).then((function(e){if(e.count>0)t.$message("此设备已被创建");else{var a={product:{__type:"Pointer",className:"Product",objectId:t.deviceform.productName},status:"OFFLINE",isEnable:!1,ACL:t.addACL,name:t.deviceform.name,devaddr:t.deviceform.devaddr,objectId:t.deviceform.devaddr,lastOnlineTime:0,detail:o,location:i,basedata:r};a.detail.devType=t.productDetail.devType,a.detail.category=t.productDetail.category.objectId,console.log("createDevice params\n ",a),t.createDevice(a)}}))),e.next=25;break;case 23:return t.$message({type:"error",message:"请按照要求填写参数"}),e.abrupt("return",!1);case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return a.stop()}}),a)})))()},submitimeiForm:function(e){var t=this;return Object(c["a"])(u.a.mark((function a(){return u.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.$refs[e].validate(function(){var e=Object(c["a"])(u.a.mark((function e(a){var i;return u.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!a){e.next=5;break}i={productid:t.imeiform.productName,devaddr:t.imeiform.devimei,latitude:t.center.lat?t.center.lat:0,longitude:t.center.lng?t.center.lng:0},Object(y["addimeidevice"])(i).then((function(e){e.objectId?(t.deviceform={},t.handleClose(),t.initQuery("设备创建成功","success")):t.$message({type:"error",message:e})})),e.next=7;break;case 5:return t.$message({type:"error",message:"请按照要求填写参数"}),e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return a.stop()}}),a)})))()},deviceToDetail:function(e){this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,productid:e.product.objectId,ischildren:"false"}})},konvaDevice:function(e){this.$router.push({path:"/Topo",query:{productid:e.product.objectId,devaddr:e.devaddr,deviceid:e.objectId,type:"device"}})}})},C=I,D=(a("a5cd"),a("bdd7")),j=Object(D["a"])(C,o,r,!1,null,"33259557",null);t["default"]=j.exports},a8a7:function(e,t,a){},bb09:function(e,t,a){"use strict";a("4113")},bf992:function(e,t,a){},c4db:function(e,t,a){"use strict";a.r(t);var i,o,r,s,n,c,l,d=a("fb07"),u=a("e97b"),p=a("d0d7"),m=a.n(p),h=(a("1d17"),a("37c6"),a("04d6"),a("a0e0"),a("3dec"),a("16b8"),a("f1e1"),a("9c6a"),a("c4bc"),a("0c40"),a("79da"),a("e170"),a("d6a4"),a("3de5"),a("98da"),a("e472"),a("1ec3"),a("9f39"),a("4656"),a("1c6f"),a("5880")),g=a("1285"),f=a("7212"),b=a("12674"),v=a("e0e9"),y=a("89e8"),w=a("1b07"),T=a("ef68"),$=a("bb22"),I=a("83b1"),C=a("0e2a"),D=a("aed5"),j=a("926a"),x=a("30b0"),A={},S=a("f43e").Base64,F="",k="";t["default"]={components:{"dgiot-wmx":D["default"],"dgiot-profile":x["default"]},data:function(){var e=this,t=function(e,t,a){var i=/[0-9a-zA-Z]/;i.test(t)?a():a(new Error("协议名称由数字和字母组合"))},a=function(t,a,i){""===a?i(new Error("最小值不能为空")):""!==e.sizeForm.endnumber&&(a>=e.sizeForm.endnumber?i(new Error("最小值小于最大值")):i())},i=function(t,a,i){""===a?i(new Error("最大值不能为空")):""!==e.sizeForm.startnumber&&(a<=e.sizeForm.startnumber?i(new Error("最大值必须大于最小值")):i())},o=function(t,a,i){a<0?i(new Error("步长大于0")):a>=e.sizeForm.endnumber-e.sizeForm.startnumber?i(new Error("步长必须小于最大值和最小值的差值")):i()},r=function(t,a,i){""===a?i(new Error("最小值不能为空")):""!==e.structform.endnumber&&(a>=e.structform.endnumber?i(new Error("最小值小于最大值")):i())},s=function(t,a,i){""===a?i(new Error("最大值不能为空")):""!==e.structform.startnumber&&(a<=e.structform.startnumber?i(new Error("最大值必须大于最小值")):i())},n=function(t,a,i){a<0?i(new Error("步长大于0")):a>=e.structform.endnumber-e.structform.startnumber?i(new Error("步长必须小于最大值和最小值的差值")):i()};return{codeFlag:!1,productInfo:{decoder:{code:""},thing:{properties:[]},config:{parser:[],profile:[],basedate:{params:[]}}},FromMachine:[{name:"ALL"}],machineForm:{},machine:!1,devicetype:"",machinestatus:"add",machineindex:0,options:[{value:"first",label:"第一轮"},{value:"last",label:"最后一轮"},{value:"all",label:"全部"}],activeIndex:"",editableTabsValue:"1",editableTabs:[],tabIndex:1,sizeOption:[{label:"20",val:"20"},{label:"不采集(计算值)",val:"计算值"},{label:"不采集(主动上报)",val:"主动上报"}],showList:!1,collapseName:["1","2","3","4"],multipleSelection:[],protolchannel:[],protoldialog:!1,productimg:"",topicdialogVisible:!1,topicform:{topic:"",type:"",desc:"",isupdated:-1},exportDialogShow:!1,exportUrl:"",exportName:"",decodertotal:0,decoderstart:0,leftItemPos:0,ed3isShow:!1,rightCollection:"",decoderlength:10,topicrule:{topic:[{required:!0,message:"请输入Topic类",trigger:"blur"}],type:[{required:!0,message:"请选择Topic权限",trigger:"change"}]},topicstart:1,topiclength:10,topictotal:0,channelData:[],allchannelData:[],innerVisible:!1,allChannelstart:0,allChannellength:20,allChanneltotal:0,category:[],current:0,schemadialogVisible:!1,collectionDialogVisible:!1,PropData:[],originwmx:!1,wmxdialogVisible:!1,wmxSituation:"新增",allunit:[],sizerule:{step:[{required:!0,trigger:"blur",validator:o}],string:[{required:!0,trigger:"blur",message:"请输入数据长度"},{type:"number",message:"数据长度必须为数字"}],startnumber:[{validator:a,required:!0,trigger:"blur"}],endnumber:[{validator:i,required:!0,trigger:"blur"}],resource:[{required:!0,message:"请选择功能类型",trigger:"change"}],true:[{required:!0,message:"请输入属性值",trigger:"blur"}],false:[{required:!0,message:"请输入属性值",trigger:"blur"}],name:[{required:!0,message:"请输入属性名称",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"}],dis:[{required:!0,message:"请输入数据标识",trigger:"blur"}],type:[{required:!0,message:"请选择数据类型",trigger:"change"}],attribute:[{required:!0,message:"请输入属性",trigger:"blur"}],attributevalue:[{required:!0,message:"请输入属性值",trigger:"blur"}],isread:[{required:!0,message:"请选择读写类型",trigger:"change"}]},structrule:{string:[{required:!0,trigger:"blur",message:"请输入数据长度"},{type:"number",message:"数据长度必须为数字"}],step:[{required:!0,trigger:"blur",validator:n}],startnumber:[{validator:r,required:!0,trigger:"blur"}],endnumber:[{validator:s,required:!0,trigger:"blur"}],resource:[{required:!0,message:"请选择功能类型",trigger:"change"}],true:[{required:!0,message:"请输入属性值",trigger:"blur"}],false:[{required:!0,message:"请输入属性值",trigger:"blur"}],name:[{required:!0,message:"请输入属性名称",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"}],dis:[{required:!0,message:"请输入数据标识",trigger:"blur"}],type:[{required:!0,message:"请选择数据类型",trigger:"change"}],attribute:[{required:!0,message:"请输入属性",trigger:"blur"}],attributevalue:[{required:!0,message:"请输入属性值",trigger:"blur"}],isread:[{required:!0,message:"请选择读写类型",trigger:"change"}]},structdialog:!1,structform:{resource:1,identifier:"",type:"INT",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",unit:"",date:"String类型的UTC时间戳 (毫秒)",string:"",specs:[],dis:"0X10",dinumber:"null",das:[]},tableData:[],activeName:"first",form:{Productname:"",ProductKey:"",ProductAll:0},ProductSecret:"",dynamicReg:!1,productId:"",productName:"",productdetail:{},topicData:[],topic:[{topic:"thing/${ProductId}/${DevAddr}/post",type:"pub",desc:"设备上报",isdef:!0},{topic:"thing/${ProductId}/${DevAddr}",type:"sub",desc:"消息下发",isdef:!0}],isshow:!1,addRules:{name:[{required:!0,message:"请输入协议名称",trigger:"blur"},{validator:t,trigger:"blur"}]},dialogTableVisible:!1,gridData:[],formInline:{name:"",version:"",desc:"",resource:!1},option:[],CategoryKey:"",productstart:0,productlength:10,producttotal:0,wmxstart:1,wmxPageSize:10,wmxtotal:20,wmxData:[],wmxDataBk:[],editorList:[],warningeditror:[],channellength:20,channelstart:0,channeltotal:0,isupdatedstruct:-1,issub:!1,subtimer:null,subdialog:!1,textarea:"",subdialogtimer:null,subdialogid:"",subaction:"stop",channelname:"",value4:!0,rulepagesize:10,rulestart:0,ruletotal:0,engineData:[],channeltype:0,resourcechannelData:[],resourcestart:0,resourcelength:10,resourcetotal:0,resourcedialogFormVisible:!1,resourceform:{},resourcechannelid:"",isreload:1,modifyIndex:-1,ace_editor:"",iframeShow:!1}},computed:Object(u["a"])({treeData:function(){var e=JSON.parse(JSON.stringify(this.option));return e.filter((function(t){var a=e.filter((function(e){return t.id==e.parentid}));return a.length>0&&(t.children=a),0==t.parentid}))},showNewItem:function(){return!(!this.sizeForm||"modbus"!=this.sizeForm.protocol)}},Object(h["mapGetters"])({sizeForm:"konva/sizeForm"})),watch:{issub:{deep:!0,handler:function(e){var t=this;this.subtimer=window.setInterval((function(){t.subAce("formInline",!1)}),5e3)}}},mounted:function(){var e=this;this.$nextTick((function(){e.$refs._tabs.$children[0].$refs.tabs[3].style.display="none",C["Websocket"].subscribe({topic:"log/channel/#",qos:2})})),this.Industry(),this.getAllunit(),r=ace.edit("editor2"),r.session.setMode("ace/mode/text"),r.setTheme("ace/theme/monokai"),r.setReadOnly(!0),r.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.$route.query.activeName&&(this.activeName=this.$route.query.activeName)},beforeDestroy:function(){window.clearInterval(this.subtimer),this.subtimer=null,window.clearInterval(this.subdialogtimer),this.subdialogtimer=null},methods:Object(u["a"])(Object(u["a"])({feateditorParser1:function(e,t,a){var i=this.productInfo;this.parserType=t,this.$baseEventBus.$emit("profileDialog",{config:e,type:t,flag:a,productInfo:i})}},Object(h["mapMutations"])({setSizeForm:"konva/setSizeForm"})),{},{tableRowClassName:function(e){e.row;var t=e.rowIndex;return 1===t?"warning-row":3===t?"success-row":""},selectStruct:function(e){},toggleList:function(){this.showList=!this.showList},getFormOrginalData:function(){return{devicetype:this.devicetype,strategy:"20",resource:1,identifier:"",dis:"0X10",dinumber:"null",type:"int",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",isshow:!0,unit:"",string:"",date:"String类型的UTC时间戳 (毫秒)",specs:{},precision:3,round:"all",struct:[{attribute:"",attributevalue:""}],das:[],daslist:[],rate:1,offset:0,order:0,protocol:"normal",operatetype:"readCoils",originaltype:"short16_AB",slaveid:"0X10",collection:"%s",control:"%d",nobound:[],editdatatype:!1,iscount:"0",countstrategy:20,countround:"all",countcollection:"%s"}},changeValue:function(e){this.$refs[e].validateField("startnumber",(function(e){if(e)return!1}))},changeStructValue:function(e){this.$refs[e].validateField("startnumber",(function(e){if(e)return!1}))},getRowClass:function(e,t){if("struct"!=e.row.dataType.type)return"row-expand-cover"},getChannelEnable:function(e,t){return 1==e.row.isEnable?"green_active":"red_active"},handleClick:function(e){"fourth"==e.name||("fiveth"==e.name?this.getProductChannel():"second"==e.name?this.getTopic():"seven"==e.name?this.getResourceChannel():"sixeth"==e.name?this.orginRule():"eighth"==e.name?this.isreload++:"fourth"!=e.name&&(window.clearInterval(this.subtimer),this.subtimer=null))},getAllunit:function(){var e=this;return Object(d["a"])(m.a.mark((function t(){var a,i;return m.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.allunit=[],t.next=3,Object(v["getAllunit"])("unit",200);case 3:a=t.sent,i=a.results,e.allunit=i.concat([]),e.allunit.unshift({data:{Name:"无",Symbol:""}});case 7:case"end":return t.stop()}}),t)})))()},getTopic:function(){var e=this,t=[];this.$get_object("Product",this.productId).then((function(a){null!==a&&void 0!==a&&a.topics&&(a.topics.forEach((function(e){e&&t.push(e)})),dgiotlog.log("resultes",a.topics),dgiotlog.log("topics",t),e.topicData=t.concat(e.topic))})).catch((function(t){e.$baseMessage("请求出错",t.error,3e3)}))},exportProduct:function(e){var t=this;return Object(d["a"])(m.a.mark((function a(){var i,o,r;return m.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,i={name:e},o=t.$baseColorfullLoading(),a.next=5,Object(b["downBinary"])("iotapi/product",i);case 5:r=a.sent,dgiotlog.log(r),t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),o.close(),t.$downBinary(r),a.next=16;break;case 12:a.prev=12,a.t0=a["catch"](0),dgiotlog.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 16:case"end":return a.stop()}}),a,null,[[0,12]])})))()},seeDecoder:function(e){var t=this;return Object(d["a"])(m.a.mark((function a(){return m.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:try{t.ace_editor=S.decode(e.code)}catch(error){dgiotlog.log(error)}case 1:case"end":return a.stop()}}),a)})))()},setTemplate:function(e){var t=this;return Object(d["a"])(m.a.mark((function a(){var i,o,r,s,n,c,l,d,u,p,h,g,f,b,v,y,w,$,I,C,D,j;return m.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=t.$baseColorfullLoading(),o=e.category,r=void 0===o?"IotHub":o,s=e.config,n=void 0===s?{konva:{Stage:{attrs:{x:14,y:29,id:"container",width:1635,height:767,container:"container",draggable:!0},children:[{attrs:{id:"Layer_5SKeJT"},children:[{attrs:{id:"Group_RoT",width:2e3,height:2e3},children:[],className:"Group"},{attrs:{id:"Group_QtGicp",draggable:!0},children:[{attrs:{x:10,y:15,id:"#dgiot-quanyizhongxinbeifen-0-1630891418339",data:"M73.142857 0h877.714286v877.714286H73.142857z",fill:"#FFFFFF",angle:-30,scaleX:.15,scaleY:.15,originX:"center",originY:"bottom",className:"Path"},className:"Path"},{attrs:{x:10,y:15,id:"#dgiot-quanyizhongxinbeifen-1-1630891418339",data:"M877.714286 137.142857A27.428571 27.428571 0 0 1 905.142857 164.571429v201.142857a27.428571 27.428571 0 0 1-27.428571 27.428571l-3.017143 0.091429A45.714286 45.714286 0 0 0 877.714286 484.571429l2.633143 0.128A27.428571 27.428571 0 0 1 905.142857 512v201.142857a27.428571 27.428571 0 0 1-27.428571 27.428572H146.285714A27.428571 27.428571 0 0 1 118.857143 713.142857V512A27.428571 27.428571 0 0 1 146.285714 484.571429l2.998857-0.091429A45.714286 45.714286 0 0 0 146.285714 393.142857l-2.651428-0.128A27.428571 27.428571 0 0 1 118.857143 365.714286V164.571429A27.428571 27.428571 0 0 1 146.285714 137.142857z m-296.100572 138.185143l-69.266285 69.284571-69.266286-69.284571-38.784 38.802286 58.258286 58.258285H402.285714v54.857143h82.285715v39.186286H402.285714v54.857143h82.285715v66.614857h54.857142v-66.614857H621.714286v-54.857143h-82.285715v-39.186286H621.714286v-54.857143h-59.574857l58.276571-58.258285-38.802286-38.802286z",fill:"#111111",angle:-30,scaleX:.15,scaleY:.15,originX:"center",originY:"bottom",className:"Path"},className:"Path"}],className:"Group"}],className:"Layer"}],className:"Stage"}},parser:[],profile:[],basedate:{}}:s,c=e.decoder,l=void 0===c?{code:""}:c,d=e.desc,u=void 0===d?"":d,p=e.icon,h=void 0===p?"":p,g=e.name,f=void 0===g?"":g,b=e.netType,v=void 0===b?"Modbus":b,y=e.nodeType,w=void 0===y?0:y,$=e.thing,I=void 0===$?{properties:[]}:$,a.prev=2,C={},C["*"]={read:!0,write:!0},D={ACL:C,category:r,config:n,decoder:l,desc:u,icon:h,name:f,netType:v,nodeType:w,thing:I},a.next=8,Object(T["postProductTemplet"])(D);case 8:j=a.sent,dgiotlog.log(j),j?t.$baseMessage(t.$translateTitle("user.Save the template successfully"),"success","vab-hey-message-success"):t.$baseMessage(t.$translateTitle("user.Save the template error"),"error","vab-hey-message-error"),i.close(),a.next=19;break;case 14:a.prev=14,a.t0=a["catch"](2),dgiotlog.log(a.t0),i.close(),t.$baseMessage(t.$translateTitle("user.Save the template error"),"error","vab-hey-message-error");case 19:case"end":return a.stop()}}),a,null,[[2,14]])})))()},updatesubdialog:function(){var e=this;return Object(d["a"])(m.a.mark((function t(){var a,i;return m.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.protoldialog=!0,a="1",i={__type:"Pointer",className:"Product",objectId:e.productId},Object(y["getChannelCountByProduct"])(e.channellength,e.channelstart,i,a).then((function(t){e.protolchannel=t.results,e.$refs.multipleTable.toggleAllSelection()})).catch((function(t){dgiotlog.log(t),e.$baseMessage("请求出错",t.error,3e3)}));case 4:case"end":return t.stop()}}),t)})))()},handleSelectionChange:function(e){this.multipleSelection=e},updateAllChannel:function(){var e=this;if(0==this.multipleSelection.length)this.protoldialog=!1;else{var t=[];this.multipleSelection.map((function(e){t.push(new Promise((function(t,a){return Object($["subupadte"])(e.objectId,"update").then((function(e){e&&t(e)})).catch((function(e){a(e)}))})))})),Promise.all(t).then((function(t){e.$message({message:"热加载成功",type:"success"}),t.length==e.multipleSelection.length&&(e.protoldialog=!1)})).catch((function(t){e.$message({message:t,type:"error"})}))}},showAllChannel:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";dgiotlog.log(this.allChannelstart,this.allChannellength),this.allChanneltotal=0,this.allchannelData=[],this.channeltype=1,this.innerVisible=!0;var a={$in:["1","3"]},i={$ne:{__type:"Pointer",className:"Product",objectId:this.productId}};Object(y["getChannelCountByProduct"])(""!=t?this.allChannellength:this.channellength,""!=t?this.allChannelstart:this.channelstart,i,a).then((function(t){e.allChanneltotal=t.count,e.allchannelData=t.results})).catch((function(e){dgiotlog.log(e)}))},getProductChannel:function(){var e=this,t={$in:["1","3"]},a={__type:"Pointer",className:"Product",objectId:this.productId};Object(y["getChannelCountByProduct"])(this.channellength,this.channelstart,a,t).then((function(t){e.channeltotal=t.count,e.channelData=t.results,0==t.results.length})).catch((function(e){dgiotlog.log(e)}))},resourceShowAllChannel:function(){var e=this;this.allChanneltotal=0,this.allchannelData=[],this.channeltype=0,this.innerVisible=!0;var t={$in:["2"]},a={$ne:{__type:"Pointer",className:"Product",objectId:this.productId}};Object(y["getChannelCountByProduct"])(this.channellength,this.channelstart,a,t).then((function(t){e.allChanneltotal=t.count,e.allchannelData=t.results})).catch((function(e){dgiotlog.log(e)}))},getResourceChannel:function(){var e=this,t={$in:["2"]},a={__type:"Pointer",className:"Product",objectId:this.productId};Object(y["getChannelCountByProduct"])(this.channellength,this.channelstart,a,t).then((function(t){e.resourcetotal=t.count,e.resourcechannelData=t.results})).catch((function(e){dgiotlog.log(e)}))},addProductChannel:function(e){var t=this;return Object(d["a"])(m.a.mark((function a(){var i,o;return m.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i={product:{__op:"AddRelation",objects:[{__type:"Pointer",className:"Product",objectId:t.productId}]}},a.next=3,Object(y["saveChanne"])(e,i);case 3:o=a.sent,o&&(t.$message({type:"success",message:"添加成功"}),1==t.channeltype?(t.showAllChannel(),t.getProductChannel()):(t.resourceShowAllChannel(),t.getResourceChannel()));case 5:case"end":return a.stop()}}),a)})))()},deleteRelation:function(e){var t=this,a={product:{__op:"RemoveRelation",objects:[{__type:"Pointer",className:"Product",objectId:this.productId}]}};Object(y["saveChanne"])(e.objectId,a).then((function(e){e&&t.$message({type:"success",message:"移除成功"}),t.getProductChannel(),t.getResourceChannel()}))},channelSizeChange:function(e){this.channellength=e,this.getProductChannel()},channelCurrentChange:function(e){this.channelstart=(e-1)*this.channellength,this.getProductChannel()},resourcechannelSizeChange:function(e){this.resourcelength=e,this.getResourceChannel()},resourcechannelCurrentChange:function(e){this.resourcestart=(e-1)*this.resourcelength,this.getResourceChannel()},allChannelSizeChange:function(e){this.allChannellength=e,this.showAllChannel("Channel")},allChannelCurrentChange:function(e){this.allChannelstart=(e-1)*this.allChannellength,this.showAllChannel("Channel")},customize:function(e){var t=this;this.resourcedialogFormVisible=!0,this.resourcechannelid=e.objectId,A=JSON.parse(JSON.stringify(e.config)),Object(I["setTimeout"])((function(){n=ace.edit("editormodel"),n.session.setMode("ace/mode/json"),n.setTheme("ace/theme/twilight"),n.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),n.setReadOnly(!0),n.setValue(JSON.stringify(t.productdetail.thing,null,4)),c=ace.edit("editorcreate"),c.session.setMode("ace/mode/mysql"),c.setTheme("ace/theme/twilight"),c.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),e.config.datamodel&&""!=e.config.datamodel?c.setValue(e.config.datamodel):c.setValue('{\n            "vars":{\n              "database":"aosong",\n              "stable":"meter",\n              "value":[\n                {\n                  "timestamp":"TIMESTAMP",\n                  "bytes":8\n                },\n                {\n                  "temperature":"FLOAT",\n                  "bytes":4\n                },\n                {\n                  "humidity":"FLOAT",\n                  "bytes":4\n                }\n              ],\n              "tags":[\n                {\n                  "devaddr":"BINARY",\n                  "bytes":12\n                }\n              ],\n              "table":"devaddr",\n              "keep":3650\n            },\n            "sql":{\n              "create_database":"CREATE DATABASE IF NOT EXISTS ${database} KEEP ${keep}",\n              "drop_database":"DROP DATABASE IF EXISTS ${database}",\n              "creat_stable":"CREATE TABLE IF NOT EXISTS ${database}.${stable} (${timestamp} TIMESTAMP, temperature FLOAT, humidity FLOAT) TAGS(devaddr BINARY[12]);",\n              "drop_stable":"DROP TABLE ${database}.${stable}",\n              "insert_stable":"INSERT INTO ${database}.${table} USING ${database}.${stable} TAGS (${devaddr}) VALUES (${temperature}, ${humidity})",\n              "insert_table":"INSERT INTO ${database}.${table} VALUES (${temperature}, ${humidity})",\n              "create_table":"CREATE TABLE ${databas}.${table} USING ${database}.${stable} TAGS (${devaddr});"\n            }\n          }')}))},questionModel:function(){Object(I["setTimeout"])((function(){l=ace.edit("editorinsert"),l.session.setMode("ace/mode/mysql"),l.setTheme("ace/theme/gob"),l.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),l.setValue('{\n          "vars":{\n            "database":"database",\n            "table":"stable",\n            "value":[\n              {\n                "timestamp":"TIMESTAMP",\n                "bytes":8\n              },\n              {\n                "int":"INT",\n                "bytes":4\n              },\n              {\n                "bigint":"BIGINT",\n                "bytes":8\n              },\n              {\n                "float":"FLOAT",\n                "bytes":4\n              },\n              {\n                "double":"DOUBLE",\n                "bytes":8\n              },\n              {\n                "binary":"BINARY",\n                "bytes":"自定义"\n              },\n              {\n                "smallint":"SMALLINT",\n                "bytes":2\n              },\n              {\n                "tinyint":"TINYINT",\n                "bytes":1\n              },\n              {\n                "bool":"BOOL",\n                "bytes":1\n              },\n              {\n                "nchar":"NCHAR",\n                "bytes":"自定义"\n              }\n            ],\n            "tags":[\n              {\n                "int":"INT",\n                "bytes":4\n              },\n              {\n                "bigint":"BIGINT",\n                "bytes":8\n              },\n              {\n                "float":"FLOAT",\n                "bytes":4\n              },\n              {\n                "double":"DOUBLE",\n                "bytes":8\n              },\n              {\n                "binary":"BINARY",\n                "bytes":"自定义"\n              },\n              {\n                "smallint":"SMALLINT",\n                "bytes":2\n              },\n              {\n                "tinyint":"TINYINT",\n                "bytes":1\n              },\n              {\n                "bool":"BOOL",\n                "bytes":1\n              },\n              {\n                "nchar":"NCHAR",\n                "bytes":"自定义"\n              }\n            ]\n          },\n          "sql":{\n            "create_database":"CREATE DATABASE IF NOT EXISTS {{database}} KEEP {{keep}}",\n            "drop_database":"DROP DATABASE IF EXISTS {{database}}",\n            "creat_stable":"CREATE TABLE IF NOT EXISTS {{database}}.{{stable}} ({{timestamp}} TIMESTAMP, temperature FLOAT, humidity FLOAT) TAGS(devaddr BINARY[12]);",\n            "drop_stable":"DROP TABLE {{database}}.{{stable}}",\n            "insert_stable":"INSERT INTO {{database}}.{{table}} USING {{database}}.{{stable}} TAGS ({{devaddr}}) VALUES ({{temperature}}, {{humidity}})",\n            "insert_table":"INSERT INTO {{database}}.{{table}} VALUES ({{temperature}}, {{humidity}})",\n            "create_table":"CREATE TABLE {{database}}.{{table}} USING {{database}}.{{stable}} TAGS ({{devaddr}});"\n          }\n        }')}))},addData:function(){var e=this;A.datamodel=c.getValue();var t={config:A};this.$update_object("Channel",this.rproductdetailesourcechannelid,t).then((function(t){t&&e.$message("添加成功")}),(function(e){Object(j["returnLogin"])(e)}))},closeWuDialog:function(){this.resourcedialogFormVisible=!1,this.resourcechannelid=""},removeDomain:function(e){var t=this.sizeForm.struct.indexOf(e);-1!==t&&this.sizeForm.struct.splice(t,1)},addDomain:function(){this.sizeForm.struct.push({attribute:"",attributevalue:""})},addDas:function(){this.sizeForm.daslist.push({addr:""})},removeDas:function(e){var t=this.sizeForm.daslist.indexOf(e);-1!==t&&this.sizeForm.daslist.splice(t,1)},removeDomain1:function(e){var t=this.structform.specs.indexOf(e);-1!==t&&this.structform.specs.splice(t,1)},addDomain1:function(){this.structform.specs.push({value:"",name:""})},submitForm:function(e){var t=this,a=[];e.daslist.map((function(e){var t=e["addr"];a.push(t)}));var i={name:e.name,devicetype:e.devicetype,dataForm:{round:e.round,data:e.dinumber,address:e.dis,rate:e.rate,offset:e.offset,order:e.order,protocol:e.protocol,operatetype:e.operatetype,originaltype:e.originaltype,slaveid:e.slaveid,collection:e.collection,control:e.control,strategy:e.strategy,iscount:e.iscount,countstrategy:e.countstrategy,countround:e.countround,countcollection:e.countcollection},ico:e.ico,required:!0,accessMode:e.isread,isshow:e.isshow,identifier:e.identifier};if("float"==e.type||"double"==e.type||"int"==e.type||"long"==e.type){var o={dataType:{type:e.type.toLowerCase(),specs:{max:e.endnumber,min:e.startnumber,step:e.step,precision:Number(e.precision),unit:""==e.unit?"":e.unit},das:a}};Object.assign(i,o),this.showNewItem||(delete i.dataForm.operatetype,delete i.dataForm.originaltype,delete i.dataForm.slaveid)}else if("image"==e.type){var r={dataType:{type:e.type.toLowerCase(),imagevalue:e.imagevalue,specs:{},das:a}};Object.assign(i,r)}else if("bool"==e.type){r={dataType:{type:e.type.toLowerCase(),specs:{0:e.false,1:e.true},das:a}};Object.assign(i,r)}else if("enum"==e.type){var s={};e.struct.map((function(e){var t=e["attribute"];s[t]=e["attributevalue"]}));r={dataType:{type:e.type.toLowerCase(),specs:s,das:a}};Object.assign(i,r)}else if("struct"==e.type){r={dataType:{type:e.type.toLowerCase(),specs:e.struct,das:a}};Object.assign(i,r)}else if("text"==e.type){r={dataType:{type:e.type.toLowerCase(),size:e.string,specs:{},das:a}};Object.assign(i,r)}else if("date"==e.type){r={dataType:{type:e.type.toLowerCase(),specs:{},das:a}};Object.assign(i,r)}else if("geopoint"==e.type){r={dataType:{type:e.type.toLowerCase(),gpstype:e.gpstype,specs:{},das:a}};Object.assign(i,r)}delete i.index,dgiotlog.log("obj",i);var n={item:i,productid:this.productId};"新增"==this.wmxSituation?Object(f["postThing"])(n).then((function(e){dgiotlog.log("新增",e),200==e.code?(t.$message({type:"success",message:"新增成功"}),t.getProDetail()):t.$message({type:"warning",message:"新增失败"+e.msg})})):"编辑"==this.wmxSituation&&Object(f["putThing"])(n).then((function(e){dgiotlog.log("编辑",e),200==e.code?(t.$message({type:"success",message:"编辑成功"}),t.getProDetail()):t.$message({type:"warning",message:"编辑失败"+e.msg})})),this.wmxdialogVisible=!1},createProperty:function(){this.setSizeForm(this.getFormOrginalData()),console.log("sizeForm",this.sizeForm),this.wmxdialogVisible=!0,this.wmxSituation="新增"},wmxDataFill:function(e,t){this.modifyIndex=t,this.wmxdialogVisible=!0,this.wmxSituation="编辑";var a={},i=[];if(e.dataType.das.forEach((function(e){i.push({addr:e})})),-1!=["float","double","int","long"].indexOf(e.dataType.type))a={name:e.name,devicetype:e.devicetype,type:e.dataType.type,daslist:i,endnumber:this.$objGet(e,"dataType.specs.max"),startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),precision:this.$objGet(e,"dataType.specs.precision"),dis:this.$objGet(e,"dataForm.address"),round:this.$objGet(e,"dataForm.round"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),slaveid:this.$objGet(e,"dataForm.slaveid"),collection:"",control:"",strategy:"",required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier,editdatatype:!0},e.dataForm&&(a.collection=e.dataForm.collection,a.control=e.dataForm.control,a.strategy=e.dataForm.strategy);else if("bool"==e.dataType.type)a={name:e.name,devicetype:e.devicetype,type:e.dataType.type,true:e.dataType.specs[1],false:e.dataType.specs[0],daslist:i,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!1,ico:e.ico,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0};else if("image"==e.dataType.type)a={name:e.name,devicetype:e.devicetype,type:e.dataType.type,imagevalue:e.dataType.imagevalue,daslist:i,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!1,ico:e.ico,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0};else if("enum"==e.dataType.type){var o=[];for(var r in e.dataType.specs)o.push({attribute:r,attributevalue:e.dataType.specs[r]});a={name:e.name,devicetype:e.devicetype,type:e.dataType.type,specs:e.dataType.specs,struct:o,daslist:i,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0}}else"struct"==e.dataType.type?a={name:e.name,devicetype:e.devicetype,type:e.dataType.type,struct:e.dataType.specs,daslist:i,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,identifier:void 0==e.dataForm?"":e.identifier,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0}:"text"==e.dataType.type?a={name:e.name,devicetype:e.devicetype,type:e.dataType.type,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,string:e.dataType.size,daslist:i,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0}:"date"==e.dataType.type?a={name:e.name,devicetype:e.devicetype,type:e.dataType.type,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,daslist:i,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),order:this.$objGet(e,"dataForm.order"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier,editdatatype:!0}:"geopoint"==e.dataType.type&&(a={name:e.name,devicetype:e.devicetype,type:e.dataType.type,gpstype:e.dataType.gpstype,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,daslist:i,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),order:this.$objGet(e,"dataForm.order"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier,editdatatype:!0});this.setSizeForm(a)},submitStruct:function(e){var t=this;this.$refs[e].validate((function(a){if(a){var i={};if("float"==t.structform.type||"double"==t.structform.type||"int"==t.structform.type)i={name:t.structform.name,dataType:{type:t.structform.type.toLowerCase(),specs:{max:t.structform.endnumber,min:t.structform.startnumber,step:t.structform.step,unit:""==t.structform.unit?"":t.structform.unit}},dataForm:{address:t.structform.dis,data:t.structform.dinumber},required:!0,accessMode:t.structform.isread,identifier:t.structform.identifier};else if("bool"==t.structform.type)i={name:t.structform.name,dataType:{type:t.structform.type.toLowerCase(),specs:{0:t.structform.false,1:t.structform.true}},dataForm:{address:t.structform.dis,data:t.structform.dinumber},required:!1,accessMode:t.structform.isread,identifier:t.structform.identifier};else if("enum"==t.structform.type){var o={};t.structform.struct.map((function(e){var t=e["attribute"];o[t]=e["attributevalue"]})),i={name:t.structform.name,dataType:{type:t.structform.type.toLowerCase(),struct:t.structform.struct,specs:o},dataForm:{address:t.structform.dis,data:t.structform.dinumber},required:!0,accessMode:t.structform.isread,identifier:t.structform.identifier}}else"text"==t.structform.type?i={name:t.structform.name,dataType:{type:t.structform.type.toLowerCase(),size:t.structform.string},dataForm:{address:t.structform.dis,data:t.structform.dinumber},required:!0,accessMode:t.structform.isread,identifier:t.structform.identifier}:"date"==t.structform.type&&(i={name:t.structform.name,dataType:{type:t.structform.type.toLowerCase()},dataForm:{address:t.structform.dis,data:t.structform.dinumber},required:!0,accessMode:t.structform.isread,identifier:t.structform.identifier});-1==t.isupdatedstruct?t.sizeForm.struct.push(i):(t.sizeForm.struct.splice(t.isupdatedstruct,1,i),t.isupdatedstruct=-1),t.$refs[e].resetFields(),t.structdialog=!1}}))},addStruct:function(e){this.structdialog=!0,this.structform={resource:1,identifier:"",type:"int",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",unit:"",specs:[],date:"String类型的UTC时间戳 (毫秒)",string:""}},editStruct:function(e,t){var a=this;if(dgiotlog.log(e,t),this.isupdatedstruct=t,this.structdialog=!0,this.structform.type=e.dataType.type.toUpperCase(),this.structform.name=e.name,this.structform.identifier=e.identifier,this.structform.isread=e.accessMode,"float"==e.dataType.type||"double"==e.dataType.type||"int"==e.dataType.type)this.structform.startnumber=e.dataType.specs.min,this.structform.endnumber=e.dataType.specs.max,this.structform.step=e.dataType.specs.step,this.structform.unit=e.dataType.specs.unit;else if("bool"==e.dataType.type)this.structform.true=e.dataType.specs["1"],this.structform.false=e.dataType.specs["0"];else if("enum"==e.dataType.type){this.structform.specs=[];var i={};Object.keys(e.dataType.specs).forEach((function(t,o){i.attribute=t,i.attributevalue=e.dataType.specs[t],a.structform.specs.push(i)}))}else"text"==e.dataType.type&&(this.structform.string=e.dataType.size)},deleteStruct:function(e){this.sizeForm.struct.splice(e,1)},preserve:function(){var e=this,t={thing:JSON.parse(o.getValue())};this.$update_object("Product",this.productId,t).then((function(t){t&&(e.$message({type:"success",message:"添加成功"}),e.schemadialogVisible=!1)})).catch((function(e){dgiotlog.log(e)}))},Industry:function(){var e=this;return Object(d["a"])(m.a.mark((function t(){var a,i;return m.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.option=[],t.next=3,e.$getIndustry("category",100);case 3:a=t.sent,i=a.results,i.map((function(t){var a={};a.value=t.type,a.label=t.data.CategoryName,a.id=t.data.Id,a.parentid=t.data.SuperId,e.option.push(a)})),e.getProDetail();case 7:case"end":return t.stop()}}),t)})))()},utc2beijing:function(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},getPropData:function(e){var t=this;0==e&&(this.productstart=0),this.CategoryKey=this.$route.query.CategoryKey;var a={count:"objectId",limit:this.productlength,skip:this.productstart,where:{"data.key":"category"}};0!=this.category.length&&(a.where.type=this.category[this.category.length-1]),Object(v["getDictCount"])(a).then((function(e){t.producttotal=e.count,t.PropData=e.results})).catch((function(e){dgiotlog.log(e)}))},productSizeChange:function(e){this.productlength=e,this.getPropData()},productCurrentChange:function(e){this.productstart=(e-1)*this.productlength,this.getPropData()},checkAddTest:function(){var e=this;this.collectionDialogVisible=!0,this.editableTabsValue=this.wmxData[0].identifier,this.activeIndex=this.wmxData[0].identifier,this.editableTabs=[],this.editorList=[],this.tabIndex=1,this.ed3isShow=!1,this.editableTabs.push({title:this.wmxData[0].identifier,name:this.wmxData[0].identifier,leftItemPos:0,content:void 0==this.wmxData[0].dataForm?"":this.wmxData[0].dataForm.collection}),0==this.ed3isShow&&Object(I["setTimeout"])((function(){e.editorList.push(ace.edit(e.wmxData[0].identifier)),e.editorList[0].session.setMode("ace/mode/erlang"),e.editorList[0].setTheme("ace/theme/monokai"),e.editorList[0].setHighlightActiveLine(!0),e.editorList[0].setFontSize(20),e.editorList[0].setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),e.ed3isShow=!0,e.editorList[0].setValue(void 0==e.wmxData[0].dataForm?"":e.wmxData[0].dataForm.collection)}),1)},handleRightTopTabClick:function(e,t){this.activeIndex=e.label},menuTabClick:function(e,t){var a=this;this.activeIndex=e.identifier;var i=this.editableTabs,o=!1,r=0;i.forEach((function(t,a){t.name===e.identifier&&(o=!0,r=a)})),0==o?(this.editableTabs.push({title:e.identifier,name:e.identifier,leftItemPos:t,content:void 0==e.dataForm?"":e.dataForm.collection}),Object(I["setTimeout"])((function(){a.editorList.push(ace.edit(e.identifier)),a.editorList[a.editorList.length-1].session.setMode("ace/mode/erlang"),a.editorList[a.editorList.length-1].setTheme("ace/theme/monokai"),a.editorList[a.editorList.length-1].setHighlightActiveLine(!0),a.editorList[a.editorList.length-1].setFontSize(20),a.editorList[a.editorList.length-1].setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),a.editorList[a.editorList.length-1].setValue(void 0==e.dataForm?"":e.dataForm.collection)}),1),this.editableTabsValue=e.identifier,this.rightCollection=void 0==e.dataForm?"":e.dataForm.collection):(this.editableTabsValue=e.identifier,this.editorList[r].setValue(void 0==e.dataForm?"":e.dataForm.collection))},removeTab:function(e){var t=this.editableTabs,a=this.editableTabsValue;a===e&&t.forEach((function(i,o){if(i.name===e){var r=t[o+1]||t[o-1];r&&(a=r.name)}})),this.editableTabsValue=a,this.activeIndex=a,this.editableTabs=t.filter((function(t){return t.name!==e}))},onSaveTap:function(e){var t=this,a=this.editableTabs[e].leftItemPos;this.productdetail.thing.properties[a].dataForm.collection=this.editorList[e].getValue();var i={thing:this.productdetail.thing};this.$update_object("Product",this.productId,i).then((function(e){e&&(t.$message({type:"success",message:"添加成功"}),t.getProDetail())})).catch((function(e){dgiotlog.log(e)}))},handleCloseCollecttion:function(e){this.$confirm("确认关闭？").then((function(t){e()})).catch((function(e){}))},onReductionTap:function(e){var t=this.editableTabs[e].leftItemPos;this.editorList[e].setValue(this.wmxData[t].dataForm.collection)},checkschema:function(){var e=this;this.schemadialogVisible=!0,Object(I["setTimeout"])((function(){o=ace.edit("editor1"),o.session.setMode("ace/mode/json"),o.setTheme("ace/theme/eclipse"),o.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),o.setValue(JSON.stringify(e.productdetail.thing,null,4))}),1)},getProDetail:function(){var e=this;i=ace.edit("editor"),i.session.setMode("ace/mode/erlang"),i.setTheme("ace/theme/monokai"),i.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.productId=this.$route.query.id,this.queryDeviceCount(this.productId),this.$get_object("Product",this.productId).then((function(t){if(dgiotlog.log("response",t),t){for(var a in e.productInfo=_.merge(t,{decoder:{code:""},thing:{properties:[]},config:{parser:[],profile:[],basedate:{params:[]}}}),e.productName=t.name,t)e.productdetail[a]=t[a];e.option.map((function(t){e.productdetail.category==t.value&&(e.productdetail.category=t.label)})),e.productdetail.createdAt=e.utc2beijing(t.createdAt),e.productdetail.id=t.id,e.dynamicReg=t.dynamicReg,e.productdetail.isshow=0,e.productdetail.category&&e.$get_object("Category",e.productdetail.category.objectId).then((function(t){dgiotlog.log("catcat",t),e.$set(e.productdetail,"categoryname",t.name)})),e.form.Productname=t.name,e.ProductSecret=t.productSecret,e.form.Productkey=e.productId,e.productimg=t.icon,t.decoder?(F=t.decoder.code,e.formInline.name=t.decoder.name,e.formInline.version=t.decoder.version,e.formInline.desc=t.decoder.desc):F="JSUlLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQolJSUgQGNvcHlyaWdodCAoQykgMjAxOCwgPHNodXdhPgolJSUgQGRvYwolJSUg5Y2P6K6u6Kej5p6QRGVtbwolJSUgQGVuZAolJSUgQ3JlYXRlZCA6IDA4LiDljYHkuIDmnIggMjAxOCAxNDo0OQolJSUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi1tb2R1bGUoc2h1d2FfZGVtb19kZWNvZGVyKS4KLWF1dGhvcigic2h1d2EiKS4KLWRlZmluZShNU0dfVFlQRSwgPDwiREVNTyI+PikuCi1wcm90b2NvbChbPDwiREVNTyI+Pl0pLgoKLWV4cG9ydChbcGFyc2VfZnJhbWUvMiwgdG9fZnJhbWUvMV0pLgoKCnBhcnNlX2ZyYW1lKEJ1ZmYsIE9wdHMpIC0+CiAgICBwYXJzZV9mcmFtZShCdWZmLCBbXSwgT3B0cykuCgoKcGFyc2VfZnJhbWUoPDw+PiwgQWNjLCBfT3B0cykgLT4KICAgIHs8PD4+LCBBY2N9OwpwYXJzZV9mcmFtZSg8PDE2IzY4LCBSZXN0L2JpbmFyeT4+ID0gQmluLCBBY2MsIF9PcHRzKSB3aGVuIGJ5dGVfc2l6ZShSZXN0KSA9PCA2IC0+CiAgICB7QmluLCBBY2N9OwpwYXJzZV9mcmFtZSg8PDE2IzY4LCBMZW46MTYvbGl0dGxlLWludGVnZXIsIExlbjoxNi9saXR0bGUtaW50ZWdlciwgMTYjNjgsIFJlc3QvYmluYXJ5Pj4gPSBCaW4sIEFjYywgT3B0cykgLT4KICAgIGNhc2UgYnl0ZV9zaXplKFJlc3QpIC0gMiA+PSBMZW4gb2YKICAgICAgICB0cnVlIC0+CiAgICAgICAgICAgIGNhc2UgUmVzdCBvZgogICAgICAgICAgICAgICAgPDxVc2VyWm9uZTpMZW4vYnl0ZXMsIENyYzo4LCAxNiMxNiwgUmVzdDEvYmluYXJ5Pj4gLT4KICAgICAgICAgICAgICAgICAgICBBY2MxID0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBzaHV3YV91dGlsczpnZXRfcGFyaXR5KFVzZXJab25lKSA9Oj0gQ3JjIG9mCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlIC0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRnJhbWUgPSAjewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8PCJtc2d0eXBlIj4+ID0+ID9NU0dfVFlQRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPDwiZGF0YSI+PiA9PiBVc2VyWm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWNjICsrIFtGcmFtZV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSAtPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFjYwogICAgICAgICAgICAgICAgICAgICAgICBlbmQsCiAgICAgICAgICAgICAgICAgICAgcGFyc2VfZnJhbWUoUmVzdDEsIEFjYzEsIE9wdHMpOwogICAgICAgICAgICAgICAgXyAtPgogICAgICAgICAgICAgICAgICAgIHBhcnNlX2ZyYW1lKFJlc3QsIEFjYywgT3B0cykKICAgICAgICAgICAgZW5kOwogICAgICAgIGZhbHNlIC0+CiAgICAgICAgICAgIHtCaW4sIEFjY30KICAgIGVuZDsKcGFyc2VfZnJhbWUoPDxfOjgsIFJlc3QvYmluYXJ5Pj4sIEFjYywgT3B0cykgLT4KICAgIHBhcnNlX2ZyYW1lKFJlc3QsIEFjYywgT3B0cykuCgoKJSUg57uE6KOF5oiQ5bCB5YyFLCDlj4LmlbDkuLpNYXDlvaLlvI8KdG9fZnJhbWUoI3s8PCJtc2d0eXBlIj4+IDo9ID9NU0dfVFlQRX0gPSBGcmFtZSkgLT4KICAgIFBheWxvYWQgPSB0ZXJtX3RvX2JpbmFyeShGcmFtZSksCiAgICA8PDE2IzAzLCBQYXlsb2FkL2JpbmFyeSwgMTYjMjM+Pi4=",void 0!=e.productdetail.thing&&"{}"!=JSON.stringify(e.productdetail.thing)||(e.productdetail.thing={properties:[]}),e.wmxData=[],e.wmxDataBk=[],e.wmxData=e.productdetail.thing.properties.filter((function(e,t){return e.index=t,e.name&&e.dataType})),e.wmxDataBk=e.wmxData,dgiotlog.log("=====",e.wmxData),e.wmxDataBk.forEach((function(t){if(t.devicetype){var a={name:t.devicetype};e.FromMachine.push(a)}})),e.FromMachine=_.uniqBy(e.FromMachine,"name"),i.setValue(S.decode(F)),i.gotoLine(i.session.getLength())}})).catch((function(t){dgiotlog.log("err",t),e.$baseMessage("请求出错",t.error,3e3)}))},queryDeviceCount:function(e){var t=this;return Object(d["a"])(m.a.mark((function a(){return m.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(g["getDeviceCountByProduct"])(e);case 2:t.form.ProductAll=a.sent;case 3:case"end":return a.stop()}}),a)})))()},handelUpdate:function(e,t){var a,i=this;a=1!=e,this.dynamicReg=a;var o={dynamicReg:!a};this.$update_object("Product",this.productId,o).then((function(e){e&&(i.$message({type:"success",message:"修改成功"}),i.dynamicReg=!a)})).catch((function(e){dgiotlog.log(e)}))},wmxhandleClose:function(){this.wmxdialogVisible=!1,this.setSizeForm(this.getFormOrginalData())},protol:function(){var e=this,t="";Object($["Compile"])(S.encode(i.getValue())).then((function(a){a&&(e.$message({type:"success",message:"编译成功"}),t="编译成功"+a.mod+"\r\n",e.warningeditror=a.warnings,e.warningeditror.map((function(e){t+=e+"\r\n"})),k+=t,r.setValue(k))})).catch((function(a){e.warningeditror=a.error,e.warningeditror.map((function(e){t+=e+"\r\n"})),k+=t,r.setValue(k)}))},decoderSizeChange:function(e){this.decoder.length=e,this.chaxun()},devicerCurrentChange:function(e){this.decoderstart=(e-1)*this.decoderlength,this.chaxun()},deletedata:function(e){var t=this;this.$del_object("Dict",e).then((function(e){e&&(t.$message("成功删除"),t.chaxun())})).catch((function(e){dgiotlog.log(e)}))},subAce:function(e,t){var a=this;this.$refs[e].validate((function(e){if(e){var o={name:a.formInline.name,version:a.formInline.version,code:S.encode(i.getValue()),desc:a.formInline.desc},s={decoder:o};a.$update_object("Product",a.productId,s).then((function(e){0==a.issub&&(a.$message({type:"success",message:"保存成功"}),1==t&&(k+="保存成功",r.setValue(k))),a.issub=!0})).catch((function(e){dgiotlog.log(e)}))}else a.$message({type:"warning",message:"输入格式有误"})}))},subAce1:function(e){var t=this;this.$refs[e].validate((function(e){if(e){var a={where:{"data.name":t.formInline.name,"data.version":t.formInline.version}};t.$query_object("Dict",a).then((function(e){e.results&&e.results.length>=1?t.$message("此协议版本已存在"):t.$get_object("Product",t.productId).then((function(e){if(e){var a={name:t.formInline.name,version:t.formInline.version,code:S.encode(i.getValue()),desc:t.formInline.desc},o={key:t.formInline.name+":"+t.formInline.version,type:"decoder",data:a,ACL:e.ACL};t.$create_object("Dict",o).then((function(e){e.error?t.$message({type:"error",message:e.error}):t.$message({type:"success",message:"保存到公共协议库成功"})})).catch((function(e){dgiotlog.log(e)}))}}))})).catch((function(e){dgiotlog.log(e)}))}else t.$message({type:"warning",message:"输入格式有误"})}))},updatesub:function(e){var t=this;Object($["subupadte"])(e.objectId,"update").then((function(e){e&&t.$message("重载成功")})).catch((function(e){t.$message(e.error)}))},chaxun:function(){var e=this,t={count:"objectId",skip:this.decoderstart,limit:this.decoderlength,where:{type:"decoder"}};this.dialogTableVisible=!0,this.$query_object("Dict",t).then((function(t){t&&(e.decodertotal=t.count,e.gridData=t.results)})).catch((function(e){dgiotlog.log(e)}))},editordata:function(e){this.formInline.name=e.data.name,this.formInline.version=e.data.version,this.formInline.desc=e.data.desc,this.formInline.resource=e.data.enable,i.setValue(S.decode(e.data.code)),this.dialogTableVisible=!1},goToDevices:function(){this.$router.push({path:"/roles/thing",query:{productid:this.productId}})},addcategory:function(){this.originwmx=!0,this.getPropData()},addMachine:function(){this.machineForm={},this.machine=!0,this.machinestatus="add"},savemachine:function(e){"edit"==this.machinestatus?this.FromMachine[this.machineindex]=e:this.FromMachine.push(e),this.machine=!1},clickmachine:function(e,t,a){"ALL"==e.name?this.wmxData=this.wmxDataBk:(this.devicetype=e.name,this.wmxData=this.wmxDataBk.filter((function(t){return t.devicetype==e.name})),this.wmxstart=1)},handleChange:function(e,t,a){},TypeInstall:function(e,t){t.map((function(t,a){if("enum"==t.DataType||"bool"==t.DataType){var i={dataType:{specs:{}}};i.name=t.Name,i.dataType.type=t.DataType,i.required=t.Required,i.identifier=t.Identifier,i.accessMode=1==t.RwFlag?"r":"rw",JSON.parse(t.DataSpecsList).map((function(e){for(var t in e){var a=e["value"],o=e["name"];i.dataType.specs[a]=o}})),e.push(i)}else if("double"==t.DataType||"int"==t.DataType||"float"==t.DataType){i={dataType:{specs:{}}};for(var o in i.name=t.Name,i.dataType.type=t.DataType,i.required=t.Required,i.identifier=t.Identifier,i.accessMode=1==t.RwFlag?"r":"rw",JSON.parse(t.DataSpecs))i.dataType.specs.min=JSON.parse(t.DataSpecs)["min"],i.dataType.specs.max=JSON.parse(t.DataSpecs)["max"],i.dataType.specs.step=JSON.parse(t.DataSpecs)["step"],i.dataType.specs.unit=JSON.parse(t.DataSpecs)["unit"];e.push(i)}else if("struct"==t.DataType){var r={dataType:{specs:[]}};r.name=t.Name,r.dataType.type=t.DataType,r.required=!t.Required,r.identifier=t.Identifier,r.accessMode=1==t.RwFlag?"r":"rw",JSON.parse(t.DataSpecsList).map((function(e){if("enum"==e.childDataType||"bool"==e.childDataType){var t={dataType:{specs:{}}};t.name=e.childName,t.dataType.type=e.childDataType.toLowerCase(),t.required=e.Required,t.identifier=e.identifier,t.accessMode=1==e.RwFlag?"r":"rw",e.childEnumSpecsDTO.map((function(e){for(var a in e){var i=e["value"],o=e["name"];t.dataType.specs[i]=o}})),r.dataType.specs.push(t)}else if("double"==e.childDataType||"int"==e.childDataType||"float"==e.childDataType){t={dataType:{specs:{}}};for(var a in t.name=e.childName,t.dataType.type=e.childDataType.toLowerCase(),t.required=e.Required,t.identifier=e.identifier,t.accessMode=1==e.RwFlag?"r":"rw",e.childSpecsDTO)t.dataType.specs.min=e.childSpecsDTO["min"],t.dataType.specs.max=e.childSpecsDTO["max"],t.dataType.specs.step=e.childSpecsDTO["precise"],t.dataType.specs.unit=e.childSpecsDTO["unit"];r.dataType.specs.push(t)}})),e.push(r)}}));var a={};e=e.reduce((function(e,t){return!a[t.identifier]&&(a[t.identifier]=e.push(t)),e}),[])},addProCategory:function(e){var t=this,a={where:{type:e.type,"data.key":"detail"}};this.$query_object("Dict",a).then((function(e){var a=e.results;if(a&&a[0].data.Ability){t.TypeInstall(t.productdetail.thing.properties,a[0].data.Ability);var i={thing:t.productdetail.thing};t.$update_object("Product",t.productId,i).then((function(e){e&&(t.$message({type:"success",message:"添加成功"}),t.getProDetail())})).catch((function(e){dgiotlog.log(e)}))}else dgiotlog.log("此选项没有属性功能")}))},deletewmx:function(e){var t=this,a={productid:this.productId,item:e};Object(f["deleteThing"])(a).then((function(e){dgiotlog.log("删除",e),200==e.code?(t.$message({type:"success",message:"删除成功"}),t.getProDetail()):t.$message({type:"warning",message:"删除失败 "+e.msg})}))},wmxSizeChange:function(e){this.wmxstart=1,this.wmxPageSize=e},wmxCurrentChange:function(e){this.wmxstart=e},nowtime:function(){var e=Date.parse(new Date),t=new Date(e),a=(t.getFullYear(),t.getMonth()+1<=10?t.getMonth():t.getMonth(),t.getDate()+1<=10?t.getDate():t.getDate(),(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":"),i=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",o=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return a+i+o+" "},subProTopic:function(e){this.subdialog=!0,this.subdialogid=e.objectId,this.channelname=e.objectId,Object(I["setTimeout"])((function(){s=ace.edit("subdialog"),s.session.setMode("ace/mode/text"),s.setTheme("ace/theme/gob"),s.setReadOnly(!0),s.setOptions({enableBasicAutocompletion:!1,enableSnippets:!0,enableLiveAutocompletion:!0})}));var t={topic:"log/channel/"+e.objectId+"/"+this.productId,qos:2},a=new RegExp("log/channel/"+e.objectId+"/"+this.productId),i="",o=this;C["Websocket"].add_hook(a,(function(e){s.session.getLength()>=1e3?i="":i+=o.nowtime()+e+"\n",s.setValue(i),s.gotoLine(s.session.getLength())}));var r=JSON.stringify({action:"start_logger"});C["Websocket"].subscribe(t,(function(t){if(t.result){var a={topic:"channel/"+e.objectId+"/"+o.productId,text:r,retained:!0,qos:2};C["Websocket"].sendMessage(a),o.subdialogtimer=window.setInterval((function(){C["Websocket"].sendMessage(a)}),6e5)}}))},handleCloseSubdialog:function(){var e=JSON.stringify({action:"stop_logger"}),t={topic:"channel/"+this.subdialogid+"/"+this.productId,text:e,retained:!0,qos:2};C["Websocket"].sendMessage(t),this.subdialog=!1,window.clearInterval(this.subdialogtimer),this.subdialogtimer=null},stopsub:function(e){var t;t=0==e?JSON.stringify({action:"stop_logger"}):JSON.stringify({action:"start_logger"});var a={topic:"channel/"+this.subdialogid+"/"+this.productId,text:t,retained:!0,qos:2};C["Websocket"].sendMessage(a)},subTopic:function(e,t){var a=this;this.$refs[e].validate((function(i){if(!i)return dgiotlog.log("error submit!!"),!1;var o="thing/"+a.productId+"/${DevAddr}/"+a.topicform.topic;a.$get_object("Product",a.productId).then((function(i){var r={topic:o,type:a.topicform.type,desc:a.topicform.desc},s=[];s.push(r);var n={};if(-1==t)s=s.concat(i.topics),n.topics=s;else{var c=i.topics.concat([]);c[t]=r,n.topics=c}a.$update_object("Product",a.productId,n).then((function(t){t&&(a.$message({type:"success",message:"成功"}),a.topicdialogVisible=!1,a.$refs[e].resetFields(),a.topicform.isupdated=-1,a.topicform.topic="",a.topicform.desc="",a.handleClick({name:"second"}))})).catch((function(e){dgiotlog.log(e)}))}))}))},topicSizeChange:function(e){this.topicstart=1,this.topiclength=e},topicCurrentChange:function(e){this.topicstart=e},updatetopic:function(e,t){this.topicform.topic=e.topic.substr(e.topic.lastIndexOf("/")+1),this.topicform.type=e.type,this.topicform.desc=e.desc,this.topicdialogVisible=!0,this.topicform.isupdated=t},deletetopic:function(e,t){var a=this;return Object(d["a"])(m.a.mark((function e(){var i,o,r,s;return m.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.$get_object("Product",a.productId);case 2:i=e.sent,o=i.topics,o&&(r=o.concat([]),r.splice(t,1),s={topics:r},a.$update_object("Product",a.productId,s),a.$message({type:"success",message:"删除成功"})),a.getTopic();case 6:case"end":return e.stop()}}),e)})))()},orginRule:function(){var e=this;Object(w["getRule"])().then((function(t){t&&(e.engineData=t)})).catch((function(t){e.$message(t.error)}))},handleSizeChange:function(e){},handleCurrentChange:function(e){},addEngine:function(){this.$router.push({path:"/rules_engine/addengine",query:{title:"新增",productid:this.productId}})},actions:function(e){var t=[];return e.map((function(e){t.push(e.name)})),t.join(",")},getRowindex:function(e,t,a){if(0==e.columnIndex)return"firstcolumn"},detailRules:function(e){this.$router.push({path:"/rules_engine/checkengine",query:{id:e}})}})}},cce6:function(e,t,a){},de50:function(e,t,a){"use strict";a("bf992")},dfab:function(e,t,a){},e2d2:function(e,t,a){},e629:function(e,t,a){"use strict";a("a8a7")},ed75:function(e,t,a){"use strict";a.r(t);var i,o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"equipment"},[a("div",{staticClass:"equ_header"},[a("ul",[a("li",[a("p",[a("span",{staticClass:"svg-container"},[a("dgiot-icon",{attrs:{icon:"device-line"}})],1),e._v(" "+e._s(e.$translateTitle("equipment.totalequipment"))+" "),a("el-tooltip",{attrs:{content:e.$translateTitle("equipment.totalequipment"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})])],1),a("span",[e._v(e._s(e.devicetotal))])]),a("li",[a("p",[a("span",{staticClass:"svg-container"},[a("dgiot-icon",{attrs:{icon:"numbers-line"}})],1),e._v(" "+e._s(e.$translateTitle("equipment.activationdevice"))+" "),a("el-tooltip",{attrs:{content:e.$translateTitle("equipment.totalactive"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})])],1),a("span",[e._v(e._s(e.activeall))])]),a("li",[a("p",[a("span",{staticClass:"svg-container"},[a("dgiot-icon",{attrs:{icon:"contrast-drop-fill"}})],1),e._v(" "+e._s(e.$translateTitle("equipment.onlinedevices"))+" "),a("el-tooltip",{attrs:{content:e.$translateTitle("equipment.totalonline"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})])],1),a("span",[e._v(e._s(e.onlineall))])]),a("li",[a("div",{staticClass:"block"},[e.productimg?a("el-image",{staticStyle:{position:"relative",top:"-55px",width:"250px",height:"200px","line-height":"200px","text-align":"center"},attrs:{src:e.productimg}},[a("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[a("i",{staticClass:"el-icon-picture-outline"})])]):e._e()],1)])])]),a("div",{staticClass:"equtabs"},[a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("route.设备管理"),name:"first"}},[a("div",[a("div",[a("el-button",{attrs:{size:"small"}},[e._v(" "+e._s(e.$translateTitle("equipment.batchaddition"))+" ")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.addDeviceForm}},[e._v(" "+e._s(e.$translateTitle("equipment.adddevice"))+" ")])],1)]),a("div",{staticClass:"equdevices",staticStyle:{"margin-top":"20px"}},[a("el-select",{staticClass:"selectdetail",attrs:{size:"small"},model:{value:e.selectdevice,callback:function(t){e.selectdevice=t},expression:"selectdevice"}},[a("el-option",{attrs:{value:e.$translateTitle("equipment.devicename")}}),a("el-option",{attrs:{value:e.$translateTitle("equipment.devicenumber")}})],1),e.selectdevice==e.$translateTitle("equipment.devicename")?a("el-input",{staticClass:"selectdetail",attrs:{placeholder:e.$translateTitle("equipment.enterproductname"),size:"small"},model:{value:e.deviceinput,callback:function(t){e.deviceinput=t},expression:"deviceinput"}}):a("el-input",{staticClass:"selectdetail",attrs:{placeholder:e.$translateTitle("equipment.enterdevicenumber"),size:"small"},model:{value:e.deviceinput,callback:function(t){e.deviceinput=t},expression:"deviceinput"}}),a("el-button",{staticClass:"selectdetail",attrs:{size:"small",type:"primary"},on:{click:function(t){return e.getDevices(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")]),a("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:e.deleteDevcie}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]),a("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:function(t){return e.unactiveDevice(!1)}}},[e._v(" "+e._s(e.$translateTitle("developer.prohibit"))+" ")]),a("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:function(t){return e.unactiveDevice(!0)}}},[e._v(" "+e._s(e.$translateTitle("developer.enable"))+" ")])],1),a("div",{staticClass:"tabstable"},[a("el-table",{ref:"filterTable",staticStyle:{width:"100%","margin-top":"20px","text-align":"center"},attrs:{data:e.tableData,"row-style":e.rowClass},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{align:"center",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.devicenumber")+"/"+e.$translateTitle("equipment.name"),prop:"name","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(i.name))]),a("p",{staticStyle:{margin:"0",color:"green"}},[e._v(" "+e._s(i.devaddr)+" ")])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.state"),prop:"status","show-overflow-tooltip":"",sortable:"",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return["ONLINE"==i.status?a("span",{class:i.status},[e._v(" "+e._s(e.$translateTitle("product.online"))+" ")]):e._e(),"ONLINE"==i.status?a("el-tooltip",{attrs:{content:"设备已经上线",placement:"top"}},[a("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"==i.status?a("span",{class:i.status},[e._v(" "+e._s(e.$translateTitle("product.offline"))+" ")]):e._e(),"OFFLINE"==i.status?a("el-tooltip",{attrs:{content:"设备已经离线",placement:"top"}},[a("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"!=i.status&&"ONLINE"!=i.status?a("span",{class:i.status},[e._v(" 未注册 ")]):e._e()]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.product"),prop:"product.name","show-overflow-tooltip":"",sortable:"",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(i.product.name))])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.nodetype"),prop:"product.nodeType","show-overflow-tooltip":"",sortable:"",width:"200"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return[a("dgiot-icon",{staticStyle:{width:"2rem",height:"2rem"},attrs:{icon:0==t.nodeType?"hotel-bed-fill":"hotel-fill"}})]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.enable")+"/"+e.$translateTitle("developer.prohibit"),prop:"enable","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row,o=t.$index;return[a("el-switch",{attrs:{"active-color":"#5eb058","inactive-color":"#cccccc"},on:{change:function(t){return e.handelUpdate(t,o)}},model:{value:i.isEnable,callback:function(t){e.$set(i,"isEnable",t)},expression:"row.isEnable"}})]}}])}),a("el-table-column",{attrs:{label:"创建时间",prop:"createdAt","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(e.utc2beijing(i.createdAt)))])]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("developer.operation"),width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row,o=t.$index;return[a("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(t){return e.editorDevice(i)}}},[e._v(" 编辑 ")]),a("el-popover",{ref:"popover-"+o,attrs:{placement:"top",width:"300"}},[a("p",[e._v("确定删除这个"+e._s(i.name)+"设备吗？")]),a("div",{staticStyle:{margin:"0","text-align":"right"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){i._self.$refs["popover-"+o].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.makeSure(e.scope,o)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),a("el-link",{attrs:{slot:"reference",type:"danger",underline:!1},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)]}}])})],1),a("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":e.devicelength,"page-sizes":[10,20,30,50],total:e.devicetotal},on:{"current-change":e.deviceCurrentChange,"size-change":e.deviceSizeChange}})],1)],1)]),a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.batchmanagement"),name:"second"}},[a("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.pctableData}},[a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.serialnumber"),type:"index",width:"200"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.batchname"),prop:"data.batch_name","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(i.data.batch_name))])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.createdAt"),prop:"createdAt","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(e.utc2beijing(i.createdAt)))])]}}])}),a("el-table-column",{attrs:{align:"center",label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.updatebatch(i.row.objectId)}}},[e._v(" 编辑 ")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.deletebatch(i.objectId)}}},[e._v(" 删除 ")]),a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.selectbatch(i.row.objectId)}}},[e._v(" 选择 ")])]}}])})],1)],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose,"close-on-click-modal":!1,title:"设备"+e.equipmentEditor,visible:e.devicedialogVisible,width:"50%"},on:{"update:visible":function(t){e.devicedialogVisible=t}}},[a("div",{staticClass:"header-title",attrs:{slot:"title"},slot:"title"},[a("span",{staticClass:"title-name"},[e._v(" "+e._s("设备"+e.equipmentEditor)+" "),a("el-tooltip",{staticStyle:{"margin-left":"5px"},attrs:{content:e.$translateTitle("equipment.text"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})])],1)]),a("div",{staticClass:"devicecontent"},[a("el-form",{ref:"deviceform",attrs:{"label-width":"150px",model:e.deviceform,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicename"),prop:"name"}},[a("el-input",{model:{value:e.deviceform.name,callback:function(t){e.$set(e.deviceform,"name",t)},expression:"deviceform.name"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicenumber"),prop:"devaddr"}},[a("el-input",{model:{value:e.deviceform.devaddr,callback:function(t){e.$set(e.deviceform,"devaddr",t)},expression:"deviceform.devaddr"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.batchname"),prop:"batchId"}},[a("el-input",{attrs:{disabled:""},model:{value:e.deviceform.batchId,callback:function(t){e.$set(e.deviceform,"batchId",t)},expression:"deviceform.batchId"}},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"suffix"},on:{click:e.addDeviceBatch},slot:"suffix"})])],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"productName"}},[a("el-input",{attrs:{readonly:""},model:{value:e.deviceform.productName,callback:function(t){e.$set(e.deviceform,"productName",t)},expression:"deviceform.productName"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.assetnumber")}},[a("el-input",{model:{value:e.deviceform.assetNum,callback:function(t){e.$set(e.deviceform,"assetNum",t)},expression:"deviceform.assetNum"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.equipmenttype")}},[a("el-input",{model:{value:e.deviceform.devModel,callback:function(t){e.$set(e.deviceform,"devModel",t)},expression:"deviceform.devModel"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.equipmentbrand")}},[a("el-input",{model:{value:e.deviceform.brand,callback:function(t){e.$set(e.deviceform,"brand",t)},expression:"deviceform.brand"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.installationlocation")}},[a("el-input",{on:{focus:e.updateLocation},model:{value:e.deviceform.address,callback:function(t){e.$set(e.deviceform,"address",t)},expression:"deviceform.address"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.describe")}},[a("el-input",{attrs:{autosize:{minRows:4,maxRows:4},type:"textarea"},model:{value:e.deviceform.desc,callback:function(t){e.$set(e.deviceform,"desc",t)},expression:"deviceform.desc"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("deviceform")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),a("el-button",{on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)]),a("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose1,"close-on-click-modal":!1,title:"批次添加",visible:e.pcdialogVisible,width:"50%"},on:{"update:visible":function(t){e.pcdialogVisible=t}}},[a("div",{staticClass:"pccontent"},[a("el-form",{ref:"pcformInline",staticClass:"demo-form-inline",attrs:{inline:!0,model:e.pcformInline,rules:e.pcformrule}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.batchname"),prop:"pcname"}},[a("el-input",{attrs:{placeholder:e.$translateTitle("equipment.batchname")},model:{value:e.pcformInline.pcname,callback:function(t){e.$set(e.pcformInline,"pcname",t)},expression:"pcformInline.pcname"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.createdAt"),prop:"createdtime"}},[a("el-date-picker",{attrs:{type:"datetime"},model:{value:e.pcformInline.createdtime,callback:function(t){e.$set(e.pcformInline,"createdtime",t)},expression:"pcformInline.createdtime"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addbatch("pcformInline")}}},[e._v(" "+e._s(e.$translateTitle("equipment.addbatch"))+" ")])],1)],1),a("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.pctableData,height:"450"}},[a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.serialnumber"),type:"index",width:"50"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.batchname"),prop:"data.batch_name","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(i.data.batch_name))])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.createdAt"),prop:"createdAt","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(e.utc2beijing(i.createdAt)))])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.operation"),width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.updatebatch(i.row.objectId)}}},[e._v(" "+e._s(e.$translateTitle("developer.edit"))+" ")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.deletebatch(i.objectId)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]),a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.selectbatch(i.row.objectId)}}},[e._v(" 选择 ")])]}}])})],1)],1)]),a("el-dialog",{directives:[{name:"drag-dialog",rawName:"v-drag-dialog"}],attrs:{"append-to-body":!0,"before-close":e.handleClosebmap,"close-on-click-modal":!1,title:"设备安装地址",visible:e.bmapdialogVisible,width:"50%"},on:{"update:visible":function(t){e.bmapdialogVisible=t}}},[a("div",[a("el-form",{attrs:{inline:!0,model:e.bmapform,size:"small"}},[a("el-form-item",{attrs:{label:"地址名称"}},[a("el-input",{model:{value:e.bmapform.keyword,callback:function(t){e.$set(e.bmapform,"keyword",t)},expression:"bmapform.keyword"}})],1),a("el-form-item",{attrs:{label:"选中地址"}},[a("el-input",{attrs:{readonly:""},model:{value:e.bmapform.address,callback:function(t){e.$set(e.bmapform,"address",t)},expression:"bmapform.address"}})],1)],1),a("baidu-map",{staticStyle:{height:"300px"},attrs:{ak:e.secret.baidu.map,center:e.center,"map-click":!1,"scroll-wheel-zoom":!0,zoom:e.zoom},on:{click:e.mapClick,ready:e.handler}},[a("bm-local-search",{staticStyle:{display:"none"},attrs:{"auto-viewport":!0,keyword:e.bmapform.keyword,location:e.bmapform.location,zoom:"12.8"}}),a("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),a("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT","auto-location":!0,"show-address-bar":!0}}),a("bm-city-list",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addressSure.apply(null,arguments)}}},[e._v(" 保 存 ")]),a("el-button",{on:{click:function(t){e.bmapdialogVisible=!1}}},[e._v("取 消")])],1)])],1)])},r=[],s=a("fb07"),n=a("e97b"),c=a("d0d7"),l=a.n(c),d=(a("1d17"),a("37c6"),a("3dec"),a("9c6a"),a("c4bc"),a("f764"),a("5662"),a("f1e1"),a("04d6"),a("df0e"),a("5ac5"),a("16b8"),a("98da"),a("a0e0"),a("adc7")),u=a("dcc6"),p=a("e0e9"),m=a("5880"),h=a("cb88"),g=a("7212"),f=a("926a"),b=a("14ba"),v={components:{BmNavigation:h["BmNavigation"],BaiduMap:h["BaiduMap"],BmLocalSearch:h["BmLocalSearch"],BmGeolocation:h["BmGeolocation"],BmCityList:h["BmCityList"]},data:function(){var e=function(e,t,a){var i=/[0-9A-Za-z]$/;""==t?a(new Error("设备地址不能为空")):i.test(t)?a():a(new Error("设备地址必须为大小写字母数字"))};return{secret:b["secret"],productimg:"",bmapdialogVisible:!1,onlineall:"",activeall:"",userId:"",batchid:"",pcdialogVisible:!1,devicedialogVisible:!1,equvalue:"0",cities:[],activeName:"first",selectdevice:"",deviceinput:"",devicenumber:"",multipleTable:[],selectRow:[],devicelength:10,devicestart:0,devicetotal:0,visible2:!1,deviceform:{name:"",devaddr:"",batchId:"",desc:"",nodeType:0,devType:"",netType:"",assetNum:"",devModel:"",address:"",productName:"",status:"",isEnable:"",brand:"",auth:12345678,yysId:"09"},yysSelect:[],rules:{name:[{required:!0,message:"请输入设备名称",trigger:"blur"}],devaddr:[{required:!0,message:"请输入设备编号",trigger:"blur"},{validator:e}],batchId:[{required:!0,message:"请输入设备批次",trigger:"blur"}],nodeType:[{required:!0,message:"请输入设备类型",trigger:"blur"}],netType:[{required:!0,message:"请选择网络格式",trigger:"change"}],devType:[{required:!0,message:"请选择设备类型",trigger:"change"}],productName:[{required:!0,message:"请选择产品名称",trigger:"change"}]},aclObj:{},pcformrule:{pcname:[{required:!0,message:"请输入批次名称",trigger:"blur"}],createdtime:[{type:"date",required:!0,message:"请选择创建时间",trigger:"change"}]},pcformInline:{pcnumber:"",pcname:"",createdtime:""},pctableData:[],equipmentEditor:"添加",tableData:[],proTableData:[],proTableData1:[],activelength:[],onlinelength:[],center:{lng:0,lat:0},zoom:13,bmapform:{keyword:"",location:"",address:""},productName:"",deviceid:"",map:null,addresspointer:"",productenable:!0,changeproduct:!0,tagsid:"",productroleslist:[]}},computed:Object(n["a"])({},Object(m["mapGetters"])({_role:"acl/role"})),watch:{multipleTable:function(e){var t=this;this.selectRow=[],e.length>0&&e.forEach((function(e,a){t.selectRow.push(t.tableData.indexOf(e))}))}},mounted:function(){this.getDevices(0),this.addDeviceBatch(0),this.queryYysId(),this.$route.query.productid&&(this.equvalue=this.$route.query.productid,this.searchProduct(this.equvalue)),this.aclObj=this.$aclObj(this._role)},methods:{queryYysId:function(){var e=this;return Object(s["a"])(l.a.mark((function t(){var a;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a={order:"-createdAt",limit:100,skip:0,where:{type:"b83b5d9fc0"}},Object(p["queryDict"])(a).then((function(t){e.yysSelect=[{name:"空",key:""}],t.results.map((function(t){e.yysSelect.push(t.data)}))}));case 2:case"end":return t.stop()}}),t)})))()},rolesSelect:function(e){var t=this;this.productroleslist=[],this.$queryProduct({}).then((function(e){if(e)for(var a in e.results[0].ACL)a.includes("role")&&t.productroleslist.push(a.substr(5))}),(function(e){Object(f["returnLogin"])(e)}))},goEdit:function(e){var t=window.location.origin+"/spa",a="production";t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var i="".concat(t,"/#?devaddr=").concat(e.devaddr,"&proudctid=").concat(e.productid);window.open(i,"__blank"),localStorage.setItem("topoData",JSON.stringify(e.config))},addressSure:function(){var e=new BMap.LocalSearch(this.map);e.enableAutoViewport();""==this.bmapform.address&&(this.deviceform.address=this.bmapform.keyword),e.search(this.bmapform.keyword),this.bmapdialogVisible=!1},handler:function(e){e.BMap;var t=e.map;this.center.lng=120.2,this.center.lat=30.26667,this.zoom=this.zoom,this.map=t},mapClick:function(e){var t=this;this.center.lng=e.point.lng,this.center.lat=e.point.lat,this.addresspointer=e.point.lng.toFixed(6)+","+e.point.lat.toFixed(6);var a=new BMap.Geocoder;a.getLocation(e.point,(function(e){t.bmapform.address=e.address,t.deviceform.address=e.address}))},updateLocation:function(){this.bmapdialogVisible=!0},handleClosebmap:function(){this.bmapdialogVisible=!1},getOnlineDevices:function(){var e=this;return Object(s["a"])(l.a.mark((function t(){var a,i;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={where:{status:"ONLINE"}},""!=e.deviceinput&&("设备名称"==e.selectdevice?a.where.name=e.deviceinput:a.where.devaddr=e.deviceinput),""!=e.devicenumber&&(a.where.devaddr=e.devicenumber),0!=e.equvalue&&(a.where.product=e.equvalue),t.next=6,e.$queryDevice(a);case 6:i=t.sent,e.onlineall=i.results.length;case 8:case"end":return t.stop()}}),t)})))()},getActiveDevices:function(){var e=this;return Object(s["a"])(l.a.mark((function t(){var a,i;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={where:{status:"ACTIVE"}},""!=e.deviceinput&&("设备名称"==e.selectdevice||"Device Name"==e.selectdevice?a.where.name=e.deviceinput:a.where.devaddr=e.deviceinput),""!=e.devicenumber&&(a.where.devaddr=e.devicenumber),0!=e.equvalue&&(a.where.product=e.equvalue),t.next=6,e.$queryDevice(a);case 6:i=t.sent,e.activeall=i.results.length;case 8:case"end":return t.stop()}}),t)})))()},searchProduct:function(){var e=this;return Object(s["a"])(l.a.mark((function t(){return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:Object(g["getProduct"])(e.equvalue).then((function(t){e.deviceform.productName=t.name,e.productName=t.name}));case 1:case"end":return t.stop()}}),t)})))()},getDevices:function(e){var t=this;return Object(s["a"])(l.a.mark((function a(){var i,o;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return 0===e&&(t.devicestart=0),t.tableData=[],i={order:"-updatedAt",limit:t.devicelength,skip:t.devicestart,count:"objectId",include:"product",where:{product:t.$route.query.productid}},""!=t.deviceinput&&("设备名称"==t.selectdevice?params.where.name=t.deviceinput:params.where.devaddr=t.deviceinput),""!=t.devicenumber&&(params.where.devaddr=t.devicenumber),a.next=7,t.$queryDevice(i);case 7:o=a.sent,t.devicetotal=o.count,t.tableData=o.results,t.getActiveDevices(),t.getOnlineDevices();case 12:case"end":return a.stop()}}),a)})))()},handelUpdate:function(e,t,a){var i=this;dgiotlog.log("row",t);var o={};for(var r in t)o[r]=t[r];o.isEnable=1!=o.isEnable,this.tableData[a]=o,this.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e={};for(var a in t)e[a]=t[a];e.isEnable=1==e.isEnable;var o={isEnable:e.isEnable};dgiotlog.log("row",t),i.$putDevice(t.objectId,o).then((function(e){e.error?i.initQuery("状态修改失败","error"):(i.initQuery("状态修改成功","success"),i.getDevices())}))})).catch((function(){i.$message({type:"info",message:"已取消修改"});var e=t;e.isEnable=1!=e.isEnable,i.tableData[a]=e}))},timestampToTime:function(e){var t=new Date(1e3*e),a=t.getFullYear()+"-",i=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",o=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",r=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",s=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",n=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return a+i+o+r+s+n},utc2beijing:function(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},filterTag:function(e,t){return t.tag===e},handleSelectionChange:function(e){this.multipleTable=e,dgiotlog.log(this.multipleTable)},deleteDevcie:function(e){var t=this;return Object(s["a"])(l.a.mark((function e(){var a;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=[],t.multipleTable.map((function(e){a.push(e.id)})),e.next=4,Object(u["Batchdelete"])("_Device",a,{}).then((function(e){e.error?t.initQuery("设备".concat(a,"删除失败"),"error"):t.initQuery("设备".concat(a,"删除成功"),"success")}));case 4:case"end":return e.stop()}}),e)})))()},unactiveDevice:function(e){var t=this;return Object(s["a"])(l.a.mark((function a(){var i,o;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=[],t.multipleTable.map((function(e){i.push(e.id)})),o={isEnable:e},a.next=5,Object(u["Batchdelete"])("_Device",i,o).then((function(a){a.error?e?t.initQuery("设备".concat(i,"启动失败"),"error"):t.initQuery("设备".concat(i,"禁用失败"),"error"):e?t.initQuery("设备".concat(i,"启动成功"),"success"):t.initQuery("设备".concat(i,"禁用成功"),"success")}));case 5:case"end":return a.stop()}}),a)})))()},rowClass:function(e){e.row;var t=e.rowIndex;if(this.selectRow.includes(t))return{"background-color":"rgba(185, 221, 249, 0.3)"}},initQuery:function(e,t){this.$message({type:t||"info",message:e})},deviceSizeChange:function(e){this.devicelength=e,this.getDevices()},deviceCurrentChange:function(e){this.devicestart=(e-1)*this.devicelength,this.getDevices()},handleClose:function(){this.deviceid="",this.deviceform={name:"",devaddr:"",batchId:"",desc:"",nodeType:0,devType:"",netType:"",assetNum:"",devModel:"",address:"",status:"",isEnable:"",brand:"",auth:12345678,yysId:""},this.$refs["deviceform"].resetFields(),this.deviceform.productName=this.productName,this.devicedialogVisible=!1,this.equipmentEditor="添加"},addDeviceForm:function(){this.deviceid="",this.devicedialogVisible=!0,this.equipmentEditor="添加"},handleClose1:function(){this.pcdialogVisible=!1,this.batchid="",this.pcformInline={pcname:"",createdtime:""}},makeSure:function(e,t){var a=this;this.$deleteDevice(row.objectId).then((function(i){i.error?(e._self.$refs["popover-".concat(t)].doClose(),a.initQuery("删除失败","error")):(a.initQuery("删除成功","success"),e._self.$refs["popover-".concat(t)].doClose(),a.getDevices())}))},addDeviceBatch:function(e){var t=this;return Object(s["a"])(l.a.mark((function a(){var i,o;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.pcdialogVisible=0!=e,a.next=3,Object(p["getBatchNumer"])();case 3:i=a.sent,o=i.results,t.pctableData=o.filter((function(e){return e.data.batch_name}));case 6:case"end":return a.stop()}}),a)})))()},editorDevice:function(e){dgiotlog.log("row",e),this.deviceid=e.objectId,this.devicedialogVisible=!0,this.deviceform={devaddr:e.devaddr,name:e.name,assetNum:void 0==e.detail?"":e.detail.assetNum,devModel:void 0==e.detail?"":e.detail.devModel,desc:void 0==e.detail?"":e.detail.desc,productid:e.product.objectId,brand:void 0==e.detail?"":e.detail.brand,productName:e.product.name,status:e.status,isEnable:e.isEnable,address:void 0==e.detail?"":e.detail.address,auth:e.basedata&&e.basedata.auth?e.basedata.auth:"",yysId:e.basedata&&e.basedata.yysId?e.basedata.yysId:""},this.bmapform.address=e.address,this.batchid=e.detail.batchid,this.center.lat=e.latitude,this.center.lng=e.longitude,this.addresspointer=e.latitude+","+e.longitude,this.tagsid=e.tagid,this.equipmentEditor="编辑",this.rolesSelect(e.productid)},getBatch:function(){return new d["Promise"]((function(e,t){i.length>0?e(i):t(!1)}))},submitForm:function(e){var t=this,a={devaddr:this.deviceform.devaddr,name:this.deviceform.name};this.$refs[e].validate((function(e){if(e)if(""!=t.deviceid){var i={where:{devaddr:t.deviceform.devaddr}};t.$queryDevice(i).then((function(e){if(0==e.results.length){var o={ACL:t.aclObj,detail:{assetNum:t.deviceform.assetNum,devModel:t.deviceform.devModel,brand:t.deviceform.brand,address:t.deviceform.address,desc:t.deviceform.desc},product:{__type:"Pointer",className:"Product",objectId:t.$route.query.productid},basedata:{auth:t.deviceform.auth,yysId:t.deviceform.yysId}};i=Object.assign(a,o),t.$putDevice(t.deviceid,i).then((function(e){e.error?t.initQuery("修改失败","error"):(t.initQuery("修改成功","success"),t.devicedialogVisible=!1,t.getDevices(),t.deviceform={},t.deviceform.productName=t.productName)}))}else t.initQuery("设备已经存在","error")}))}else{i={where:{devaddr:t.deviceform.devaddr}};t.$queryDevice(i).then((function(e){if(0==e.results.length){var o={ACL:t.aclObj,detail:{assetNum:t.deviceform.assetNum,devModel:t.deviceform.devModel,brand:t.deviceform.brand,address:t.deviceform.address,desc:t.deviceform.desc},product:{__type:"Pointer",className:"Product",objectId:t.$route.query.productid},basedata:{auth:t.deviceform.auth,yysId:t.deviceform.yysId}};i=Object.assign(a,o),t.$postDevice(i).then((function(e){e.error?t.initQuery("创建失败","error"):(t.initQuery("创建成功","success"),t.devicedialogVisible=!1,t.getDevices(),t.deviceform={},t.deviceform.productName=t.productName)}))}else t.initQuery("设备已经存在","error")}))}else t.$message("必填项未填")}))},addbatch:function(e){var t=this;return Object(s["a"])(l.a.mark((function a(){return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.$refs[e].validate((function(a){if(!a)return dgiotlog.log("error submit!!"),!1;if(""===t.batchid){var i={data:{batch_name:t.pcformInline.pcname,createdtime:Math.ceil(t.pcformInline.createdtime/1e3)},ACL:t.aclObj,key:t.pcformInline.pcname,type:"batch_number"};t.$postDict(i).then((function(a){a.error?t.$message({message:"新增失败".concat(a.error),type:"error"}):(t.$message({message:"新增成功",type:"success"}),t.$refs[e].resetFields(),t.addDeviceBatch())}))}else{var o={objectId:t.batchid,data:{batch_name:t.pcformInline.pcname,createdtime:Math.ceil(t.pcformInline.createdtime/1e3)},ACL:t.aclObj,type:"batch_number"};t.$putDict(o.objectId,o).then((function(a){a.error?t.initQuery("修改失败","error"):(t.initQuery("修改成功","success"),t.batchid="",t.pcformInline={pcname:"",createdtime:""},t.$refs[e].resetFields(),t.addDeviceBatch())}))}}));case 1:case"end":return a.stop()}}),a)})))()},updatebatch:function(e,t){this.pcformInline.pcname=e.data.batch_name,this.pcformInline.createdtime=1e3*e.data.createdtime,this.batchid=t},deletebatch:function(e){var t=this;return Object(s["a"])(l.a.mark((function a(){var i;return l.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(p["delDict"])(e);case 3:i=a.sent,dgiotlog.log(i),t.queryDict(),t.addDeviceBatch(),a.next=13;break;case 9:a.prev=9,a.t0=a["catch"](0),dgiotlog.log(a.t0),t.$message.error("".concat(a.t0));case 13:case"end":return a.stop()}}),a,null,[[0,9]])})))()},selectbatch:function(e,t){this.batchid=t,this.deviceform.pc=e.data.batch_name,this.deviceform.batchId=e.data.batch_name,this.pcdialogVisible=!1,dgiotlog.log(this.batchid,"this.batchid ")},deviceToDetail:function(e){this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,ischildren:"false"}})},handleClick:function(e,t){"second"==e.name&&this.queryDict()},queryDict:function(){var e=this;return Object(s["a"])(l.a.mark((function t(){var a,i;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$getBatchNumer();case 2:a=t.sent,i=a.results,e.pctableData=i.filter((function(e){return e.data.batch_name}));case 5:case"end":return t.stop()}}),t)})))()},deviceToChildren:function(e){this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,ischildren:"true"}})}}},y=v,w=(a("89c0"),a("de50"),a("bdd7")),T=Object(w["a"])(y,o,r,!1,null,"c386fa5e",null);t["default"]=T.exports},fe51:function(e,t,a){"use strict";var i,o,r,s,n,c,l,d=a("fb07"),u=a("e97b"),p=a("d0d7"),m=a.n(p),h=(a("1d17"),a("37c6"),a("04d6"),a("a0e0"),a("3dec"),a("16b8"),a("f1e1"),a("9c6a"),a("c4bc"),a("0c40"),a("79da"),a("e170"),a("d6a4"),a("3de5"),a("98da"),a("e472"),a("1ec3"),a("9f39"),a("4656"),a("1c6f"),a("5880")),g=a("1285"),f=a("7212"),b=a("12674"),v=a("e0e9"),y=a("89e8"),w=a("1b07"),T=a("ef68"),$=a("bb22"),I=a("83b1"),C=a("0e2a"),D=a("aed5"),j=a("926a"),x=a("30b0"),A={},S=a("f43e").Base64,F="",k="",O={components:{"dgiot-wmx":D["default"],"dgiot-profile":x["default"]},data:function(){var e=this,t=function(e,t,a){var i=/[0-9a-zA-Z]/;i.test(t)?a():a(new Error("协议名称由数字和字母组合"))},a=function(t,a,i){""===a?i(new Error("最小值不能为空")):""!==e.sizeForm.endnumber&&(a>=e.sizeForm.endnumber?i(new Error("最小值小于最大值")):i())},i=function(t,a,i){""===a?i(new Error("最大值不能为空")):""!==e.sizeForm.startnumber&&(a<=e.sizeForm.startnumber?i(new Error("最大值必须大于最小值")):i())},o=function(t,a,i){a<0?i(new Error("步长大于0")):a>=e.sizeForm.endnumber-e.sizeForm.startnumber?i(new Error("步长必须小于最大值和最小值的差值")):i()},r=function(t,a,i){""===a?i(new Error("最小值不能为空")):""!==e.structform.endnumber&&(a>=e.structform.endnumber?i(new Error("最小值小于最大值")):i())},s=function(t,a,i){""===a?i(new Error("最大值不能为空")):""!==e.structform.startnumber&&(a<=e.structform.startnumber?i(new Error("最大值必须大于最小值")):i())},n=function(t,a,i){a<0?i(new Error("步长大于0")):a>=e.structform.endnumber-e.structform.startnumber?i(new Error("步长必须小于最大值和最小值的差值")):i()};return{codeFlag:!1,productInfo:{decoder:{code:""},thing:{properties:[]},config:{parser:[],profile:[],basedate:{params:[]}}},FromMachine:[{name:"ALL"}],machineForm:{},machine:!1,devicetype:"",machinestatus:"add",machineindex:0,options:[{value:"first",label:"第一轮"},{value:"last",label:"最后一轮"},{value:"all",label:"全部"}],activeIndex:"",editableTabsValue:"1",editableTabs:[],tabIndex:1,sizeOption:[{label:"20",val:"20"},{label:"不采集(计算值)",val:"计算值"},{label:"不采集(主动上报)",val:"主动上报"}],showList:!1,collapseName:["1","2","3","4"],multipleSelection:[],protolchannel:[],protoldialog:!1,productimg:"",topicdialogVisible:!1,topicform:{topic:"",type:"",desc:"",isupdated:-1},exportDialogShow:!1,exportUrl:"",exportName:"",decodertotal:0,decoderstart:0,leftItemPos:0,ed3isShow:!1,rightCollection:"",decoderlength:10,topicrule:{topic:[{required:!0,message:"请输入Topic类",trigger:"blur"}],type:[{required:!0,message:"请选择Topic权限",trigger:"change"}]},topicstart:1,topiclength:10,topictotal:0,channelData:[],allchannelData:[],innerVisible:!1,allChannelstart:0,allChannellength:20,allChanneltotal:0,category:[],current:0,schemadialogVisible:!1,collectionDialogVisible:!1,PropData:[],originwmx:!1,wmxdialogVisible:!1,wmxSituation:"新增",allunit:[],sizerule:{step:[{required:!0,trigger:"blur",validator:o}],string:[{required:!0,trigger:"blur",message:"请输入数据长度"},{type:"number",message:"数据长度必须为数字"}],startnumber:[{validator:a,required:!0,trigger:"blur"}],endnumber:[{validator:i,required:!0,trigger:"blur"}],resource:[{required:!0,message:"请选择功能类型",trigger:"change"}],true:[{required:!0,message:"请输入属性值",trigger:"blur"}],false:[{required:!0,message:"请输入属性值",trigger:"blur"}],name:[{required:!0,message:"请输入属性名称",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"}],dis:[{required:!0,message:"请输入数据标识",trigger:"blur"}],type:[{required:!0,message:"请选择数据类型",trigger:"change"}],attribute:[{required:!0,message:"请输入属性",trigger:"blur"}],attributevalue:[{required:!0,message:"请输入属性值",trigger:"blur"}],isread:[{required:!0,message:"请选择读写类型",trigger:"change"}]},structrule:{string:[{required:!0,trigger:"blur",message:"请输入数据长度"},{type:"number",message:"数据长度必须为数字"}],step:[{required:!0,trigger:"blur",validator:n}],startnumber:[{validator:r,required:!0,trigger:"blur"}],endnumber:[{validator:s,required:!0,trigger:"blur"}],resource:[{required:!0,message:"请选择功能类型",trigger:"change"}],true:[{required:!0,message:"请输入属性值",trigger:"blur"}],false:[{required:!0,message:"请输入属性值",trigger:"blur"}],name:[{required:!0,message:"请输入属性名称",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"}],dis:[{required:!0,message:"请输入数据标识",trigger:"blur"}],type:[{required:!0,message:"请选择数据类型",trigger:"change"}],attribute:[{required:!0,message:"请输入属性",trigger:"blur"}],attributevalue:[{required:!0,message:"请输入属性值",trigger:"blur"}],isread:[{required:!0,message:"请选择读写类型",trigger:"change"}]},structdialog:!1,structform:{resource:1,identifier:"",type:"INT",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",unit:"",date:"String类型的UTC时间戳 (毫秒)",string:"",specs:[],dis:"0X10",dinumber:"null",das:[]},tableData:[],activeName:"first",form:{Productname:"",ProductKey:"",ProductAll:0},ProductSecret:"",dynamicReg:!1,productId:"",productName:"",productdetail:{},topicData:[],topic:[{topic:"thing/${ProductId}/${DevAddr}/post",type:"pub",desc:"设备上报",isdef:!0},{topic:"thing/${ProductId}/${DevAddr}",type:"sub",desc:"消息下发",isdef:!0}],isshow:!1,addRules:{name:[{required:!0,message:"请输入协议名称",trigger:"blur"},{validator:t,trigger:"blur"}]},dialogTableVisible:!1,gridData:[],formInline:{name:"",version:"",desc:"",resource:!1},option:[],CategoryKey:"",productstart:0,productlength:10,producttotal:0,wmxstart:1,wmxPageSize:10,wmxtotal:20,wmxData:[],wmxDataBk:[],editorList:[],warningeditror:[],channellength:20,channelstart:0,channeltotal:0,isupdatedstruct:-1,issub:!1,subtimer:null,subdialog:!1,textarea:"",subdialogtimer:null,subdialogid:"",subaction:"stop",channelname:"",value4:!0,rulepagesize:10,rulestart:0,ruletotal:0,engineData:[],channeltype:0,resourcechannelData:[],resourcestart:0,resourcelength:10,resourcetotal:0,resourcedialogFormVisible:!1,resourceform:{},resourcechannelid:"",isreload:1,modifyIndex:-1,ace_editor:"",iframeShow:!1}},computed:Object(u["a"])({treeData:function(){var e=JSON.parse(JSON.stringify(this.option));return e.filter((function(t){var a=e.filter((function(e){return t.id==e.parentid}));return a.length>0&&(t.children=a),0==t.parentid}))},showNewItem:function(){return!(!this.sizeForm||"modbus"!=this.sizeForm.protocol)}},Object(h["mapGetters"])({sizeForm:"konva/sizeForm"})),watch:{issub:{deep:!0,handler:function(e){var t=this;this.subtimer=window.setInterval((function(){t.subAce("formInline",!1)}),5e3)}}},mounted:function(){var e=this;this.$nextTick((function(){e.$refs._tabs.$children[0].$refs.tabs[3].style.display="none",C["Websocket"].subscribe({topic:"log/channel/#",qos:2})})),this.Industry(),this.getAllunit(),r=ace.edit("editor2"),r.session.setMode("ace/mode/text"),r.setTheme("ace/theme/monokai"),r.setReadOnly(!0),r.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.$route.query.activeName&&(this.activeName=this.$route.query.activeName)},beforeDestroy:function(){window.clearInterval(this.subtimer),this.subtimer=null,window.clearInterval(this.subdialogtimer),this.subdialogtimer=null},methods:Object(u["a"])(Object(u["a"])({feateditorParser1:function(e,t,a){var i=this.productInfo;this.parserType=t,this.$baseEventBus.$emit("profileDialog",{config:e,type:t,flag:a,productInfo:i})}},Object(h["mapMutations"])({setSizeForm:"konva/setSizeForm"})),{},{tableRowClassName:function(e){e.row;var t=e.rowIndex;return 1===t?"warning-row":3===t?"success-row":""},selectStruct:function(e){},toggleList:function(){this.showList=!this.showList},getFormOrginalData:function(){return{devicetype:this.devicetype,strategy:"20",resource:1,identifier:"",dis:"0X10",dinumber:"null",type:"int",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",isshow:!0,unit:"",string:"",date:"String类型的UTC时间戳 (毫秒)",specs:{},precision:3,round:"all",struct:[{attribute:"",attributevalue:""}],das:[],daslist:[],rate:1,offset:0,order:0,protocol:"normal",operatetype:"readCoils",originaltype:"short16_AB",slaveid:"0X10",collection:"%s",control:"%d",nobound:[],editdatatype:!1,iscount:"0",countstrategy:20,countround:"all",countcollection:"%s"}},changeValue:function(e){this.$refs[e].validateField("startnumber",(function(e){if(e)return!1}))},changeStructValue:function(e){this.$refs[e].validateField("startnumber",(function(e){if(e)return!1}))},getRowClass:function(e,t){if("struct"!=e.row.dataType.type)return"row-expand-cover"},getChannelEnable:function(e,t){return 1==e.row.isEnable?"green_active":"red_active"},handleClick:function(e){"fourth"==e.name||("fiveth"==e.name?this.getProductChannel():"second"==e.name?this.getTopic():"seven"==e.name?this.getResourceChannel():"sixeth"==e.name?this.orginRule():"eighth"==e.name?this.isreload++:"fourth"!=e.name&&(window.clearInterval(this.subtimer),this.subtimer=null))},getAllunit:function(){var e=this;return Object(d["a"])(m.a.mark((function t(){var a,i;return m.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.allunit=[],t.next=3,Object(v["getAllunit"])("unit",200);case 3:a=t.sent,i=a.results,e.allunit=i.concat([]),e.allunit.unshift({data:{Name:"无",Symbol:""}});case 7:case"end":return t.stop()}}),t)})))()},getTopic:function(){var e=this,t=[];this.$get_object("Product",this.productId).then((function(a){null!==a&&void 0!==a&&a.topics&&(a.topics.forEach((function(e){e&&t.push(e)})),dgiotlog.log("resultes",a.topics),dgiotlog.log("topics",t),e.topicData=t.concat(e.topic))})).catch((function(t){e.$baseMessage("请求出错",t.error,3e3)}))},exportProduct:function(e){var t=this;return Object(d["a"])(m.a.mark((function a(){var i,o,r;return m.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,i={name:e},o=t.$baseColorfullLoading(),a.next=5,Object(b["downBinary"])("iotapi/product",i);case 5:r=a.sent,dgiotlog.log(r),t.$baseMessage(t.$translateTitle("alert.Data request successfully"),"success","vab-hey-message-success"),o.close(),t.$downBinary(r),a.next=16;break;case 12:a.prev=12,a.t0=a["catch"](0),dgiotlog.log(a.t0),t.$baseMessage(t.$translateTitle("alert.Data request error")+"".concat(a.t0),"error","vab-hey-message-error");case 16:case"end":return a.stop()}}),a,null,[[0,12]])})))()},seeDecoder:function(e){var t=this;return Object(d["a"])(m.a.mark((function a(){return m.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:try{t.ace_editor=S.decode(e.code)}catch(error){dgiotlog.log(error)}case 1:case"end":return a.stop()}}),a)})))()},setTemplate:function(e){var t=this;return Object(d["a"])(m.a.mark((function a(){var i,o,r,s,n,c,l,d,u,p,h,g,f,b,v,y,w,$,I,C,D,j;return m.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=t.$baseColorfullLoading(),o=e.category,r=void 0===o?"IotHub":o,s=e.config,n=void 0===s?{konva:{Stage:{attrs:{x:14,y:29,id:"container",width:1635,height:767,container:"container",draggable:!0},children:[{attrs:{id:"Layer_5SKeJT"},children:[{attrs:{id:"Group_RoT",width:2e3,height:2e3},children:[],className:"Group"},{attrs:{id:"Group_QtGicp",draggable:!0},children:[{attrs:{x:10,y:15,id:"#dgiot-quanyizhongxinbeifen-0-1630891418339",data:"M73.142857 0h877.714286v877.714286H73.142857z",fill:"#FFFFFF",angle:-30,scaleX:.15,scaleY:.15,originX:"center",originY:"bottom",className:"Path"},className:"Path"},{attrs:{x:10,y:15,id:"#dgiot-quanyizhongxinbeifen-1-1630891418339",data:"M877.714286 137.142857A27.428571 27.428571 0 0 1 905.142857 164.571429v201.142857a27.428571 27.428571 0 0 1-27.428571 27.428571l-3.017143 0.091429A45.714286 45.714286 0 0 0 877.714286 484.571429l2.633143 0.128A27.428571 27.428571 0 0 1 905.142857 512v201.142857a27.428571 27.428571 0 0 1-27.428571 27.428572H146.285714A27.428571 27.428571 0 0 1 118.857143 713.142857V512A27.428571 27.428571 0 0 1 146.285714 484.571429l2.998857-0.091429A45.714286 45.714286 0 0 0 146.285714 393.142857l-2.651428-0.128A27.428571 27.428571 0 0 1 118.857143 365.714286V164.571429A27.428571 27.428571 0 0 1 146.285714 137.142857z m-296.100572 138.185143l-69.266285 69.284571-69.266286-69.284571-38.784 38.802286 58.258286 58.258285H402.285714v54.857143h82.285715v39.186286H402.285714v54.857143h82.285715v66.614857h54.857142v-66.614857H621.714286v-54.857143h-82.285715v-39.186286H621.714286v-54.857143h-59.574857l58.276571-58.258285-38.802286-38.802286z",fill:"#111111",angle:-30,scaleX:.15,scaleY:.15,originX:"center",originY:"bottom",className:"Path"},className:"Path"}],className:"Group"}],className:"Layer"}],className:"Stage"}},parser:[],profile:[],basedate:{}}:s,c=e.decoder,l=void 0===c?{code:""}:c,d=e.desc,u=void 0===d?"":d,p=e.icon,h=void 0===p?"":p,g=e.name,f=void 0===g?"":g,b=e.netType,v=void 0===b?"Modbus":b,y=e.nodeType,w=void 0===y?0:y,$=e.thing,I=void 0===$?{properties:[]}:$,a.prev=2,C={},C["*"]={read:!0,write:!0},D={ACL:C,category:r,config:n,decoder:l,desc:u,icon:h,name:f,netType:v,nodeType:w,thing:I},a.next=8,Object(T["postProductTemplet"])(D);case 8:j=a.sent,dgiotlog.log(j),j?t.$baseMessage(t.$translateTitle("user.Save the template successfully"),"success","vab-hey-message-success"):t.$baseMessage(t.$translateTitle("user.Save the template error"),"error","vab-hey-message-error"),i.close(),a.next=19;break;case 14:a.prev=14,a.t0=a["catch"](2),dgiotlog.log(a.t0),i.close(),t.$baseMessage(t.$translateTitle("user.Save the template error"),"error","vab-hey-message-error");case 19:case"end":return a.stop()}}),a,null,[[2,14]])})))()},updatesubdialog:function(){var e=this;return Object(d["a"])(m.a.mark((function t(){var a,i;return m.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.protoldialog=!0,a="1",i={__type:"Pointer",className:"Product",objectId:e.productId},Object(y["getChannelCountByProduct"])(e.channellength,e.channelstart,i,a).then((function(t){e.protolchannel=t.results,e.$refs.multipleTable.toggleAllSelection()})).catch((function(t){dgiotlog.log(t),e.$baseMessage("请求出错",t.error,3e3)}));case 4:case"end":return t.stop()}}),t)})))()},handleSelectionChange:function(e){this.multipleSelection=e},updateAllChannel:function(){var e=this;if(0==this.multipleSelection.length)this.protoldialog=!1;else{var t=[];this.multipleSelection.map((function(e){t.push(new Promise((function(t,a){return Object($["subupadte"])(e.objectId,"update").then((function(e){e&&t(e)})).catch((function(e){a(e)}))})))})),Promise.all(t).then((function(t){e.$message({message:"热加载成功",type:"success"}),t.length==e.multipleSelection.length&&(e.protoldialog=!1)})).catch((function(t){e.$message({message:t,type:"error"})}))}},showAllChannel:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";dgiotlog.log(this.allChannelstart,this.allChannellength),this.allChanneltotal=0,this.allchannelData=[],this.channeltype=1,this.innerVisible=!0;var a={$in:["1","3"]},i={$ne:{__type:"Pointer",className:"Product",objectId:this.productId}};Object(y["getChannelCountByProduct"])(""!=t?this.allChannellength:this.channellength,""!=t?this.allChannelstart:this.channelstart,i,a).then((function(t){e.allChanneltotal=t.count,e.allchannelData=t.results})).catch((function(e){dgiotlog.log(e)}))},getProductChannel:function(){var e=this,t={$in:["1","3"]},a={__type:"Pointer",className:"Product",objectId:this.productId};Object(y["getChannelCountByProduct"])(this.channellength,this.channelstart,a,t).then((function(t){e.channeltotal=t.count,e.channelData=t.results,0==t.results.length})).catch((function(e){dgiotlog.log(e)}))},resourceShowAllChannel:function(){var e=this;this.allChanneltotal=0,this.allchannelData=[],this.channeltype=0,this.innerVisible=!0;var t={$in:["2"]},a={$ne:{__type:"Pointer",className:"Product",objectId:this.productId}};Object(y["getChannelCountByProduct"])(this.channellength,this.channelstart,a,t).then((function(t){e.allChanneltotal=t.count,e.allchannelData=t.results})).catch((function(e){dgiotlog.log(e)}))},getResourceChannel:function(){var e=this,t={$in:["2"]},a={__type:"Pointer",className:"Product",objectId:this.productId};Object(y["getChannelCountByProduct"])(this.channellength,this.channelstart,a,t).then((function(t){e.resourcetotal=t.count,e.resourcechannelData=t.results})).catch((function(e){dgiotlog.log(e)}))},addProductChannel:function(e){var t=this;return Object(d["a"])(m.a.mark((function a(){var i,o;return m.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i={product:{__op:"AddRelation",objects:[{__type:"Pointer",className:"Product",objectId:t.productId}]}},a.next=3,Object(y["saveChanne"])(e,i);case 3:o=a.sent,o&&(t.$message({type:"success",message:"添加成功"}),1==t.channeltype?(t.showAllChannel(),t.getProductChannel()):(t.resourceShowAllChannel(),t.getResourceChannel()));case 5:case"end":return a.stop()}}),a)})))()},deleteRelation:function(e){var t=this,a={product:{__op:"RemoveRelation",objects:[{__type:"Pointer",className:"Product",objectId:this.productId}]}};Object(y["saveChanne"])(e.objectId,a).then((function(e){e&&t.$message({type:"success",message:"移除成功"}),t.getProductChannel(),t.getResourceChannel()}))},channelSizeChange:function(e){this.channellength=e,this.getProductChannel()},channelCurrentChange:function(e){this.channelstart=(e-1)*this.channellength,this.getProductChannel()},resourcechannelSizeChange:function(e){this.resourcelength=e,this.getResourceChannel()},resourcechannelCurrentChange:function(e){this.resourcestart=(e-1)*this.resourcelength,this.getResourceChannel()},allChannelSizeChange:function(e){this.allChannellength=e,this.showAllChannel("Channel")},allChannelCurrentChange:function(e){this.allChannelstart=(e-1)*this.allChannellength,this.showAllChannel("Channel")},customize:function(e){var t=this;this.resourcedialogFormVisible=!0,this.resourcechannelid=e.objectId,A=JSON.parse(JSON.stringify(e.config)),Object(I["setTimeout"])((function(){n=ace.edit("editormodel"),n.session.setMode("ace/mode/json"),n.setTheme("ace/theme/twilight"),n.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),n.setReadOnly(!0),n.setValue(JSON.stringify(t.productdetail.thing,null,4)),c=ace.edit("editorcreate"),c.session.setMode("ace/mode/mysql"),c.setTheme("ace/theme/twilight"),c.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),e.config.datamodel&&""!=e.config.datamodel?c.setValue(e.config.datamodel):c.setValue('{\n            "vars":{\n              "database":"aosong",\n              "stable":"meter",\n              "value":[\n                {\n                  "timestamp":"TIMESTAMP",\n                  "bytes":8\n                },\n                {\n                  "temperature":"FLOAT",\n                  "bytes":4\n                },\n                {\n                  "humidity":"FLOAT",\n                  "bytes":4\n                }\n              ],\n              "tags":[\n                {\n                  "devaddr":"BINARY",\n                  "bytes":12\n                }\n              ],\n              "table":"devaddr",\n              "keep":3650\n            },\n            "sql":{\n              "create_database":"CREATE DATABASE IF NOT EXISTS ${database} KEEP ${keep}",\n              "drop_database":"DROP DATABASE IF EXISTS ${database}",\n              "creat_stable":"CREATE TABLE IF NOT EXISTS ${database}.${stable} (${timestamp} TIMESTAMP, temperature FLOAT, humidity FLOAT) TAGS(devaddr BINARY[12]);",\n              "drop_stable":"DROP TABLE ${database}.${stable}",\n              "insert_stable":"INSERT INTO ${database}.${table} USING ${database}.${stable} TAGS (${devaddr}) VALUES (${temperature}, ${humidity})",\n              "insert_table":"INSERT INTO ${database}.${table} VALUES (${temperature}, ${humidity})",\n              "create_table":"CREATE TABLE ${databas}.${table} USING ${database}.${stable} TAGS (${devaddr});"\n            }\n          }')}))},questionModel:function(){Object(I["setTimeout"])((function(){l=ace.edit("editorinsert"),l.session.setMode("ace/mode/mysql"),l.setTheme("ace/theme/gob"),l.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),l.setValue('{\n          "vars":{\n            "database":"database",\n            "table":"stable",\n            "value":[\n              {\n                "timestamp":"TIMESTAMP",\n                "bytes":8\n              },\n              {\n                "int":"INT",\n                "bytes":4\n              },\n              {\n                "bigint":"BIGINT",\n                "bytes":8\n              },\n              {\n                "float":"FLOAT",\n                "bytes":4\n              },\n              {\n                "double":"DOUBLE",\n                "bytes":8\n              },\n              {\n                "binary":"BINARY",\n                "bytes":"自定义"\n              },\n              {\n                "smallint":"SMALLINT",\n                "bytes":2\n              },\n              {\n                "tinyint":"TINYINT",\n                "bytes":1\n              },\n              {\n                "bool":"BOOL",\n                "bytes":1\n              },\n              {\n                "nchar":"NCHAR",\n                "bytes":"自定义"\n              }\n            ],\n            "tags":[\n              {\n                "int":"INT",\n                "bytes":4\n              },\n              {\n                "bigint":"BIGINT",\n                "bytes":8\n              },\n              {\n                "float":"FLOAT",\n                "bytes":4\n              },\n              {\n                "double":"DOUBLE",\n                "bytes":8\n              },\n              {\n                "binary":"BINARY",\n                "bytes":"自定义"\n              },\n              {\n                "smallint":"SMALLINT",\n                "bytes":2\n              },\n              {\n                "tinyint":"TINYINT",\n                "bytes":1\n              },\n              {\n                "bool":"BOOL",\n                "bytes":1\n              },\n              {\n                "nchar":"NCHAR",\n                "bytes":"自定义"\n              }\n            ]\n          },\n          "sql":{\n            "create_database":"CREATE DATABASE IF NOT EXISTS {{database}} KEEP {{keep}}",\n            "drop_database":"DROP DATABASE IF EXISTS {{database}}",\n            "creat_stable":"CREATE TABLE IF NOT EXISTS {{database}}.{{stable}} ({{timestamp}} TIMESTAMP, temperature FLOAT, humidity FLOAT) TAGS(devaddr BINARY[12]);",\n            "drop_stable":"DROP TABLE {{database}}.{{stable}}",\n            "insert_stable":"INSERT INTO {{database}}.{{table}} USING {{database}}.{{stable}} TAGS ({{devaddr}}) VALUES ({{temperature}}, {{humidity}})",\n            "insert_table":"INSERT INTO {{database}}.{{table}} VALUES ({{temperature}}, {{humidity}})",\n            "create_table":"CREATE TABLE {{database}}.{{table}} USING {{database}}.{{stable}} TAGS ({{devaddr}});"\n          }\n        }')}))},addData:function(){var e=this;A.datamodel=c.getValue();var t={config:A};this.$update_object("Channel",this.rproductdetailesourcechannelid,t).then((function(t){t&&e.$message("添加成功")}),(function(e){Object(j["returnLogin"])(e)}))},closeWuDialog:function(){this.resourcedialogFormVisible=!1,this.resourcechannelid=""},removeDomain:function(e){var t=this.sizeForm.struct.indexOf(e);-1!==t&&this.sizeForm.struct.splice(t,1)},addDomain:function(){this.sizeForm.struct.push({attribute:"",attributevalue:""})},addDas:function(){this.sizeForm.daslist.push({addr:""})},removeDas:function(e){var t=this.sizeForm.daslist.indexOf(e);-1!==t&&this.sizeForm.daslist.splice(t,1)},removeDomain1:function(e){var t=this.structform.specs.indexOf(e);-1!==t&&this.structform.specs.splice(t,1)},addDomain1:function(){this.structform.specs.push({value:"",name:""})},submitForm:function(e){var t=this,a=[];e.daslist.map((function(e){var t=e["addr"];a.push(t)}));var i={name:e.name,devicetype:e.devicetype,dataForm:{round:e.round,data:e.dinumber,address:e.dis,rate:e.rate,offset:e.offset,order:e.order,protocol:e.protocol,operatetype:e.operatetype,originaltype:e.originaltype,slaveid:e.slaveid,collection:e.collection,control:e.control,strategy:e.strategy,iscount:e.iscount,countstrategy:e.countstrategy,countround:e.countround,countcollection:e.countcollection},ico:e.ico,required:!0,accessMode:e.isread,isshow:e.isshow,identifier:e.identifier};if("float"==e.type||"double"==e.type||"int"==e.type||"long"==e.type){var o={dataType:{type:e.type.toLowerCase(),specs:{max:e.endnumber,min:e.startnumber,step:e.step,precision:Number(e.precision),unit:""==e.unit?"":e.unit},das:a}};Object.assign(i,o),this.showNewItem||(delete i.dataForm.operatetype,delete i.dataForm.originaltype,delete i.dataForm.slaveid)}else if("image"==e.type){var r={dataType:{type:e.type.toLowerCase(),imagevalue:e.imagevalue,specs:{},das:a}};Object.assign(i,r)}else if("bool"==e.type){r={dataType:{type:e.type.toLowerCase(),specs:{0:e.false,1:e.true},das:a}};Object.assign(i,r)}else if("enum"==e.type){var s={};e.struct.map((function(e){var t=e["attribute"];s[t]=e["attributevalue"]}));r={dataType:{type:e.type.toLowerCase(),specs:s,das:a}};Object.assign(i,r)}else if("struct"==e.type){r={dataType:{type:e.type.toLowerCase(),specs:e.struct,das:a}};Object.assign(i,r)}else if("text"==e.type){r={dataType:{type:e.type.toLowerCase(),size:e.string,specs:{},das:a}};Object.assign(i,r)}else if("date"==e.type){r={dataType:{type:e.type.toLowerCase(),specs:{},das:a}};Object.assign(i,r)}else if("geopoint"==e.type){r={dataType:{type:e.type.toLowerCase(),gpstype:e.gpstype,specs:{},das:a}};Object.assign(i,r)}delete i.index,dgiotlog.log("obj",i);var n={item:i,productid:this.productId};"新增"==this.wmxSituation?Object(f["postThing"])(n).then((function(e){dgiotlog.log("新增",e),200==e.code?(t.$message({type:"success",message:"新增成功"}),t.getProDetail()):t.$message({type:"warning",message:"新增失败"+e.msg})})):"编辑"==this.wmxSituation&&Object(f["putThing"])(n).then((function(e){dgiotlog.log("编辑",e),200==e.code?(t.$message({type:"success",message:"编辑成功"}),t.getProDetail()):t.$message({type:"warning",message:"编辑失败"+e.msg})})),this.wmxdialogVisible=!1},createProperty:function(){this.setSizeForm(this.getFormOrginalData()),console.log("sizeForm",this.sizeForm),this.wmxdialogVisible=!0,this.wmxSituation="新增"},wmxDataFill:function(e,t){this.modifyIndex=t,this.wmxdialogVisible=!0,this.wmxSituation="编辑";var a={},i=[];if(e.dataType.das.forEach((function(e){i.push({addr:e})})),-1!=["float","double","int","long"].indexOf(e.dataType.type))a={name:e.name,devicetype:e.devicetype,type:e.dataType.type,daslist:i,endnumber:this.$objGet(e,"dataType.specs.max"),startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),precision:this.$objGet(e,"dataType.specs.precision"),dis:this.$objGet(e,"dataForm.address"),round:this.$objGet(e,"dataForm.round"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),slaveid:this.$objGet(e,"dataForm.slaveid"),collection:"",control:"",strategy:"",required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier,editdatatype:!0},e.dataForm&&(a.collection=e.dataForm.collection,a.control=e.dataForm.control,a.strategy=e.dataForm.strategy);else if("bool"==e.dataType.type)a={name:e.name,devicetype:e.devicetype,type:e.dataType.type,true:e.dataType.specs[1],false:e.dataType.specs[0],daslist:i,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!1,ico:e.ico,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0};else if("image"==e.dataType.type)a={name:e.name,devicetype:e.devicetype,type:e.dataType.type,imagevalue:e.dataType.imagevalue,daslist:i,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!1,ico:e.ico,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0};else if("enum"==e.dataType.type){var o=[];for(var r in e.dataType.specs)o.push({attribute:r,attributevalue:e.dataType.specs[r]});a={name:e.name,devicetype:e.devicetype,type:e.dataType.type,specs:e.dataType.specs,struct:o,daslist:i,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0}}else"struct"==e.dataType.type?a={name:e.name,devicetype:e.devicetype,type:e.dataType.type,struct:e.dataType.specs,daslist:i,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,identifier:void 0==e.dataForm?"":e.identifier,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0}:"text"==e.dataType.type?a={name:e.name,devicetype:e.devicetype,type:e.dataType.type,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,string:e.dataType.size,daslist:i,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0}:"date"==e.dataType.type?a={name:e.name,devicetype:e.devicetype,type:e.dataType.type,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,daslist:i,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),order:this.$objGet(e,"dataForm.order"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier,editdatatype:!0}:"geopoint"==e.dataType.type&&(a={name:e.name,devicetype:e.devicetype,type:e.dataType.type,gpstype:e.dataType.gpstype,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,daslist:i,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),order:this.$objGet(e,"dataForm.order"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,identifier:e.identifier,editdatatype:!0});this.setSizeForm(a)},submitStruct:function(e){var t=this;this.$refs[e].validate((function(a){if(a){var i={};if("float"==t.structform.type||"double"==t.structform.type||"int"==t.structform.type)i={name:t.structform.name,dataType:{type:t.structform.type.toLowerCase(),specs:{max:t.structform.endnumber,min:t.structform.startnumber,step:t.structform.step,unit:""==t.structform.unit?"":t.structform.unit}},dataForm:{address:t.structform.dis,data:t.structform.dinumber},required:!0,accessMode:t.structform.isread,identifier:t.structform.identifier};else if("bool"==t.structform.type)i={name:t.structform.name,dataType:{type:t.structform.type.toLowerCase(),specs:{0:t.structform.false,1:t.structform.true}},dataForm:{address:t.structform.dis,data:t.structform.dinumber},required:!1,accessMode:t.structform.isread,identifier:t.structform.identifier};else if("enum"==t.structform.type){var o={};t.structform.struct.map((function(e){var t=e["attribute"];o[t]=e["attributevalue"]})),i={name:t.structform.name,dataType:{type:t.structform.type.toLowerCase(),struct:t.structform.struct,specs:o},dataForm:{address:t.structform.dis,data:t.structform.dinumber},required:!0,accessMode:t.structform.isread,identifier:t.structform.identifier}}else"text"==t.structform.type?i={name:t.structform.name,dataType:{type:t.structform.type.toLowerCase(),size:t.structform.string},dataForm:{address:t.structform.dis,data:t.structform.dinumber},required:!0,accessMode:t.structform.isread,identifier:t.structform.identifier}:"date"==t.structform.type&&(i={name:t.structform.name,dataType:{type:t.structform.type.toLowerCase()},dataForm:{address:t.structform.dis,data:t.structform.dinumber},required:!0,accessMode:t.structform.isread,identifier:t.structform.identifier});-1==t.isupdatedstruct?t.sizeForm.struct.push(i):(t.sizeForm.struct.splice(t.isupdatedstruct,1,i),t.isupdatedstruct=-1),t.$refs[e].resetFields(),t.structdialog=!1}}))},addStruct:function(e){this.structdialog=!0,this.structform={resource:1,identifier:"",type:"int",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",unit:"",specs:[],date:"String类型的UTC时间戳 (毫秒)",string:""}},editStruct:function(e,t){var a=this;if(dgiotlog.log(e,t),this.isupdatedstruct=t,this.structdialog=!0,this.structform.type=e.dataType.type.toUpperCase(),this.structform.name=e.name,this.structform.identifier=e.identifier,this.structform.isread=e.accessMode,"float"==e.dataType.type||"double"==e.dataType.type||"int"==e.dataType.type)this.structform.startnumber=e.dataType.specs.min,this.structform.endnumber=e.dataType.specs.max,this.structform.step=e.dataType.specs.step,this.structform.unit=e.dataType.specs.unit;else if("bool"==e.dataType.type)this.structform.true=e.dataType.specs["1"],this.structform.false=e.dataType.specs["0"];else if("enum"==e.dataType.type){this.structform.specs=[];var i={};Object.keys(e.dataType.specs).forEach((function(t,o){i.attribute=t,i.attributevalue=e.dataType.specs[t],a.structform.specs.push(i)}))}else"text"==e.dataType.type&&(this.structform.string=e.dataType.size)},deleteStruct:function(e){this.sizeForm.struct.splice(e,1)},preserve:function(){var e=this,t={thing:JSON.parse(o.getValue())};this.$update_object("Product",this.productId,t).then((function(t){t&&(e.$message({type:"success",message:"添加成功"}),e.schemadialogVisible=!1)})).catch((function(e){dgiotlog.log(e)}))},Industry:function(){var e=this;return Object(d["a"])(m.a.mark((function t(){var a,i;return m.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.option=[],t.next=3,e.$getIndustry("category",100);case 3:a=t.sent,i=a.results,i.map((function(t){var a={};a.value=t.type,a.label=t.data.CategoryName,a.id=t.data.Id,a.parentid=t.data.SuperId,e.option.push(a)})),e.getProDetail();case 7:case"end":return t.stop()}}),t)})))()},utc2beijing:function(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},getPropData:function(e){var t=this;0==e&&(this.productstart=0),this.CategoryKey=this.$route.query.CategoryKey;var a={count:"objectId",limit:this.productlength,skip:this.productstart,where:{"data.key":"category"}};0!=this.category.length&&(a.where.type=this.category[this.category.length-1]),Object(v["getDictCount"])(a).then((function(e){t.producttotal=e.count,t.PropData=e.results})).catch((function(e){dgiotlog.log(e)}))},productSizeChange:function(e){this.productlength=e,this.getPropData()},productCurrentChange:function(e){this.productstart=(e-1)*this.productlength,this.getPropData()},checkAddTest:function(){var e=this;this.collectionDialogVisible=!0,this.editableTabsValue=this.wmxData[0].identifier,this.activeIndex=this.wmxData[0].identifier,this.editableTabs=[],this.editorList=[],this.tabIndex=1,this.ed3isShow=!1,this.editableTabs.push({title:this.wmxData[0].identifier,name:this.wmxData[0].identifier,leftItemPos:0,content:void 0==this.wmxData[0].dataForm?"":this.wmxData[0].dataForm.collection}),0==this.ed3isShow&&Object(I["setTimeout"])((function(){e.editorList.push(ace.edit(e.wmxData[0].identifier)),e.editorList[0].session.setMode("ace/mode/erlang"),e.editorList[0].setTheme("ace/theme/monokai"),e.editorList[0].setHighlightActiveLine(!0),e.editorList[0].setFontSize(20),e.editorList[0].setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),e.ed3isShow=!0,e.editorList[0].setValue(void 0==e.wmxData[0].dataForm?"":e.wmxData[0].dataForm.collection)}),1)},handleRightTopTabClick:function(e,t){this.activeIndex=e.label},menuTabClick:function(e,t){var a=this;this.activeIndex=e.identifier;var i=this.editableTabs,o=!1,r=0;i.forEach((function(t,a){t.name===e.identifier&&(o=!0,r=a)})),0==o?(this.editableTabs.push({title:e.identifier,name:e.identifier,leftItemPos:t,content:void 0==e.dataForm?"":e.dataForm.collection}),Object(I["setTimeout"])((function(){a.editorList.push(ace.edit(e.identifier)),a.editorList[a.editorList.length-1].session.setMode("ace/mode/erlang"),a.editorList[a.editorList.length-1].setTheme("ace/theme/monokai"),a.editorList[a.editorList.length-1].setHighlightActiveLine(!0),a.editorList[a.editorList.length-1].setFontSize(20),a.editorList[a.editorList.length-1].setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),a.editorList[a.editorList.length-1].setValue(void 0==e.dataForm?"":e.dataForm.collection)}),1),this.editableTabsValue=e.identifier,this.rightCollection=void 0==e.dataForm?"":e.dataForm.collection):(this.editableTabsValue=e.identifier,this.editorList[r].setValue(void 0==e.dataForm?"":e.dataForm.collection))},removeTab:function(e){var t=this.editableTabs,a=this.editableTabsValue;a===e&&t.forEach((function(i,o){if(i.name===e){var r=t[o+1]||t[o-1];r&&(a=r.name)}})),this.editableTabsValue=a,this.activeIndex=a,this.editableTabs=t.filter((function(t){return t.name!==e}))},onSaveTap:function(e){var t=this,a=this.editableTabs[e].leftItemPos;this.productdetail.thing.properties[a].dataForm.collection=this.editorList[e].getValue();var i={thing:this.productdetail.thing};this.$update_object("Product",this.productId,i).then((function(e){e&&(t.$message({type:"success",message:"添加成功"}),t.getProDetail())})).catch((function(e){dgiotlog.log(e)}))},handleCloseCollecttion:function(e){this.$confirm("确认关闭？").then((function(t){e()})).catch((function(e){}))},onReductionTap:function(e){var t=this.editableTabs[e].leftItemPos;this.editorList[e].setValue(this.wmxData[t].dataForm.collection)},checkschema:function(){var e=this;this.schemadialogVisible=!0,Object(I["setTimeout"])((function(){o=ace.edit("editor1"),o.session.setMode("ace/mode/json"),o.setTheme("ace/theme/eclipse"),o.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),o.setValue(JSON.stringify(e.productdetail.thing,null,4))}),1)},getProDetail:function(){var e=this;i=ace.edit("editor"),i.session.setMode("ace/mode/erlang"),i.setTheme("ace/theme/monokai"),i.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.productId=this.$route.query.id,this.queryDeviceCount(this.productId),this.$get_object("Product",this.productId).then((function(t){if(dgiotlog.log("response",t),t){for(var a in e.productInfo=_.merge(t,{decoder:{code:""},thing:{properties:[]},config:{parser:[],profile:[],basedate:{params:[]}}}),e.productName=t.name,t)e.productdetail[a]=t[a];e.option.map((function(t){e.productdetail.category==t.value&&(e.productdetail.category=t.label)})),e.productdetail.createdAt=e.utc2beijing(t.createdAt),e.productdetail.id=t.id,e.dynamicReg=t.dynamicReg,e.productdetail.isshow=0,e.productdetail.category&&e.$get_object("Category",e.productdetail.category.objectId).then((function(t){dgiotlog.log("catcat",t),e.$set(e.productdetail,"categoryname",t.name)})),e.form.Productname=t.name,e.ProductSecret=t.productSecret,e.form.Productkey=e.productId,e.productimg=t.icon,t.decoder?(F=t.decoder.code,e.formInline.name=t.decoder.name,e.formInline.version=t.decoder.version,e.formInline.desc=t.decoder.desc):F="JSUlLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQolJSUgQGNvcHlyaWdodCAoQykgMjAxOCwgPHNodXdhPgolJSUgQGRvYwolJSUg5Y2P6K6u6Kej5p6QRGVtbwolJSUgQGVuZAolJSUgQ3JlYXRlZCA6IDA4LiDljYHkuIDmnIggMjAxOCAxNDo0OQolJSUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi1tb2R1bGUoc2h1d2FfZGVtb19kZWNvZGVyKS4KLWF1dGhvcigic2h1d2EiKS4KLWRlZmluZShNU0dfVFlQRSwgPDwiREVNTyI+PikuCi1wcm90b2NvbChbPDwiREVNTyI+Pl0pLgoKLWV4cG9ydChbcGFyc2VfZnJhbWUvMiwgdG9fZnJhbWUvMV0pLgoKCnBhcnNlX2ZyYW1lKEJ1ZmYsIE9wdHMpIC0+CiAgICBwYXJzZV9mcmFtZShCdWZmLCBbXSwgT3B0cykuCgoKcGFyc2VfZnJhbWUoPDw+PiwgQWNjLCBfT3B0cykgLT4KICAgIHs8PD4+LCBBY2N9OwpwYXJzZV9mcmFtZSg8PDE2IzY4LCBSZXN0L2JpbmFyeT4+ID0gQmluLCBBY2MsIF9PcHRzKSB3aGVuIGJ5dGVfc2l6ZShSZXN0KSA9PCA2IC0+CiAgICB7QmluLCBBY2N9OwpwYXJzZV9mcmFtZSg8PDE2IzY4LCBMZW46MTYvbGl0dGxlLWludGVnZXIsIExlbjoxNi9saXR0bGUtaW50ZWdlciwgMTYjNjgsIFJlc3QvYmluYXJ5Pj4gPSBCaW4sIEFjYywgT3B0cykgLT4KICAgIGNhc2UgYnl0ZV9zaXplKFJlc3QpIC0gMiA+PSBMZW4gb2YKICAgICAgICB0cnVlIC0+CiAgICAgICAgICAgIGNhc2UgUmVzdCBvZgogICAgICAgICAgICAgICAgPDxVc2VyWm9uZTpMZW4vYnl0ZXMsIENyYzo4LCAxNiMxNiwgUmVzdDEvYmluYXJ5Pj4gLT4KICAgICAgICAgICAgICAgICAgICBBY2MxID0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBzaHV3YV91dGlsczpnZXRfcGFyaXR5KFVzZXJab25lKSA9Oj0gQ3JjIG9mCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlIC0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRnJhbWUgPSAjewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8PCJtc2d0eXBlIj4+ID0+ID9NU0dfVFlQRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPDwiZGF0YSI+PiA9PiBVc2VyWm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWNjICsrIFtGcmFtZV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSAtPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFjYwogICAgICAgICAgICAgICAgICAgICAgICBlbmQsCiAgICAgICAgICAgICAgICAgICAgcGFyc2VfZnJhbWUoUmVzdDEsIEFjYzEsIE9wdHMpOwogICAgICAgICAgICAgICAgXyAtPgogICAgICAgICAgICAgICAgICAgIHBhcnNlX2ZyYW1lKFJlc3QsIEFjYywgT3B0cykKICAgICAgICAgICAgZW5kOwogICAgICAgIGZhbHNlIC0+CiAgICAgICAgICAgIHtCaW4sIEFjY30KICAgIGVuZDsKcGFyc2VfZnJhbWUoPDxfOjgsIFJlc3QvYmluYXJ5Pj4sIEFjYywgT3B0cykgLT4KICAgIHBhcnNlX2ZyYW1lKFJlc3QsIEFjYywgT3B0cykuCgoKJSUg57uE6KOF5oiQ5bCB5YyFLCDlj4LmlbDkuLpNYXDlvaLlvI8KdG9fZnJhbWUoI3s8PCJtc2d0eXBlIj4+IDo9ID9NU0dfVFlQRX0gPSBGcmFtZSkgLT4KICAgIFBheWxvYWQgPSB0ZXJtX3RvX2JpbmFyeShGcmFtZSksCiAgICA8PDE2IzAzLCBQYXlsb2FkL2JpbmFyeSwgMTYjMjM+Pi4=",void 0!=e.productdetail.thing&&"{}"!=JSON.stringify(e.productdetail.thing)||(e.productdetail.thing={properties:[]}),e.wmxData=[],e.wmxDataBk=[],e.wmxData=e.productdetail.thing.properties.filter((function(e,t){return e.index=t,e.name&&e.dataType})),e.wmxDataBk=e.wmxData,dgiotlog.log("=====",e.wmxData),e.wmxDataBk.forEach((function(t){if(t.devicetype){var a={name:t.devicetype};e.FromMachine.push(a)}})),e.FromMachine=_.uniqBy(e.FromMachine,"name"),i.setValue(S.decode(F)),i.gotoLine(i.session.getLength())}})).catch((function(t){dgiotlog.log("err",t),e.$baseMessage("请求出错",t.error,3e3)}))},queryDeviceCount:function(e){var t=this;return Object(d["a"])(m.a.mark((function a(){return m.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(g["getDeviceCountByProduct"])(e);case 2:t.form.ProductAll=a.sent;case 3:case"end":return a.stop()}}),a)})))()},handelUpdate:function(e,t){var a,i=this;a=1!=e,this.dynamicReg=a;var o={dynamicReg:!a};this.$update_object("Product",this.productId,o).then((function(e){e&&(i.$message({type:"success",message:"修改成功"}),i.dynamicReg=!a)})).catch((function(e){dgiotlog.log(e)}))},wmxhandleClose:function(){this.wmxdialogVisible=!1,this.setSizeForm(this.getFormOrginalData())},protol:function(){var e=this,t="";Object($["Compile"])(S.encode(i.getValue())).then((function(a){a&&(e.$message({type:"success",message:"编译成功"}),t="编译成功"+a.mod+"\r\n",e.warningeditror=a.warnings,e.warningeditror.map((function(e){t+=e+"\r\n"})),k+=t,r.setValue(k))})).catch((function(a){e.warningeditror=a.error,e.warningeditror.map((function(e){t+=e+"\r\n"})),k+=t,r.setValue(k)}))},decoderSizeChange:function(e){this.decoder.length=e,this.chaxun()},devicerCurrentChange:function(e){this.decoderstart=(e-1)*this.decoderlength,this.chaxun()},deletedata:function(e){var t=this;this.$del_object("Dict",e).then((function(e){e&&(t.$message("成功删除"),t.chaxun())})).catch((function(e){dgiotlog.log(e)}))},subAce:function(e,t){var a=this;this.$refs[e].validate((function(e){if(e){var o={name:a.formInline.name,version:a.formInline.version,code:S.encode(i.getValue()),desc:a.formInline.desc},s={decoder:o};a.$update_object("Product",a.productId,s).then((function(e){0==a.issub&&(a.$message({type:"success",message:"保存成功"}),1==t&&(k+="保存成功",r.setValue(k))),a.issub=!0})).catch((function(e){dgiotlog.log(e)}))}else a.$message({type:"warning",message:"输入格式有误"})}))},subAce1:function(e){var t=this;this.$refs[e].validate((function(e){if(e){var a={where:{"data.name":t.formInline.name,"data.version":t.formInline.version}};t.$query_object("Dict",a).then((function(e){e.results&&e.results.length>=1?t.$message("此协议版本已存在"):t.$get_object("Product",t.productId).then((function(e){if(e){var a={name:t.formInline.name,version:t.formInline.version,code:S.encode(i.getValue()),desc:t.formInline.desc},o={key:t.formInline.name+":"+t.formInline.version,type:"decoder",data:a,ACL:e.ACL};t.$create_object("Dict",o).then((function(e){e.error?t.$message({type:"error",message:e.error}):t.$message({type:"success",message:"保存到公共协议库成功"})})).catch((function(e){dgiotlog.log(e)}))}}))})).catch((function(e){dgiotlog.log(e)}))}else t.$message({type:"warning",message:"输入格式有误"})}))},updatesub:function(e){var t=this;Object($["subupadte"])(e.objectId,"update").then((function(e){e&&t.$message("重载成功")})).catch((function(e){t.$message(e.error)}))},chaxun:function(){var e=this,t={count:"objectId",skip:this.decoderstart,limit:this.decoderlength,where:{type:"decoder"}};this.dialogTableVisible=!0,this.$query_object("Dict",t).then((function(t){t&&(e.decodertotal=t.count,e.gridData=t.results)})).catch((function(e){dgiotlog.log(e)}))},editordata:function(e){this.formInline.name=e.data.name,this.formInline.version=e.data.version,this.formInline.desc=e.data.desc,this.formInline.resource=e.data.enable,i.setValue(S.decode(e.data.code)),this.dialogTableVisible=!1},goToDevices:function(){this.$router.push({path:"/roles/thing",query:{productid:this.productId}})},addcategory:function(){this.originwmx=!0,this.getPropData()},addMachine:function(){this.machineForm={},this.machine=!0,this.machinestatus="add"},savemachine:function(e){"edit"==this.machinestatus?this.FromMachine[this.machineindex]=e:this.FromMachine.push(e),this.machine=!1},clickmachine:function(e,t,a){"ALL"==e.name?this.wmxData=this.wmxDataBk:(this.devicetype=e.name,this.wmxData=this.wmxDataBk.filter((function(t){return t.devicetype==e.name})),this.wmxstart=1)},handleChange:function(e,t,a){},TypeInstall:function(e,t){t.map((function(t,a){if("enum"==t.DataType||"bool"==t.DataType){var i={dataType:{specs:{}}};i.name=t.Name,i.dataType.type=t.DataType,i.required=t.Required,i.identifier=t.Identifier,i.accessMode=1==t.RwFlag?"r":"rw",JSON.parse(t.DataSpecsList).map((function(e){for(var t in e){var a=e["value"],o=e["name"];i.dataType.specs[a]=o}})),e.push(i)}else if("double"==t.DataType||"int"==t.DataType||"float"==t.DataType){i={dataType:{specs:{}}};for(var o in i.name=t.Name,i.dataType.type=t.DataType,i.required=t.Required,i.identifier=t.Identifier,i.accessMode=1==t.RwFlag?"r":"rw",JSON.parse(t.DataSpecs))i.dataType.specs.min=JSON.parse(t.DataSpecs)["min"],i.dataType.specs.max=JSON.parse(t.DataSpecs)["max"],i.dataType.specs.step=JSON.parse(t.DataSpecs)["step"],i.dataType.specs.unit=JSON.parse(t.DataSpecs)["unit"];e.push(i)}else if("struct"==t.DataType){var r={dataType:{specs:[]}};r.name=t.Name,r.dataType.type=t.DataType,r.required=!t.Required,r.identifier=t.Identifier,r.accessMode=1==t.RwFlag?"r":"rw",JSON.parse(t.DataSpecsList).map((function(e){if("enum"==e.childDataType||"bool"==e.childDataType){var t={dataType:{specs:{}}};t.name=e.childName,t.dataType.type=e.childDataType.toLowerCase(),t.required=e.Required,t.identifier=e.identifier,t.accessMode=1==e.RwFlag?"r":"rw",e.childEnumSpecsDTO.map((function(e){for(var a in e){var i=e["value"],o=e["name"];t.dataType.specs[i]=o}})),r.dataType.specs.push(t)}else if("double"==e.childDataType||"int"==e.childDataType||"float"==e.childDataType){t={dataType:{specs:{}}};for(var a in t.name=e.childName,t.dataType.type=e.childDataType.toLowerCase(),t.required=e.Required,t.identifier=e.identifier,t.accessMode=1==e.RwFlag?"r":"rw",e.childSpecsDTO)t.dataType.specs.min=e.childSpecsDTO["min"],t.dataType.specs.max=e.childSpecsDTO["max"],t.dataType.specs.step=e.childSpecsDTO["precise"],t.dataType.specs.unit=e.childSpecsDTO["unit"];r.dataType.specs.push(t)}})),e.push(r)}}));var a={};e=e.reduce((function(e,t){return!a[t.identifier]&&(a[t.identifier]=e.push(t)),e}),[])},addProCategory:function(e){var t=this,a={where:{type:e.type,"data.key":"detail"}};this.$query_object("Dict",a).then((function(e){var a=e.results;if(a&&a[0].data.Ability){t.TypeInstall(t.productdetail.thing.properties,a[0].data.Ability);var i={thing:t.productdetail.thing};t.$update_object("Product",t.productId,i).then((function(e){e&&(t.$message({type:"success",message:"添加成功"}),t.getProDetail())})).catch((function(e){dgiotlog.log(e)}))}else dgiotlog.log("此选项没有属性功能")}))},deletewmx:function(e){var t=this,a={productid:this.productId,item:e};Object(f["deleteThing"])(a).then((function(e){dgiotlog.log("删除",e),200==e.code?(t.$message({type:"success",message:"删除成功"}),t.getProDetail()):t.$message({type:"warning",message:"删除失败 "+e.msg})}))},wmxSizeChange:function(e){this.wmxstart=1,this.wmxPageSize=e},wmxCurrentChange:function(e){this.wmxstart=e},nowtime:function(){var e=Date.parse(new Date),t=new Date(e),a=(t.getFullYear(),t.getMonth()+1<=10?t.getMonth():t.getMonth(),t.getDate()+1<=10?t.getDate():t.getDate(),(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":"),i=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",o=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return a+i+o+" "},subProTopic:function(e){this.subdialog=!0,this.subdialogid=e.objectId,this.channelname=e.objectId,Object(I["setTimeout"])((function(){s=ace.edit("subdialog"),s.session.setMode("ace/mode/text"),s.setTheme("ace/theme/gob"),s.setReadOnly(!0),s.setOptions({enableBasicAutocompletion:!1,enableSnippets:!0,enableLiveAutocompletion:!0})}));var t={topic:"log/channel/"+e.objectId+"/"+this.productId,qos:2},a=new RegExp("log/channel/"+e.objectId+"/"+this.productId),i="",o=this;C["Websocket"].add_hook(a,(function(e){s.session.getLength()>=1e3?i="":i+=o.nowtime()+e+"\n",s.setValue(i),s.gotoLine(s.session.getLength())}));var r=JSON.stringify({action:"start_logger"});C["Websocket"].subscribe(t,(function(t){if(t.result){var a={topic:"channel/"+e.objectId+"/"+o.productId,text:r,retained:!0,qos:2};C["Websocket"].sendMessage(a),o.subdialogtimer=window.setInterval((function(){C["Websocket"].sendMessage(a)}),6e5)}}))},handleCloseSubdialog:function(){var e=JSON.stringify({action:"stop_logger"}),t={topic:"channel/"+this.subdialogid+"/"+this.productId,text:e,retained:!0,qos:2};C["Websocket"].sendMessage(t),this.subdialog=!1,window.clearInterval(this.subdialogtimer),this.subdialogtimer=null},stopsub:function(e){var t;t=0==e?JSON.stringify({action:"stop_logger"}):JSON.stringify({action:"start_logger"});var a={topic:"channel/"+this.subdialogid+"/"+this.productId,text:t,retained:!0,qos:2};C["Websocket"].sendMessage(a)},subTopic:function(e,t){var a=this;this.$refs[e].validate((function(i){if(!i)return dgiotlog.log("error submit!!"),!1;var o="thing/"+a.productId+"/${DevAddr}/"+a.topicform.topic;a.$get_object("Product",a.productId).then((function(i){var r={topic:o,type:a.topicform.type,desc:a.topicform.desc},s=[];s.push(r);var n={};if(-1==t)s=s.concat(i.topics),n.topics=s;else{var c=i.topics.concat([]);c[t]=r,n.topics=c}a.$update_object("Product",a.productId,n).then((function(t){t&&(a.$message({type:"success",message:"成功"}),a.topicdialogVisible=!1,a.$refs[e].resetFields(),a.topicform.isupdated=-1,a.topicform.topic="",a.topicform.desc="",a.handleClick({name:"second"}))})).catch((function(e){dgiotlog.log(e)}))}))}))},topicSizeChange:function(e){this.topicstart=1,this.topiclength=e},topicCurrentChange:function(e){this.topicstart=e},updatetopic:function(e,t){this.topicform.topic=e.topic.substr(e.topic.lastIndexOf("/")+1),this.topicform.type=e.type,this.topicform.desc=e.desc,this.topicdialogVisible=!0,this.topicform.isupdated=t},deletetopic:function(e,t){var a=this;return Object(d["a"])(m.a.mark((function e(){var i,o,r,s;return m.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.$get_object("Product",a.productId);case 2:i=e.sent,o=i.topics,o&&(r=o.concat([]),r.splice(t,1),s={topics:r},a.$update_object("Product",a.productId,s),a.$message({type:"success",message:"删除成功"})),a.getTopic();case 6:case"end":return e.stop()}}),e)})))()},orginRule:function(){var e=this;Object(w["getRule"])().then((function(t){t&&(e.engineData=t)})).catch((function(t){e.$message(t.error)}))},handleSizeChange:function(e){},handleCurrentChange:function(e){},addEngine:function(){this.$router.push({path:"/rules_engine/addengine",query:{title:"新增",productid:this.productId}})},actions:function(e){var t=[];return e.map((function(e){t.push(e.name)})),t.join(",")},getRowindex:function(e,t,a){if(0==e.columnIndex)return"firstcolumn"},detailRules:function(e){this.$router.push({path:"/rules_engine/checkengine",query:{id:e}})}})};t["a"]=O}}]);