name: oss
on:
  push:
    branches:
      - master
jobs:
  oss:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout master
        uses: actions/checkout@v2
        with:
          ref: master
      - name: Compress resources
        run: |
          apt-get install zip
          apt-get install rar
          tar -cvf assets.tar public/assets/
          tar -zcvf assets.tar.gz public/assets/
          zip  assets.zip public/assets/
          rar a assets.rar public/assets/
          mv assets.tar assets.tar.gz assets.zip  assets.rar -t public/assets/
      - name: Upload COS
        uses: zkqiang/tencent-cos-action@v0.1.0
        with:
          # https://github:com/marketplace/actions/tencent-cos-action:
          # https://cloud.tencent.com/document/product/436/10976#.E6.8C.87.E5.AE.9A-bucket-.E5.92.8C-region-.E7.9A.84.E5.91.BD.E4.BB.A4
          args: delete -r -f /dgiot_release/dashboardCdn/public/assets/ && upload -r ./public/assets/ /dgiot_release/dashboardCdn/public/assets/
          secret_id: ${{ secrets.SECRET_ID }}
          secret_key: ${{ secrets.SECRET_KEY }}
          bucket: ${{ secrets.BUCKET }}
          region: ap-shanghai-fsi
